<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Gollum - Git-based Markdown wiki | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2021/01/07/gollum-markdown-wiki/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="" />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2021/01/07/gollum-markdown-wiki/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="Gollum - Git-based Markdown wiki">
  <meta property="og:description" content="We needed to create an internal knowledge base, preferably based on a wiki-engine. The requirements were:
in-house hosting simple maintenance no vendor-lock - ideally, storing articles as plain-text files customization and styling not overloaded with gigabytes of fancy JS-frameworks version control Markdown markup From my own researching and evaluating, there are very few wikis that meet all the requirements, and out of those Gollum seems to be the best.
Even though it has its own installation guide, for me that wasnâ€™t enough, so here are my guides for Linux and Mac OS, plus some customizing and tweaking.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2021-01-07T13:30:42+01:00">
    <meta property="article:modified_time" content="2021-01-07T13:30:42+01:00">
    <meta property="article:tag" content="Web">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Macos">
    <meta property="article:tag" content="Devops">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2021/01/07/gollum-markdown-wiki/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Gollum - Git-based Markdown wiki</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2021-01-07 13:30:42 &#43;0100</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 18 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>We needed to create an internal knowledge base, preferably based on a wiki-engine. The requirements were:</p>
<ul>
<li>in-house hosting</li>
<li>simple maintenance</li>
<li>no vendor-lock - ideally, storing articles as plain-text files</li>
<li>customization and styling</li>
<li>not overloaded with gigabytes of fancy JS-frameworks</li>
<li>version control</li>
<li>Markdown markup</li>
</ul>
<p>From my own researching and evaluating, there are very few wikis that meet all the requirements, and out of those <a href="https://en.wikipedia.org/wiki/Gollum_Wiki">Gollum</a> seems to be the best.</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/gollum-markdown.png" alt="Gollum wiki (original picture: https://www.deviantart.com/aronimo717/art/Hobbit-Gollum-431742580)">

<p>Even though it has its own <a href="https://github.com/gollum/gollum/wiki/Installation">installation guide</a>, for me that wasn&rsquo;t enough, so here are my guides for Linux and Mac OS, plus some customizing and tweaking.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#installation">Installation</a>
      <ul>
        <li><a href="#gnulinux">GNU/Linux</a>
          <ul>
            <li><a href="#packages">Packages</a></li>
            <li><a href="#user-and-repository">User and repository</a></li>
            <li><a href="#templates">Templates</a></li>
            <li><a href="#config">Config</a></li>
            <li><a href="#systemd">systemd</a></li>
            <li><a href="#nginx">NGINX</a></li>
          </ul>
        </li>
        <li><a href="#mac-os">Mac OS</a></li>
      </ul>
    </li>
    <li><a href="#editing-and-authentication">Editing and authentication</a>
      <ul>
        <li><a href="#web-ui">Web UI</a></li>
        <li><a href="#local-editing">Local editing</a>
          <ul>
            <li><a href="#establish-ssh-connection-to-the-wiki-host">Establish SSH connection to the wiki host</a></li>
            <li><a href="#clone-the-wiki-repository">Clone the wiki repository</a></li>
            <li><a href="#run-gollum">Run Gollum</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#customization">Customization</a>
      <ul>
        <li><a href="#css-and-js">CSS and JS</a></li>
        <li><a href="#header-footer-sidebar">Header, footer, sidebar</a></li>
      </ul>
    </li>
    <li><a href="#a-bit-about-features">A bit about features</a></li>
    <li><a href="#ldap-authentication">LDAP authentication</a>
      <ul>
        <li><a href="#setting-up-omniauth-in-gollum">Setting up omniauth in Gollum</a>
          <ul>
            <li><a href="#filtering-out-disabled-users">Filtering out disabled users</a></li>
          </ul>
        </li>
        <li><a href="#customizing-authentication-views">Customizing authentication views</a></li>
        <li><a href="#unprotecting-rss-feed">Unprotecting RSS feed</a></li>
      </ul>
    </li>
  </ul>
</nav>
<p>At first, before discovering Gollum, I actually decided to create my own wiki-engine, as I didn&rsquo;t like any of the wikis I found by that moment, and even started prototyping it with <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/">.NET Core Blazor</a> (<em>server-side variant</em>). But then I took a closer look at Gollum and abandoned the idea.</p>
<p><a href="https://github.com/gollum/gollum">Gollum</a> has it all:</p>
<ul>
<li>no mandatory &ldquo;cloud&rdquo;, host it anywhere you want, even locally</li>
<li>very simple maintenance, especially comparing to Confluence, Redmine, MediaWiki and similar ones that require a database</li>
<li>articles source is plain-text files, so you own your knowledge base and free to migrate to something else</li>
<li>good customization, including custom CSS and JS</li>
<li>version control is in its nature, as content lives in a Git repository</li>
<li>Markdown (<em>and <a href="https://github.com/gollum/gollum#markups">additional markups</a></em>)</li>
</ul>
<p>By the way, Gollum is what is running wikis on GitHub and GitLab, so you can actually clone wikis from there and run them locally on your machine.</p>
<h1 id="installation">Installation</h1>
<h2 id="gnulinux">GNU/Linux</h2>
<p>The goal is to run Gollum behind <a href="#nginx">NGINX</a> as a reverse proxy, available at <a href="http://wiki.your.host">http://wiki.your.host</a>.</p>
<h3 id="packages">Packages</h3>
<p>Install required packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo apt install ruby ruby<span style="color:#f92672">-</span>dev make zlib1g<span style="color:#f92672">-</span>dev libicu<span style="color:#f92672">-</span>dev build<span style="color:#f92672">-</span>essential git cmake
</span></span><span style="display:flex;"><span>$ sudo apt install zlib1g zlib1g<span style="color:#f92672">-</span>dev libicu<span style="color:#f92672">-</span>dev
</span></span><span style="display:flex;"><span>$ sudo apt install pkg<span style="color:#f92672">-</span>config
</span></span><span style="display:flex;"><span>$ sudo apt install libssl<span style="color:#f92672">-</span>dev</span></span></code></pre></div>
<p>and then Gollum gem itself:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo gem install gollum</span></span></code></pre></div>
<h3 id="user-and-repository">User and repository</h3>
<p>Create a user to run the wiki from:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ sudo adduser --shell /bin/bash --gecos <span style="color:#e6db74">&#39;Gollum application&#39;</span> gollum</span></span></code></pre></div>
<p>Login as this user and create the wiki folder, initialize the Git repository and set the default commits author:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo <span style="color:#f92672">--</span>login <span style="color:#f92672">--</span>user gollum
</span></span><span style="display:flex;"><span>$ mkdir wiki
</span></span><span style="display:flex;"><span>$ cd wiki
</span></span><span style="display:flex;"><span>$ git init <span style="color:#f92672">--</span>bare <span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>$ git config user<span style="color:#f92672">.</span>name <span style="color:#e6db74">&#34;birdperson&#34;</span>
</span></span><span style="display:flex;"><span>$ git config user<span style="color:#f92672">.</span>email <span style="color:#e6db74">&#34;birdperson@your.host&#34;</span>
</span></span><span style="display:flex;"><span>$ exit</span></span></code></pre></div>
<p>Note the <code>--bare</code> option - it is required for users to be able to use this repository as a remote for their local cloned repository, so they could push their commits to it.</p>
<h3 id="templates">Templates</h3>
<p>Gollum uses <a href="https://mustache.github.io/">Mustache</a> system for templating. If you&rsquo;d like to customize default wiki layouts by modifying Gollum&rsquo;s base templates, don&rsquo;t edit the default ones - make a copy and work with the copies instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ mkdir -p /usr/local/share/gollum/templates
</span></span><span style="display:flex;"><span>$ cp -r /var/lib/gems/2.7.0/gems/gollum-VERSION/lib/gollum/templates/* /usr/local/share/gollum/templates/
</span></span><span style="display:flex;"><span>$ sudo chown -R gollum:gollum /usr/local/share/gollum</span></span></code></pre></div>
<p>You&rsquo;ll also need to set this path in the <a href="#config">config</a> or specify it on launch:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gollum <span style="color:#f92672">--</span>config config<span style="color:#f92672">.</span>rb <span style="color:#f92672">--</span>host localhost \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>template<span style="color:#f92672">-</span>dir <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>your<span style="color:#f92672">/</span>custom<span style="color:#f92672">/</span>templates</span></span></code></pre></div>
<h3 id="config">Config</h3>
<p>Create the wiki config:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo mkdir <span style="color:#f92672">-</span>p <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>gollum
</span></span><span style="display:flex;"><span>$ sudo nano <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>gollum<span style="color:#f92672">/</span>config<span style="color:#f92672">.</span>rb</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># define the wiki options</span>
</span></span><span style="display:flex;"><span>wiki_options <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:h1_title</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:user_icons</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;gravatar&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:live_preview</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:allow_uploads</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:per_page_uploads</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:allow_editing</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:css</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:js</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:mathjax</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:emoji</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:show_all</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:template_dir</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/usr/local/share/gollum/templates&#39;</span> <span style="color:#75715e"># if you have custom templates</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pass wiki options to the Gollum app</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Precious</span><span style="color:#f92672">::</span><span style="color:#66d9ef">App</span><span style="color:#f92672">.</span>set(<span style="color:#e6db74">:wiki_options</span>, wiki_options)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># if present, undefine the :FORMAT_NAMES constant to avoid the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;already initialized constant FORMAT_NAMES&#34; warning</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Gollum</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Page</span><span style="color:#f92672">.</span>send <span style="color:#e6db74">:remove_const</span>, <span style="color:#e6db74">:FORMAT_NAMES</span> <span style="color:#66d9ef">if</span> defined? <span style="color:#66d9ef">Gollum</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Page</span><span style="color:#f92672">::</span><span style="color:#66d9ef">FORMAT_NAMES</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># redefine the :FORMAT_NAMES constant to limit the available</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># formats on the editor to only markdown</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Gollum</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Page</span><span style="color:#f92672">::</span><span style="color:#66d9ef">FORMAT_NAMES</span> <span style="color:#f92672">=</span> { <span style="color:#e6db74">:markdown</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Markdown&#34;</span> }</span></span></code></pre></div>
<h3 id="systemd">systemd</h3>
<p>Create a systemd service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo nano <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>systemd<span style="color:#f92672">/</span>system<span style="color:#f92672">/</span>gollum<span style="color:#f92672">.</span>service</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Gollum wiki</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">After</span><span style="color:#f92672">=</span><span style="color:#e6db74">network.target</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#e6db74">simple</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#e6db74">gollum</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Group</span><span style="color:#f92672">=</span><span style="color:#e6db74">gollum</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WorkingDirectory</span><span style="color:#f92672">=</span><span style="color:#e6db74">/home/gollum/wiki</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#e6db74">/usr/local/bin/gollum --config &#34;/etc/gollum/config.rb&#34; --host localhost</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Restart</span><span style="color:#f92672">=</span><span style="color:#e6db74">on-abort</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WantedBy</span><span style="color:#f92672">=</span><span style="color:#e6db74">multi-user.target</span></span></span></code></pre></div>
<p>Why localhost? You guessed it right - because we&rsquo;ll be running it behind a proper reverse proxy, such as <a href="#nginx">NGINX</a>, so we don&rsquo;t want Gollum to expose its port to the network.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo systemctl enable gollum<span style="color:#f92672">.</span>service
</span></span><span style="display:flex;"><span>$ sudo systemctl start gollum<span style="color:#f92672">.</span>service</span></span></code></pre></div>
<p>Verify that it&rsquo;s bound to <code>127.0.0.1</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo ss <span style="color:#f92672">-</span>lntup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>tcp    <span style="color:#a6e22e">LISTEN</span>  <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">4096</span>          <span style="color:#ae81ff">127.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.1</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">4567</span>          <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">:*</span>      <span style="color:#66d9ef">users:</span><span style="color:#f92672">((</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">gollum</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">pid</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">33932</span><span style="color:#f92672">,</span>fd<span style="color:#66d9ef">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span></span></span></code></pre></div>
<p>You can also try to open <a href="http://your.host:4567">http://your.host:4567</a> - it should fail.</p>
<h3 id="nginx">NGINX</h3>
<p>Install and setup NGINX as a reverse proxy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo apt install nginx
</span></span><span style="display:flex;"><span>$ sudo rm <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>enabled<span style="color:#f92672">/</span>default
</span></span><span style="display:flex;"><span>$ sudo nano <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>available<span style="color:#f92672">/</span>wiki<span style="color:#f92672">.</span>your<span style="color:#f92672">.</span>host</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">default_server</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#e6db74">[::]:80</span> <span style="color:#e6db74">default_server</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">_</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> $scheme;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Scheme</span> $scheme;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_redirect</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://localhost:4567</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ sudo ln <span style="color:#f92672">-</span>s <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>available<span style="color:#f92672">/</span>wiki<span style="color:#f92672">.</span>your<span style="color:#f92672">.</span>host <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>enabled<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>$ sudo systemctl restart nginx<span style="color:#f92672">.</span>service</span></span></code></pre></div>
<p>Now your wiki should be available at <a href="http://wiki.your.host">http://wiki.your.host</a>. Obviously, first you&rsquo;d need to add a record for <code>wiki.your.host</code> in your local DNS server or at your hoster control panel (<em>assuming you already have <code>your.host</code> domain registered</em>).</p>
<p>In our case we host wiki in the internal network only, so it&rsquo;s not exposed to the internet, and there is no real need to restrict access to it. However, it might still be a good idea to protect it with at least <a href="https://github.com/retifrav/scraps/blob/master/_linux/index.md#basic-authentication">Basic authentication</a>, unless you plan do add a <a href="#ldap-authentication">proper authentication</a> later.</p>
<h2 id="mac-os">Mac OS</h2>
<p>Here the goal is to simply run Gollum locally on demand - to preview your local changes before pushing them to the main repository on server.</p>
<p>Install required packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ brew install icu4c
</span></span><span style="display:flex;"><span>$ brew install pkg<span style="color:#f92672">-</span>config
</span></span><span style="display:flex;"><span>$ brew install ruby</span></span></code></pre></div>
<p>Since Mac OS already has system Ruby, you&rsquo;ll need to &ldquo;overwrite&rdquo; it in your <code>~/.bash_profile</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/opt/ruby/bin:</span>$PATH<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>export LDFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-L/usr/local/opt/ruby/lib&#34;</span>
</span></span><span style="display:flex;"><span>export CPPFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-I/usr/local/opt/ruby/include&#34;</span>
</span></span><span style="display:flex;"><span>export PKG_CONFIG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/opt/ruby/lib/pkgconfig&#34;</span></span></span></code></pre></div>
<p>Update the environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ source <span style="color:#f92672">~/.</span>bash_profile</span></span></code></pre></div>
<p>and check the versions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ ruby <span style="color:#f92672">--</span>version
</span></span><span style="display:flex;"><span>ruby <span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>p0 <span style="color:#f92672">(</span><span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span><span style="color:#f92672">-</span><span style="color:#ae81ff">25</span> revision <span style="color:#ae81ff">95</span>aff21468<span style="color:#f92672">)</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">x86_64-darwin19</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gem <span style="color:#f92672">--</span>version
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span></span></span></code></pre></div>
<p>Try to install Gollum now. In my case it failed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gem install gollum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Building</span> native extensions<span style="color:#f92672">.</span> <span style="color:#a6e22e">This</span> could take a <span style="color:#66d9ef">while</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ERROR</span><span style="color:#66d9ef">:</span>  <span style="color:#66d9ef">Error</span> <span style="color:#66d9ef">installing</span> <span style="color:#66d9ef">gollum:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ERROR</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Failed</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">build</span> <span style="color:#66d9ef">gem</span> <span style="color:#66d9ef">native</span> <span style="color:#66d9ef">extension.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">current</span> <span style="color:#66d9ef">directory:</span> <span style="color:#66d9ef">/usr/local/lib/ruby/gems/</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">/gems/ffi-</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">/ext/ffi_c</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>ruby <span style="color:#f92672">-</span>I <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span><span style="color:#a6e22e">Cellar</span><span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>_1<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">-</span>r <span style="color:#f92672">./</span>siteconf20210104<span style="color:#f92672">-</span><span style="color:#ae81ff">30597</span><span style="color:#f92672">-</span>m0yzw0<span style="color:#f92672">.</span>rb extconf<span style="color:#f92672">.</span>rb
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> ffi_prep_closure_loc<span style="color:#f92672">()</span> in <span style="color:#f92672">-</span>lffi<span style="color:#f92672">...</span> yes
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> ffi_prep_cif_var<span style="color:#f92672">()...</span> yes
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> ffi_raw_call<span style="color:#f92672">()...</span> yes
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> ffi_prep_raw_closure<span style="color:#f92672">()...</span> yes
</span></span><span style="display:flex;"><span>creating extconf<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>creating <span style="color:#a6e22e">Makefile</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current directory<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/usr/local/lib/ruby/gems/</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">/gems/ffi-</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">/ext/ffi_c</span>
</span></span><span style="display:flex;"><span>make <span style="color:#e6db74">&#34;DESTDIR=&#34;</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current directory<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/usr/local/lib/ruby/gems/</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">/gems/ffi-</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">/ext/ffi_c</span>
</span></span><span style="display:flex;"><span>make <span style="color:#e6db74">&#34;DESTDIR=&#34;</span>
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">AbstractMemory</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">ArrayType</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">Buffer</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">Call</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">ClosurePool</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">DynamicLibrary</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>compiling <span style="color:#a6e22e">Function</span><span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Function</span><span style="color:#f92672">.</span>c<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">847</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">17</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">declaration</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">function</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">ffi_prep_closure_loc</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">invalid</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">C99</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">-Werror</span>,<span style="color:#66d9ef">-Wimplicit-function-declaration</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    ffiStatus <span style="color:#66d9ef">=</span> ffi_prep_closure_loc<span style="color:#f92672">(</span>closure<span style="color:#f92672">-&gt;</span>pcl<span style="color:#f92672">,</span> <span style="color:#f92672">&amp;</span>fnInfo<span style="color:#f92672">-&gt;</span>ffi_cif<span style="color:#f92672">,</span> callback_invoke<span style="color:#f92672">,</span> closure<span style="color:#f92672">,</span> code<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Function</span><span style="color:#f92672">.</span>c<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">847</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">17</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">note:</span> <span style="color:#66d9ef">did</span> <span style="color:#66d9ef">you</span> <span style="color:#66d9ef">mean</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">ffi_prep_closure</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">?</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Library</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Developer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">CommandLineTools</span><span style="color:#f92672">/</span><span style="color:#a6e22e">SDKs</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSX10</span><span style="color:#f92672">.</span><span style="color:#ae81ff">14.</span>sdk<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>include<span style="color:#f92672">/</span>ffi<span style="color:#f92672">/</span>ffi<span style="color:#f92672">.</span>h<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">269</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">note:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">ffi_prep_closure</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">declared</span> <span style="color:#66d9ef">here</span>
</span></span><span style="display:flex;"><span>ffi_prep_closure<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> error generated<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>make<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">***</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">Function.o</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">Error</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>make failed<span style="color:#f92672">,</span> exit code <span style="color:#ae81ff">2</span></span></span></code></pre></div>
<p>Here this error is caused by the <a href="https://github.com/ffi/ffi/issues/791#issuecomment-645594873">obsolete libffi library</a>. To fix it, force the required gem, and this time Gollum should install fine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gem install ffi <span style="color:#f92672">--</span> <span style="color:#f92672">--</span>disable<span style="color:#f92672">-</span>system<span style="color:#f92672">-</span>libffi
</span></span><span style="display:flex;"><span>$ gem install gollum</span></span></code></pre></div>
<p>Make a symlink for Gollum executable somewhere in your <code>PATH</code>, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ ln <span style="color:#f92672">-</span>s <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span>gems<span style="color:#f92672">/</span><span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>gems<span style="color:#f92672">/</span>gollum<span style="color:#f92672">-</span><span style="color:#a6e22e">VERSION</span><span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>gollum <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span></span></span></code></pre></div>
<p>Now do the steps described in <a href="#local-editing">local editing</a> and try to run your wiki. It might fail with the following error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>the<span style="color:#f92672">/</span>clonned<span style="color:#f92672">/</span>wiki<span style="color:#f92672">/</span>repository
</span></span><span style="display:flex;"><span>$ gollum <span style="color:#f92672">--</span>config config<span style="color:#f92672">.</span>rb <span style="color:#f92672">--</span>host localhost
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span>gems<span style="color:#f92672">/</span><span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>gems<span style="color:#f92672">/</span>sinatra<span style="color:#f92672">-</span><span style="color:#ae81ff">2.1</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>sinatra<span style="color:#f92672">/</span>base<span style="color:#f92672">.</span>rb<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">1755</span><span style="color:#66d9ef">:in</span> <span style="color:#66d9ef">`detect_rack_handler&#39;: Server handler (thin,puma,reel,HTTP,webrick) not found. (RuntimeError)
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">    from /usr/local/lib/ruby/gems/3.0.0/gems/sinatra-2.1.0/lib/sinatra/base.rb:1493:in `run!</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">/Users/YOURNAME/bin/gollum:</span><span style="color:#960050;background-color:#1e0010">286</span><span style="color:#66d9ef">:in</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">&lt;main&gt;</span><span style="color:#960050;background-color:#1e0010">&#39;</span></span></span></code></pre></div>
<p>That means that you have no web-server in your Ruby. Install some, for example <a href="https://github.com/ruby/webrick">webrick</a>, and then you&rsquo;ll be able to run the wiki:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gem install webrick
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gollum <span style="color:#f92672">--</span>config config<span style="color:#f92672">.</span>rb <span style="color:#f92672">--</span>host localhost
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">2021</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">01</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">04</span> <span style="color:#960050;background-color:#1e0010">16</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">40</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">58</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">INFO</span>  <span style="color:#a6e22e">WEBrick</span> <span style="color:#ae81ff">1.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">2021</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">01</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">04</span> <span style="color:#960050;background-color:#1e0010">16</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">40</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">58</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">INFO</span>  ruby <span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span><span style="color:#f92672">-</span><span style="color:#ae81ff">25</span><span style="color:#f92672">)</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">x86_64-darwin19</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">==</span> <span style="color:#a6e22e">Sinatra</span> <span style="color:#f92672">(</span>v2<span style="color:#f92672">.</span><span style="color:#ae81ff">1.0</span><span style="color:#f92672">)</span> has taken the stage on <span style="color:#ae81ff">4567</span> <span style="color:#66d9ef">for</span> production <span style="color:#66d9ef">with</span> backup from <span style="color:#a6e22e">WEBrick</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#960050;background-color:#1e0010">2021</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">01</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">04</span> <span style="color:#960050;background-color:#1e0010">16</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">40</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">58</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">INFO</span>  <span style="color:#a6e22e">WEBrick</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">:HTTPServer</span><span style="color:#66d9ef">#</span><span style="color:#66d9ef">start:</span> <span style="color:#66d9ef">pid</span><span style="color:#f92672">=</span><span style="color:#ae81ff">38628</span> port<span style="color:#66d9ef">=</span><span style="color:#ae81ff">4567</span></span></span></code></pre></div>
<p>The wiki is now available on <a href="http://localhost:4567">http://localhost:4567</a>.</p>
<h1 id="editing-and-authentication">Editing and authentication</h1>
<h2 id="web-ui">Web UI</h2>
<p>Gollum has a web UI for editing, and that would be the easiest option in most cases.</p>
<p>Sadly, there is no authentication out of the box, but it is possible to add it, for example <a href="https://github.com/gollum/gollum/wiki/Gollum-via-Rack-and-CAS-SSO">like this</a> or via <a href="#ldap-authentication">LDAP</a>. At the very least you can set-up <a href="https://github.com/retifrav/scraps/blob/master/_linux/index.md#basic-authentication">Basic authentication</a>.</p>
<p>Another thing to note due to the lack of authentication is that by default all the changes made via web UI will be authored by the default user from <a href="#user-and-repository">Git repository config</a> on server, which is rather unfortunate in case of a team wiki.</p>
<h2 id="local-editing">Local editing</h2>
<p>But why edit wiki in web UI, when its content is just plain-text Markdown files in a Git repository? You can work with it as with any other Git repository!</p>
<p>So, every team member can have a local copy of the wiki, author and <a href="https://withblue.ink/2020/05/17/how-and-why-to-sign-git-commits.html#why-to-sign-git-commits">sign</a> their commits and push them to the main repository via SSH (<em>so everyone authenticates with their personal SSH keys</em>). You can even disable editing via web UI, so Git and SSH would be the only way to edit the wiki. How awesome is that.</p>
<h3 id="establish-ssh-connection-to-the-wiki-host">Establish SSH connection to the wiki host</h3>
<p>As usual, create an <a href="https://github.com/retifrav/scraps/blob/master/_linux/ssh.md#generate-a-new-ssh-key">SSH key</a> on your machine and add the wiki host to your SSH config (<code>~/.ssh/config</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Host wiki.your.host
</span></span><span style="display:flex;"><span>HostName wiki.your.host <span style="color:#75715e"># or its IP address, if you don&#39;t have a domain</span>
</span></span><span style="display:flex;"><span>User gollum
</span></span><span style="display:flex;"><span>IdentityFile ~/.ssh/NAME-OF-THE-PRIVATE-KEY-FILE-YOU-JUST-CREATED</span></span></code></pre></div>
<p>Then go the wiki host and add your public key to <code>/home/gollum/.ssh/authorized_keys</code>.</p>
<h3 id="clone-the-wiki-repository">Clone the wiki repository</h3>
<p>Now you should be able to clone the wiki repository via SSH. On your local machine clone the wiki repository like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/your/documents/or/whatever
</span></span><span style="display:flex;"><span>$ git clone gollum@wiki.your.host:wiki wiki.your.host</span></span></code></pre></div>
<p>Make sure that you have meaningful username and e-mail in your Git config (<em>these values will be used for authoring your changes in the wiki</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">./</span>wiki<span style="color:#f92672">.</span>your<span style="color:#f92672">.</span>host
</span></span><span style="display:flex;"><span>$ git config user<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>$ git config user<span style="color:#f92672">.</span>email</span></span></code></pre></div>
<p>The rest is as with any other Git repository: you do some changes, commit them and push to remote.</p>
<h3 id="run-gollum">Run Gollum</h3>
<p>To run Gollum locally, first <a href="#installation">install it</a> on your machine, create a <a href="#config">config</a> in the root of the wiki repository that you&rsquo;ve just cloned (<em>no need to commit the local config, and actually add it to <code>.gitignore</code></em>) and then:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>wiki<span style="color:#f92672">.</span>your<span style="color:#f92672">.</span>host
</span></span><span style="display:flex;"><span>$ gollum <span style="color:#f92672">--</span>config config<span style="color:#f92672">.</span>rb <span style="color:#f92672">--</span>host localhost</span></span></code></pre></div>
<p>Now you can open <a href="http://localhost:4567">http://localhost:4567</a> in your browser. Note that it will only render what&rsquo;s already committed, so if you don&rsquo;t see changes you&rsquo;ve made, check if you&rsquo;ve committed them.</p>
<p>The main purpose of running Gollum locally is to preview your changes and <a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History#_git_amend">amend</a> local commits <em>before pushing</em> to remote. For example, you&rsquo;ve committed some changes (<em>did not push them yet</em>), previewed them in browser and decided to do some more changes. To preview new changes you&rsquo;ll need to commit them too, but instead of making a new commit you can just do this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ git add <span style="color:#f92672">.</span> <span style="color:#f92672">&amp;&amp;</span> git commit <span style="color:#f92672">--</span>amend <span style="color:#f92672">--</span>no<span style="color:#f92672">-</span>edit</span></span></code></pre></div>
<p>That will update your last commit (<code>--amend</code>), preserving the original commit message (<code>--no-edit</code>). You can amend your commit countless number of times and push it to the main repository only when you are completely satisfied with the changes.</p>
<h1 id="customization">Customization</h1>
<p>As already mentioned, you can customize default wiki layouts by editing Gollum <a href="#templates">templates</a>.</p>
<h2 id="css-and-js">CSS and JS</h2>
<p>Aside from templates, you can also add your customs CSS and JS. To enable those, make sure your <a href="#config">wiki config</a> has the following lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">css</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">js</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span></span></span></code></pre></div>
<p>Then create <code>custom.css</code> and <code>custom.js</code> files in the wiki root. Now you can either write your custom CSS and JS right there, or use them as &ldquo;importing points&rdquo; - for example here&rsquo;s my <code>custom.css</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>@<span style="color:#66d9ef">import</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;site.css&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">import</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;site-tablet.css&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">import</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;site-phone.css&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>@<span style="color:#66d9ef">import</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;homepage.css&#34;</span><span style="color:#f92672">)</span>;</span></span></code></pre></div>
<p>and then I do the actual styling in those files.</p>
<p>By the way, even though the pages markup is Markdown, you can just as well use raw HTML blocks. And you can also assign CSS classes to Markdown elements, such as images:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>![](/files/some-image.png){:class=&#34;some-css-class&#34;}</span></span></code></pre></div>
<p>As an example, our main page is mostly done with raw HTML. And thanks to injected custom styles, it nicely adapts to mobile screens:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/styling-main.png" alt="Gollum wiki, main page" style="border:1px solid black;">

<p>Also, default Gollum styles (<em>at least, in older versions</em>) define some rather ugly margins for ToC, headers, paragraphs and so on, but you can easily customize that into something nicer like this:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/styling-article.png" alt="Gollum wiki, article" style="border:1px solid black;">

<p>Note that by default both <code>custom.css</code> and <code>custom.js</code> are included in the <code>&lt;head&gt;</code>. If you would like to move your JS code to the end of <code>&lt;body&gt;</code>, you can do it by modifying the following template: <code>/path/to/gems/gollum-VERSION/lib/gollum/templates/layout.mustache</code> (<em>or rather a <a href="#templates">copy of it</a> that you made earlier</em>).</p>
<p>But before starting to customize the hell out of default styling, make sure that you have the latest Gollum version. In our case we were on the latest version, but since the moment we did our customization for adaptive layout there were a couple of new Gollum versions released, and there default styling was already addressing that very same thing out of the box, so our efforts turned out to be a bit of a waste.</p>
<h2 id="header-footer-sidebar">Header, footer, sidebar</h2>
<p>There are certain special files (<em>subpages</em>) that get injected into pages - you can guess where exactly on a page by looking at their names:</p>
<ul>
<li><code>_Header.md</code></li>
<li><code>_Sidebar.md</code></li>
<li><code>_Footer.md</code></li>
</ul>
<p>You can use them for injecting some common blocks, such as table of contents (ToC). Here&rsquo;s my <code>_Header.md</code>, for instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>[[_TOC_]]</span></span></code></pre></div>
<p>These blocks affect all the pages in the current and nested folders, unless they are &ldquo;overwritten&rdquo; on lower levels. For example, I have an <code>archive</code> folder with its own <code>_Header.md</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">â”œâ”€â”€</span> <span style="color:#a6e22e">_Header</span><span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">â”œâ”€â”€</span> some<span style="color:#f92672">-</span>article<span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">â”œâ”€â”€</span> archive
</span></span><span style="display:flex;"><span><span style="color:#f92672">â”‚</span>   <span style="color:#f92672">â”œâ”€â”€</span> <span style="color:#a6e22e">_Header</span><span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">â”‚</span>   <span style="color:#f92672">â”œâ”€â”€</span> some<span style="color:#f92672">-</span>old<span style="color:#f92672">-</span>article<span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">â”‚</span>   <span style="color:#f92672">â”œâ”€â”€</span> some<span style="color:#f92672">-</span>other<span style="color:#f92672">-</span>old<span style="color:#f92672">-</span>article<span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span></span></span></code></pre></div>
<p>and it has different contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>![](/files/archived.png){:class=&#34;archived-banner&#34;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[_TOC_]]</span></span></code></pre></div>
<p>so, aside from ToC, all the pages in the <code>archive</code> folder (<em>and nested folders</em>) will also have a special banner.</p>
<h1 id="a-bit-about-features">A bit about features</h1>
<p>Gollum has quite a number of <a href="https://github.com/gollum/gollum/wiki">features</a>, and I won&rsquo;t describe all of them, but I would like to highlight some, as they are easy to overlook:</p>
<ul>
<li><em>RSS feed</em> - available at <a href="http://wiki.your.host/gollum/feed/">http://wiki.your.host/gollum/feed/</a> (<em>note the trailing slash</em>)</li>
<li><em>TeX math equations via MathJax</em></li>
<li><em>YAML frontmatter</em> - much like in Jekyll or Octopress. You can use it to set the page title (<em>and other metadata</em>)</li>
<li><em>Overview</em> - a service page that allows you to navigate the wiki directory tree. Available at <a href="http://wiki.your.host/gollum/overview">http://wiki.your.host/gollum/overview</a></li>
<li><em>Macros</em> (<em>full list is <a href="https://github.com/gollum/gollum/wiki/Standard-Macros">here</a></em>), including <a href="https://github.com/gollum/gollum/wiki#custom-macros">custom macros</a>
<ul>
<li><em>Global ToC</em> - you can add <code>&lt;&lt;GlobalTOC()&gt;&gt;</code> macros to the main page and that will generate a list of all the wiki pages (<em>unlike Overview, this will list only content pages</em>)</li>
</ul>
</li>
</ul>
<h1 id="ldap-authentication">LDAP authentication</h1>
<p>If the average technical level in your team isn&rsquo;t very high, so not everyone is capable of setting-up an SSH connection and working with a Git repository (<em>let alone <a href="https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work">signing commits</a></em>), then you will likely have to enable editing via <a href="#web-ui">web UI</a>. One other reason for why you might want to do that is to allow people to make changes in the wiki from their mobile devices, where it isn&rsquo;t trivial/possible to work with a Git repository.</p>
<p>But then you&rsquo;ll face the problem of authoring the changes, because without authentication all the changes will be authored by the default user that is set in <a href="#user-and-repository">Git config</a> on the server, making it impossible to track who changed what.</p>
<p>One of the authentication options is to use <a href="/blog/2022/06/16/dotnet-ldap-authentication/#whats-the-point-of-using-an-ldap-server">LDAP</a>. Below I&rsquo;ll provide instructions for <a href="https://en.wikipedia.org/wiki/Active_Directory">Active Directory</a>, but as I already mentioned in the <a href="/blog/2022/06/16/dotnet-ldap-authentication/#ldap-servers-specifics">other article</a>, different servers have different specifics, so you&rsquo;ll likely need to change some things, if you are using something else.</p>
<p>Before doing anything with Gollum, check that your LDAP server <a href="/blog/2022/06/16/dotnet-ldap-authentication/#checking-access-to-ldap-server">is available</a> and you can communicate with it from the host where you are running Gollum.</p>
<h2 id="setting-up-omniauth-in-gollum">Setting up omniauth in Gollum</h2>
<p>Thanks a lot to this <a href="https://pub.nethence.com/www/gollum-ad">beautiful person</a> for describing the procedure. Here&rsquo;s also another <a href="https://remyd1.fr/comm/blog/2022/gollum-wiki/#configuring-gollum">good tutorial</a>.</p>
<p>First you need to install some more packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gem install omniauth
</span></span><span style="display:flex;"><span>$ gem install omniauth<span style="color:#f92672">-</span>ldap
</span></span><span style="display:flex;"><span>$ gem install omnigollum
</span></span><span style="display:flex;"><span>$ gem install gollum<span style="color:#f92672">-</span>rugged_adapter</span></span></code></pre></div>
<p>Then add the following in your <code>config.rb</code> after the Gollum&rsquo;s initialization:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Gollum initialization/settings</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Gollum</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Page</span><span style="color:#f92672">::</span><span style="color:#66d9ef">FORMAT_NAMES</span> <span style="color:#f92672">=</span> { <span style="color:#e6db74">:markdown</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Markdown&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># seems to be production by default, so no need to set it</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Precious::App.set(:environment, :production)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;omnigollum&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;omniauth-ldap&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ldapZone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;com&#39;</span>
</span></span><span style="display:flex;"><span>ldapDomain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;our-company&#39;</span>
</span></span><span style="display:flex;"><span>ldapSubDomain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ad&#39;</span>
</span></span><span style="display:flex;"><span>ldapHost <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>ldapSubDomain<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">#{</span>ldapDomain<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">#{</span>ldapZone<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>ldapQueryBase <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DC=</span><span style="color:#e6db74">#{</span>ldapDomain<span style="color:#e6db74">}</span><span style="color:#e6db74">,DC=</span><span style="color:#e6db74">#{</span>ldapZone<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>options <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:providers</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Proc</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    provider <span style="color:#e6db74">:ldap</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:title</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Your Active Directory credentials for the company domain&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:host</span> <span style="color:#f92672">=&gt;</span> ldapHost,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># your LDAP server&#39;s port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:port</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3268</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:method</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">:plain</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:base</span> <span style="color:#f92672">=&gt;</span> ldapQueryBase,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># your LDAP server&#39;s attribute for the unique ID</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:uid</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;sAMAccountName&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># this filter query is for Active Directory, so you might need to adjust it</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># for your particular LDAP server. The `CN=crew` means that user must be</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># a member of the group named `crew`, so in your case it will be something different</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:filter</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;(&amp;(sAMAccountName=%{username})(memberOf=CN=crew,CN=Users,</span><span style="color:#e6db74">#{</span>ldapQueryBase<span style="color:#e6db74">}</span><span style="color:#e6db74">))&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># service user credentials (someone needs to query the server, preferably not a real user)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:bind_dn</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;SERVICE-USER-NAME&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">:password</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;SERVICE-USER-PASSWORD&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:dummy_auth</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:protected_routes</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;/*&#39;</span><span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:author_format</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Proc</span><span style="color:#f92672">.</span>new { <span style="color:#f92672">|</span>user<span style="color:#f92672">|</span> user<span style="color:#f92672">.</span>name },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:author_email</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Proc</span><span style="color:#f92672">.</span>new { <span style="color:#f92672">|</span>user<span style="color:#f92672">|</span> user<span style="color:#f92672">.</span>email },
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># https://github.com/arr2036/omnigollum/issues/42</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># any AD user, who is able to authenticate, will have access</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">:authorized_users</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># otherwise you can further restrict access to an explicit list of your AD users,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># for example via an environment variable (OMNIGOLLUM_AUTHORIZED_USERS=alleria,luna,mirana)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#:authorized_users =&gt; ENV[&#34;OMNIGOLLUM_AUTHORIZED_USERS&#34;].split(&#34;,&#34;)</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Precious</span><span style="color:#f92672">::</span><span style="color:#66d9ef">App</span><span style="color:#f92672">.</span>set(<span style="color:#e6db74">:omnigollum</span>, options)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Precious</span><span style="color:#f92672">::</span><span style="color:#66d9ef">App</span><span style="color:#f92672">.</span>register <span style="color:#66d9ef">Omnigollum</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Sinatra</span></span></span></code></pre></div>
<p>This is it, nothing else is needed. Well, obviously except for enabling HTTPS in your <a href="#nginx">reverse proxy</a>, so passwords wouldn&rsquo;t be sent in plain-text unencrypted.</p>
<p>You can now run Gollum as usual, just add <code>--adapter rugged</code> parameter (<em>not sure if this is actually required, as it seems to be the <a href="https://github.com/gollum/gollum/wiki/Git-adapters#rugged">default one</a> anyway</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ gollum <span style="color:#f92672">--</span>config config<span style="color:#f92672">.</span>rb <span style="color:#f92672">--</span>host localhost <span style="color:#f92672">--</span>adapter rugged</span></span></code></pre></div>
<p>Trying to run that, I got the following errors (<em>first on <a href="#mac-os">Mac OS</a> and then also on <a href="#gnulinux">GNU/Linux</a> server</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>homebrew<span style="color:#f92672">/</span>Cellar<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.2</span>_1<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.0</span><span style="color:#f92672">/</span>rubygems<span style="color:#f92672">/</span>specification.rb:<span style="color:#ae81ff">2295</span><span style="color:#f92672">:</span>in <span style="color:#960050;background-color:#1e0010">`</span>raise_if_conflicts<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">:</span> Unable to activate omniauth<span style="color:#f92672">-</span>ldap<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0.0</span>, because omniauth<span style="color:#f92672">-</span><span style="color:#ae81ff">2.1.1</span> conflicts with omniauth (<span style="color:#f92672">~&gt;</span> <span style="color:#ae81ff">1.8.1</span>) (Gem<span style="color:#f92672">::</span>ConflictError)
</span></span><span style="display:flex;"><span>    from <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>homebrew<span style="color:#f92672">/</span>Cellar<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.2</span>_1<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.0</span><span style="color:#f92672">/</span>rubygems<span style="color:#f92672">/</span>specification.rb:<span style="color:#ae81ff">1424</span><span style="color:#f92672">:</span>in <span style="color:#960050;background-color:#1e0010">`</span>activate<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>internal:<span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>homebrew<span style="color:#f92672">/</span>Cellar<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.2</span>_1<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.0</span><span style="color:#f92672">/</span>rubygems<span style="color:#f92672">/</span>core_ext<span style="color:#f92672">/</span>kernel_require.rb<span style="color:#f92672">&gt;:</span><span style="color:#ae81ff">148</span><span style="color:#f92672">:</span>in <span style="color:#960050;background-color:#1e0010">`</span>require<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">:</span> cannot load such file <span style="color:#f92672">--</span> omniauth<span style="color:#f92672">-</span>ldap (LoadError)
</span></span><span style="display:flex;"><span>    from <span style="color:#f92672">&lt;</span>internal:<span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>homebrew<span style="color:#f92672">/</span>Cellar<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.2</span>_1<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>ruby<span style="color:#f92672">/</span><span style="color:#ae81ff">3.2.0</span><span style="color:#f92672">/</span>rubygems<span style="color:#f92672">/</span>core_ext<span style="color:#f92672">/</span>kernel_require.rb<span style="color:#f92672">&gt;:</span><span style="color:#ae81ff">148</span><span style="color:#f92672">:</span>in <span style="color:#960050;background-color:#1e0010">`</span>require<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    ...</span></span></code></pre></div>
<p>To resolve this I had to uninstall the newer version of <code>omniauth</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ gem uninstall omniauth
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Select gem to uninstall:
</span></span><span style="display:flex;"><span> 1. omniauth-1.8.1
</span></span><span style="display:flex;"><span> 2. omniauth-2.1.1
</span></span><span style="display:flex;"><span> 3. All versions
</span></span><span style="display:flex;"><span>&gt; <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Successfully uninstalled omniauth-2.1.1</span></span></code></pre></div>
<p>And then Gollum launched fine.</p>
<h3 id="filtering-out-disabled-users">Filtering out disabled users</h3>
<p>One minor but still important thing to note here is that current configuration will probably allow to authenticate with a disabled account too (<em>if it is a member of the <code>crew</code> group</em>). It should not, but still, it&rsquo;s better to explicitly filter disabled accounts out.</p>
<p>There is an <a href="/blog/2022/06/16/dotnet-ldap-authentication/#useraccountcontrol">attribute</a> that allows to do that - <code>(!(userAccountControl:1.2.840.113556.1.4.803:=2))</code> - but adding it to the query/filter makes the query invalid, so it might be that there is something wrong with the syntax (<em>exclamation mark needs to be escaped somehow?</em>). It works fine in our other portals which use the same Active Directory server for authentication, so I&rsquo;m puzzled about what could be different in this case.</p>
<h2 id="customizing-authentication-views">Customizing authentication views</h2>
<p>Trying to open any page in your wiki, you should now get the following authentication form (<em>if you are unauthenticated</em>):</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/omnigollum-default-authentication-form.png" alt="omnigollum default authentication form">

<p>Which doesn&rsquo;t look too nice, so I wanted to customize it, and I was hoping this could be done via <a href="#templates">templates</a>, but sadly it looks like the only way to do this is by editing the <code>omniauth</code>/<code>omnigollum</code> gems sources, which means that you&rsquo;ll need to do that again on the next update:</p>
<ul>
<li><a href="./customization/ldap-authentication/form.rb">/path/to/gems/omniauth-VERSION/lib/omniauth/form.rb</a></li>
<li><a href="./customization/ldap-authentication/form.css">/path/to/gems/omniauth-VERSION/lib/omniauth/form.css</a></li>
<li><a href="./customization/ldap-authentication/omnigollum.rb">/path/to/gems/omnigollum-VERSION/lib/omnigollum.rb</a></li>
<li><a href="./customization/ldap-authentication/Error.mustache">/path/to/gems/omnigollum-VERSION/templates/Error.mustache</a>
<ul>
<li>it is a template, but it has the same file name as the main error template, so it needs to be edited in sources (<em>unless there is a mechanism for nested/scoped templates</em>)</li>
<li>also, this error page customization capabilities are rather limited, because it is just a <code>div</code> that is getting inserted into the main layout</li>
</ul>
</li>
</ul>
<p>I&rsquo;ve settled with the following (<em>reused login page styling from other portals, so it looked familiar for everyone in the team</em>):</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/omnigollum-custom-authentication-form.png" alt="omnigollum custom authentication form">

<p>Better, innit.</p>
<p>Another thing you&rsquo;d probably want to do is to <a href="https://github.com/remyd1/gollum/commit/925ebcfe04f294c979b9e088dc0955ca1dfa8c44">show currently signed-in user</a>. For that you&rsquo;d need to create a new template <code>/path/to/your/custom/templates/user.mustache</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;float: right; margin-top: 30px; font-family: Verdana, sans-serif;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>    {{#user_authed}}
</span></span><span style="display:flex;"><span>      [
</span></span><span style="display:flex;"><span>      Signed in via &lt;<span style="color:#f92672">b</span>&gt;{{user_provider}}&lt;/<span style="color:#f92672">b</span>&gt; as &lt;<span style="color:#f92672">b</span>&gt;{{user_name}}&lt;/<span style="color:#f92672">b</span>&gt;
</span></span><span style="display:flex;"><span>      |
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/__omnigollum__/logout&#34;</span>&gt;logout&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    {{/user_authed}}
</span></span><span style="display:flex;"><span>    {{^user_authed}}
</span></span><span style="display:flex;"><span>      [
</span></span><span style="display:flex;"><span>      You are not logged in
</span></span><span style="display:flex;"><span>      |
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/__omnigollum__/login&#34;</span>&gt;login&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    {{/user_authed}}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;</span></span></code></pre></div>
<p>then customize the <code>/path/to/your/custom/templates/layout.mustache</code> (<em>note the replacement of the <code>&amp;lt;</code> with <code>&lt;</code> - I had to do it this way here in the article because of the Hugo limitation</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container-lg clearfix&#34;</span>&gt;
</span></span><span style="display:flex;"><span> {{{yield}}}
</span></span><span style="display:flex;"><span> {{&amp;lt; user}} <span style="color:#75715e">&lt;!-- replace `&amp;lt;` with the actual `&lt;` symbol --&gt;</span>
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div>
<p>and finally edit the <code>/path/to/gems/gollum-VERSION/lib/gollum/views/layout.rb</code> source (<em>which means that you&rsquo;ll need to do that again on the next update</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># original sources</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># passthrough additional omniauth parameters for status bar</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">user_authed</span>
</span></span><span style="display:flex;"><span>        @user_authed
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">user_provider</span>
</span></span><span style="display:flex;"><span>        @user<span style="color:#f92672">.</span>provider
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">user_name</span>
</span></span><span style="display:flex;"><span>        @user<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span></span></span></code></pre></div>
<p>Now all the changes made via web UI will be properly authored too. For example, here you can see who edited the page last time and which user is logged in at the moment:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/01/07/gollum-markdown-wiki/images/omnigollum-authenticated-users.png" alt="omnigollum authenticated users" style="border:1px solid black;">

<p>And if you trust the <code>omni*</code> packages enough, you can now probably even expose your wiki to the big internet, so your team could use it without office VPN.</p>
<h2 id="unprotecting-rss-feed">Unprotecting RSS feed</h2>
<p>One sad drawback of enabling authentication is that RSS clients won&rsquo;t be able to read the feed. A not so secure workaround for that would be to exclude the RSS route <code>/gollum/feed/</code> from <code>protected_routes</code> in <code>config.rb</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">-  :protected_routes =&gt; [&#39;/*&#39;],
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+  :protected_routes =&gt; [
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+    /^\/(?!gollum\/feed\/)(.*)/
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+  ],
</span></span></span></code></pre></div><p>However, by default Gollum will fail to start with this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Feb <span style="color:#ae81ff">12</span> 12:02:20 wiki gollum<span style="color:#f92672">[</span>2004919<span style="color:#f92672">]</span>: /var/lib/gems/3.0.0/gems/mustermann-2.0.2/lib/mustermann/regular.rb:41:in <span style="color:#e6db74">`</span>check_anchors<span style="color:#960050;background-color:#1e0010">&#39;</span>: regular expression should not contain ^: <span style="color:#e6db74">&#34;^\\\\/(?!gollum\\\\/feed\\\\/)(.*)&#34;</span> <span style="color:#f92672">(</span>Mustermann::CompileError<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>That <code>check_anchors</code> parameter seems to be <a href="https://github.com/sinatra/mustermann/blob/main/mustermann/README.md#regexp">configurable</a>, and <a href="https://sinatrarb.com/intro.html">Sinatra documentation</a> even mentions how:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#e6db74">:mustermann_opts</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">:check_anchors</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>but I could not <a href="https://github.com/gollum/gollum/issues/2097">figure out</a> where exactly in <code>config.rb</code> that should be set. So instead I just changed the default value in the original <code>mustermann/regular.rb</code> that is mentioned in the error message (<em>which of course will get reverted on the next update</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">-    def initialize(string, check_anchors: true, **options)
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+    def initialize(string, check_anchors: false, **options)
</span></span></span></code></pre></div><p>Alternatively, I could probably come up with a different regular expression to exclude the <code>/gollum/feed/</code> route, which wouldn&rsquo;t rely on <code>^</code>, but so far I failed with that too.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/web/">web</a><a class="tag" href="https://retifrav.github.io/tags/linux/">linux</a><a class="tag" href="https://retifrav.github.io/tags/macos/">macos</a><a class="tag" href="https://retifrav.github.io/tags/devops/">devops</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <script>
  var id =  57 ;

  if (id)
  {
    let url = "https://github.com/retifrav/retifrav.github.io/issues/".concat(id);
    let api_url = "https://api.github.com/repos/retifrav/retifrav.github.io/issues/".concat(id, "/comments");
    
    var commentsDiv = document.getElementById("comments");

    let xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("GET", api_url);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
    xhr.send();

    xhr.onload = function()
    {
      if (xhr.status != 200)
      {
        let errorText = document.createElement("p");
        errorText.innerHTML = "<i>Comments for this post yet are not opened yet (or you have GitHub scripts disabled).</i>";
        commentsDiv.appendChild(errorText);
      }
      else
      {
        let comments = xhr.response;

        let mainHeader = document.createElement("h2");
        mainHeader.innerHTML = "Comments: ".concat(comments.length);
        commentsDiv.appendChild(mainHeader);

        let issueLink = document.createElement("p");
        issueLink.innerHTML = "<i>You can leave a comment using this <a href='".concat(url, "'>GitHub issue</a>.</i>");
        commentsDiv.appendChild(issueLink);
        
        comments.forEach(function(comment)
        {
            let commentContent = document.createElement("div");
            commentContent.setAttribute('class', 'gh-comment')
            commentContent.innerHTML = "".concat(
                "<div class='gh-header'>",
                  "<img src='", comment.user.avatar_url, "' />",
                  "<div style='margin:auto 0;'>",
                    "<b><a class='gh-username' href='", comment.user.html_url, "'>", comment.user.login, "</a></b>",
                    " commented at <em>", new Date(comment.created_at), "</em>",
                  "</div>",
                "</div>",
                "<div class='gh-body'>",
                  comment.body_html,
                "</div>"
            );
            commentsDiv.appendChild(commentContent);
        });
      }
    };

    xhr.onerror = function()
    {
      let errorText = document.createElement("p");
      errorText.innerHTML = "<i>Some error loading comments.</i>";
      commentsDiv.appendChild(errorText);
    };
  }
</script>

      
      </div>
    </div>
  </div>

  
        <div id="footer">
          <div>
              2014 - 2025,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Resources</h3>
              <div class="sidebar-row">
                <a href="/index.xml" title="Subscribe to RSS">
                  <img src="/images/rss.png" width="50px">
                </a>
                <a href="https://discord.gg/4tJXNUjWYV" title="Discord server">
                  <img src="/images/discord.png" width="50px">
                </a>
                <a href="https://t.me/decovar" title="Telegram channel">
                  <img src="/images/telegram.png" width="50px">
                </a>
              </div>
            </div>
            
            
            
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (68)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (37)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/linux">linux (28)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (11)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/ios">ios (8)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/apple">apple (7)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/home-automation">home-automation (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    

    <script>
        
        window.onload = () =>
        {
            
            
            
            
            
            
            
            
            
            
            
        }
    </script>

    
    
  </body>
</html>

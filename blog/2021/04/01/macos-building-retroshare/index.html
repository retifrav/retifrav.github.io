<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Building RetroShare on Mac OS | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2021/04/01/macos-building-retroshare/" />

    <meta name="generator" content="Hugo 0.115.4" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="" />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:title" content="Building RetroShare on Mac OS" />
<meta property="og:description" content="A couple of weeks ago RetroShare has released version 0.6.6. But while download page offers quite a variety of pre-built packages for different operating systems, there is no 0.6.6 build for Mac OS (only 0.6.5 is available).


    

I found this peculiar, so I decided to try to build it from sources myself. It also seemed like a good opportunity to finally try RetroShare, as it has been available for more than 15 years, and I&rsquo;ve heard many good things about it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://retifrav.github.io/blog/2021/04/01/macos-building-retroshare/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2021-04-01T21:14:20+02:00" />
<meta property="article:modified_time" content="2021-04-01T21:14:20+02:00" />


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2021/04/01/macos-building-retroshare/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Building RetroShare on Mac OS</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2021-04-01 21:14:20 &#43;0200</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 14 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>A couple of weeks ago <a href="https://retroshare.cc/">RetroShare</a> has released version <a href="https://retroshareteam.wordpress.com/2021/03/15/release-notes-for-v0-6-6/">0.6.6</a>. But while download page offers quite a variety of pre-built packages for different operating systems, there is no 0.6.6 build for Mac OS (<em>only 0.6.5 is available</em>).</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-splash.png" alt="RetroShare splash">

<p>I found this peculiar, so I decided to try to build it from sources myself. It also seemed like a good opportunity to finally try RetroShare, as it has been available for more than 15 years, and I&rsquo;ve heard many good things about it.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#building">Building</a>
      <ul>
        <li><a href="#without-plugins">Without plugins</a>
          <ul>
            <li><a href="#sdk-resolving-issue">SDK resolving issue</a></li>
            <li><a href="#missing-openssl-headers-paths">Missing OpenSSL headers paths</a></li>
            <li><a href="#missing-dependencies">Missing dependencies</a></li>
            <li><a href="#missing-paths-to-linked-libraries">Missing paths to linked libraries</a></li>
            <li><a href="#features">Features</a></li>
          </ul>
        </li>
        <li><a href="#with-plugins">With plugins</a></li>
        <li><a href="#what-about-building-from-qt-creator">What about building from Qt Creator</a></li>
      </ul>
    </li>
    <li><a href="#deployment">Deployment</a>
      <ul>
        <li><a href="#bundling-resources">Bundling resources</a></li>
        <li><a href="#making-a-dmg">Making a DMG</a></li>
      </ul>
    </li>
    <li><a href="#other-notes">Other notes</a>
      <ul>
        <li><a href="#homebrew-is-awesome">Homebrew is awesome</a></li>
        <li><a href="#about-retroshare">About RetroShare</a>
          <ul>
            <li><a href="#documentation-isnt-great">Documentation isn&rsquo;t great</a></li>
            <li><a href="#inconsistent-connectivity">Inconsistent connectivity</a>
              <ul>
                <li><a href="#windows">Windows</a></li>
                <li><a href="#mac-os">Mac OS</a></li>
                <li><a href="#linux">Linux</a></li>
              </ul>
            </li>
            <li><a href="#overall">Overall</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#my-builds">My builds</a></li>
  </ul>
</nav>
<p>At the moment Mac OS section on <a href="http://retroshare.cc/downloads.html">download page</a> looks like this:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-download-macos.png" alt="RetroShare download Mac OS">

<p>Let&rsquo;s take a cheeky look into the building process then.</p>
<h1 id="environment">Environment</h1>
<p>RetroShare is based on Qt and currently it uses <code>qmake</code>. So as the very minimum, aside from cloning <a href="https://github.com/RetroShare/RetroShare">the repository</a>, you need to have Qt installed in your system. If anything, I <a href="https://retifrav.github.io/blog/2020/12/04/qt-without-installer/">built</a> mine from sources, but it will most likely just as well work if you&rsquo;ll get it using <a href="https://www.qt.io/download-qt-installer">official installer</a>.</p>
<p>Just in case, here&rsquo;s my environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ sw_vers -productVersion
</span></span><span style="display:flex;"><span>10.15.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ xcrun --sdk macosx --show-sdk-version
</span></span><span style="display:flex;"><span>11.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gcc --version
</span></span><span style="display:flex;"><span>Configured with: --prefix<span style="color:#f92672">=</span>/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir<span style="color:#f92672">=</span>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/4.2.1
</span></span><span style="display:flex;"><span>Apple clang version 12.0.0 <span style="color:#f92672">(</span>clang-1200.0.32.29<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Target: x86_64-apple-darwin19.6.0
</span></span><span style="display:flex;"><span>Thread model: posix
</span></span><span style="display:flex;"><span>InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ qmake --version
</span></span><span style="display:flex;"><span>QMake version 3.1
</span></span><span style="display:flex;"><span>Using Qt version 5.15.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /path/to/retroshare/src
</span></span><span style="display:flex;"><span>$ git show
</span></span><span style="display:flex;"><span>751fffc30 <span style="color:#f92672">(</span>HEAD, tag: v0.6.6<span style="color:#f92672">)</span></span></span></code></pre></div>
<h1 id="building">Building</h1>
<p>The base application is extendable with plugins, and there is a <code>qmake</code> configuration option for building those too. I&rsquo;ll describe the process for both variants: with and without plugins.</p>
<p>Building without plugins is easier, because it has less 3rd-party dependencies. And I would say, 3rd-party dependencies is the main difficulty of building RetroShare from sources.</p>
<h2 id="without-plugins">Without plugins</h2>
<p>There is <a href="https://retrosharedocs.readthedocs.io/en/latest/developer/compilation/#compilation-on-macos">some documentation</a> on the matter (<em>more about that <a href="#documentation-isnt-great">later</a></em>), from which I got to know that I need to install the following dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install openssl
</span></span><span style="display:flex;"><span>$ brew install miniupnpc
</span></span><span style="display:flex;"><span>$ brew install libmicrohttpd</span></span></code></pre></div>
<h3 id="sdk-resolving-issue">SDK resolving issue</h3>
<p>Let&rsquo;s try to configure it now:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/rapidshare/src
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ qmake ..
</span></span><span style="display:flex;"><span>Project MESSAGE: RetroShare version 0.6.6-0-g751fffc30 determined via git
</span></span><span style="display:flex;"><span>Project WARNING: QMAKE: You have disabled deprecated warnings.
</span></span><span style="display:flex;"><span>Project WARNING: QMAKE: You have disabled C preprocessor warnings.
</span></span><span style="display:flex;"><span>Project WARNING: QMAKE: You have enabled RetroShare direct chat which is deprecated!
</span></span><span style="display:flex;"><span>Project MESSAGE: ***retroshare.pri: Set Target and SDK to MacOS 10.11
</span></span><span style="display:flex;"><span>Project MESSAGE: ***retroshare.pri:MacOSX
</span></span><span style="display:flex;"><span>Project ERROR: Could not resolve SDK SDKVersion <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;macosx10.11&#39;</span> using --show-sdk-version</span></span></code></pre></div>
<p>So right from the very beginning you are getting this fantastic error in your face. Smells like something is hardcoded somewhere.</p>
<p>And indeed, if you open <code>/path/to/retroshare/src/retroshare.pri</code>, there is this weird block at the line 129:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># To select your MacOsX version append the following assignation to qmake</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># command line &#34;CONFIG+=rs_macos10.11&#34; where 10.11 depends your version</span>
</span></span><span style="display:flex;"><span>macx:CONFIG *<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.8:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.9:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.10:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.12:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.13:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.14:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11
</span></span><span style="display:flex;"><span>rs_macos10.15:CONFIG -<span style="color:#f92672">=</span> rs_macos10.11</span></span></code></pre></div>
<p>This hardcoded list of versions doesn&rsquo;t look good at all. And no matter what values I provided to <code>CONFIG</code>, the configuration was always failing with the same error. Certainly can&rsquo;t tell what grand plan original developer had behind it, but it definitely does not make sense to me. So I ended up editing this block manually like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>macx:CONFIG *<span style="color:#f92672">=</span> rs_macos11.1
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.8:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.9:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.10:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.12:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.13:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.14:CONFIG -= rs_macos10.11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#rs_macos10.15:CONFIG -= rs_macos10.11</span></span></span></code></pre></div>
<p>Why <code>11.1</code>? Because that&rsquo;s what <code>xcrun</code> reports in my system, and apparently that&rsquo;s what is getting checked against during configuration.</p>
<p>Now the project configures fine, so we can build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake ..
</span></span><span style="display:flex;"><span>$ make -j12</span></span></code></pre></div>
<h3 id="missing-openssl-headers-paths">Missing OpenSSL headers paths</h3>
<p>But during the build I got these errors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>../../../openpgpsdk/src/openpgpsdk/packet.h:32:10: fatal error: <span style="color:#e6db74">&#39;openssl/bn.h&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;openssl/bn.h&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>../../../libretroshare/src/pqi/pqihash.h:26:10: fatal error: <span style="color:#e6db74">&#39;openssl/sha.h&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;openssl/sha.h&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>../../../retroshare-gui/src/TorControl/CryptoKey.cpp:41:10: fatal error: <span style="color:#e6db74">&#39;openssl/bn.h&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;openssl/bn.h&gt;</span></span></span></code></pre></div>
<p>That can be solved by explicitly providing paths to OpenSSL headers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/include&#34;</span> ..</span></span></code></pre></div>
<p>By the way, Homebrew had a warning about something similar:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>openssl@1.1 is keg-only, which means it was not symlinked into /usr/local,
</span></span><span style="display:flex;"><span>because macOS provides LibreSSL.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If you need to have openssl@1.1 first in your PATH, run:
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#39;export PATH=&#34;/usr/local/opt/openssl@1.1/bin:$PATH&#34;&#39;</span> &gt;&gt; /Users/YOURNAME/.bash_profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For compilers to find openssl@1.1 you may need to set:
</span></span><span style="display:flex;"><span>  export LDFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-L/usr/local/opt/openssl@1.1/lib&#34;</span>
</span></span><span style="display:flex;"><span>  export CPPFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-I/usr/local/opt/openssl@1.1/include&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For pkg-config to find openssl@1.1 you may need to set:
</span></span><span style="display:flex;"><span>  export PKG_CONFIG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl@1.1/lib/pkgconfig&#34;</span></span></span></code></pre></div>
<p>and I tried to do so in my <code>~/.bash_profile</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/bin:</span>$PATH<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>export LDFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-L/usr/local/opt/openssl/lib&#34;</span>
</span></span><span style="display:flex;"><span>export CPPFLAGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-I/usr/local/opt/openssl/include&#34;</span>
</span></span><span style="display:flex;"><span>export PKG_CONFIG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/lib/pkgconfig&#34;</span></span></span></code></pre></div>
<p>but that didn&rsquo;t help. And providing paths via <code>qmake</code> CLI parameters did help, so that&rsquo;s what I will be doing going forward.</p>
<h3 id="missing-dependencies">Missing dependencies</h3>
<p>Next error I got was this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>../../../libretroshare/src/util/rsjson.h:24:10: fatal error: <span style="color:#e6db74">&#39;rapidjson/document.h&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;rapidjson/document.h&gt;</span></span></span></code></pre></div>
<p>That is solved by installing <a href="https://miloyip.github.io/rapidjson/">RapidJSON</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install rapidjson</span></span></code></pre></div>
<p>Then there was this error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>../../../libretroshare/src/rsserver/p3face-info.cc:31:11: fatal error: <span style="color:#e6db74">&#39;sqlcipher/sqlite3.h&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;sqlcipher/sqlite3.h&gt;</span></span></span></code></pre></div>
<p>That is solved by installing <a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install sqlcipher</span></span></code></pre></div>
<h3 id="missing-paths-to-linked-libraries">Missing paths to linked libraries</h3>
<p>After that everything finally built, but failed on linking stage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ld: library not found <span style="color:#66d9ef">for</span> -lsqlcipher
</span></span><span style="display:flex;"><span>ld: library not found <span style="color:#66d9ef">for</span> -lminiupnpc
</span></span><span style="display:flex;"><span>ld: library not found <span style="color:#66d9ef">for</span> -lssl</span></span></code></pre></div>
<p>That is because providing just include paths is not enough, you also need to provide paths to linked libraries binaries. So, the final sequence of commands to configure and build RetroShare (<em>without plugins</em>) is this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/rapidshare/src
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ qmake <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/sqlcipher/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/miniupnpc/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ make -j12</span></span></code></pre></div>
<h3 id="features">Features</h3>
<p>You might want to enable/disable certain application features:</p>
<ul>
<li>by default <code>autologin</code> is disabled, so you&rsquo;ll need to enter your password every time you launch RetroShare, which is certainly more secure but also rather annoying</li>
<li>another example is <code>retroshare_service</code>, which, if I understood correctly, allows RetroShare to run &ldquo;headless&rdquo; (<em>without GUI</em>). It is enabled by default, and I don&rsquo;t need it</li>
<li>not sure what <code>use_native_dialogs</code> does, but it is disabled by default, and having enabled it I seem to get more responsive GUI dialogs in the application</li>
</ul>
<p>So my configuration looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/sqlcipher/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/miniupnpc/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>rs_autologin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>no_retroshare_service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>rs_use_native_dialogs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>release <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>..</span></span></code></pre></div>
<p>Building takes about 8 minutes on my Mac, and as a result I get a working RetroShare application in <code>/path/to/retroshare/src/build/retroshare-gui/src/RetroShare.app</code>.</p>
<h2 id="with-plugins">With plugins</h2>
<p>RetroShare has some plugins as part of the main repository, and there are also plugins in separate repositories (<em>for example, <a href="https://github.com/RetroShare/RetroChess">RetroChess</a></em>).</p>
<p>To enable building RetroShare with plugins, you need to set this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake CONFIG<span style="color:#f92672">+=</span>retroshare_plugins ..</span></span></code></pre></div>
<p>If you want to build more plugins than just the ones from main repository, clone their repositories and copy sources to <code>/path/to/retroshare/src/plugins</code> folder and add them in <code>plugins.pro</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">SUBDIRS</span> <span style="color:#f92672">+=</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">VOIP</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FeedReader</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">RetroChess</span> <span style="color:#66d9ef">#</span> added</span></span></code></pre></div>
<p>Before building you need to install required dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install ffmpeg
</span></span><span style="display:flex;"><span>$ brew install speex
</span></span><span style="display:flex;"><span>$ brew install speexdsp
</span></span><span style="display:flex;"><span>$ brew install opencv</span></span></code></pre></div>
<p>The last one, <a href="https://opencv.org/">OpenCV</a>, is one crazy package. It drags a whole bunch of dependencies of its own, which in turn drag a lot more on their own, including by the way Qt. You can see the full list for yourself:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew deps --tree --installed opencv</span></span></code></pre></div>
<p>Anyway, having installed all the dependencies, you can now build the project. Needless to say, you&rsquo;ll face errors about missing headers and linked libraries, so to save you some time, here are all of them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/sqlcipher/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/miniupnpc/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/opencv/include/opencv4&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/opencv/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speex/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speex/lib/&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speexdsp/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speexdsp/lib/&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/ffmpeg/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>retroshare_plugins <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>..</span></span></code></pre></div>
<p>&hellip;Yet, you will still get errors, though different ones this time. Here&rsquo;s the first one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Undefined symbols <span style="color:#66d9ef">for</span> architecture x86_64:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;cv::VideoCapture::VideoCapture(int, int)&#34;</span>, referenced from:
</span></span><span style="display:flex;"><span>      QVideoInputDevice::start<span style="color:#f92672">()</span> in QVideoDevice.o
</span></span><span style="display:flex;"><span>ld: symbol<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> not found <span style="color:#66d9ef">for</span> architecture x86_64
</span></span><span style="display:flex;"><span>clang: error: linker command failed with exit code <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>use -v to see invocation<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>make<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span>: *** <span style="color:#f92672">[</span>lib/libVOIP.dylib<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>make<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: *** <span style="color:#f92672">[</span>sub-VOIP-make_first<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>make: *** <span style="color:#f92672">[</span>plugins-make_first<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">2</span></span></span></code></pre></div>
<p>This one is happening because RetroShare doesn&rsquo;t link to one of the libraries from OpenCV. To find out which one, you can google for <code>cv::VideoCapture</code> and discover that it&rsquo;s part of <a href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html">videoio</a>, so you need to add that missing link with <code>LIBS+=-lopencv_videoio</code>.</p>
<p>Next error was more difficult to figure out:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>usr/include/libxslt/xslt.h:83:22: error: default initialization of an object of const type <span style="color:#e6db74">&#39;const int&#39;</span></span></span></code></pre></div>
<p>Luckily, I&rsquo;ve encountered something similar (<em><a href="https://github.com/ffi/ffi/issues/791#issuecomment-645594873">not exactly</a></em>) before, so soon enough I suspected that it&rsquo;s yet again Mac OS providing an obsolete version of a library. And indeed, after I installed and used the latest <a href="http://xmlsoft.org/XSLT/">XSLT</a> library:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install libxslt</span></span></code></pre></div>
<p>the problem was gone. So, here&rsquo;s the final configuration command (<em>with the <a href="#features">features</a> I&rsquo;ve enabled</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ qmake <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/openssl/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/sqlcipher/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/miniupnpc/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/opencv/include/opencv4&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/opencv/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speex/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speex/lib/&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speexdsp/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/speexdsp/lib/&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>INCLUDEPATH<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/libxslt/include&#34;</span> QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/libxslt/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>QMAKE_LIBDIR<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/local/opt/ffmpeg/lib&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>LIBS<span style="color:#f92672">+=</span>-lopencv_videoio <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>retroshare_plugins <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>rs_autologin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>no_retroshare_service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>rs_use_native_dialogs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>CONFIG<span style="color:#f92672">+=</span>release <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>..</span></span></code></pre></div>
<p>Having built such a configuration, aside from <code>RetroShare.app</code> you will also get plugins built in <code>/path/to/retroshare/src/build/plugins/**/lib/*.dylib</code>. These files needs to be either bundled into <code>RetroShare.app/Contents/Resources/</code> or copied to <code>/Users/YOURNAME/.retroshare/extensions6/</code> (<em>or whichever path is set in Preferences</em>). Having done that, when you launch RetroShare next time, it should discover the plugins:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-plugins.png" alt="RetroShare plugins discovery">

<h2 id="what-about-building-from-qt-creator">What about building from Qt Creator</h2>
<p>You might ask, why building with bare <code>qmake</code> from CLI, why not building from Qt Creator?</p>
<p>Well, first of all, building from CLI is just faster and actually more convenient. But also here&rsquo;s what I get when I try to build the RetroShare project from Qt Creator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/bin/sh: cmake: command not found
</span></span><span style="display:flex;"><span>make<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: *** <span style="color:#f92672">[</span>../../supportlibs/udp-discovery-cpp/libudp-discovery.a<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">127</span></span></span></code></pre></div>
<p>And I&rsquo;ve no idea what this is about. I have CMake discoverable in my PATH, and also it is added in Qt Creator settings, and also I can build other CMake projects from Qt Creator just fine. Yeah, no idea.</p>
<h1 id="deployment">Deployment</h1>
<h2 id="bundling-resources">Bundling resources</h2>
<p>There are certain styles files which need to be bundled in the <a href="https://en.wikipedia.org/wiki/Bundle_(macOS)#Application_bundles">application bundle</a>. Not sure why those are not added to <a href="https://doc.qt.io/qt-5/resources.html">resources</a>.</p>
<p>So, if you won&rsquo;t bundle those, the application will still work, but you will be missing some skins/styles in the list of available style options, for example Bubble style for chats:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-bubble-style.png" alt="RetroShare chat styles">

<p>Bundling stuff into application bundle on Mac OS with <code>qmake</code> is done via <a href="https://doc.qt.io/qt-5/qmake-variable-reference.html#qmake-bundle-data">QMAKE_BUNDLE_DATA</a>. In <code>/path/to/retroshare/src/retroshare-gui/src/retroshare-gui.pro</code> on line 275 there is a block for <code>macx</code> <a href="https://doc.qt.io/qt-5/qmake-language.html#scopes-and-conditions">scope</a> - that&rsquo;s where the application icon is getting bundled, by the way. To bundle styles (<em>or other resources</em>) too, add the following lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>dplQSS.files <span style="color:#f92672">=</span> $$PWD/qss
</span></span><span style="display:flex;"><span>dplQSS.path <span style="color:#f92672">=</span> Contents/Resources
</span></span><span style="display:flex;"><span>QMAKE_BUNDLE_DATA <span style="color:#f92672">+=</span> dplQSS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dplChatStyles.files <span style="color:#f92672">=</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    $$PWD/gui/qss/chat/Bubble <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    $$PWD/gui/qss/chat/Bubble_Compact
</span></span><span style="display:flex;"><span>dplChatStyles.path <span style="color:#f92672">=</span> Contents/Resources/stylesheets
</span></span><span style="display:flex;"><span>QMAKE_BUNDLE_DATA <span style="color:#f92672">+=</span> dplChatStyles</span></span></code></pre></div>
<p>Having configured and built the application, you should get the following contents in your RetroShare application bundle:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">2</span> /path/to/retroshare/src/build/retroshare-gui/src/RetroShare.app/Contents/Resources/
</span></span><span style="display:flex;"><span>├── empty.lproj
</span></span><span style="display:flex;"><span>├── qss
</span></span><span style="display:flex;"><span>│   ├── blacknight/
</span></span><span style="display:flex;"><span>│   ├── blue/
</span></span><span style="display:flex;"><span>│   ├── blue.qss
</span></span><span style="display:flex;"><span>│   ├── groove.qss
</span></span><span style="display:flex;"><span>│   ├── orangesurfer/
</span></span><span style="display:flex;"><span>│   ├── orangesurfer.qss
</span></span><span style="display:flex;"><span>│   ├── qdarkstyle/
</span></span><span style="display:flex;"><span>│   ├── qdarkstyle-v2.qss
</span></span><span style="display:flex;"><span>│   ├── qdarkstyle.qss
</span></span><span style="display:flex;"><span>│   ├── qlive/
</span></span><span style="display:flex;"><span>│   ├── qlive.qss
</span></span><span style="display:flex;"><span>│   ├── redscorpion/
</span></span><span style="display:flex;"><span>│   ├── redscorpion.qss
</span></span><span style="display:flex;"><span>│   ├── silver/
</span></span><span style="display:flex;"><span>│   ├── silver.qss
</span></span><span style="display:flex;"><span>│   ├── uus/
</span></span><span style="display:flex;"><span>│   ├── uus.qss
</span></span><span style="display:flex;"><span>│   ├── yaba/
</span></span><span style="display:flex;"><span>│   ├── yaba.qss
</span></span><span style="display:flex;"><span>│   ├── yeah/
</span></span><span style="display:flex;"><span>│   └── yeah.qss
</span></span><span style="display:flex;"><span>├── rsMacIcon.icns
</span></span><span style="display:flex;"><span>└── stylesheets
</span></span><span style="display:flex;"><span>    ├── Bubble/
</span></span><span style="display:flex;"><span>    └── Bubble_Compact/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span> directories, <span style="color:#ae81ff">13</span> files</span></span></code></pre></div>
<h2 id="making-a-dmg">Making a DMG</h2>
<p>If you&rsquo;d like to distribute your build to other people, you&rsquo;ll need to bundle required libraries and frameworks and also make a <a href="https://en.wikipedia.org/wiki/Apple_Disk_Image">DMG</a>.</p>
<p>Why DMG? No particular reason, really. It can just as well be a ZIP archive, but DMG seem to be more common for distributing applications on Mac OS.</p>
<p>In order to find and copy all the required libraries and frameworks, I would recommend to use <a href="https://doc.qt.io/qt-5/macos-deployment.html#macdeploy">macdeployqt</a>. Actually, I would not recommend it, as it seem to bundle some redundant things as well, for example <a href="https://doc.qt.io/qt-5/qtvirtualkeyboard-index.html">Virtual Keyboard</a>, which I don&rsquo;t think is used in RetroShare. But still - it does the job, so it&rsquo;s easier to copy all the dependencies with <code>macdeployqt</code> than to find and copy them manually. Though RetroShare plugins do need to be copied manually.</p>
<p>Conveniently enough, <code>macdeployqt</code> can also make a DMG. So here&rsquo;s the entire chain of commands for deployment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>retroshare<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp \
</span></span><span style="display:flex;"><span><span style="color:#f92672">./</span>plugins<span style="color:#f92672">/</span><span style="color:#a6e22e">FeedReader</span><span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libFeedReader<span style="color:#f92672">.</span>dylib \
</span></span><span style="display:flex;"><span><span style="color:#f92672">./</span>plugins<span style="color:#f92672">/</span><span style="color:#a6e22e">VOIP</span><span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libVOIP<span style="color:#f92672">.</span>dylib \
</span></span><span style="display:flex;"><span><span style="color:#f92672">./</span>plugins<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroChess</span><span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libRetroChess<span style="color:#f92672">.</span>dylib \
</span></span><span style="display:flex;"><span><span style="color:#f92672">./</span>retroshare<span style="color:#f92672">-</span>gui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroShare</span><span style="color:#f92672">.</span>app<span style="color:#f92672">/</span><span style="color:#a6e22e">Contents</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Resources</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>hs <span style="color:#f92672">./</span>retroshare<span style="color:#f92672">-</span>gui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroShare</span><span style="color:#f92672">.</span>app
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">28</span>M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ macdeployqt <span style="color:#f92672">./</span>retroshare<span style="color:#f92672">-</span>gui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroShare</span><span style="color:#f92672">.</span>app <span style="color:#f92672">-</span>dmg <span style="color:#f92672">-</span>verbose<span style="color:#66d9ef">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>hs <span style="color:#f92672">./</span>retroshare<span style="color:#f92672">-</span>gui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroShare</span><span style="color:#f92672">.</span>app
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">220</span>M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>hs <span style="color:#f92672">./</span>retroshare<span style="color:#f92672">-</span>gui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#a6e22e">RetroShare</span><span style="color:#f92672">.</span>dmg
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">81</span>M</span></span></code></pre></div>
<h1 id="other-notes">Other notes</h1>
<h2 id="homebrew-is-awesome">Homebrew is awesome</h2>
<p>I must say, <a href="https://brew.sh/">Homebrew</a> is an absolute life savior. Getting (<em>and building</em>) all the dependencies without it would take dramatically more time. Or maybe I would have just given up halfway.</p>
<h2 id="about-retroshare">About RetroShare</h2>
<p>I&rsquo;ve never used RetroShare before, and here&rsquo;s what I can tell after using it for a week.</p>
<h3 id="documentation-isnt-great">Documentation isn&rsquo;t great</h3>
<p>Documentation, and namely Mac OS build instructions, is scattered across several places. I could count at least five:</p>
<ol>
<li><a href="https://github.com/RetroShare/documentation">One repository</a></li>
<li><a href="https://github.com/RetroShare/docs">Another repository</a></li>
<li>Three documents (<em>and a patch</em>) in the <a href="https://github.com/RetroShare/RetroShare/tree/v0.6.6-Official-Release/build_scripts/OSX">main repository</a>:
<ul>
<li><code>MacOS.10.6_RS_Compilation_Instructions.txt</code></li>
<li><code>MacOS_X_InstallGuide.md</code></li>
<li><code>OSX_RS_Compilation_Instructions.txt</code></li>
<li><code>retroshare-mac-build.patch</code></li>
</ul>
</li>
</ol>
<p>The manual for building is not very helpful, which is why I created this very article. I would even say, the instructions from manual are half-baked and written in a negligent manner, there are a lot of typos and it even contains nonsense like:</p>
<blockquote>In QtCreator Option Git add its path:
<pre><code>C:\Program Files\Git\bin</code></pre></blockquote>
<p>That is from the section about building RetroShare on Mac OS.</p>
<p>General documentation content also seems to be outdated. There are screenshots of menus and settings that no longer exist, and some instructions refer to no longer existing things as well.</p>
<p>Surely, I would be happy to make my contribution and update the documentation with my instructions, and also to fix typos and to make it look better. But given its current state, it just feels like my efforts would go into a void. At the very least documentation should be concentrated in one place first.</p>
<h3 id="inconsistent-connectivity">Inconsistent connectivity</h3>
<p>RetroShare requires you to have &ldquo;friends&rdquo; - other people&rsquo;s nodes who added you as their &ldquo;friend&rdquo;. There are no servers: basically everyone is a server, and together they form a <a href="https://en.wikipedia.org/wiki/Friend-to-friend">network</a>.</p>
<p>That is the first difficulty you will encounter, but that is not an issue, and actually that is one of the main features of RetroShare. It&rsquo;s even awesome. Also, luckily enough, I&rsquo;ve got invites from several people, so I had at least something to connect to.</p>
<p>The real issues started to appear later: I tried running RetroShare on Windows, Mac OS and Linux, and I had different experience on all three.</p>
<h4 id="windows">Windows</h4>
<p>On Windows I seemed to get connected at first, and I was even getting forums, chats and so on, but the very next day it just stopped: I am no longer able to see any forums, and all the chats I entered the day before now have no people in them.</p>
<p>The NAT and DHT indicators show the following:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-dht-windows.png" alt="RetroShare DHT on Windows">

<p>And neither of them ever got green.</p>
<h4 id="mac-os">Mac OS</h4>
<p>Then I tried it on Mac OS, as by that moment I&rsquo;ve managed to build it. There it was better, and I get forum posts, chats and so on.</p>
<p>The NAT and DHT indicators, however, are all red:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-dht-macos.png" alt="RetroShare DHT on Mac OS">

<p>Plus Network settings seem to have some troubles getting external IP, though I am not sure if it matters:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-network-macos.png" alt="RetroShare Network on Mac OS">

<h4 id="linux">Linux</h4>
<p>Finally, I tried RetroShare in a virtual machine running Linux, and would you look at that:</p>


    <img class="image-post" loading="lazy" src="/blog/2021/04/01/macos-building-retroshare/images/retroshare-dht-linux.png" alt="RetroShare DHT on Linux">

<p>Everything is green!</p>
<p>No idea, how come the same thing works so differently across different platforms in the same network. I even tried forwarding ports on my router - that didn&rsquo;t change a thing: still, only Linux had green DHT indicator, and Windows was still having troubles getting content.</p>
<h3 id="overall">Overall</h3>
<p>As much as I wanted to like it, as a user, I can&rsquo;t say that I will use RetroShare every day or rely on it for something important. It could be that this is because I am still an unexperienced user, but it has been more than a week as I&rsquo;m trying to get familiar with it, and now I am about to give up.</p>
<p>The idea is certainly great, no doubt about that, especially looking at how &ldquo;normal&rdquo; internet is going to shit, but implementation is certainly not perfect. Aside from inconsistent connectivity, there are random (<em>but seldom</em>) application crashes, GUI can freeze on certain actions, notification flags on tabs do not disappear even though there are no unread items left, etc - all that results in not a great user experience.</p>
<p>On the bright side, though, the repository is <a href="https://github.com/RetroShare/RetroShare/commits/master">rather active</a>, so hopefully it all will get better eventually. Maybe I will even find some time to help fixing those issues.</p>
<p>And as a developer, I must admit the fact that (<em>despite the length of my article</em>) RetroShare actually builds just fine on Mac OS, and almost all the troubles I had were coming from missing dependencies. Given the cross-platform nature and the size of the project, this is quite impressive, especially considering that Mac OS is not its primary target platform.</p>
<h1 id="my-builds">My builds</h1>
<p>Here are magnet links for my RetroShare 0.6.6 builds on Mac OS:</p>
<ul>
<li><a href="magnet:?xt=urn:btih:90f8565a607896698199210b91e7202d2ebcb91d&amp;dn=RetroShare%5F0.6.6-MacOS%5F10.15.7-Qt%5F5.15.2-no%5Fplugins.dmg&amp;tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A6969&amp;tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&amp;tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce&amp;tr=udp%3A%2F%2Fopentor.org%3A2710%2Fannounce&amp;tr=udp%3A%2F%2Ftracker.cyberia.is%3A6969%2Fannounce">without plugins</a></li>
<li><a href="magnet:?xt=urn:btih:a4e809ef5bdd7505c0a0c11acf666501bbed830f&amp;dn=RetroShare%5F0.6.6-MacOS%5F10.15.7-Qt%5F5.15.2-with%5Fplugins.dmg&amp;tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A6969&amp;tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&amp;tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce&amp;tr=udp%3A%2F%2Fopentor.org%3A2710%2Fannounce&amp;tr=udp%3A%2F%2Ftracker.cyberia.is%3A6969%2Fannounce">with plugins</a></li>
</ul>
<p>Let me know if it fails to run on your system, because I suspect that <code>macdeployqt</code> doesn&rsquo;t actually pack all the dependencies.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/macos/">macos</a><a class="tag" href="https://retifrav.github.io/tags/qt/">qt</a><a class="tag" href="https://retifrav.github.io/tags/soft/">soft</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <script>
  var id =  60 ;

  if (id)
  {
    let url = "https://github.com/retifrav/retifrav.github.io/issues/".concat(id);
    let api_url = "https://api.github.com/repos/retifrav/retifrav.github.io/issues/".concat(id, "/comments");
    
    var commentsDiv = document.getElementById("comments");

    let xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("GET", api_url);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
    xhr.send();

    xhr.onload = function()
    {
      if (xhr.status != 200)
      {
        let errorText = document.createElement("p");
        errorText.innerHTML = "<i>Comments for this post yet are not opened yet (or you have GitHub scripts disabled).</i>";
        commentsDiv.appendChild(errorText);
      }
      else
      {
        let comments = xhr.response;

        let mainHeader = document.createElement("h2");
        mainHeader.innerHTML = "Comments: ".concat(comments.length);
        commentsDiv.appendChild(mainHeader);

        let issueLink = document.createElement("p");
        issueLink.innerHTML = "<i>You can leave a comment using this <a href='".concat(url, "'>GitHub issue</a>.</i>");
        commentsDiv.appendChild(issueLink);
        
        comments.forEach(function(comment)
        {
            let commentContent = document.createElement("div");
            commentContent.setAttribute('class', 'gh-comment')
            commentContent.innerHTML = "".concat(
                "<div class='gh-header'>",
                  "<img src='", comment.user.avatar_url, "' />",
                  "<div style='margin:auto 0;'>",
                    "<b><a class='gh-username' href='", comment.user.html_url, "'>", comment.user.login, "</a></b>",
                    " commented at <em>", new Date(comment.created_at), "</em>",
                  "</div>",
                "</div>",
                "<div class='gh-body'>",
                  comment.body_html,
                "</div>"
            );
            commentsDiv.appendChild(commentContent);
        });
      }
    };

    xhr.onerror = function()
    {
      let errorText = document.createElement("p");
      errorText.innerHTML = "<i>Some error loading comments.</i>";
      commentsDiv.appendChild(errorText);
    };
  }
</script>

      
      </div>
    </div>
  </div>

        <div id="footer">
          <div>
              2014 - 2023,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <a href="/index.xml" title="Subscribe to RSS"><img src="/images/rss.png" width="50px"></a>
              <a style="margin-left: 5px;" href="https://t.me/decovar" title="Telegram channel"><img src="/images/telegram.png" width="50px"></a>
            </div>
            <div id="telegramWidgetBlock" class="sidebar-section"></div>
            <div class="sidebar-section">
                <h3>Stuff</h3>
                <ul class="sidebar-list">
                    <li><a href="/stuff/kakoi-jvotne-vi-kysaiti/index.html">КАКОИ ЖВОТНЕ ВЫ КУСАИТИ?</a></li>
                </ul>
            </div>
            <div id="social-networks" class="sidebar-section">
              <h3>Social networks</h3>
              <div style="font-family:Courier New;">
                  Zuck: <i>Yeah so if you ever need info about anyone at Harvard</i><br/>
                  Zuck: <i>Just ask</i><br/>
                  Zuck: <i>I have over 4,000 emails, pictures, addresses, SNS</i><br/>
                  smb: <i>What? How'd you manage that one?</i><br/>
                  Zuck: <i>People just submitted it.</i><br/>
                  Zuck: <i>I don't know why.</i><br/>
                  Zuck: <i>They "trust me"</i><br/>
                  Zuck: <i>Dumb fucks</i>
              </div>
            </div>
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (65)</a></li>
                  
                  <li><a href="/tags/fail">fail (39)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (36)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/linux">linux (27)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (14)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (10)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/ios">ios (7)</a></li>
                  
                  <li><a href="/tags/apple">apple (6)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/android">android (3)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53340325-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "UA-53340325-1");
    </script>

    <script>
        const telegramBlock = document.getElementById("telegramWidgetBlock");
        window.onload = () =>
        {
            const pinnedTelegramPosts = [277,279,306,312,319]
            const randomedPostID = pinnedTelegramPosts[
                Math.floor(Math.random() * pinnedTelegramPosts.length)
            ];
            const telegramWidgetScript = document.createElement("script");
            telegramWidgetScript.src = "https://telegram.org/js/telegram-widget.js?21";
            telegramWidgetScript.dataset["telegramPost"] = `decovar/${randomedPostID}`;
            telegramWidgetScript.dataset["color"] = "1E8448";
            telegramWidgetScript.dataset["width"] = "100%";
            telegramWidgetScript.dataset["userpic"] = "false";
            telegramBlock.appendChild(telegramWidgetScript);
        }
    </script>

    
    
  </body>
</html>

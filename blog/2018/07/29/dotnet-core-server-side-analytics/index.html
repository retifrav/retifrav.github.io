<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Server-side analytics in .NET Core | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2018/07/29/dotnet-core-server-side-analytics/" />

    <meta name="generator" content="Hugo 0.117.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="" />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:title" content="Server-side analytics in .NET Core" />
<meta property="og:description" content="Google Analytics is a good tool for analyzing your website audience, but it uses client-side code (JS), which is not always reliable, because you don&rsquo;t control what&rsquo;s happening there, and users can simply disable GA scripts (web-browsers even start to block such tracking out-of-the-box).


    

More reliable way to analyze your visitors would be a server-side analytics." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://retifrav.github.io/blog/2018/07/29/dotnet-core-server-side-analytics/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-07-29T18:28:00+02:00" />
<meta property="article:modified_time" content="2018-07-29T18:28:00+02:00" />


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2018/07/29/dotnet-core-server-side-analytics/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Server-side analytics in .NET Core</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2018-07-29 18:28:00 &#43;0200</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 8 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>Google Analytics is a good tool for analyzing your website audience, but it uses client-side code (JS), which is not always reliable, because you don&rsquo;t control what&rsquo;s happening there, and users can simply disable GA scripts (web-browsers even start to block such tracking out-of-the-box).</p>


    <img class="image-post" loading="lazy" src="/blog/2018/07/29/dotnet-core-server-side-analytics/images/dotnet-core-analytics.png" alt=".NET Core analytics">

<p>More reliable way to analyze your visitors would be a server-side analytics.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#why-to-use-server-side-analytics">Why to use server-side analytics</a></li>
    <li><a href="#adding-analytics-in-net-core">Adding analytics in .NET Core</a>
      <ul>
        <li><a href="#custom-middleware">Custom middleware</a></li>
        <li><a href="#how-to-deal-with-a-reverse-proxy">How to deal with a reverse proxy</a></li>
        <li><a href="#analyzing-collected-data">Analyzing collected data</a></li>
      </ul>
    </li>
    <li><a href="#bonus-part">Bonus part</a>
      <ul>
        <li><a href="#some-interesting-requests">Some interesting requests</a></li>
        <li><a href="#headers-override">Headers override</a></li>
      </ul>
    </li>
    <li><a href="#updates">Updates</a>
      <ul>
        <li><a href="#2020-05-20--goaccess">2020-05-20 | GoAccess</a></li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="why-to-use-server-side-analytics">Why to use server-side analytics</h1>
<p>I mean, come on, you own the server, so your analytics numbers will be much more precise (or actually, <em>absolutely correct</em>) - it&rsquo;s just inevitable, because every request goes through your server, and you can count and analyze them. On top of that you won&rsquo;t be dependent on a 3rd-party instance, so you won&rsquo;t share your (<em>and your visitors</em>) data with it.</p>
<p>Speaking about numbers being more precise. Right now GA tells me that there were <strong>3</strong> visitors on my website today. Whereas according to my analytics I had <strong>34</strong> visitors without bots and <strong>45</strong> in total.</p>
<p>There are downsides though.</p>
<p>First one is the increased workload on your server. The more visitors you have (<em>requests per second</em>), the more loaded your server will be (<em>database, mostly</em>). And if you have quite a large daily audience, you might simply run out of hardware resources to process all that. But if you do have a large daily audience, then I guess you can spend some money on your infrastructure.</p>
<p>Another disadvantage of your own analytics comparing with the GA scripts is that you&rsquo;ll have to do lots of things yourself. For example, separating real human visitors from web-crawlers/robots or getting geography of your visitors based on their IP-addresses (<em>by the way, several users can have the same IP-address</em>). But we&rsquo;re not so easily scared by the difficulties, are we.</p>
<p>So let&rsquo;s see how to analyze your website visitors in .NET Core MVC project.</p>
<h1 id="adding-analytics-in-net-core">Adding analytics in .NET Core</h1>
<p>This can be done by using a custom middleware.</p>
<h2 id="custom-middleware">Custom middleware</h2>
<p>If you don&rsquo;t know what middleware is, Microsoft has a good <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/?view=aspnetcore-2.1&amp;tabs=aspnetcore2x">documentation</a> about that.</p>
<p>But I can explain basics a bit faster. You must remember that scene from <a href="https://www.themoviedb.org/movie/1911-the-13th-warrior">The 13th Warrior</a>, where vikings were sitting at the table and passing a bowl with water in a <a href="https://youtu.be/GkcsLFSAS30">quite peculiar manner</a>: everyone was washing from it and then spitting and blowing their nose in it, so every viking next in chain was getting bowl with more and more disgusting contents. In our case this bowl is a web-request, and vikings are middlewares.</p>
<p><font color="blue"><strong>Request</strong></font> (<em>bowl</em>) goes to the first middleware (<em>viking</em>), gets processed (<em>spitted into</em>), then goes to the next middleware (<em>next viking</em>), and so on. The last middleware (<em>viking</em>) in the chain/queue gets absolutely horrible bowl full of nasty things, does his part and sends it back via the same queue/chain (<em>so it goes in reverse order</em>). Others can add something to the bowl (<em>now it&rsquo;s a <font color="green"><strong>response</strong></font></em>) on its way back, but they prefer not touch it much.</p>
<p>So, what we will be doing here is adding a new middleware - a new viking to sit at the table, wash from the bowl and spit into it.</p>
<p>Take a look at your <code>Startup.cs</code> file. You&rsquo;ll see something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(
</span></span><span style="display:flex;"><span>    IApplicationBuilder app,
</span></span><span style="display:flex;"><span>    IHostingEnvironment env,
</span></span><span style="display:flex;"><span>    ILoggerFactory loggerFactory
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span>    app.UseStaticFiles(); <span style="color:#75715e">// middleware #1</span>
</span></span><span style="display:flex;"><span>    app.UseStatusCodePages(); <span style="color:#75715e">// middleware #2</span>
</span></span><span style="display:flex;"><span>    app.UseAuthentication(); <span style="color:#75715e">// middleware #3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>These <code>app.UseSOMETHING()</code> are middlewares. Their order is important, so <code>UseStaticFiles()</code> middleware gets the request first, then <code>UseStatusCodePages()</code>, then <code>UseAuthentication()</code>, and so on.</p>
<p>So where should we put our middleware? Of course, in the very beginning of this chain/queue, so every request is counted:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(
</span></span><span style="display:flex;"><span>    IApplicationBuilder app,
</span></span><span style="display:flex;"><span>    IHostingEnvironment env,
</span></span><span style="display:flex;"><span>    ILoggerFactory loggerFactory
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span>    app.UseAnalytics(); <span style="color:#75715e">// now this is middleware #1</span>
</span></span><span style="display:flex;"><span>    app.UseStaticFiles(); <span style="color:#75715e">// middleware #2</span>
</span></span><span style="display:flex;"><span>    app.UseStatusCodePages(); <span style="color:#75715e">// middleware #3</span>
</span></span><span style="display:flex;"><span>    app.UseAuthentication(); <span style="color:#75715e">// middleware #4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now we need to actually implement it. Create the <code>Middleware/AnalyticsMiddleware.cs</code> file in your project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> YOUR-PROJECT.Middleware
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnalyticsMiddleware</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> RequestDelegate _next;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ILogger _logger;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _connectionString { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IConfiguration _configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> AnalyticsMiddleware(
</span></span><span style="display:flex;"><span>            RequestDelegate next,
</span></span><span style="display:flex;"><span>            ILoggerFactory loggerFactory,
</span></span><span style="display:flex;"><span>            IConfiguration configuration
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _next = next;
</span></span><span style="display:flex;"><span>            _logger = loggerFactory.CreateLogger&lt;AnalyticsMiddleware&gt;();
</span></span><span style="display:flex;"><span>            _configuration = configuration;
</span></span><span style="display:flex;"><span>            _connectionString = _configuration.GetConnectionString(<span style="color:#e6db74">&#34;DefaultConnection&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task InvokeAsync(HttpContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                StringBuilder info = <span style="color:#66d9ef">new</span> StringBuilder(<span style="color:#e6db74">$&#34;Got a request{Environment.NewLine}---{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                info.Append(<span style="color:#e6db74">$&#34;- remote IP: {context.Connection.RemoteIpAddress}{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                info.Append(<span style="color:#e6db74">$&#34;- path: {context.Request.Path}{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                info.Append(<span style="color:#e6db74">$&#34;- query string: {context.Request.QueryString}{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                info.Append(<span style="color:#e6db74">$&#34;- [headers] ua: {context.Request.Headers[HeaderNames.UserAgent]}{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                info.Append(<span style="color:#e6db74">$&#34;- [headers] referer: {context.Request.Headers[HeaderNames.Referer]}{Environment.NewLine}&#34;</span>);
</span></span><span style="display:flex;"><span>                _logger.LogWarning(info.ToString());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// we don&#39;t care much about exceptions in analytics</span>
</span></span><span style="display:flex;"><span>                _logger.LogError(<span style="color:#e6db74">$&#34;Some error in analytics middleware. {ex.Message}&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> _next(context);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnalyticsMiddlewareExtensions</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IApplicationBuilder UseAnalytics(<span style="color:#66d9ef">this</span> IApplicationBuilder builder)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> builder.UseMiddleware&lt;AnalyticsMiddleware&gt;();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now every time your server (<em>website</em>) gets a request, you&rsquo;ll see the following in your log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>WARN  [<span style="color:#ae81ff">2018</span>-<span style="color:#ae81ff">07</span>-<span style="color:#ae81ff">27</span> <span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">19</span>] Got a visitor
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- remote IP: <span style="color:#ae81ff">127.0</span>.<span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>- path: /some/path
</span></span><span style="display:flex;"><span>- query <span style="color:#66d9ef">string</span>: ?some=param
</span></span><span style="display:flex;"><span>- [headers] ua: Mozilla/<span style="color:#ae81ff">5.0</span> (Macintosh; Intel Mac OS X <span style="color:#ae81ff">10.13</span>; rv:<span style="color:#ae81ff">62.0</span>) Gecko/<span style="color:#ae81ff">20100101</span> Firefox/<span style="color:#ae81ff">62.0</span>
</span></span><span style="display:flex;"><span>- [headers] referer: http:<span style="color:#75715e">//some-source</span></span></span></code></pre></div>
<p>But such a log-wall is rather hard to analyze, better to store this data in a database instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> (MySqlConnection sqlConn = <span style="color:#66d9ef">new</span> MySqlConnection(_connectionString))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    sqlConn.Open();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    MySqlCommand cmd = <span style="color:#66d9ef">new</span> MySqlCommand(<span style="color:#e6db74">&#34;INSERT INTO analytics(dt, ip, path, query, referer, ua) VALUES(@dt, @ip, @path, @query, @referer, @ua);&#34;</span>, sqlConn);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@dt&#34;</span>, DateTime.Now);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@ip&#34;</span>, context.Connection.RemoteIpAddress);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@path&#34;</span>, context.Request.Path);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@query&#34;</span>, context.Request.QueryString);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@referer&#34;</span>, context.Request.Headers[HeaderNames.Referer]);
</span></span><span style="display:flex;"><span>    cmd.Parameters.AddWithValue(<span style="color:#e6db74">&#34;@ua&#34;</span>, context.Request.Headers[HeaderNames.UserAgent]);
</span></span><span style="display:flex;"><span>    cmd.ExecuteNonQuery();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And here&rsquo;s the table for that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>analytics<span style="color:#f92672">`</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">11</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>dt<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>ip<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">45</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>path<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">250</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>query<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">500</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>referer<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">500</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">`</span>ua<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">250</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
</span></span><span style="display:flex;"><span>);</span></span></code></pre></div>
<p>Oh, by the way, since you&rsquo;re now collecting and storing your users data directly - it would be a good idea if you described that in your <code>/privacy.txt</code>.</p>
<h2 id="how-to-deal-with-a-reverse-proxy">How to deal with a reverse proxy</h2>
<p>If your Kestrel is running behind a reverse proxy (<em>which is recommended</em>), then all the IP addresses you get from it by default are <code>127.0.0.1</code>. To forward real IP addresses from the reverse proxy to your website you need to:</p>
<ol>
<li>Configure the proxy (<em>NGINX in my case</em>);</li>
<li>Configure the .NET Core application (<em>your website</em>).</li>
</ol>
<p>Here&rsquo;s a <a href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-2.1&amp;tabs=aspnetcore2x#configure-a-reverse-proxy-server">manual</a> from Microsoft.</p>
<p>Start with NGINX by <code>nano /etc/nginx/sites-available/WEBSITE</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://localhost:5000</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">keep-alive</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_cache_bypass</span> $http_upgrade;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># forward real IP address
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span>  <span style="color:#e6db74">X-Forwarded-Proto</span> $scheme;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And then add a <code>UseForwardedHeaders()</code> middleware (<em>yes, yet another, but this time a standard one</em>) in <code>Startup.cs</code> <em>before</em> your <code>UseAnalytics()</code> middleware:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// get real IP from reverse proxy</span>
</span></span><span style="display:flex;"><span>app.UseForwardedHeaders(<span style="color:#66d9ef">new</span> ForwardedHeadersOptions
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#75715e">// our custom analytics middleware</span>
</span></span><span style="display:flex;"><span>app.UseAnalytics();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...</span></span></span></code></pre></div>
<p>Now you will be getting real IP addresses forwarded from NGINX.</p>
<h2 id="analyzing-collected-data">Analyzing collected data</h2>
<p>Soon enough you&rsquo;ll discover, that quite a portion of requests:</p>
<ol>
<li>Are for some not that interesting resources like <code>/favicon.ico</code>, <code>/css/*</code>, <code>/fonts/*</code>, etc;</li>
<li>Are sent by search-crawlers and other robots.</li>
</ol>
<p>That trashes your analytics data a bit. But you can improve the situation.</p>
<p>First type of requests (<em>not interesting resources</em>) can be filtered by adding the following RegExp check:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (!Regex.IsMatch(
</span></span><span style="display:flex;"><span>    context.Request.Path,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">@&#34;(^\/css\/.*)|(^\/fonts\/.*)|(^\/images\/.*)|(^\/js\/.*)|(^\/lib\/.*)|(^\/favicon(-.*|.ico$))|(^\/robots.txt$)|(^\/rss.xml$)&#34;</span>,
</span></span><span style="display:flex;"><span>    RegexOptions.IgnoreCase
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only requests for &#34;good&#34; resources get processed here</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Second type of requests (<em>robots</em>) cannot be filtered out reliably enough. The only thing you can do about here is to check the <code>User-Agent</code>, but that is not reliable as you cannot know all the possible values for crawlers, and on top of that users can modify <code>User-Agent</code> value in their browsers. So you can only approximately assume that if this value contains <code>/bot</code> substring, then likely it is a bot:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (Regex.IsMatch(
</span></span><span style="display:flex;"><span>    context.Request.Headers[HeaderNames.UserAgent],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">@&#34;(\/bot)|(bot\/)&#34;</span>,
</span></span><span style="display:flex;"><span>    RegexOptions.IgnoreCase
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something with it, or actually simply don&#39;t analyze such requests</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>I decided to save and analyze those anyway. For instance, in my view for analytics I just mark such requests with a different color:</p>


    <img class="image-post" loading="lazy" src="/blog/2018/07/29/dotnet-core-server-side-analytics/images/bots.png" alt="Requests from bots">

<p>By the way, looking at statistics so far, bots/crawlers from Yandex are requesting my website several fucking times per hour. Google bots are much more humble in that regard.</p>
<h1 id="bonus-part">Bonus part</h1>
<h2 id="some-interesting-requests">Some interesting requests</h2>
<p>I added server-side analytics to my website just a couple of days ago, but I can already see some interesting requests in the collected data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">a2billing</span><span style="color:#f92672">/</span><span style="color:#f92672">admin</span><span style="color:#f92672">/</span><span style="color:#f92672">Public</span><span style="color:#f92672">/</span><span style="color:#f92672">PP_error</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">c</span><span style="color:#f92672">=</span><span style="color:#f92672">accessdenied</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">js</span><span style="color:#f92672">/</span><span style="color:#f92672">wpdialog</span>.<span style="color:#a6e22e">js</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">xmlrpc</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">rsd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">blog</span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">wordpress</span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">wp</span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">site</span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">cms</span><span style="color:#f92672">/</span><span style="color:#f92672">wp-includes</span><span style="color:#f92672">/</span><span style="color:#f92672">wlwmanifest</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">index</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">c</span><span style="color:#f92672">=</span><span style="color:#f92672">58</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewtopic</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">t</span><span style="color:#f92672">=</span><span style="color:#f92672">9377</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">dl</span><span style="color:#f92672">=</span><span style="color:#f92672">names</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">spmode</span><span style="color:#f92672">=</span><span style="color:#f92672">full</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewtopic</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">p</span><span style="color:#f92672">=</span><span style="color:#f92672">17478</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewtopic</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">p</span><span style="color:#f92672">=</span><span style="color:#f92672">13965</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewtopic</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">t</span><span style="color:#f92672">=</span><span style="color:#f92672">20277</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">manager</span><span style="color:#f92672">/</span><span style="color:#f92672">index</span>.<span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewforum</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">f</span><span style="color:#f92672">=</span><span style="color:#f92672">927</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewforum</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">f</span><span style="color:#f92672">=</span><span style="color:#f92672">915</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">viewforum</span>.<span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#f92672">f</span><span style="color:#f92672">=</span><span style="color:#f92672">1132</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">connectors</span><span style="color:#f92672">/</span><span style="color:#f92672">system</span><span style="color:#f92672">/</span><span style="color:#f92672">phpthumb</span>.<span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">libs</span><span style="color:#f92672">/</span><span style="color:#f92672">js</span><span style="color:#f92672">/</span><span style="color:#f92672">iframe</span>.<span style="color:#a6e22e">js</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#f92672">dbs</span>.<span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">idea</span><span style="color:#f92672">/</span><span style="color:#f92672">WebServers</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">ssh</span><span style="color:#f92672">/</span><span style="color:#f92672">id_dsa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">ssh</span><span style="color:#f92672">/</span><span style="color:#f92672">id_ecdsa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">ssh</span><span style="color:#f92672">/</span><span style="color:#f92672">id_ed25519</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">id_dsa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">ssh</span><span style="color:#f92672">/</span><span style="color:#f92672">id_rsa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">winscp</span>.<span style="color:#a6e22e">ini</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">WinSCP</span>.<span style="color:#a6e22e">ini</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">id_rsa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">filezilla</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">FileZilla</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">sitemanager</span>.<span style="color:#a6e22e">xml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">WS_FTP</span>.<span style="color:#a6e22e">ini</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">ws_ftp</span>.<span style="color:#a6e22e">ini</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">WS_FTP</span>.<span style="color:#a6e22e">INI</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">vscode</span><span style="color:#f92672">/</span><span style="color:#f92672">sftp</span>.<span style="color:#a6e22e">json</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">deployment-config</span>.<span style="color:#a6e22e">json</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">ftpsync</span>.<span style="color:#a6e22e">settings</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">ftpconfig</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">remote-sync</span>.<span style="color:#a6e22e">json</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">vscode</span><span style="color:#f92672">/</span><span style="color:#f92672">ftp-sync</span>.<span style="color:#a6e22e">json</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">lfm</span>.<span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">env</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#f92672">sftp-config</span>.<span style="color:#a6e22e">json</span></span></span></code></pre></div>
<p>Silly twats just assume there is Wordpress or some other PHP-based CMS (<em>what else, right?</em>) behind the website and they try to open commonly known pages (<em>with random IDs?</em>). So far I didn&rsquo;t see <code>/wp-admin</code> among those, which is surprising, but I guess it&rsquo;s just a matter of time before I get it.</p>
<h2 id="headers-override">Headers override</h2>
<p>By the way, since we&rsquo;ve touched the subject of middlewares. You can actually override some response headers to make the life of silly twats even more miserable by adding the following middleware:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#75715e">// rewrite some headers for more security</span>
</span></span><span style="display:flex;"><span>app.Use(<span style="color:#66d9ef">async</span> (context, next) =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    context.Response.OnStarting(() =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// if Antiforgery hasn&#39;t already set this header</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(context.Response.Headers[<span style="color:#e6db74">&#34;X-Frame-Options&#34;</span>]))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// do not allow to put your website pages into frames (prevents clickjacking)</span>
</span></span><span style="display:flex;"><span>            context.Response.Headers.Add(<span style="color:#e6db74">&#34;X-Frame-Options&#34;</span>, <span style="color:#e6db74">&#34;DENY&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// check MIME types (prevents MIME-based attacks)</span>
</span></span><span style="display:flex;"><span>        context.Response.Headers.Add(<span style="color:#e6db74">&#34;X-Content-Type-Options&#34;</span>, <span style="color:#e6db74">&#34;nosniff&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// hide server information</span>
</span></span><span style="display:flex;"><span>        context.Response.Headers.Add(<span style="color:#e6db74">&#34;Server&#34;</span>, <span style="color:#e6db74">&#34;ololo&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// allow to load scripts only from listed sources</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//context.Response.Headers.Add(&#34;Content-Security-Policy&#34;, &#34;default-src &#39;self&#39; *.google-analytics.com; style-src &#39;self&#39; &#39;unsafe-inline&#39;; script-src &#39;self&#39; &#39;unsafe-inline&#39;&#34;);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Task.FromResult(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> next();
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
<p>Note, however, that if you have a reverse proxy web-server, then most likely it will send its name in the <code>Server</code> header anyway (<em>so you need to change it there</em>).</p>
<hr class="updates-separator">
<h1 id="updates">Updates</h1>
<h2 id="2020-05-20--goaccess">2020-05-20 | GoAccess</h2>
<p>A perhaps easier way of analyzing visitors on your website would be to parse your web-server logs with a special tool, such as <a href="/blog/2020/05/20/visitors-analytics-with-goaccess/">GoAccess</a>.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/dotnet/">dotnet</a><a class="tag" href="https://retifrav.github.io/tags/web/">web</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <div style="border:2px orange solid; background-color: floralwhite; border-radius:0.5rem; padding: 10px 14px; font-style:italic; font-size:0.9em;">
              If you'd like to comment the article, you can do it on the
              <a href="https://decovar.dev/blog/2018/07/29/dotnet-core-server-side-analytics/#remark42" style="font-weight:bold;">
                  original website</a>. This one is just a mirror without comments.
          </div>
      
      </div>
    </div>
  </div>

        <div id="footer">
          <div>
              2014 - 2023,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <a href="/index.xml" title="Subscribe to RSS"><img src="/images/rss.png" width="50px"></a>
              <a style="margin-left: 5px;" href="https://t.me/decovar" title="Telegram channel"><img src="/images/telegram.png" width="50px"></a>
            </div>
            <div id="telegramWidgetBlock" class="sidebar-section"></div>
            <div class="sidebar-section">
                <h3>Stuff</h3>
                <ul class="sidebar-list">
                    <li><a href="/stuff/kakoi-jvotne-vi-kysaiti/index.html">КАКОИ ЖВОТНЕ ВЫ КУСАИТИ?</a></li>
                </ul>
            </div>
            <div id="social-networks" class="sidebar-section">
              <h3>Social networks</h3>
              <div style="font-family:Courier New;">
                  Zuck: <i>Yeah so if you ever need info about anyone at Harvard</i><br/>
                  Zuck: <i>Just ask</i><br/>
                  Zuck: <i>I have over 4,000 emails, pictures, addresses, SNS</i><br/>
                  smb: <i>What? How'd you manage that one?</i><br/>
                  Zuck: <i>People just submitted it.</i><br/>
                  Zuck: <i>I don't know why.</i><br/>
                  Zuck: <i>They "trust me"</i><br/>
                  Zuck: <i>Dumb fucks</i>
              </div>
            </div>
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (65)</a></li>
                  
                  <li><a href="/tags/fail">fail (39)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (36)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/linux">linux (27)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (14)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (10)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/ios">ios (7)</a></li>
                  
                  <li><a href="/tags/apple">apple (6)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/android">android (3)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53340325-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "UA-53340325-1");
    </script>

    <script>
        const telegramBlock = document.getElementById("telegramWidgetBlock");
        window.onload = () =>
        {
            const pinnedTelegramPosts = [323]
            const randomedPostID = pinnedTelegramPosts[
                Math.floor(Math.random() * pinnedTelegramPosts.length)
            ];
            const telegramWidgetScript = document.createElement("script");
            telegramWidgetScript.src = "https://telegram.org/js/telegram-widget.js?21";
            telegramWidgetScript.dataset["telegramPost"] = `decovar/${randomedPostID}`;
            telegramWidgetScript.dataset["color"] = "1E8448";
            telegramWidgetScript.dataset["width"] = "100%";
            telegramWidgetScript.dataset["userpic"] = "false";
            telegramBlock.appendChild(telegramWidgetScript);
        }
    </script>

    
    
  </body>
</html>

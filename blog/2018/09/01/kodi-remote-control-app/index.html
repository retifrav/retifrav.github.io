<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>XBMC/Kodi remote control application | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2018/09/01/kodi-remote-control-app/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="" />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2018/09/01/kodi-remote-control-app/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="XBMC/Kodi remote control application">
  <meta property="og:description" content="There is this great piece of software - XBMC/Kodi media player. I’ll write a separate article about that one, but today I want to show you a remote control application for it, which I’ve created for myself.
Beauty, innit.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2018-09-01T20:46:42-07:00">
    <meta property="article:modified_time" content="2018-09-01T20:46:42-07:00">
    <meta property="article:tag" content="Mestuff">
    <meta property="article:tag" content="Qt">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2018/09/01/kodi-remote-control-app/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">XBMC/Kodi remote control application</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2018-09-01 20:46:42 -0700</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 12 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>There is this great piece of software - <a href="https://kodi.tv">XBMC/Kodi</a> media player. I&rsquo;ll write a separate article about that one, but today I want to show you a remote control application for it, which I&rsquo;ve created for myself.</p>


    <img class="image-post" loading="lazy" src="/blog/2018/09/01/kodi-remote-control-app/images/kodi-remote-control-app.png" alt="Kodi remote control application">

<p>Beauty, innit.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#why">Why</a></li>
    <li><a href="#framework">Framework</a></li>
    <li><a href="#development">Development</a>
      <ul>
        <li><a href="#window-geometry-and-settings">Window geometry and settings</a></li>
        <li><a href="#layout-and-controls">Layout and controls</a></li>
        <li><a href="#shortcuts">Shortcuts</a></li>
        <li><a href="#json-rpc-api">JSON-RPC API</a>
          <ul>
            <li><a href="#how-to-send-requests">How to send requests</a></li>
            <li><a href="#get-active-player">Get active player</a></li>
            <li><a href="#set-subtitles">Set subtitles</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#source-code">Source code</a></li>
  </ul>
</nav>
<h1 id="why">Why</h1>
<p>There are quite a few remote control applications available already (<em>I personally use <a href="https://itunes.apple.com/us/app/official-kodi-remote/id520480364">this one</a> on my phone</em>), so what&rsquo;s the point of creating yet another one? There is no much of a point, actually, so I did it mostly for fun. But not entirely, because while mobile offering is pretty much satisfying, I couldn&rsquo;t find a convenient desktop (Mac OS) application. Well, there is this <a href="https://kodi.wiki/view/OS_X_remote_dashboard_widget">Dashboard widget</a>, but I didn&rsquo;t like it.</p>
<p>So I decided to create my own.</p>
<h1 id="framework">Framework</h1>
<p>First of all, how does Kodi even respond to the outside world? Long story short, it has a <a href="https://kodi.wiki/view/JSON-RPC_API">JSON-RPC API</a>, so you can talk to it via <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequests</a>. That immediately begs for a Qt/QML application, because:</p>
<ol>
<li>It has XMLHttpRequest support <a href="/blog/2018/06/09/qml-xmlhttprequest/">out of the box</a>;</li>
<li>Nice GUI which is easy to create;</li>
<li>As a &ldquo;side effect&rdquo;, it will be a truly cross-platform application.</li>
</ol>
<h1 id="development">Development</h1>
<p>So it is a QML application, and there is (<em>almost</em>) no C++ code except for the standard <code>main.cpp</code> stuff. I have nothing against C++, but there was no point in using it here, as you will see.</p>
<p>And as I&rsquo;m having a 12 hours flight, I&rsquo;ll describe my application with lots of unnecessary details.</p>
<h2 id="window-geometry-and-settings">Window geometry and settings</h2>
<p>As any other frequently used application, it should save and restore its window coordinates and geometry. A handy <a href="http://doc.qt.io/qt-5/qsettings.html">QSettings</a> module will take care of it for you, even though its QML API is still a part of <a href="http://doc.qt.io/qt-5/qml-qt-labs-settings-settings.html">Qt.labs</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Qt</span>.<span style="color:#a6e22e">labs</span>.<span style="color:#a6e22e">settings</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Window</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Settings</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">settings</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">y</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></div>
<p>Don&rsquo;t forget to specify your application&rsquo;s name and domain at <code>main.cpp</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>QGuiApplication <span style="color:#a6e22e">app</span>(argc, argv);
</span></span><span style="display:flex;"><span>app.setOrganizationName(<span style="color:#e6db74">&#34;Declaration of VAR&#34;</span>);
</span></span><span style="display:flex;"><span>app.setApplicationName(<span style="color:#e6db74">&#34;KodiRemote&#34;</span>);
</span></span><span style="display:flex;"><span>app.setOrganizationDomain(<span style="color:#e6db74">&#34;decovar.io&#34;</span>);</span></span></code></pre></div>
<p>Launch the application, change its size and position, close it and launch again. You can also check the settings file here: <code>~/Library/Preferences/io.decovar.KodiRemote.plist</code> (or <a href="http://doc.qt.io/qt-5/qsettings.html#platform-specific-notes">wherever</a>).</p>
<h2 id="layout-and-controls">Layout and controls</h2>
<p>I took a <a href="http://doc.qt.io/qt-5/qml-qtquick-layouts-gridlayout.html">GridLayout</a> and filled it with control buttons, each having fancy SVG image made by me in Sketch (<em>such a nice tool for that purpose</em>):</p>


    <img class="image-post" loading="lazy" src="/blog/2018/09/01/kodi-remote-control-app/images/sketch-buttons.png" alt="Sketch, creating buttons">

<p>Since buttons share a fair amount of properties, I created a custom <code>ControlButton.qml</code> component:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span> <span style="color:#ae81ff">2.11</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Controls</span> <span style="color:#ae81ff">2.4</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Layouts</span> <span style="color:#ae81ff">1.11</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtGraphicalEffects</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Button</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">source</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillWidth</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillHeight</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// gets bigger a bit when hovered
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">scale</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">hovered</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1.05</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">background</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Rectangle</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;transparent&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// here goes an SVG image
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Image</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">img</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fillMode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Image</span>.<span style="color:#a6e22e">PreserveAspectFit</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// also, when hovered, the button glows a bit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Glow</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">glow</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">img</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">radius</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">samples</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#094354&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">img</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">hovered</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Glowing and scaling effects look like this:</p>







    <video autoplay="yes" controls="yes" loop="yes"  class="video">
        <source src="/blog/2018/09/01/kodi-remote-control-app/video/hovered-glowing-scaling.mp4" type="video/mp4">
    </video>
    
    <p class="video-fallback">If video doesn’t play in your browser, you can download it <a href="/blog/2018/09/01/kodi-remote-control-app/video/hovered-glowing-scaling.mp4">here</a>.</p>
    


<p>And I put them into GridLayout like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">ControlButton</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">btn_stop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">row</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do keep your images in resources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;qrc:/img/stop.svg&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onClicked</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// some logic will be here later
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>I recommend to utilize <a href="http://doc.qt.io/qt-5/resources.html">Qt Resource System</a> for storing images, so you could use <code>qrc:/</code> path instead of absolute or relative paths from your file-system. For instance, here&rsquo;s how my project&rsquo;s structure looks like:</p>


    <img class="image-post" loading="lazy" src="/blog/2018/09/01/kodi-remote-control-app/images/qt-resources-images.png" alt="Images in Qt resources">

<p>Aside from buttons I also have custom labels and inputs on the side panel. Labels are not that interesting (<em>you can look at their source code later</em>), but text inputs are something different. It is actually not that trivial task to create a more or less decently looking input field in QML. So here&rsquo;s mine <code>InfoInput.qml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span> <span style="color:#ae81ff">2.11</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Controls</span> <span style="color:#ae81ff">2.4</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Layouts</span> <span style="color:#ae81ff">1.11</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// a background for it, so the field clearly stands out
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Rectangle</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// take all the width avaulable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillWidth</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// leave anough room for symbols in the line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">preferredHeight</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti</span>.<span style="color:#a6e22e">contentHeight</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// expose the text property
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// expose also the placeholder property
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">placeholder</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// in case of a password field
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">echoMode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti</span>.<span style="color:#a6e22e">echoMode</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TextInput</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">verticalCenter</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">verticalCenter</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">horizontalAlignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Text</span>.<span style="color:#a6e22e">AlignRight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// make paddings so you inputs don&#39;t look like your average Linux application GUI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">leftPadding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">rightPadding</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">leftPadding</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">clip</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Text</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">placeholder</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">horizontalAlignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">horizontalAlignment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">leftPadding</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">leftPadding</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">rightPadding</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">leftPadding</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">clip</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">clip</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">font</span>.<span style="color:#a6e22e">italic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;grey&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// hide placeholder when any text in entered
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">ti</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Another custom control I created is a <code>MessageBox.qml</code> - dialog window for showing errors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span> <span style="color:#ae81ff">2.11</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Window</span> <span style="color:#ae81ff">2.11</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Controls</span> <span style="color:#ae81ff">2.4</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">QtQuick</span>.<span style="color:#a6e22e">Layouts</span> <span style="color:#ae81ff">1.11</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Window</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dialog</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// both title and message text properties are available to be set from &#34;outside&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">title</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">textMain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">title</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">modality</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Qt</span>.<span style="color:#a6e22e">WindowModal</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">minimumWidth</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">maximumWidth</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">width</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">minimumHeight</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">maximumHeight</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">height</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Rectangle</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">border</span>.<span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ColumnLayout</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">anchors</span>.<span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parent</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Text</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillWidth</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillHeight</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">topMargin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">leftMargin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">rightMargin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">horizontalAlignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Text</span>.<span style="color:#a6e22e">AlignHCenter</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">verticalAlignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Text</span>.<span style="color:#a6e22e">AlignVCenter</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">textMain</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">font</span>.<span style="color:#a6e22e">family</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Courier New&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">font</span>.<span style="color:#a6e22e">pixelSize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">wrapMode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Text</span>.<span style="color:#a6e22e">WordWrap</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Button</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">btn</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">leftMargin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">rightMargin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Layout</span>.<span style="color:#a6e22e">fillWidth</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Close&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">onClicked</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">dialog</span>.<span style="color:#a6e22e">close</span>(); }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="shortcuts">Shortcuts</h2>
<p><a href="https://doc.qt.io/qt-5/qml-qtquick-shortcut.html">Shortcuts</a> are actions for the keyboard keys combinations. I wanted to be able to operate my remote control not only with mouse/touchpad, but with a physical keyboard too. That is actually the main reason why I decided to create my own remote control application, so I could bind the keys I like:</p>
<ul>
<li>arrow keys for navigation;</li>
<li>enter/return for selecting;</li>
<li>space for play/pause;</li>
<li>other combinations like jumping back and forth, choosing subtitles, etc.</li>
</ul>
<p>Some of the combinations I had in mind originally turned out to be impossible to implement (<em>like single</em> <code>⌥</code>/<code>ALT</code> <em>key</em>), because there is no such sequence available, so I had to substitute them with less obvious ones, which led to adding a side-panel where all the combinations are listed.</p>
<p>But anyway, here&rsquo;s how you add a shortcut:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Shortcut</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sequence</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Ctrl+X&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onActivated</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">btn_stop</span>.<span style="color:#a6e22e">clicked</span>()
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>So when <code>Ctrl</code> + <code>X</code> combination is pressed, <code>btn_stop.clicked()</code> handler will get executed - just like as if you clicked on this button with mouse.</p>
<h2 id="json-rpc-api">JSON-RPC API</h2>
<p>Now the most interesting part - how to communicate with Kodi API.</p>
<h3 id="how-to-send-requests">How to send requests</h3>
<p>As I said, it has a JSON-RPC API, and it is available at <code>http://IP:port/jsonrpc</code>, which is the entry point for your requests. Every request should contain a method you would like to call, and that&rsquo;s how you control the Kodi: choosing a movie to watch, sending play/pause command, switching between subtitles, deleting files - all that is done via XMLHttpRequests calling certain methods.</p>
<p>API is self-descriptive, so if you send a request with method <code>JSONRPC.Introspect</code>, Kodi will return you the list of methods it supports:</p>


    <img class="image-post" loading="lazy" src="/blog/2018/09/01/kodi-remote-control-app/images/paw-requests.png" alt="Paw">

<p>By the way, that is <a href="https://paw.cloud">Paw</a> at the screenshot - a must-have application for working with HTTP-requests.</p>
<p>How to understand which methods to use? Well, read the documentation or try them one by one yourself. Or you can start with the ones that are listed by some nice dude in <a href="https://forum.kodi.tv/showthread.php?tid=157996&amp;page=7">this thread</a>.</p>
<p>Now how to implement it in QML. Since all the requests have a similar structure, I decided to store it in a property, so I could just replace <code>-=PLACEHOLDER=-</code> value with concrete methods and parameters each time I need to send a new request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">playerURL</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;http://&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ti_iPort</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/jsonrpc&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">methodTemplate</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;{\&#34;jsonrpc\&#34;:\&#34;2.0\&#34;,\&#34;method\&#34;:-=PLACEHOLDER=-,\&#34;id\&#34;:1}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span></code></pre></div>
<p>So the full URL for a request is formed like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepateRequest</span>(<span style="color:#a6e22e">actionName</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">playerURL</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?request=&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> encodeURIComponent(
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">methodTemplate</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;-=PLACEHOLDER=-&#34;</span>, <span style="color:#a6e22e">actionName</span>)
</span></span><span style="display:flex;"><span>                );
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>XMLHttpRequests in QML are nothing new, except if you protected your player with a password - then you need to add <code>Authorization</code> header:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">callback</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//console.log(decodeURIComponent(url));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">onreadystatechange</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">myxhr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">myxhr</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span>) { <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">myxhr</span>); }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })(<span style="color:#a6e22e">xhr</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>, <span style="color:#e6db74">&#34;Basic &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Qt</span>.<span style="color:#a6e22e">btoa</span>(<span style="color:#a6e22e">user</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">password</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>I saved my user/password data (<em>values from input fields at the side panel</em>) as well as player&rsquo;s IP address and port in <code>Settings</code> too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Window</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">root</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">playerURL</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;http://&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ti_iPort</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/jsonrpc&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_user</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">string</span> <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_password</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Settings</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">settings</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">iPort</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_iPort</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_user</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">property</span> <span style="color:#a6e22e">alias</span> <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_password</span>.<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">InfoText</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;IP and port&#34;</span> }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InfoInput</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_iPort</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;192.168.1.5:8080&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InfoText</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;User&#34;</span> }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InfoInput</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_user</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;osmc&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InfoText</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Password&#34;</span> }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">InfoInput</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ti_password</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;osmc&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">echoMode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">TextInput</span>.<span style="color:#a6e22e">Password</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></div>
<p>Requests results are processed with this callback function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processResults</span>(<span style="color:#a6e22e">o</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">jsn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">responseText</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// if there was no error, return JSON result
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">jsn</span>.<span style="color:#a6e22e">hasOwnProperty</span>(<span style="color:#e6db74">&#34;error&#34;</span>)) { <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">jsn</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#75715e">// set message text and show the dialog window
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">textMain</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Some error has occurred&lt;br/&gt;Code: &#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> <span style="color:#a6e22e">jsn</span>[<span style="color:#e6db74">&#34;error&#34;</span>][<span style="color:#e6db74">&#34;code&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&lt;br/&gt;Error: &#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">+</span> <span style="color:#a6e22e">jsn</span>[<span style="color:#e6db74">&#34;error&#34;</span>][<span style="color:#e6db74">&#34;message&#34;</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//console.log(dialogError.textMain.replace(/&lt;br\/&gt;/g, &#34; | &#34;));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">show</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">textMain</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Some error has occurred&lt;br/&gt;Code: &#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&lt;br/&gt;Status: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">statusText</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">textMain</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;br\/&gt;/g</span>, <span style="color:#e6db74">&#34; | &#34;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">show</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}    
</span></span></code></pre></div>
<p>Finally, here&rsquo;s how <code>btn_stop.clicked()</code> handler looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">ControlButton</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">btn_stop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onClicked</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">request</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">prepateRequest</span>(<span style="color:#e6db74">&#34;\&#34;Player.Stop\&#34;,\&#34;params\&#34;:{\&#34;playerid\&#34;:1}&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">o</span>) { <span style="color:#a6e22e">processResults</span>(<span style="color:#a6e22e">o</span>); }
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>That&rsquo;s all the basics, so now you know enough to implement your own remote control for Kodi.</p>
<h3 id="get-active-player">Get active player</h3>
<p>As you might have noticed, Kodi has 2 &ldquo;modes&rdquo;:</p>
<ol>
<li>When you are browsing the main UI/menu, choosing movies to watch and changing the settings;</li>
<li>When you are watching a movie, so there is an actual player on the screen.</li>
</ol>
<p>Naturally, some commands are only available in one mode and others are available in another. So if you&rsquo;ll send a <code>Player.Stop</code> command while browsing the menu - nothing will happen.</p>
<p>To prevent the execution of irrelevant commands there is a special method <code>Player.GetActivePlayers</code>, which returns a positive ID (<code>playerid</code>) if Kodi is in player mode. Using this ID you can then query that player with commands.</p>
<p>But I decided that it is safe enough to assume that usually this ID is always <code>1</code>, so I just send my requests with <code>&quot;playerid&quot;:1</code>. And if there is an active player, then it works, and if not, then so what, let it fail.</p>
<p>However, in some cases it actually might be a good idea to execute this request before sending a command. For example, the arrow keys are used for navigation (<code>Input.Left</code>/<code>Input.Right</code>) while in browsing-the-menu mode, but you can reuse them in player mode so they would become <code>Player.Seek</code> commands.</p>
<h3 id="set-subtitles">Set subtitles</h3>
<p>Subtitles are set by index, so first you need to get the list of available subtitles by calling the <code>Player.GetProperties</code> method and passing <code>subtitles</code> value among its <a href="https://kodi.wiki/view/JSON-RPC_API/v8#Player.Property.Value">properties</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;jsonrpc&#34;</span>:<span style="color:#e6db74">&#34;2.0&#34;</span>,<span style="color:#f92672">&#34;method&#34;</span>:<span style="color:#e6db74">&#34;Player.GetProperties&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;params&#34;</span>:{<span style="color:#f92672">&#34;properties&#34;</span>:[<span style="color:#e6db74">&#34;subtitles&#34;</span>],<span style="color:#f92672">&#34;playerid&#34;</span>:<span style="color:#ae81ff">1</span>}}</span></span></code></pre></div>
<p>Result can look something like that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;jsonrpc&#34;</span>: <span style="color:#e6db74">&#34;2.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;result&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;subtitles&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;(External)&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;nor&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;swe&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sv&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;fin&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;fi&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;dan&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;da&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now, if you want to set finnish subtitles, you need to pass index <code>3</code> with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;jsonrpc&#34;</span>:<span style="color:#e6db74">&#34;2.0&#34;</span>,<span style="color:#f92672">&#34;method&#34;</span>:<span style="color:#e6db74">&#34;Player.SetSubtitle&#34;</span>,<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;params&#34;</span>:{<span style="color:#f92672">&#34;subtitle&#34;</span>:<span style="color:#ae81ff">3</span>,<span style="color:#f92672">&#34;playerid&#34;</span>:<span style="color:#ae81ff">1</span>}}</span></span></code></pre></div>
<p>I display available subtitles in a <a href="http://doc.qt.io/qt-5/qml-qtquick-controls-combobox.html">ComboBox</a> like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Shortcut</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sequence</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Ctrl+S&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onActivated</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// get the list of subtitles
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">request</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">prepateRequest</span>(<span style="color:#e6db74">&#34;\&#34;Player.GetProperties\&#34;,\&#34;params\&#34;:{\&#34;playerid\&#34;:1,\&#34;properties\&#34;:[\&#34;subtitleenabled\&#34;,\&#34;currentsubtitle\&#34;,\&#34;subtitles\&#34;]}&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">o</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rez</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">processResults</span>(<span style="color:#a6e22e">o</span>)[<span style="color:#e6db74">&#34;result&#34;</span>];
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">subtitles</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rez</span>[<span style="color:#e6db74">&#34;subtitles&#34;</span>];
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">subsModel</span>.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">subsModel</span>.<span style="color:#a6e22e">append</span>({
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;index&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;-1&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;lang&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;- no subtitles -&#34;</span>
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">subsCombo</span>.<span style="color:#a6e22e">currentIndex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">subtitles</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">subtitles</span>)
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">lang</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">subtitles</span>[<span style="color:#a6e22e">s</span>][<span style="color:#e6db74">&#34;language&#34;</span>];
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">subsModel</span>.<span style="color:#a6e22e">append</span>({
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;index&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">subtitles</span>[<span style="color:#a6e22e">s</span>][<span style="color:#e6db74">&#34;index&#34;</span>].<span style="color:#a6e22e">toString</span>(),
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;lang&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">lang</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">lang</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;unknown&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">subtitles</span>[<span style="color:#a6e22e">s</span>][<span style="color:#e6db74">&#34;name&#34;</span>]
</span></span><span style="display:flex;"><span>                        });
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//console.log(subtitles[s][&#34;index&#34;] + &#34;, &#34; + subtitles[s][&#34;language&#34;] + &#34;, &#34; + subtitles[s][&#34;name&#34;]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// if there is an active subtitle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">rez</span>[<span style="color:#e6db74">&#34;subtitleenabled&#34;</span>] <span style="color:#f92672">===</span> <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// select the active subtitle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">currentSubtitle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rez</span>[<span style="color:#e6db74">&#34;currentsubtitle&#34;</span>];
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">currentSubtitle</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e">//console.log(&#34;not null&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            <span style="color:#75715e">//console.log(currentSubtitle[&#34;index&#34;]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">subsModel</span>.<span style="color:#a6e22e">count</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#75715e">//console.log(subsModel.get(i).index + &#34; - &#34; + currentSubtitle[&#34;index&#34;]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">subsModel</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">i</span>).<span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">currentSubtitle</span>[<span style="color:#e6db74">&#34;index&#34;</span>].<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>                                {
</span></span><span style="display:flex;"><span>                                    <span style="color:#a6e22e">subsCombo</span>.<span style="color:#a6e22e">currentIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>                                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">subsDialog</span>.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>If you want to disable subtitles, then&hellip; what then? I couldn&rsquo;t find in the documentation what to do in this case, so I <a href="/blog/2017/11/22/http-debugging-proxy-macos/">sniffed</a> the packet that is sent by a mobile remote application:</p>


    <img class="image-post" loading="lazy" src="/blog/2018/09/01/kodi-remote-control-app/images/kodi-setsubtitles-off-proxie.png" alt="Proxie, Kodi set subtitles off">

<p>And it turned out to be that simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;jsonrpc&#34;</span>:<span style="color:#e6db74">&#34;2.0&#34;</span>,<span style="color:#f92672">&#34;method&#34;</span>:<span style="color:#e6db74">&#34;Player.SetSubtitle&#34;</span>,<span style="color:#f92672">&#34;params&#34;</span>:{<span style="color:#f92672">&#34;playerid&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;subtitle&#34;</span>:<span style="color:#e6db74">&#34;off&#34;</span>},<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>}</span></span></code></pre></div>
<p>In my opinion, dealing with subtitles was the most difficult part of the entire project, the rest is done via more or less trivial requests.</p>
<h1 id="source-code">Source code</h1>
<p>Source code is published here: <a href="https://github.com/retifrav/kodi-remote">https://github.com/retifrav/kodi-remote</a></p>



<hr class="updates-divider"/>
<div class="alert alert-info">
    <strong>[27.04.2019] Update:</strong> GET requests stopped working with Kodi v18 Leia
</div>

<p>As it turned out, I was using an old version of Kodi which I got with <a href="https://osmc.tv">OSMC</a> distribution. But when I switched to <a href="https://libreelec.tv">LibreELEC</a>, I suddenly ended up with <strong>Kodi v18 Leia</strong>, and in this release <code>GET</code> requests <a href="https://github.com/xbmc/xbmc/pull/12281">were disabled</a> for most of the API methods.</p>
<p>That resulted in the following error for all the functions in my remote control application:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;error&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#ae81ff">-32099</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Bad client permission.&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;jsonrpc&#34;</span>: <span style="color:#e6db74">&#34;2.0&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Because <a href="https://forum.kodi.tv/showthread.php?tid=324598">from now on</a> all the requests to Kodi JSON-RPC API have to be with the <code>POST</code> HTTP method. For my application it meant two things:</p>
<ol>
<li>Change from <code>GET</code> to <code>POST</code>, obviously;</li>
<li>Move JSON commands from URL to the request body.</li>
</ol>
<p>First thing is simple to implement but so is the second: body is simply set as a parameter of <code>xhr.send()</code>. Here&rsquo;s a reworked <code>request()</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">params</span>, <span style="color:#a6e22e">callback</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">method</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">method</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;POST&#34;</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">errorText</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Unknown HTTP method: &#34;</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">method</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">errorText</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">textMain</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">errorText</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dialogError</span>.<span style="color:#a6e22e">show</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">params</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">methodTemplate</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;-=PLACEHOLDER=-&#34;</span>, <span style="color:#a6e22e">params</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">method</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;GET&#34;</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">params</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;?request=&#34;</span>.<span style="color:#a6e22e">concat</span>(encodeURIComponent(<span style="color:#a6e22e">params</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">onreadystatechange</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">myxhr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">myxhr</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span>) { <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">myxhr</span>); }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })(<span style="color:#a6e22e">xhr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">method</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">playerURL</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">params</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">playerURL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>, <span style="color:#e6db74">&#34;Basic &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Qt</span>.<span style="color:#a6e22e">btoa</span>(<span style="color:#a6e22e">user</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">password</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">method</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;GET&#34;</span>) { <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> { <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">params</span>); }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>As you can see, I kept the <code>GET</code> option - that is because some API methods (<code>Player.GetProperties</code>) still support <code>GET</code> (<em>although they work with <code>POST</code> as well</em>).</p>
<p>You also might have noticed that I merged <code>prepareRequest()</code> (<em>formerly <code>prepateRequest</code></em>) into <code>request()</code>.</p>
<p>An example of calling the function from the button click:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">ControlButton</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">btn_space</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onClicked</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">request</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;\&#34;Player.PlayPause\&#34;,\&#34;params\&#34;:{\&#34;playerid\&#34;:1}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">o</span>) { <span style="color:#a6e22e">processResults</span>(<span style="color:#a6e22e">o</span>); }
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>All the changes are reflected in <a href="https://github.com/retifrav/kodi-remote/commit/da361a881419fd3e2b10fb430a40869a6e54e3a1">this commit</a>.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/mestuff/">mestuff</a><a class="tag" href="https://retifrav.github.io/tags/qt/">qt</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <script>
  var id =  16 ;

  if (id)
  {
    let url = "https://github.com/retifrav/retifrav.github.io/issues/".concat(id);
    let api_url = "https://api.github.com/repos/retifrav/retifrav.github.io/issues/".concat(id, "/comments");
    
    var commentsDiv = document.getElementById("comments");

    let xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("GET", api_url);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
    xhr.send();

    xhr.onload = function()
    {
      if (xhr.status != 200)
      {
        let errorText = document.createElement("p");
        errorText.innerHTML = "<i>Comments for this post yet are not opened yet (or you have GitHub scripts disabled).</i>";
        commentsDiv.appendChild(errorText);
      }
      else
      {
        let comments = xhr.response;

        let mainHeader = document.createElement("h2");
        mainHeader.innerHTML = "Comments: ".concat(comments.length);
        commentsDiv.appendChild(mainHeader);

        let issueLink = document.createElement("p");
        issueLink.innerHTML = "<i>You can leave a comment using this <a href='".concat(url, "'>GitHub issue</a>.</i>");
        commentsDiv.appendChild(issueLink);
        
        comments.forEach(function(comment)
        {
            let commentContent = document.createElement("div");
            commentContent.setAttribute('class', 'gh-comment')
            commentContent.innerHTML = "".concat(
                "<div class='gh-header'>",
                  "<img src='", comment.user.avatar_url, "' />",
                  "<div style='margin:auto 0;'>",
                    "<b><a class='gh-username' href='", comment.user.html_url, "'>", comment.user.login, "</a></b>",
                    " commented at <em>", new Date(comment.created_at), "</em>",
                  "</div>",
                "</div>",
                "<div class='gh-body'>",
                  comment.body_html,
                "</div>"
            );
            commentsDiv.appendChild(commentContent);
        });
      }
    };

    xhr.onerror = function()
    {
      let errorText = document.createElement("p");
      errorText.innerHTML = "<i>Some error loading comments.</i>";
      commentsDiv.appendChild(errorText);
    };
  }
</script>

      
      </div>
    </div>
  </div>

  
        <div id="footer">
          <div>
              2014 - 2025,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Resources</h3>
              <div class="sidebar-row">
                <a href="/index.xml" title="Subscribe to RSS">
                  <img src="/images/rss.png" width="50px">
                </a>
                
                <a href="https://t.me/decovar" title="Telegram channel">
                  <img src="/images/telegram.png" width="50px">
                </a>
              </div>
            </div>
            
            
            
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (68)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (37)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/linux">linux (28)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (11)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/ios">ios (8)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/apple">apple (7)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/home-automation">home-automation (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    

    <script>
        
        window.onload = () =>
        {
            
            
            
            
            
            
            
            
            
            
            
        }
    </script>

    
    
  </body>
</html>

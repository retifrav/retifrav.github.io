<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CMake target_link_libraries() scopes | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2023/07/22/cmake-target-link-libraries-scopes/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="The CMake&#39;s target_link_libraries() function has 3 different scopes: PRIVATE, INTERFACE and PUBLIC. As I am only pretending to be a real developer, I didn&#39;t know what they actually mean, and so I tested their effects in practice. The main goal was to establish in which cases would I need to deliver 3rd-party dependencies (which my project depends on) to my users (whose applications depend on my project)." />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2023/07/22/cmake-target-link-libraries-scopes/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="CMake target_link_libraries() scopes">
  <meta property="og:description" content="The CMake&#39;s target_link_libraries() function has 3 different scopes: PRIVATE, INTERFACE and PUBLIC. As I am only pretending to be a real developer, I didn&#39;t know what they actually mean, and so I tested their effects in practice. The main goal was to establish in which cases would I need to deliver 3rd-party dependencies (which my project depends on) to my users (whose applications depend on my project).">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2023-07-22T14:32:36+02:00">
    <meta property="article:modified_time" content="2023-07-22T14:32:36+02:00">
    <meta property="article:tag" content="Cmake">
    <meta property="article:tag" content="Cpp">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2023/07/22/cmake-target-link-libraries-scopes/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">CMake target_link_libraries() scopes</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2023-07-22 14:32:36 &#43;0200</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 27 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>The CMake&rsquo;s <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html">target_link_libraries()</a> function has different <a href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#target-usage-requirements">scopes</a> (<em><code>PRIVATE</code>/<code>INTERFACE</code>/<code>PUBLIC</code></em>), and I never understood what exactly each one of them means and how do they actually affect the final result.</p>


    <img class="image-post" loading="lazy" src="/blog/2023/07/22/cmake-target-link-libraries-scopes/images/cmake-linking.png" alt="CMake, linking 3rd-party dependency, your SDK and application">

<p>As there is a limit for how long one can postpone one&rsquo;s ignorance, it finally came a time for me to investigate the matter, which I did by (<em>reading the documentation and</em>) conducting a small experiment of my own.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#theory">Theory</a>
      <ul>
        <li><a href="#what-are-these-scopes">What are these scopes</a>
          <ul>
            <li><a href="#which-scope-is-the-best">Which scope is the best</a></li>
          </ul>
        </li>
        <li><a href="#a-silly-analogy">A silly analogy</a></li>
      </ul>
    </li>
    <li><a href="#practical-example">Practical example</a>
      <ul>
        <li><a href="#static-libraries">STATIC libraries</a>
          <ul>
            <li><a href="#private">PRIVATE</a></li>
            <li><a href="#interface">INTERFACE</a></li>
            <li><a href="#public">PUBLIC</a></li>
          </ul>
        </li>
        <li><a href="#shared-libraries">SHARED libraries</a>
          <ul>
            <li><a href="#private-1">PRIVATE</a>
              <ul>
                <li><a href="#what-if-transitive-dependency-is-also-shared">What if transitive dependency is also SHARED</a></li>
              </ul>
            </li>
            <li><a href="#interface-1">INTERFACE</a></li>
            <li><a href="#public-1">PUBLIC</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#so-when-do-i-need-to-deliver-3rd-party-dependencies-to-my-customers">So when do I need to deliver 3rd-party dependencies to my customers</a>
      <ul>
        <li><a href="#but-i-dont-want-to">But I don&rsquo;t want to</a></li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="theory">Theory</h1>
<p>If anything, I am now on CMake v3.26.4, which might be important to state, as (<em>much</em>) older versions had different policies for things like <a href="https://cmake.org/Bug/view.php?id=16102">include directories propagation</a>, and newer versions might have something different too.</p>
<h2 id="what-are-these-scopes">What are these scopes</h2>
<p>Before reading my interpretation, do read the <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html#libraries-for-a-target-and-or-its-dependents">documentation</a> and <a href="https://cmake.org/pipermail/cmake/2016-May/063400.html">this post</a> from Craig Scott (<em>author of <a href="https://crascit.com/professional-cmake/">Professional CMake</a></em>).</p>
<p>As I understood it, scopes define how <em>dependencies</em> of a library will affect <em>consumers</em> of that library. So if you only deal with <em>direct</em> dependencies and don&rsquo;t have consumers upper in the dependency chain, then you probably don&rsquo;t need to care about all that, as this is really about <em>transitive</em> dependencies (<em>dependencies of dependencies</em>).</p>
<p>For example, let&rsquo;s say we have a Project, which is a collection of libraries. This Project is used by some Tool (<em>so Tool depends on Project</em>) and also it has a dependency of its own (<em>so Project depends on Dependency</em>). In this case that Dependency library will be a <em>direct</em> dependency for our Project and a <em>transitive</em> dependency for the Tool:</p>


    <img class="image-post" loading="lazy" src="/blog/2023/07/22/cmake-target-link-libraries-scopes/images/relations.png" alt="Relations between projects">

<p>Applying to this example, my understanding of the scopes would be the following:</p>
<ul>
<li>
<p><strong>PRIVATE</strong> - the Tool gets <code>doThingy()</code> functionality of Dependency through <code>doTheThing()</code> function of AnotherLibrary and cannot get <code>doThingy()</code> function directly from Dependency:


    <img class="image-post" loading="lazy" src="/blog/2023/07/22/cmake-target-link-libraries-scopes/images/private.png" alt="CMake, PRIVATE linking">
</p>
</li>
<li>
<p><strong>INTERFACE</strong> - the Tool gets <code>doThingy()</code> function directly from Dependency, while AnotherLibrary does not (<em>and so it no longer has <code>doTheThing()</code> function available</em>):


    <img class="image-post" loading="lazy" src="/blog/2023/07/22/cmake-target-link-libraries-scopes/images/interface.png" alt="CMake, INTERFACE linking">
</p>
</li>
<li>
<p><strong>PUBLIC</strong> - the Tool can do both: get <code>doThingy()</code> functionality of Dependency through <code>doTheThing()</code> function of AnotherLibrary and get <code>doThingy()</code> function directly from Dependency:


    <img class="image-post" loading="lazy" src="/blog/2023/07/22/cmake-target-link-libraries-scopes/images/public.png" alt="CMake, PUBLIC linking">
</p>
</li>
</ul>
<p>While <code>PRIVATE</code> and <code>PUBLIC</code> scopes make sense to me, I cannot think of a real-world example of <code>INTERFACE</code> linkage. Why would a library A link to library B only to make B available higher in the dependency chain, so without using B&rsquo;s functionality itself?</p>
<p>The <code>INTERFACE</code> scope would probably make sense for a so-called &ldquo;header-only&rdquo; library (<em>which has no sources of its own, only headers</em>), when it provides linking to other libraries without using them itself. But I myself never needed to create such a thing, so I&rsquo;m still puzzled about the actual use of the <code>INTERFACE</code> scope.</p>
<h3 id="which-scope-is-the-best">Which scope is the best</h3>
<p>I saw this question being asked in a couple of places: either &ldquo;<em>which one is the best</em>&rdquo; or &ldquo;<em>which one should I use</em>&rdquo;. I wouldn&rsquo;t say that any of the scopes is better or worse than another, it&rsquo;s just different scopes for different purposes.</p>
<p>If we take one of the most common dependencies, such as <a href="http://zlib.net">zlib</a>, then applying to the same example from above, if the Tool has no intention of using any of zlib&rsquo;s functionality on its own, as it only needs what AnotherLibrary provides in its <code>doTheThing()</code> function, then one should choose <code>PRIVATE</code> scope when linking to zlib from AnotherLibrary.</p>
<p>However, if, in addition to whatever <code>doTheThing()</code> does, Tool also needs to perform some compression/decompression operations of its own, then it indeed would require access to zlib&rsquo;s API too. So now it&rsquo;s both AnotherLibrary and Tool who should have access to zlib functions, and in that case one should choose <code>PUBLIC</code> scope when linking to zlib from AnotherLibrary. Although I don&rsquo;t quite understand why wouldn&rsquo;t Tool just <code>find_package()</code> zlib and link to it itself then, so AnotherLibrary could keep its linking to zlib as <code>PRIVATE</code>. This would also make the Tool&rsquo;s dependency on zlib more clear/visible in its <code>CMakeLists.txt</code>.</p>
<p>If after reading the last sentence you were going to say &ldquo;<em>but in that case Tool will need to have zlib binary for linking, while when it gets zlib through AnotherLibrary&rsquo;s private linking it won&rsquo;t</em>&rdquo;, then I have <a href="#private">some news</a> for you.</p>
<h2 id="a-silly-analogy">A silly analogy</h2>
<p>If previous sections didn&rsquo;t add much clarity, let&rsquo;s try the following silly analogy.</p>
<p>Say, you&rsquo;d like to steal a game. Such a process usually involves getting the base game and finding a crack for it (<em>modified executable or/and accompanying files</em>). In general, the latter is provided by crackers, and the former is provided by repackers, who incorporate the crack into the base game and distribute the result.</p>
<p>To make the analogy fit a bit better, let&rsquo;s assume that you don&rsquo;t know the original cracker website (<em>it frequently gets shut down and thus moves around a lot</em>), so you cannot download the crack yourself, only repacker always knows how to get it.</p>
<p>The scopes in this case will be the following:</p>
<ul>
<li><strong>PRIVATE</strong> - repacker takes the original crack, applies it to the base game, compresses everything one hundred times into an archive, compresses that archive one thousand times more and makes an installer out of it (<em>which of course will require Administrator elevation on your machine</em>) with distorted pictures, shitty music and some advertisement banners. Of course, he doesn&rsquo;t provide any links/credits to the original cracker;
<ul>
<li>this option might seem to be the worst, but most of the time you don&rsquo;t have any other way to get the base game in order to apply the crack yourself (<em>which you also don&rsquo;t have</em>);</li>
</ul>
</li>
<li><strong>INTERFACE</strong> - repacker doesn&rsquo;t do anything, he doesn&rsquo;t even re-upload the original crack, he just posts a link to the original cracker release page, where you can download the crack from;
<ul>
<li>assuming that you somehow already have the base game, here the <code>INTERFACE</code> scope actually makes sense;</li>
</ul>
</li>
<li><strong>PUBLIC</strong> - repacker still does all that horrible shit as in <code>PRIVATE</code> variant, but this time he also provides a link to the original cracker release page, so if you already have the base game, you might prefer to download just the crack from its origin and apply it to the base game yourself, instead of using repacker&rsquo;s garbage installer.</li>
</ul>
<p>As you can see, the analogy is very silly indeed and not entirely correct too, so don&rsquo;t hang to it too much. I almost regret adding it to the article.</p>
<h1 id="practical-example">Practical example</h1>
<p>That trio of projects from <a href="#what-are-these-scopes">above</a> (<em>Dependency, Project and Tool</em>) is what I used in <a href="https://github.com/retifrav/cmake-target-link-libraries-example">this repository</a> for experimenting with <code>target_link_libraries()</code> scopes to see what exactly do they do in practice.</p>
<p>Once again, it is 3 different entities:</p>
<ol>
<li>Dependency - a library, that is a direct dependency for Project (<em>and a transitive dependency for Tool</em>);</li>
<li>Project - a set of libraries, one of which depends on Dependency;</li>
<li>Tool - a CLI application that depends on libraries from Project.</li>
</ol>
<p>This is a simplified variation of what we actually have in our project at work (<em>as shown on the <a href="./images/cmake-linking.png">main picture</a></em>): we develop an SDK or rather a framework (<em>Project</em>), which has several 3rd-party dependencies (<em>Dependency</em>), and we deliver that SDK to our customers, who in turn use it to build their own applications (<em>Tool</em>). So our direct dependencies are transitive dependencies for our customers.</p>
<p>The Dependency is a library called <code>Thingy</code>, and it is built the same way for all the cases, as nothing changes for it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tree <span style="color:#f92672">../</span>install<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> thingy<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">.</span>cmake</span></span></code></pre></div>
<p>Now let&rsquo;s see how different scopes of linking to it from Project will affect Tool.</p>
<h2 id="static-libraries">STATIC libraries</h2>
<p>Here the Project libraries are built as <code>STATIC</code> libraries.</p>
<h3 id="private">PRIVATE</h3>
<p>Linking to <code>Thingy</code> library with <code>PRIVATE</code> scope:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">PRIVATE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Configure and build the project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>Let&rsquo;s see what we have inside <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">STATIC</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span> <span style="color:#e6db74">&#34;\$&lt;LINK_ONLY:dpndnc::Thingy&gt;&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Okay, so <code>INTERFACE_LINK_LIBRARIES</code> property got <code>dpndnc::Thingy</code> linking target. That looks concerning already, because we chose <code>PRIVATE</code> scope, so linking to <code>Thingy</code> should have ended with <code>AnotherLibrary</code> and should have not propagated upper in the dependency chain, right? That we will find out soon enough.</p>
<p>But first let&rsquo;s check what symbols are available in the resulting binary (<em>here I&rsquo;m using <code>nm</code> instrument on Mac OS, on other platforms it might be something else</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>another.cpp.o:
</span></span><span style="display:flex;"><span>000000000000038c s GCC_except_table0
</span></span><span style="display:flex;"><span>00000000000003a0 s GCC_except_table3
</span></span><span style="display:flex;"><span>00000000000003e4 s GCC_except_table4
</span></span><span style="display:flex;"><span>0000000000000400 s __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000000000638 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>00000000000000d0 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000000000 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>As you can see, it contains <code>prjct::lbrAnother::doAnother()</code> and <code>prjct::lbrAnother::doTheThing()</code> own functions, but also there is <code>dpndnc::doThingy()</code> function from <code>Thingy</code>.</p>
<p>Now let&rsquo;s try to configure the Tool. It has the following in its <a href="https://github.com/retifrav/cmake-target-link-libraries-example/blob/master/tl/CMakeLists.txt">CMakeLists.txt</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">SomeLibrary</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>find_package(<span style="color:#e6db74">AnotherLibrary</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>CMAKE_PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PRIVATE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">prjct::SomeLibrary</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">prjct::AnotherLibrary</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>so everything should be fine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>but it isn&rsquo;t:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">CMake</span> <span style="color:#a6e22e">Error</span> at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>share<span style="color:#f92672">/</span><span style="color:#a6e22e">AnotherLibrary</span><span style="color:#f92672">/</span><span style="color:#a6e22e">AnotherLibraryTargets</span><span style="color:#f92672">.</span>cmake<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">60</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">set_target_properties</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">The</span> link interface of target <span style="color:#e6db74">&#34;prjct::AnotherLibrary&#34;</span> contains<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  but the target was not found<span style="color:#f92672">.</span>  <span style="color:#a6e22e">Possible</span> reasons include<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">*</span> <span style="color:#66d9ef">There</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">a</span> <span style="color:#66d9ef">typo</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">the</span> <span style="color:#66d9ef">target</span> <span style="color:#66d9ef">name.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">*</span> <span style="color:#66d9ef">A</span> <span style="color:#66d9ef">find_package</span> <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">missing</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">an</span> <span style="color:#66d9ef">IMPORTED</span> <span style="color:#66d9ef">target.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">*</span> <span style="color:#66d9ef">An</span> <span style="color:#66d9ef">ALIAS</span> <span style="color:#66d9ef">target</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">missing.</span></span></span></code></pre></div>
<p>That&rsquo;s strange, but let&rsquo;s add <code>find_package()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex; background-color:#3c3d38"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>find_package(<span style="color:#e6db74">SomeLibrary</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>find_package(<span style="color:#e6db74">AnotherLibrary</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)</span></span></code></pre></div>
<p>and try again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>but that will fail too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">CMake</span> <span style="color:#a6e22e">Error</span> at <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">50</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">find_package</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Could</span> not find a <span style="color:#66d9ef">package</span> configuration file provided by <span style="color:#e6db74">&#34;Thingy&#34;</span> <span style="color:#66d9ef">with</span> any
</span></span><span style="display:flex;"><span>  of the following names<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ThingyConfig.cmake</span>
</span></span><span style="display:flex;"><span>    thingy<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Add</span> the installation prefix of <span style="color:#e6db74">&#34;Thingy&#34;</span> to <span style="color:#a6e22e">CMAKE_PREFIX_PATH</span> or set
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Thingy_DIR&#34;</span> to a directory containing one of the above files<span style="color:#f92672">.</span>  <span style="color:#a6e22e">If</span> <span style="color:#e6db74">&#34;Thingy&#34;</span>
</span></span><span style="display:flex;"><span>  provides a separate development <span style="color:#66d9ef">package</span> or <span style="color:#a6e22e">SDK</span><span style="color:#f92672">,</span> be sure it has been
</span></span><span style="display:flex;"><span>  installed<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>Well, fuck. So it wants <code>/path/to/cmake-target-link-libraries-example/dpndnc/install</code> to be also present in <code>CMAKE_PREFIX_PATH</code>. But again, shouldn&rsquo;t have all traces to <code>Thingy</code> dependency &ldquo;disappeared&rdquo; after <code>AnotherLibrary</code> was built, as it&rsquo;s a <code>STATIC</code> library and it links to <code>Thingy</code> with <code>PRIVATE</code> scope?</p>
<p>Turns out, they should have not. I already mentioned my ignorance, and that&rsquo;s another evidence to it: I did not know that static libraries do not &ldquo;bundle&rdquo; their dependencies into their resulting binary. Moreover, static libraries are not really libraries, they are kind of archives of object files, which are what actually contains the symbols (<em>I&rsquo;d recommend you to read some more about this, as my understanding is still a bit vague</em>). So <code>AnotherLibrary</code> doesn&rsquo;t not &ldquo;contain&rdquo; <code>Thingy</code> functions, and so for our customer to be able to build his Tool application we need to deliver both our Project package <em>and</em> the <code>Thingy</code> package (<em>otherwise he will have to get it from somewhere else himself</em>).</p>
<p>That is the main reason why I wanted to research this topic and make this experiment. Our project has a lot of 3rd-party dependencies, and I was naively hoping that if we just set <code>PRIVATE</code> scope on linking to them from our SDK, then we won&rsquo;t need to distribute these dependencies packages in addition to our main package. Well, tough titties, looks like we&rsquo;ll have to anyway.</p>
<p>Okay then, let&rsquo;s add the missing path to <code>CMAKE_PREFIX_PATH</code> and finally build the application:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>While we are here, it is annoying (<em>and error-prone</em>) to add <code>find_package()</code> for every single transitive dependency, so instead you (<em>as maintainer of your project</em>) should use <a href="https://cmake.org/cmake/help/latest/module/CMakeFindDependencyMacro.html">find_dependency()</a> macro in <code>AnotherLibrary</code>&rsquo;s <a href="https://github.com/retifrav/cmake-target-link-libraries-example/blob/master/prjct/libraries/AnotherLibrary/Config.cmake.in">CMake config</a> like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include(<span style="color:#e6db74">CMakeFindDependencyMacro</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># ...keeping in mind, that this is not needed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># when AnotherLibrary is SHARED and links to Thingy with PRIVATE scope
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># (there will be more details about that later)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>find_dependency(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)</span></span></code></pre></div>
<p>Having that (<em>and having re-build/re-installed the Project</em>), we can now delete <code>find_package(Thingy CONFIG REQUIRED)</code> from the Tool project.</p>
<p>Now let&rsquo;s inspect the resulting Tool binary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003de0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e78 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e8c s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003ea0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e20 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003e64 s GCC_except_table2
</span></span><span style="display:flex;"><span>0000000100003c10 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>0000000100003ae0 t __GLOBAL__sub_I_some.cpp
</span></span><span style="display:flex;"><span>0000000100003d30 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000100008000 b someString
</span></span><span style="display:flex;"><span>0000000100008030 b thingyString
</span></span><span style="display:flex;"><span>0000000100008018 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003c00 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003b30 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003a10 T prjct::lbrSome::doSome()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003c60 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>It has all the symbols from the Project&rsquo;s libraries: <code>AnotherLibrary</code> and <code>SomeLibrary</code>, and we can call these functions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;via AnotherLibrary | &#34;</span>;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doTheThing();</span></span></code></pre></div>
<p>But <code>nm</code> also says that the Tool binary has <code>dpndnc::doThingy()</code> symbol, which comes from the <code>Thingy</code> library. However, if we&rsquo;ll try to call that function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;directly | &#34;</span>;
</span></span><span style="display:flex;"><span>dpndnc<span style="color:#f92672">::</span>doThingy();</span></span></code></pre></div>
<p>It will first fail with undeclared identifier:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">27</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">use</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">undeclared</span> <span style="color:#66d9ef">identifier</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">dpndnc</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">dpndnc::doThingy</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> error generated<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>and if you&rsquo;ll try to add <code>#include &lt;Thingy/thingy.h&gt;</code>, then it will fail with missing header:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">7</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">fatal</span> <span style="color:#66d9ef">error:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">Thingy/thingy.h</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">file</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">found</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span>include <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Thingy</span><span style="color:#f92672">/</span>thingy<span style="color:#f92672">.</span>h<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">^~~~~~~~~~~~~~~~~</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> error generated<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>You can of course copy <code>Thingy/thingy.h</code> from <code>Thingy</code> installation folder so it becomes discoverable for the Tool project (<em>for instance, in Project installation folder</em>), and then you will in fact be able to call that function: the project will compile and will run just fine; but that is not how it was indented to work. The point of this stunt is to demonstrate that this is what the scopes are really about: discoverability of a library&rsquo;s public headers. Or so I understood it.</p>
<p>If you are curious enough, you can also take a look an Ninja&rsquo;s build commands in <code>/path/to/cmake-target-link-libraries-example/tl/build/build.ninja</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>build <span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>tool<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">INCLUDES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build some<span style="color:#f92672">-</span>tool<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">LINK_LIBRARIES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libSomeLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libAnotherLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span></span></span></code></pre></div>
<p>So indeed, it links to all 3 of them: <code>libSomeLibrary.a</code>, <code>libAnotherLibrary.a</code> (<em>these two are part of the Project</em>) and <code>libThingy.a</code> (<em>this one is part of the <code>Thingy</code></em>), even though the latter is a <code>PRIVATE</code> dependency of the Project. Thus, the only(?) effect that <code>PRIVATE</code> scope actually has here is that <code>Thingy</code>&rsquo;s public headers are not added to the Tool&rsquo;s <code>INCLUDES</code>; but as you saw a bit earlier, manually making these headers available lets the Tool discover <code>dpndnc::doThingy()</code> symbol and still call that function with no problems, as the the library is linked to anyway. So it really is about the headers, isn&rsquo;t it?</p>
<p>As a side note, that discovery made me suspect that we might be doing something stupid when we merge our SDK installation and our 3rd-party dependencies installations together into a single &ldquo;bundle&rdquo; with <code>bin</code>/<code>include</code>/<code>lib</code>/<code>share</code> folders structure (<em>for the delivery convenience</em>), because that roally fucks the <code>PRIVATE</code> scope of our linking to them, as all the public headers become discoverable for consuming projects, don&rsquo;t they. Goddamn.</p>
<h3 id="interface">INTERFACE</h3>
<p>Let&rsquo;s see what changes with <code>INTERFACE</code> scope:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">INTERFACE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Configure the project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>If we now try to build the project without changing anything in its sources, it will fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>libraries<span style="color:#f92672">/</span><span style="color:#a6e22e">AnotherLibrary</span><span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>another<span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">fatal</span> <span style="color:#66d9ef">error:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">Thingy/thingy.h</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">file</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">found</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span>include <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Thingy</span><span style="color:#f92672">/</span>thingy<span style="color:#f92672">.</span>h<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">^~~~~~~~~~~~~~~~~</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> error generated<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>That&rsquo;s <code>INTERFACE</code> scope in action: even though <code>AnotherLibrary</code> finds <code>Thingy</code> package and links to its library, that library&rsquo;s functionality is not available in the project itself. But to be precise, it&rsquo;s only headers that are not available, so if you&rsquo;ll copy <code>Thingy/thingy.h</code> into <code>AnotherLibrary</code>&rsquo;s <code>include</code> or make it discoverable in some other way, then the project will build fine, the symbols inside <code>libAnotherLibrary.a</code> will be the same as with <a href="#private">PRIVATE</a> scope, and then the Tool will also be able to call <code>doTheThing()</code>. So once again, the only(?) effect the scopes have is the headers discoverability for targets.</p>
<p>But anyway, as we are not going to manually make <code>Thingy</code> headers available for <code>AnotherLibrary</code> against the <code>INTERFACE</code> scope wishes, we&rsquo;ll need to comment out (<em>or wrap into <code>#ifdef</code></em>) the following lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//#include &lt;Thingy/thingy.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//void doTheThing()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//{
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//    dpndnc::doThingy();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//}
</span></span></span></code></pre></div>
<p>Then the project will build and install:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>Here&rsquo;s what is inside <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code> this time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">STATIC</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span> <span style="color:#e6db74">&#34;dpndnc::Thingy&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Now there is no <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#genex:LINK_ONLY">LINK_ONLY</a> generator expression, which apparently means that this time projects higher in the dependency chain not only will link to <code>Thingy</code> library binary but will also get its public headers.</p>
<p>And here are the symbols that are available in the resulting <code>libAnotherLibrary.a</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>another.cpp.o:
</span></span><span style="display:flex;"><span>000000000000037c s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000000390 s GCC_except_table2
</span></span><span style="display:flex;"><span>00000000000003d4 s GCC_except_table3
</span></span><span style="display:flex;"><span>00000000000003f0 s __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>00000000000005e0 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000000000 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>Quite naturally there is no <code>prjct::lbrAnother::doTheThing()</code> anymore, as we commented it out, but there is also no <code>dpndnc::doThingy()</code>, so <code>AnotherLibrary</code> really is just passing <code>Thingy</code> library linking interface without using the library itself.</p>
<p>If we now try to configure the Tool project, it will fail the same way (<em>first not finding <code>dpndnc::Thingy</code> target and then not finding <code>ThingyConfig.cmake</code></em>), so let&rsquo;s configure it with everything provided in the <code>CMAKE_PREFIX_PATH</code> right away:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>What symbols does this variant have:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003df0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e88 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e9c s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003eb0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e30 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003e74 s GCC_except_table2
</span></span><span style="display:flex;"><span>0000000100003c20 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>0000000100003b00 t __GLOBAL__sub_I_some.cpp
</span></span><span style="display:flex;"><span>0000000100003d40 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000100008000 b someString
</span></span><span style="display:flex;"><span>0000000100008030 b thingyString
</span></span><span style="display:flex;"><span>0000000100008018 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003b50 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003a30 T prjct::lbrSome::doSome()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003c70 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>This time there is no <code>prjct::lbrAnother::doTheThing()</code>, but there is still <code>dpndnc::doThingy()</code>. What&rsquo;s also different is that <code>Thingy</code>&rsquo;s public headers are discoverable now, which means that we have the following set of functions available for Tool to use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Thingy/thingy.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// trying to use that will fail to build with
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// error: no member named &#39;doTheThing&#39; in namespace &#39;prjct::lbrAnother&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cout &lt;&lt; &#34;via AnotherLibrary | &#34;;
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">//prjct::lbrAnother::doTheThing();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// but that one now works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;directly | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>dpndnc<span style="color:#f92672">::</span>doThingy();</span></span></code></pre></div>
<p>If you are still curious, there is something different in <code>/path/to/cmake-target-link-libraries-example/tl/build/build.ninja</code> too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>build <span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>tool<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">INCLUDES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build some<span style="color:#f92672">-</span>tool<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">LINK_LIBRARIES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libSomeLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libAnotherLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span></span></span></code></pre></div>
<p>The set of linking libraries is the same, but <code>INCLUDES</code> now contains the path to <code>Thingy</code>&rsquo;s headers too.</p>
<h3 id="public">PUBLIC</h3>
<p>Finally, the <code>PUBLIC</code> scope:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">PUBLIC</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Configure and build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>Here everything works the same way as with <a href="#private">PRIVATE</a> scope, so <code>AnotherLibrary</code> can call <code>doThingy()</code> function from <code>Thingy</code> library:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Thingy/thingy.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doTheThing</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    dpndnc<span style="color:#f92672">::</span>doThingy();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>But <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code> is the same as with <a href="#interface">INTERFACE</a> scope:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">STATIC</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span> <span style="color:#e6db74">&#34;dpndnc::Thingy&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>And symbols inside <code>libAnotherLibrary.a</code> are again the same as with <a href="#private">PRIVATE</a> scope:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>another.cpp.o:
</span></span><span style="display:flex;"><span>000000000000038c s GCC_except_table0
</span></span><span style="display:flex;"><span>00000000000003a0 s GCC_except_table3
</span></span><span style="display:flex;"><span>00000000000003e4 s GCC_except_table4
</span></span><span style="display:flex;"><span>0000000000000400 s __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000000000638 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>00000000000000d0 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000000000 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>Configuring the Tool still requires providing paths to both installation folders:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>And the Tool executable symbols will be the same as with <a href="#private">PRIVATE</a> too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003dd0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e68 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e7c s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e90 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003e10 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003e54 s GCC_except_table2
</span></span><span style="display:flex;"><span>0000000100003c00 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>0000000100003ad0 t __GLOBAL__sub_I_some.cpp
</span></span><span style="display:flex;"><span>0000000100003d20 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000100008000 b someString
</span></span><span style="display:flex;"><span>0000000100008030 b thingyString
</span></span><span style="display:flex;"><span>0000000100008018 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003bf0 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003b20 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003a00 T prjct::lbrSome::doSome()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003c50 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>All that means that the Tool can now use both <code>doTheThing()</code> function from <code>AnotherLibrary</code> and <code>doThingy()</code> function from <code>Thingy</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Thingy/thingy.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// now this one works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;via AnotherLibrary | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doTheThing();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// and this one works too
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;directly | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>dpndnc<span style="color:#f92672">::</span>doThingy();</span></span></code></pre></div>
<p>I remember you were curious about this kind of things, so here&rsquo;s what&rsquo;s inside <code>/path/to/cmake-target-link-libraries-example/tl/build/build.ninja</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>build <span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>tool<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">INCLUDES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build some<span style="color:#f92672">-</span>tool<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">LINK_LIBRARIES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libSomeLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libAnotherLibrary<span style="color:#f92672">.</span>a  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span></span></span></code></pre></div>
<p>As you can see, it&rsquo;s the same as with <a href="#interface">INTERFACE</a> scope.</p>
<h2 id="shared-libraries">SHARED libraries</h2>
<p>Let&rsquo;s check if anything is different when Project libraries are built as <code>SHARED</code>.</p>
<p>But first, a couple of words about DLLs - shared libraries on Windows. As you probably know, <code>.dll</code> file is what your application would need to be available for its runtime, but in order to link with that library on building your application you would still need a <code>.lib</code> file. That <code>.lib</code> file isn&rsquo;t produced &ldquo;by default&rdquo;, because you need to explicitly mark the library&rsquo;s symbols for export/import (<em>or add <code>-DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS=1</code> to export everything, but that&rsquo;s not recommended</em>).</p>
<p>With <code>SomeLibrary</code> as an example, to export its symbols for producing <code>.lib</code> you&rsquo;d need to add <code>__declspec</code> keyword for every symbol in its <a href="https://github.com/retifrav/cmake-target-link-libraries-example/blob/master/prjct/libraries/SomeLibrary/include/Some/some.h">public header</a>. But as you need to do that only when the library is built as <code>SHARED</code>, then you&rsquo;d need to add a compile definition and check for it with <code>#ifdef</code>.</p>
<p>Good news here is that you don&rsquo;t need to set this definition yourself, because CMake already does that for <code>SHARED</code> libraries on its own, in a form of <code>-DSomeLibrary_EXPORTS</code>, where <code>SomeLibrary</code> is the name of the target (<em>you&rsquo;ll be able to see that for yourself in the resulting <code>build.ninja</code> file, on the <code>DEFINES</code> lines</em>). So you only need to do <code>#ifdef SomeLibrary_EXPORTS</code> in your sources. But even that part can be taken care of by CMake with <a href="https://cmake.org/cmake/help/latest/module/GenerateExportHeader.html">GenerateExportHeader</a> (<em>as described in <a href="https://kitware.com/create-dlls-on-windows-without-declspec-using-new-cmake-export-all-feature/">this post</a></em>), although this functionality I haven&rsquo;t tested myself.</p>
<p>Now back to scopes.</p>
<h3 id="private-1">PRIVATE</h3>
<p>Having that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">PRIVATE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>configure libraries as <code>SHARED</code> and build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DBUILD_SHARED_LIBS</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>And yes, there will be something new, here&rsquo;s what&rsquo;s inside <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">SHARED</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Nothing about linking to <code>Thingy</code>!</p>
<p>Let&rsquo;s look at the symbols:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.dylib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000000003ebc s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000003f28 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000003ed0 s GCC_except_table3
</span></span><span style="display:flex;"><span>0000000000003f14 s GCC_except_table4
</span></span><span style="display:flex;"><span>0000000000003cf0 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>0000000000003e10 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000008018 b thingyString
</span></span><span style="display:flex;"><span>0000000000008000 b anotherString
</span></span><span style="display:flex;"><span>0000000000003a30 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex;"><span>0000000000003960 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000003d40 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>There are differences here too. Unlike <a href="#private">PRIVATE</a> scope with <code>STATIC</code> variant, <code>AnotherLibrary</code>&rsquo;s binary now contains <code>Thingy</code> stuff too: not just the function, as before, but also its string variable, which <code>AnotherLibrary</code> binary did not contain in either of scopes with <code>STATIC</code> variant.</p>
<p>And you guessed it right, this means that Tool no longer needs to find the <code>Thingy</code> CMake package and does not need to link to <code>Thingy</code>&rsquo;s binary, so there is no need to provide path to <code>Thingy</code> installation in <code>CMAKE_INSTALL_PREFIX</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>It builds and gets the following symbols:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003e90 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003ed0 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003f14 s GCC_except_table2
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrSome::doSome()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>Only the Project&rsquo;s libraries symbols, no traces of <code>Thingy</code> stuff.</p>
<p>Same story in the <code>/path/to/cmake-target-link-libraries-example/tl/build/build.ninja</code>, no linking to <code>Thingy</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>build <span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>tool<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">INCLUDES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build some<span style="color:#f92672">-</span>tool<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">LINK_LIBRARIES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wl</span><span style="color:#f92672">,-</span>rpath<span style="color:#f92672">,/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libSomeLibrary<span style="color:#f92672">.</span>dylib  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libAnotherLibrary<span style="color:#f92672">.</span>dylib
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span></span></span></code></pre></div>
<p>What&rsquo;s new is that <code>LINK_LIBRARIES</code> now also has <code>-Wl,-rpath</code>.</p>
<p>As for the sources, needless to say that calling <code>doThingy()</code> won&rsquo;t work in this case, same as with <a href="#private">PRIVATE</a> scope in <code>STATIC</code> variant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// not available, or rather not discoverable
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">//#include &lt;Thingy/thingy.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// that works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;via AnotherLibrary | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doTheThing();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// but that doesn&#39;t
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cout &lt;&lt; &#34;directly | &#34;;
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">//dpndnc::doThingy();
</span></span></span></code></pre></div>
<p>A slightly interesting detail is that if you&rsquo;ll make <code>Thingy/thingy.h</code> header discoverable (<em>for example, by copying it to <code>include</code> inside the Project&rsquo;s installation</em>), then Tool will be able to call <code>dpndnc::doThingy()</code>, just like as it was in the same situation with <a href="#private">PRIVATE</a> scope in <code>STATIC</code> variant. But here in <code>SHARED</code> variant it still won&rsquo;t need the <code>Thingy</code>&rsquo;s binary for linking, as this symbol will be resolved from <code>AnotherLibrary</code> binary. Cool, huh. Anyway, it&rsquo;s just a side note; you should definitely not do such things (<em>manipulating headers discovery against scope intentions</em>).</p>
<p>Of course, since the Project libraries are <code>SHARED</code> now, the executable will fail to run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dyld<span style="color:#f92672">[</span>58538<span style="color:#f92672">]</span>: Library not loaded: @rpath/libSomeLibrary.dylib
</span></span><span style="display:flex;"><span>  Referenced from: &lt;SOME-ID-HERE&gt; /path/to/cmake-target-link-libraries-example/tl/install/bin/some-tool
</span></span><span style="display:flex;"><span>  Reason: tried: <span style="color:#e6db74">&#39;/usr/local/lib/libSomeLibrary.dylib&#39;</span> <span style="color:#f92672">(</span>no such file<span style="color:#f92672">)</span>, <span style="color:#e6db74">&#39;/usr/lib/libSomeLibrary.dylib&#39;</span> <span style="color:#f92672">(</span>no such file, not in dyld cache<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Abort trap: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ otool -L ../install/bin/some-tool
</span></span><span style="display:flex;"><span>    @rpath/libSomeLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    @rpath/libAnotherLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libc++.1.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1500.65.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libSystem.B.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1319.100.3<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>On Windows you&rsquo;d need to put the libraries DLLs alongside the executable, while on Mac OS (<em>and GNU/Linux</em>) you also need to set <code>DYLD_LIBRARY_PATH</code> (<em><code>LD_LIBRARY_PATH</code> on GNU/Linux</em>) environment variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cp ../../prjct/install/lib/*.dylib ../install/bin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ DYLD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install/bin&#34;</span> ../install/bin/some-tool
</span></span><span style="display:flex;"><span><span style="color:#75715e"># or</span>
</span></span><span style="display:flex;"><span>$ cd ../install/bin
</span></span><span style="display:flex;"><span>$ DYLD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.&#34;</span> ./some-tool</span></span></code></pre></div>
<p>What&rsquo;s interesting, although unrelated to scopes effects, is that if you try to install the Tool again, right after just installing it, the installation will have some error message while still returning <code>0</code> exit code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cmake --build . --target install
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2/3<span style="color:#f92672">]</span> Install the project...
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /path/to/cmake-target-link-libraries-example/tl/install/bin/some-tool
</span></span><span style="display:flex;"><span>$ echo $?
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cmake --build . --target install
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>0/1<span style="color:#f92672">]</span> Install the project...
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Up-to-date: /path/to/cmake-target-link-libraries-example/tl/install/bin/some-tool
</span></span><span style="display:flex;"><span>error: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/install_name_tool: no LC_RPATH load command with path: /path/to/cmake-target-link-libraries-example/prjct/install/lib found in: /path/to/cmake-target-link-libraries-example/tl/install/bin/some-tool <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> architecture x86_64<span style="color:#f92672">)</span>, required <span style="color:#66d9ef">for</span> specified option <span style="color:#e6db74">&#34;-delete_rpath /path/to/cmake-target-link-libraries-example/prjct/install/lib&#34;</span>
</span></span><span style="display:flex;"><span>$ echo $?
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span></span></span></code></pre></div>
<p>Removing <code>../install/bin/some-tool</code> file and trying again gets rid of the error message. I have no idea what that is, probably one of the Mac OS things.</p>
<p>Anyway, to summarize, the <code>PRIVATE</code> scope in case of <code>SHARED</code> libraries lets you not to deliver your 3rd-party dependencies to you customer, as he&rsquo;ll be able to build his Tool without them. Great news, isn&rsquo;t it. Too bad your customer will likely want to get exactly <code>STATIC</code> variants of your Project libraries, not to mention that he&rsquo;ll probably want to be able to build your Project from sources himself.</p>
<h4 id="what-if-transitive-dependency-is-also-shared">What if transitive dependency is also SHARED</h4>
<p>If <code>Thingy</code> library also was a <code>SHARED</code> library, that wouldn&rsquo;t affect the build and linking:</p>
<ul>
<li>there would be still no linking to it in <code>AnotherLibraryTargets.cmake</code>;</li>
<li>Tool configuration would still not require adding path to <code>Thingy</code>&rsquo;s installation into <code>CMAKE_INSTALL_PREFIX</code> and would not require <code>Thingy</code>&rsquo;s binary to be available for linking.</li>
</ul>
<p>But that would certainly affect the final application - the Tool - because it would then require <code>Thingy</code>&rsquo;s binary for its runtime (<em>in addition to the Project&rsquo;s libraries, and that obviously applies to other scopes too</em>). So if your goal is to minimize the number of things you have to deliver, then you&rsquo;d probably prefer your 3rd-party (<em>transitive for your customer</em>) dependencies to remain <code>STATIC</code> (<em>but that might complicate things if some of those are licensed under LGPL or similar</em>).</p>
<h3 id="interface-1">INTERFACE</h3>
<p>Having that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">INTERFACE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>configure libraries as <code>SHARED</code> and build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DBUILD_SHARED_LIBS</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>Linking to <code>Thingy</code> will be back in <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">SHARED</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span> <span style="color:#e6db74">&#34;dpndnc::Thingy&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Symbols will be the same as with <a href="#interface">INTERFACE</a> scope in <code>STATIC</code> variant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.dylib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000000003ef0 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000003f04 s GCC_except_table2
</span></span><span style="display:flex;"><span>0000000000003f48 s GCC_except_table3
</span></span><span style="display:flex;"><span>0000000000003e40 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000000008000 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000003ac0 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>And again, building the Tool will require providing paths to both Project and <code>Thingy</code> installations:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>The Tool&rsquo;s binary will get the following symbols:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003e64 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003efc s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003ea4 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003ee8 s GCC_except_table2
</span></span><span style="display:flex;"><span>0000000100003db0 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000100008000 b thingyString
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrSome::doSome()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000100003ce0 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>Unlike its <code>STATIC</code> variant, this time there are no string variables from <code>AnotherLibrary</code> and <code>SomeLibrary</code>, but available functions are the same:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Thingy/thingy.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// trying to use that one will fail to build with
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// error: no member named &#39;doTheThing&#39; in namespace &#39;prjct::lbrAnother&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cout &lt;&lt; &#34;via AnotherLibrary | &#34;;
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">//prjct::lbrAnother::doTheThing();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// that one works fine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;directly | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>dpndnc<span style="color:#f92672">::</span>doThingy();</span></span></code></pre></div>
<p>The <code>/path/to/cmake-target-link-libraries-example/tl/build/build.ninja</code> contents are almost the same as with <a href="#interface">INTERFACE</a> scope in <code>STATIC</code> variant, except for the <code>-Wl,-rpath</code> again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>build <span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>tool<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">INCLUDES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include <span style="color:#f92672">-</span>isystem <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>include
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build some<span style="color:#f92672">-</span>tool<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">LINK_LIBRARIES</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wl</span><span style="color:#f92672">,-</span>rpath<span style="color:#f92672">,/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libSomeLibrary<span style="color:#f92672">.</span>dylib  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libAnotherLibrary<span style="color:#f92672">.</span>dylib  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>dpndnc<span style="color:#f92672">/</span>install<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span></span></span></code></pre></div>
<p>And the Tool executable will still require Project&rsquo;s libraries to be available for runtime. But even though it requires <code>Thingy</code>&rsquo;s binary for linking, it is not needed for runtime:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ otool -L ../install/bin/some-tool
</span></span><span style="display:flex;"><span>    @rpath/libSomeLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    @rpath/libAnotherLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libc++.1.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1500.65.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libSystem.B.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1319.100.3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp ../../prjct/install/lib/*.dylib ../install/bin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls -L1 ../install/bin/
</span></span><span style="display:flex;"><span>libAnotherLibrary.dylib
</span></span><span style="display:flex;"><span>libSomeLibrary.dylib
</span></span><span style="display:flex;"><span>some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ DYLD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install/bin&#34;</span> ../install/bin/some-tool</span></span></code></pre></div>
<h3 id="public-1">PUBLIC</h3>
<p>Having that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">Thingy</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">PUBLIC</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">dpndnc::Thingy</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>configure libraries as <code>SHARED</code> and build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>prjct
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DBUILD_SHARED_LIBS</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>The linking to <code>Thingy</code> is still present in <code>install/share/AnotherLibrary/AnotherLibraryTargets.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Create imported target prjct::AnotherLibrary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>add_library(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">SHARED</span> <span style="color:#e6db74">IMPORTED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#e6db74">prjct::AnotherLibrary</span> <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">INTERFACE_INCLUDE_DIRECTORIES</span> <span style="color:#e6db74">&#34;${_IMPORT_PREFIX}/include;${_IMPORT_PREFIX}/include&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span> <span style="color:#e6db74">&#34;dpndnc::Thingy&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Symbols are the same plus again <code>Thingy</code>&rsquo;s string variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/lib/libAnotherLibrary.dylib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000000003ebc s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000003f28 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000000003ed0 s GCC_except_table3
</span></span><span style="display:flex;"><span>0000000000003f14 s GCC_except_table4
</span></span><span style="display:flex;"><span>0000000000003cf0 t __GLOBAL__sub_I_another.cpp
</span></span><span style="display:flex;"><span>0000000000003e10 t __GLOBAL__sub_I_thingy.cpp
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex;"><span>0000000000008018 b thingyString
</span></span><span style="display:flex;"><span>0000000000008000 b anotherString
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000003a30 T prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000003960 T prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>0000000000003d40 T dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>Building the Tool of course still requires both installation paths:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>link<span style="color:#f92672">-</span>libraries<span style="color:#f92672">-</span>example<span style="color:#f92672">/</span>tl
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/cmake-target-link-libraries-example/prjct/install;/path/to/cmake-target-link-libraries-example/dpndnc/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>The symbols it gets are these:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>$ nm --demangle ../install/bin/some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>0000000100003e84 s GCC_except_table0
</span></span><span style="display:flex;"><span>0000000100003ec4 s GCC_except_table1
</span></span><span style="display:flex;"><span>0000000100003f08 s GCC_except_table2
</span></span><span style="display:flex;"><span>                 U __Unwind_Resume
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrAnother::doTheThing()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrAnother::doAnother()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U prjct::lbrSome::doSome()
</span></span><span style="display:flex; background-color:#3c3d38"><span>                 U dpndnc::doThingy()
</span></span><span style="display:flex;"><span>                 ...</span></span></code></pre></div>
<p>And all the functions are available:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;SomeLibrary/some.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;AnotherLibrary/another.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Thingy/thingy.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Direct dependencies:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrSome<span style="color:#f92672">::</span>doSome();
</span></span><span style="display:flex;"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doAnother();
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Transitive dependency:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// this one works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;via AnotherLibrary | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>prjct<span style="color:#f92672">::</span>lbrAnother<span style="color:#f92672">::</span>doTheThing();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// and this one works
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;directly | &#34;</span>;
</span></span><span style="display:flex; background-color:#3c3d38"><span>dpndnc<span style="color:#f92672">::</span>doThingy();</span></span></code></pre></div>
<p>Requirements for runtime libraries are the same too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ otool -L ../install/bin/some-tool
</span></span><span style="display:flex;"><span>    @rpath/libSomeLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    @rpath/libAnotherLibrary.dylib <span style="color:#f92672">(</span>compatibility version 0.0.0, current version 0.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libc++.1.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1500.65.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    /usr/lib/libSystem.B.dylib <span style="color:#f92672">(</span>compatibility version 1.0.0, current version 1319.100.3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp ../../prjct/install/lib/*.dylib ../install/bin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls -L1 ../install/bin/
</span></span><span style="display:flex;"><span>libAnotherLibrary.dylib
</span></span><span style="display:flex;"><span>libSomeLibrary.dylib
</span></span><span style="display:flex;"><span>some-tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ DYLD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install/bin&#34;</span> ../install/bin/some-tool</span></span></code></pre></div>
<h1 id="so-when-do-i-need-to-deliver-3rd-party-dependencies-to-my-customers">So when do I need to deliver 3rd-party dependencies to my customers</h1>
<p>&hellip;so they could build their applications with your SDK/framework/library, which is their direct dependency.</p>
<p>Almost always, as it seems.</p>
<p>Assuming that we are comparing the scope of <code>target_link_libraries()</code> from our library to 3rd-party dependencies, with both <code>STATIC</code> and <code>SHARED</code> variants of our library, a summarizing table would be this:</p>
<div style="overflow-x:auto;">
    <table class="table">
        <thead>
            <tr>
                <th></th>
                <th>STATIC</th>
                <th>SHARED</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>PRIVATE</th>
                <td style="color:red;">yes</td>
                <td style="color:green;">no</td>
            </tr>
            <tr>
                <th>INTERFACE</th>
                <td style="color:red;">yes</td>
                <td style="color:red;">yes</td>
            </tr>
            <tr>
                <th>PUBLIC</th>
                <td style="color:red;">yes</td>
                <td style="color:red;">yes</td>
            </tr>
        </tbody>
    </table>
</div>
<h2 id="but-i-dont-want-to">But I don&rsquo;t want to</h2>
<p>If you really don&rsquo;t want to distribute all of your 3rd-party dependencies to customers (<em>one of the reasons could be that they are not using CMake, so they&rsquo;d need to somehow manage the transitive dependencies linking themselves</em>), then there are still some options (<em>none of which I&rsquo;ve tried myself</em>).</p>
<p>You could probably bundle/vendor 3rd-party dependencies sources into your SDK/framework/library project and make them <a href="https://cmake.org/cmake/help/latest/command/add_library.html#object-libraries">OBJECT</a> libraries. But we are all civilized people here, right, we want to use CMake packages and <code>find_package(Thingy CONFIG REQUIRED)</code>, and probably with a package manager such as <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/">vcpkg</a>, so no vendoring, forget that I even brought this up.</p>
<p>Another way to &ldquo;hide&rdquo; 3rd-party dependencies would probably be via making a frankenstein monster of a static mega-library, which would contain everything: object files of your libraries and object files of 3rd-party libraries. Basically, you would &ldquo;unpack&rdquo; all the static libraries that you got and &ldquo;pack&rdquo; their object files into one big <del>fucking</del> final static library, which is what you&rsquo;d distribute to your customers. As with the previous option, this doesn&rsquo;t look like something I would recommend, but if you still would like to do that, here are some links for further reading:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/2157629/">Linking static libraries to other static libraries</a>;</li>
<li><a href="https://stackoverflow.com/questions/13128/">How can I combine several C/C++ libraries into one</a>;</li>
<li><a href="https://stackoverflow.com/questions/50022318/">Using CMake to build a static library of static libraries</a>;</li>
<li><a href="https://cristianadam.eu/20190501/bundling-together-static-libraries-with-cmake/">Bundling together static libraries with CMake</a>, and as a result of that one, a <a href="https://gitlab.kitware.com/cmake/cmake/-/issues/19224">feature request</a> in CMake&rsquo;s repository.</li>
</ul>
<p>It also wouldn&rsquo;t hurt to make sure that none of your 3rd-party dependencies license terms would mind against you performing these acrobatic exercises.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/cmake/">cmake</a><a class="tag" href="https://retifrav.github.io/tags/cpp/">cpp</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <div style="border:2px orange solid; background-color: floralwhite; border-radius:0.5rem; padding: 10px 14px; font-style:italic; font-size:0.9em;">
              If you'd like to comment the article, you can do it on the
              <a href="https://decovar.dev/blog/2023/07/22/cmake-target-link-libraries-scopes/#remark42" style="font-weight:bold;">
                  original website</a>. This one is just a mirror without comments.
          </div>
      
      </div>
    </div>
  </div>

        <div id="footer">
          <div>
              2014 - 2024,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <a href="/index.xml" title="Subscribe to RSS"><img src="/images/rss.png" width="50px"></a>
              <a style="margin-left: 5px;" href="https://t.me/decovar" title="Telegram channel"><img src="/images/telegram.png" width="50px"></a>
            </div>
            <div id="telegramWidgetBlock" class="sidebar-section"></div>
            <div class="sidebar-section">
                <h3>Stuff</h3>
                <ul class="sidebar-list">
                    <li><a href="/stuff/kakoi-jvotne-vi-kysaiti/index.html">КАКОИ ЖВОТНЕ ВЫ КУСАИТИ?</a></li>
                </ul>
            </div>
            <div id="social-networks" class="sidebar-section">
              <h3>Social networks</h3>
              <div style="font-family:Courier New;">
                  Zuck: <i>Yeah so if you ever need info about anyone at Harvard</i><br/>
                  Zuck: <i>Just ask</i><br/>
                  Zuck: <i>I have over 4,000 emails, pictures, addresses, SNS</i><br/>
                  smb: <i>What? How'd you manage that one?</i><br/>
                  Zuck: <i>People just submitted it.</i><br/>
                  Zuck: <i>I don't know why.</i><br/>
                  Zuck: <i>They "trust me"</i><br/>
                  Zuck: <i>Dumb fucks</i>
              </div>
            </div>
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (67)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (36)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/linux">linux (27)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (14)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (11)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/ios">ios (7)</a></li>
                  
                  <li><a href="/tags/apple">apple (6)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53340325-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "UA-53340325-1");
    </script>

    <script>
        const telegramBlock = document.getElementById("telegramWidgetBlock");
        window.onload = () =>
        {
            const pinnedTelegramPosts = [306,319,323]
            const randomedPostID = pinnedTelegramPosts[
                Math.floor(Math.random() * pinnedTelegramPosts.length)
            ];
            const telegramWidgetScript = document.createElement("script");
            telegramWidgetScript.src = "https://telegram.org/js/telegram-widget.js?21";
            telegramWidgetScript.dataset["telegramPost"] = `decovar/${randomedPostID}`;
            telegramWidgetScript.dataset["color"] = "1E8448";
            telegramWidgetScript.dataset["width"] = "100%";
            telegramWidgetScript.dataset["userpic"] = "false";
            telegramBlock.appendChild(telegramWidgetScript);
        }
    </script>

    
    
  </body>
</html>

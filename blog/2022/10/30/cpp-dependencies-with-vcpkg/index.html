<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Managing dependencies in a C&#43;&#43; project with vcpkg | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2022/10/30/cpp-dependencies-with-vcpkg/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="vcpkg package manager greatly helps with managing dependencies in a C&#43;&#43; project. Comparing with Conan, in my opinion, it&#39;s simpler to understand and use (if you already have some experience with CMake)." />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2022/10/30/cpp-dependencies-with-vcpkg/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="Managing dependencies in a C&#43;&#43; project with vcpkg">
  <meta property="og:description" content="vcpkg package manager greatly helps with managing dependencies in a C&#43;&#43; project. Comparing with Conan, in my opinion, it&#39;s simpler to understand and use (if you already have some experience with CMake).">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-10-30T16:09:08+02:00">
    <meta property="article:modified_time" content="2022-10-30T16:09:08+02:00">
    <meta property="article:tag" content="Cpp">
    <meta property="article:tag" content="Cmake">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2022/10/30/cpp-dependencies-with-vcpkg/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Managing dependencies in a C&#43;&#43; project with vcpkg</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2022-10-30 16:09:08 &#43;0200</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 113 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>More than half a year ago I was <a href="/blog/2022/02/06/cpp-dependencies-with-conan/">trying out Conan</a> package manager for resolving dependencies in our C++ project. The research went well, but we never actually proceeded with switching to Conan for the whole project. And then a couple of weeks ago I started looking into <a href="https://vcpkg.io/">vcpkg</a>.</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/vcpkg.png" alt="vcpkg logo">

<p>I&rsquo;ve heard about vcpkg before and even tried to make a vcpkg package for one library a couple of years ago, but back then I didn&rsquo;t find documentation for this (<em>as I now understand, that&rsquo;s because one does not really create a &ldquo;package&rdquo;</em>) and abandonned the task. I never thought I&rsquo;ll be looking at vcpkg again, but recently I discovered that some teams have been switching from Conan to vcpkg, which sounded intriguing and promising, as we still needed a package manager for our projects.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#why-we-didnt-proceed-with-conan">Why we didn&rsquo;t proceed with Conan</a></li>
    <li><a href="#about-vcpkg">About vcpkg</a>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#what-is-a-vcpkg-package">What is a vcpkg package</a></li>
        <li><a href="#registry">Registry</a>
          <ul>
            <li><a href="#port-structure">Port structure</a>
              <ul>
                <li><a href="#vcpkgjson">vcpkg.json</a></li>
                <li><a href="#portfilecmake">portfile.cmake</a>
                  <ul>
                    <li><a href="#vcpkg_from_git">vcpkg_from_git</a></li>
                    <li><a href="#vcpkg_cmake_configure">vcpkg_cmake_configure</a></li>
                    <li><a href="#vcpkg_cmake_install">vcpkg_cmake_install</a></li>
                    <li><a href="#vcpkg_cmake_config_fixup">vcpkg_cmake_config_fixup</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#versions">Versions</a>
              <ul>
                <li><a href="#baselinejson">baseline.json</a></li>
                <li><a href="#versions-file">Versions file</a>
                  <ul>
                    <li><a href="#several-versions-of-a-port">Several versions of a port</a></li>
                    <li><a href="#checking-versions-and-hashes">Checking versions and hashes</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#triplets">Triplets</a></li>
      </ul>
    </li>
    <li><a href="#creating-your-own-ports">Creating your own ports</a>
      <ul>
        <li><a href="#portfile">Portfile</a>
          <ul>
            <li><a href="#adding-files">Adding files</a></li>
            <li><a href="#patches">Patches</a></li>
            <li><a href="#features">Features</a>
              <ul>
                <li><a href="#platform-specific-features">Platform-specific features</a></li>
                <li><a href="#feature-dependent-features">Feature-dependent features</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#cmake-helpers">CMake helpers</a></li>
        <li><a href="#cmake-wrapper">CMake wrapper</a></li>
        <li><a href="#multiple-targetscomponents-in-one-project">Multiple targets/components in one project</a>
          <ul>
            <li><a href="#making-cmake-configs-discoverable">Making CMake configs discoverable</a></li>
            <li><a href="#partial-components-installation">Partial components installation</a>
              <ul>
                <li><a href="#internal-dependencies">Internal dependencies</a>
                  <ul>
                    <li><a href="#header-only-libraries">Header-only libraries</a></li>
                  </ul>
                </li>
                <li><a href="#sparse-checkout">Sparse checkout</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#updating-a-port">Updating a port</a></li>
      </ul>
    </li>
    <li><a href="#installing-ports-from-a-registry">Installing ports from a registry</a>
      <ul>
        <li><a href="#without-a-project">Without a project</a>
          <ul>
            <li><a href="#dummy-installation">Dummy installation</a></li>
          </ul>
        </li>
        <li><a href="#in-a-project">In a project</a>
          <ul>
            <li><a href="#locking-on-dependencies-versions">Locking on dependencies versions</a>
              <ul>
                <li><a href="#transitive-dependencies">Transitive dependencies</a></li>
              </ul>
            </li>
            <li><a href="#multiple-registries">Multiple registries</a></li>
            <li><a href="#cmake-presets">CMake presets</a></li>
            <li><a href="#updating-a-dependency-version">Updating a dependency version</a></li>
            <li><a href="#static-crtmsvc-linkage">Static CRT/MSVC linkage</a></li>
            <li><a href="#dynamic-and-static-linking">Dynamic and static linking</a>
              <ul>
                <li><a href="#what-if-a-library-is-static-only">What if a library is static only</a></li>
              </ul>
            </li>
            <li><a href="#mapping-of-release-binaries-in-relwithdebinfo">Mapping of Release binaries in RelWithDebInfo</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#per-platform-specifics">Per-platform specifics</a>
      <ul>
        <li><a href="#webassembly">WebAssembly</a>
          <ul>
            <li><a href="#chainloading-emscripten-toolchain">Chainloading Emscripten toolchain</a>
              <ul>
                <li><a href="#cmake_prefix_path-isnt-used">CMAKE_PREFIX_PATH isn&rsquo;t used</a></li>
              </ul>
            </li>
            <li><a href="#enabling-pthreads-support">Enabling pthreads support</a>
              <ul>
                <li><a href="#side-effect-of-chainloading-a-custom-toolchain">Side-effect of chainloading a custom toolchain</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#windows">Windows</a>
          <ul>
            <li><a href="#msvc-toolset">MSVC toolset</a></li>
            <li><a href="#release-binaries-size-is-bigger-with-vcpkg">Release binaries size is bigger with vcpkg</a>
              <ul>
                <li><a href="#removing-z7-flag-from-release-configuration">Removing /Z7 flag from Release configuration</a></li>
                <li><a href="#comparison-of-binary-sizes-with-and-without-z7">Comparison of binary sizes with and without /Z7</a></li>
              </ul>
            </li>
            <li><a href="#building-with-clang-instead-of-msvc">Building with Clang instead of MSVC</a>
              <ul>
                <li><a href="#lzma-fails-without-avx2-intrinsics">LZMA fails without AVX2 intrinsics</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#gnulinux">GNU/Linux</a>
          <ul>
            <li><a href="#missing-executable-attribute">Missing executable attribute</a></li>
          </ul>
        </li>
        <li><a href="#ios">iOS</a>
          <ul>
            <li><a href="#combinedfatuniversal-binaries-for-devices-and-simulator">Combined/fat/universal binaries for devices and simulator</a>
              <ul>
                <li><a href="#merging-different-architectures-into-one-universal-binary">Merging different architectures into one universal binary</a></li>
                <li><a href="#jpeg-turbo-doesnt-support-building-with-more-than-one-architecture">jpeg-turbo doesn&rsquo;t support building with more than one architecture</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#mac-os">Mac OS</a>
          <ul>
            <li><a href="#universal-binaries">Universal binaries</a>
              <ul>
                <li><a href="#png-fails-to-generate-tf1">PNG fails to generate tf1</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#dependency-graph">Dependency graph</a></li>
    <li><a href="#distributing-your-project">Distributing your project</a></li>
    <li><a href="#so-how-is-vcpkg-comparing-with-conan">So, how is vcpkg comparing with Conan</a>
      <ul>
        <li><a href="#simplicity">Simplicity</a></li>
        <li><a href="#speed">Speed</a></li>
        <li><a href="#documentation">Documentation</a></li>
        <li><a href="#overall-impression">Overall impression</a></li>
      </ul>
    </li>
    <li><a href="#updates">Updates</a>
      <ul>
        <li><a href="#2023-09-01--build-time-improvements">2023-09-01 | Build time improvements</a></li>
        <li><a href="#2024-07-24--tools-as-host-dependencies">2024-07-24 | Tools as host dependencies</a></li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="why-we-didnt-proceed-with-conan">Why we didn&rsquo;t proceed with Conan</h1>
<p>I think, this is because we chose a wrong approach to it. At the first glance it seemed that integrating Conan as a part of our build system would be too disruptive, so we decided to just pack pre-built artifacts from the <code>install</code> destination with <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#packing">export-pkg -pf</a>. So we were not making source packages and were not implementing the <code>build()</code> method in recipes.</p>
<p>Effectively, we were prebuilding all our dependencies for <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#projects-and-configurations">all the platforms</a> that we target, and that turned out to be very (<em>very</em>) time-consuming, so we pretty much didn&rsquo;t progress beyond that <a href="/blog/2022/02/06/cpp-dependencies-with-conan/images/dependencies-graph.png">small subset</a> of dependencies from the pilot project created during research.</p>
<p>So yeah, perhaps if we chose to integrate Conan into our buildsystem and build dependencies from sources, the result would be better (<em>faster</em>). Why didn&rsquo;t we do so? Well, we have been already working with other package managers before - APT/deb, NuGet, npm and others that our users were requesting - and these packages are mostly just archives with certain meta-information, and that is how we were looking at Conan too, not expecting it to also be able to manage building. It also didn&rsquo;t help that we were reading Conan&rsquo;s documentation rather chaotically: I remember I was googling for something like &ldquo;<em><a href="https://google.com/search?q=Conan+package+pre-built+binaries">Conan package pre-built binaries</a></em>&rdquo; and getting directly to <a href="https://docs.conan.io/en/1.53/creating_packages/existing_binaries.html">those pages</a> without properly studying the rest of the documentation.</p>
<p>Anyway, having covered dependencies of the pilot project (<em>one of our libraries</em>) with Conan, we invited a couple of other teams to test it out, and immediately it turned out that they use a different combination of platforms/compilers, which we didn&rsquo;t pre-build for, and so they had to force/override specific versions (<em>for example, with <code>-s compiler.toolset=&quot;v142&quot;</code> and <code>-DCONAN_DISABLE_CHECK_COMPILER=1</code></em>), as they were not able to build missing binaries (<em>because we did not implement the <code>build()</code> method in recipes</em>).</p>
<p>But even that was not all, as users (<em>understandably</em>) wanted to fetch 3rd-party dependencies from Conan Center and our packages from our Artifactory, while we were fetching everything from our Artifactory (<em>using different <code>user/channel</code> values too</em>), and such a situation isn&rsquo;t handled too nicely with Conan (<em>or we didn&rsquo;t find a way</em>).</p>
<p>Finally, not everyone in our team liked the idea of complicating the build toolchain by adding yet another tool, because not only one needs to run one more thing before building the project, but also the installation of that thing isn&rsquo;t very straightforward, as one needs to have Python, pip and only then Conan can be installed. Yes, it is rather a trivial setup, and yet some have managed to struggle even with this. You really shouldn&rsquo;t underestimate how common the question/challenge of installing pip is.</p>
<h1 id="about-vcpkg">About vcpkg</h1>
<p>In short, vcpkg is a combination of a <a href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">CMake toolchain</a> and a <a href="https://github.com/microsoft/vcpkg-tool">CLI tool</a>. Together they handle the following:</p>
<ul>
<li>figuring out build environment (<em>platform, compiler, linking</em>);</li>
<li>fetching dependencies sources, patching them if required;</li>
<li>building <u>or restoring</u> those dependencies before configuring the main project.</li>
</ul>
<p>Restoring means that if dependencies have been already built before, then instead of building them again vcpkg will restore their pre-built binary packages either from local cache or from a remote storage. This functionality is called <a href="https://github.com/microsoft/vcpkg/blob/master/docs/users/binarycaching.md">binary caching</a>, and as <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#why-bother">with Conan</a> that&rsquo;s our main reasoning for using vcpkg for resolving dependencies - to avoid re-building the code that changes only so often.</p>
<p>Here&rsquo;s also a <a href="https://youtube.com/watch?v=b4gJtXfrNfU">good talk</a> at <a href="https://ndcoslo.com">NDC Oslo</a> conference about vcpkg, Conan and in general about dependency management for C++ projects.</p>
<p>Schematically simplified vcpkg functionality can be visualized like this:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/vcpkg-schema.png" alt="vcpkg functionality schema">

<p>There will be more details about what&rsquo;s going on here later, but in short it shows <a href="#in-a-project">a project</a> that depends on 3 libraries (<em>and 3 CMake helpers</em>), and vcpkg handles fetching and building dependencies before building the main project. If dependencies have been already built before, then they are just restored from cache.</p>
<p>For us local cache on CI/CD buildbots will be absolutely enough, but later we&rsquo;ll probably also consider optionally storing pre-built dependencies packages in a centralized remote (<em>in-house</em>) storage, perhaps in a form of NuGet packages. In terms of the schema above the only change in that case would be that the cache will be stored not on the same machine but on some other server.</p>
<h2 id="installation">Installation</h2>
<p>You need to have one of the latest CMake versions in the system, otherwise vcpkg installer script will download it for you and put it somewhere in the system, so you&rsquo;ll have more than one CMake on your computer. In my case it required CMake 3.24 as a minimum.</p>
<p>Regarding system environment, I have Windows, Mac OS and GNU/Linux hosts, and while here in the article it is assumed that one uses Mac OS environment, all the steps will be 99% the same on any other platform. And on Windows, as usual, I recommend to use Git BASH.</p>
<p>The installation of vcpkg starts with cloning its repository:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>$ git clone git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">microsoft/vcpkg.git</span>
</span></span><span style="display:flex;"><span>$ cd <span style="color:#f92672">./</span>vcpkg<span style="color:#f92672">/</span></span></span></code></pre></div>
<p>That will bring you the first of the two components - the CMake toolchain - it will be placed to <code>/path/to/programs/vcpkg/scripts/buildsystems/vcpkg.cmake</code>.</p>
<p>Before continuing, set <code>VCPKG_DISABLE_METRICS</code> environment variable to prevent anal telemetry probing (<em>it&rsquo;s Microsoft, after all</em>).</p>
<p>Now you can start the &ldquo;installation&rdquo; by executing this script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ <span style="color:#f92672">./</span>bootstrap<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">.</span>sh</span></span></code></pre></div>
<p>It will in turn call <code>./scripts/bootstrap.sh</code> script and download the second component - vcpkg CLI tool binary from its repository. In my case it was <a href="https://github.com/microsoft/vcpkg-tool/releases/download/2022-09-20/vcpkg-glibc">2022-09-20</a> version. It also does some other things, which you can look up in the script file. I would prefer to do all these things myself than letting a script execute a bazillion commands in my system.</p>
<p>As a result you&rsquo;ll have the tool binary at <code>/path/to/programs/vcpkg/vcpkg</code> (<em><code>vcpkg.exe</code> on Windows</em>). For convenience, you might want to add <code>/path/to/programs/vcpkg</code> to your <code>PATH</code> (<em>so you could call vcpkg CLI tool from anywhere</em>). And while you are at it, also set <code>VCPKG_ROOT</code> environment variable to <code>/path/to/programs/vcpkg</code>.</p>
<h2 id="what-is-a-vcpkg-package">What is a vcpkg package</h2>
<p>Right away, it is not correct to call them &ldquo;<em>packages</em>&rdquo;, because they are more like recipes for configuring and building. In vcpkg&rsquo;s terminology they are called &ldquo;<em>ports</em>&rdquo;.</p>
<p>In its basic form a vcpkg port is just these two files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">./</span>glfw
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>here:</p>
<ul>
<li><code>portfile.cmake</code> - CMake instructions for fetching sources, configuring, building, installing and grooming;</li>
<li><code>vcpkg.json</code> - information about the package/port: name, description, homepage, version and its own dependencies.</li>
</ul>
<p>If a library, which you want to add as a dependency to you project, is already has a nice and modern CMake project file and with proper installation too, then you won&rsquo;t need anything but these two files to make a <del>package</del> port.</p>
<p>But quite often (<em>way too often</em>) you will need at the very least to patch the original library&rsquo;s <code>CMakeLists.txt</code> or even create one from scratch, as the original library&rsquo;s repository might not have anything for CMake out of the box. Either way, the point is that <code>portfile.cmake</code> file isn&rsquo;t a replacement for a potentially missing <code>CMakeLists.txt</code>, as its purpose should be just to get the sources and run commands for building/installation, so it expects <code>CMakeLists.txt</code> to be already available.</p>
<p>Missing/additional files are supposed to be just placed into the package folder alongside and referred to from <code>portfile.cmake</code>. For example, here&rsquo;s how a more complex package might look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">./</span>dearimgui
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> fixing<span style="color:#f92672">-</span>something<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>here:</p>
<ul>
<li><code>CMakeLists.txt</code> - if you are unlucky enough to require a library without CMake support;</li>
<li><code>fixing-something.patch</code> - in case there is some problem or a change that you need to fix/apply, and the library maintainer doesn&rsquo;t want / can&rsquo;t do it;</li>
<li><code>portfile.cmake</code> - applies the <code>fixing-something.patch</code> after fetching library sources and copies <code>CMakeLists.txt</code> to the library source directory (<em>or wherever you want</em>);</li>
<li><code>vcpkg.json</code> - name, version, etc.</li>
</ul>
<h2 id="registry">Registry</h2>
<p>Packages or actually <a href="#what-is-a-vcpkg-package">ports</a> need to be stored somewhere, and such place is called a &ldquo;registry&rdquo;. As a matter of fact, the repository that you cloned to <a href="#installation">install</a> vcpkg is at the same time a registry too: <del>packages</del> ports are located in the <code>./ports</code> folder. You can take a look at any of them to see for yourself that in the most simple cases it is indeed just a duo of <code>portfile.cmake</code> and <code>vcpkg.json</code> files. You&rsquo;ll also see that in many cases it isn&rsquo;t so simple.</p>
<p>And so yes, you can use Microsoft&rsquo;s vcpkg repository as a registry for your project. But we of course wanted to have our own in-house registry on our own server maintained by ourselves. And what would you know, setting up your own vcpkg registry is the fucking easiest thing in the world.</p>
<p>Here&rsquo;s Microsoft&rsquo;s own <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/registries.md">documentation</a> (<em>and also <a href="https://devblogs.microsoft.com/cppblog/registries-bring-your-own-libraries-to-vcpkg/">this article</a></em>) on the matter. Basically, a vcpkg registry is just a Git repository with the following structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> ports
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> versions</span></span></code></pre></div>
<p>That Git repository can be hosted on a GitHub, GitLab, Gitea, whatever other service or just a regular bare Git repository available via SSH/HTTP. Isn&rsquo;t it fucking great! I was so happy, I almost pissed myself. That is an absolute respect and a huge <strong>+1</strong> to Microsoft&rsquo;s karma.</p>
<p>So let&rsquo;s create our own vcpkg registry. For starters it will contain just one port - <a href="https://www.glfw.org">GLFW</a> library - and the structure of the repository will then be the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> ports
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> glfw
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> versions
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> baseline<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> g<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> glfw<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>As an example for the reference, I&rsquo;ve created my own public registry <a href="https://github.com/retifrav/vcpkg-registry">here</a> (<em>right now it contains several other ports too</em>).</p>
<h3 id="port-structure">Port structure</h3>
<p>With <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/glfw">my GLFW port</a> as an example.</p>
<h4 id="vcpkgjson">vcpkg.json</h4>
<p>The <code>vcpkg.json</code> contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A multi-platform library for OpenGL/Vulkan/etc, window and input&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;homepage&#34;</span>: <span style="color:#e6db74">&#34;https://www.glfw.org/&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;vcpkg-cmake&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;vcpkg-cmake-config&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>These <code>vcpkg-cmake</code> and <code>vcpkg-cmake-config</code> dependencies will be covered in a minute. For now note the <code>&quot;host&quot;: true</code> - it means that these dependencies are so-called &ldquo;host dependencies&rdquo;, so they are fetched and installed before the packages that depend on them.</p>
<h4 id="portfilecmake">portfile.cmake</h4>
<p>The <code>portfile.cmake</code> looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># where to get the package sources from
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_from_git(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">OUT_SOURCE_PATH</span> <span style="color:#e6db74">SOURCE_PATH</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">URL</span> <span style="color:#e6db74">git@github.com:glfw/glfw.git</span>             <span style="color:#75715e"># Git repository cloning URL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">REF</span> <span style="color:#e6db74">7482de6071d21db77a7236155da44c172a7f6c9e</span> <span style="color:#75715e"># commit hash (pointing to a version tag)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># how to configure the project
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># thankfully, GLFW already has CMakeLists.txt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_configure(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># where CMakeLists.txt is (here&#39;s it&#39;s on the root level of the project)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">SOURCE_PATH</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># CMake configuration options, just regular -D stuff
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">OPTIONS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">-DGLFW_BUILD_EXAMPLES=0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">-DGLFW_BUILD_TESTS=0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">-DGLFW_BUILD_DOCS=0</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># this one actually builds and installs the project
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_install()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># this will (try to) fix possible problems with imported targets
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;glfw3&#34;</span>          <span style="color:#75715e"># if the project name (glfw3) is different from the port name (glfw)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;lib/cmake/glfw3&#34;</span> <span style="color:#75715e"># where to find project&#39;s CMake configs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># don&#39;t know what this is used for, I have never needed it yet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#vcpkg_fixup_pkgconfig()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># this one you just need to have, and sometimes you&#39;ll need to delete even more things
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># feels like a crutch, but okay
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>file(<span style="color:#e6db74">REMOVE_RECURSE</span> <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/debug/include&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># vcpkg expects license information to be contained in the file named &#34;copyright&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>file(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">INSTALL</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}/LICENSE.md&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span> <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/${PORT}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">RENAME</span> <span style="color:#e6db74">copyright</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>The <code>${PORT}</code> thing is of course not a standard CMake variable. <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_common_definitions.md">Here</a> you can take a look at the full(?) list of vcpkg variables that can be used in portfiles.</p>
<p>Now, if you, like me, started by reading <a href="https://devblogs.microsoft.com/cppblog/registries-bring-your-own-libraries-to-vcpkg/">that blog post</a>, then at first you&rsquo;ll have the following functions in your <code>portfile.cmake</code>:</p>
<ul>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_configure_cmake.md">vcpkg_configure_cmake()</a></li>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_install_cmake.md">vcpkg_install_cmake()</a></li>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_fixup_cmake_targets.md">vcpkg_fixup_cmake_targets()</a></li>
</ul>
<p>But when you&rsquo;ll go to read about any of these in the documentation, you&rsquo;ll discover that they have been already deprecated, and instead you should use these ones:</p>
<ul>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_cmake_configure.md">vcpkg_cmake_configure()</a></li>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_cmake_install.md">vcpkg_cmake_install()</a></li>
<li><a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/ports/vcpkg-cmake-config/vcpkg_cmake_config_fixup.md">vcpkg_cmake_config_fixup()</a></li>
</ul>
<p>And that is why our example GLFW package depends on <code>vcpkg-cmake</code> and <code>vcpkg-cmake-config</code> packages, which are so-called helper packages, as they provide these functions to GLFW&rsquo;s portfile.</p>
<p>Why the deprecated variants come out of the box and the new ones are placed into helper packages - I don&rsquo;t know. Perhaps that is so they could be easier updated to newer versions?</p>
<p>Another thing here is that if we don&rsquo;t want to use Microsoft&rsquo;s registry, then we&rsquo;ll obviously need to copy these packages (<a href="https://github.com/microsoft/vcpkg/tree/master/ports/vcpkg-cmake">vcpkg-cmake</a> and <a href="https://github.com/microsoft/vcpkg/tree/master/ports/vcpkg-cmake-config">vcpkg-cmake-config</a>) to our registry, and then the structure of the registry will be the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> ports
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> glfw
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>port<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg_cmake_build<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg_cmake_configure<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg_cmake_install<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>port<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> vcpkg_cmake_config_fixup<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> versions
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> baseline<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> g<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> glfw<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> v<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>And now some more details about these functions from the portfile.</p>
<h5 id="vcpkg_from_git">vcpkg_from_git</h5>
<p>The <a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_from_git.md">vcpkg_from_git()</a> function fetches the library sources from a Git repository.</p>
<p>Here I&rsquo;m using a GitHub repository that is available via SSH, so I need to have the following in my <code>~/.ssh/config</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">Host</span> github<span style="color:#f92672">.</span>com
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">HostName</span> github<span style="color:#f92672">.</span>com
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span> git
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PreferredAuthentications</span> publickey
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IdentityFile</span> <span style="color:#f92672">~/.</span>ssh<span style="color:#f92672">/</span><span style="color:#a6e22e">MY</span><span style="color:#f92672">-</span><span style="color:#a6e22e">GITHUB</span><span style="color:#f92672">-</span><span style="color:#a6e22e">SSH</span><span style="color:#f92672">-</span><span style="color:#a6e22e">KEY</span></span></span></code></pre></div>
<p>Or you can just as well replace the <code>URL</code> value with <code>https://github.com/glfw/glfw.git</code> variant, but then in case of private repositories you&rsquo;ll need to set-up the credentials thing.</p>
<p>GitHub here is used as an example, and instead there of course can be any other service or just a <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Getting-Git-on-a-Server">bare Git repository</a> on your server. Speaking of which, I once again would like to recommend you to clone/mirror all your 3rd-party dependencies sources <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#source-code-repositories">to your servers</a>, so you don&rsquo;t rely on 3rd-party services outside of your IT infrastructure.</p>
<p>Another note about <code>vcpkg_from_git()</code> is that Microsoft&rsquo;s tutorial examples use different functions for fetching sources: <a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_from_github.md">vcpkg_from_github()</a> and <a href="https://github.com/Microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_from_gitlab.md">vcpkg_from_gitlab()</a>. But first of all, for me those failed (<em>even though I did provide required access tokens</em>); and secondly, what is the point of using these at all, if <code>vcpkg_from_git()</code> with SSH-key authentication is absolutely enough?</p>
<h5 id="vcpkg_cmake_configure">vcpkg_cmake_configure</h5>
<p>This function does the regular CMake project configuration. You need to:</p>
<ul>
<li>set path to <code>CMakeLists.txt</code> folder in the <code>SOURCE_PATH</code>. Usually it&rsquo;s the root level of the project sources, which conveniently is stored in the <code>${SOURCE_PATH}</code> variable (<em>looks a bit confusing, I know</em>);</li>
<li>provide <code>-D</code> options (<em>if any</em>). It is recommended to disable building samples/demos/tests and documentation-related stuff.</li>
</ul>
<p>If the project doesn&rsquo;t have a <code>CMakeLists.txt</code>, this command will naturally fail, just like as CMake itself would, so you&rsquo;ll need to create one yourself and <a href="#adding-files">add it</a> to the port.</p>
<h5 id="vcpkg_cmake_install">vcpkg_cmake_install</h5>
<p>This function builds and installs the configured project. It actually calls the <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_cmake_build.md">vcpkg_cmake_build()</a> function and sets <code>TARGET install</code>.</p>
<h5 id="vcpkg_cmake_config_fixup">vcpkg_cmake_config_fixup</h5>
<p>That one fixes potential problems with installed CMake targets, as some projects do some really weird shit with their CMake configs. For example, you can get the following error if you won&rsquo;t call this function after <code>vcpkg_cmake_install()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">Policy</span> <span style="color:#a6e22e">CMP0111</span> is not set<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">An</span> <span style="color:#66d9ef">imported</span> <span style="color:#66d9ef">target</span> <span style="color:#66d9ef">missing</span> <span style="color:#66d9ef">its</span> <span style="color:#66d9ef">location</span> <span style="color:#66d9ef">property</span> <span style="color:#66d9ef">fails</span> <span style="color:#66d9ef">during</span> <span style="color:#66d9ef">generation</span></span></span></code></pre></div>
<p>and many other different problems.</p>
<p>In order for <code>vcpkg_cmake_config_fixup()</code> function to work it needs to know where the project installs its CMake configs to. If those are installed into an unusual place (<em>they usually are</em>), then it will fail with an error like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">Building</span> some<span style="color:#f92672">-</span>library<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x86-windows...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/path/to/your/vcpkg-registry/ports/some-library</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Fetching</span> git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>come<span style="color:#66d9ef">:</span><span style="color:#66d9ef">retifrav/some-library.git</span> <span style="color:#66d9ef">cb96b1bd1af1e15eae2660097b4db2ddeaa94313...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Extracting</span> <span style="color:#66d9ef">source</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/downloads/some-library-cb96b1bd1af1e15eae2660097b4db2ddeaa94313.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>library<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>ddeaa94313<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>e7aebed2b<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CMake</span> <span style="color:#a6e22e">Error</span> at scripts<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span>vcpkg_cmake_config_fixup<span style="color:#f92672">.</span>cmake<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">81</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">message</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>library_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>share<span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>library<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>  does not exist<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>To fix that you need to go to <code>/path/to/programs/vcpkg/packages/some-library_x64-osx</code> and find where exactly this project installs its CMake files. For example, if they are in <code>cmake/SomeLibrary</code>, then your <code>vcpkg_cmake_config_fixup()</code> should have the following arguments:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># if the project name (SomeLibrary) is different from the port name (some-library)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># where project&#39;s CMake configs are installed by default
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;cmake/SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>And as you&rsquo;ve <a href="#portfilecmake">already seen</a>, for GLFW port it&rsquo;s these:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;glfw3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;lib/cmake/glfw3&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>If CMake configs are nowhere to find, then probably that library doesn&rsquo;t have a <a href="/blog/2021/03/08/cmake-cpp-library/#configs">proper installation</a> (<em>or mayby no <a href="/blog/2021/03/08/cmake-cpp-library/#install-instructions">installation</a> at all</em>), and then you&rsquo;ll need to <a href="#patches">patch</a> its <code>CMakeLists.txt</code>.</p>
<p>The <code>vcpkg_cmake_config_fixup()</code> function also organizes installed CMake configs and puts them into <code>share/PACKAGE-NAME</code> folder. Without doing this you can get the following warnings:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">The</span> following cmake files were found outside <span style="color:#f92672">/</span>share<span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>library<span style="color:#f92672">.</span> <span style="color:#a6e22e">Please</span> place cmake files in <span style="color:#f92672">/</span>share<span style="color:#f92672">/</span>some<span style="color:#f92672">-</span>library<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>debug<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>packages<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake</span></span></code></pre></div>
<p>What I haven&rsquo;t figured yet is how to handle the situation when the library and its vcpkg port have different names, for example the library target name (<em>and CMake config</em>) is <code>SomeLibrary</code> but the port name is <code>some-library</code>. In that case the contents of <code>share</code> folder will end up being like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>debug<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>library
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt</span></span></code></pre></div>
<p>I think this is not a correct structure, as it seems that the intention is to have one folder per port. It all works fine like this, but I&rsquo;m concerned that it might cause problems in future.</p>
<h3 id="versions">Versions</h3>
<h4 id="baselinejson">baseline.json</h4>
<p>The <code>baseline.json</code>, as I understood, lists default versions of all the packages that are available in that registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;dearimgui&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;1.88.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;glad&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;0.1.36&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;glfw&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;3.3.7&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;...&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Then if a project has no <a href="#locking-on-dependencies-versions">overrides</a>, these will be the versions vcpkg will get for it. And if a project lists a dependency with <code>version&gt;=</code> field, then in case it&rsquo;s lower than the baselined, vcpkg will skip all higher versions untill the baselined value; otherwise it will take the first versions that is equal or higher.</p>
<h4 id="versions-file">Versions file</h4>
<p>Individual <code>*.json</code> files establish which version of the port is available in which commit, for example here&rsquo;s <code>glfw.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;versions&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;git-tree&#34;</span>: <span style="color:#e6db74">&#34;597fa07e1afd57c50dfdbeb0c0d28f4157748564&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>To get the commit hash value (<em>for the <code>git-tree</code> property</em>) of the current version of the <code>glfw</code> port you need to run the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/your/vcpkg-registry
</span></span><span style="display:flex;"><span>$ git rev-parse HEAD:./ports/glfw
</span></span><span style="display:flex;"><span>597fa07e1afd57c50dfdbeb0c0d28f4157748564</span></span></code></pre></div>
<p>And it might not be obvious, but it means that whenever you make any changes to <code>glfw</code> port and commit them, you should not immediately push that commit to server. First you need to run <code>git rev-parse</code> to get the new hash value, set this value to <code>git-tree</code>, amend (<em><code>git commit --amend --no-edit</code></em>) your commit and only then push your commit to server. Here are <a href="#updating-a-port">some more details</a> about that.</p>
<h5 id="several-versions-of-a-port">Several versions of a port</h5>
<p>A port can have more than one version. To add another version you need to, with my <code>glfw</code> port as <a href="https://github.com/retifrav/vcpkg-registry/commit/bc0525884389177f8b42d756b036032fa6ffae8d">an example</a>:</p>
<ol>
<li>Set a new Git hash (<em>pointing to a different version tag</em>) in <code>./ports/glfw/portfile.cmake</code>;</li>
<li>Update the <code>version</code> value in <code>./ports/glfw/vcpkg.json</code>;</li>
<li>Commit and do the <code>git rev-parse</code> thing;</li>
<li>Add (<em>not replace</em>) a new version to <code>./versions/g-/glfw.json</code>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;versions&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;git-tree&#34;</span>: <span style="color:#e6db74">&#34;597fa07e1afd57c50dfdbeb0c0d28f4157748564&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.7&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;git-tree&#34;</span>: <span style="color:#e6db74">&#34;45af0346d2ec926146091ab374c475cac5aaf055&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></li>
</ol>
<p>So at first I had GLFW version <code>3.3.8</code> and now I added version <code>3.3.7</code>. So even though this commit is &ldquo;newer&rdquo;, and the versions order is &ldquo;wrong&rdquo;, it doesn&rsquo;t matter at all, as it&rsquo;s all just Git hashes pointing to certain &ldquo;states&rdquo; of the repository.</p>
<p>If you&rsquo;ll get this error trying to install a dependency in your project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>-- Running vcpkg install
</span></span><span style="display:flex;"><span>Fetching registry information from git@github.com:retifrav/vcpkg-registry.git <span style="color:#f92672">(</span>HEAD<span style="color:#f92672">)</span>...
</span></span><span style="display:flex;"><span>git archive failed with message:
</span></span><span style="display:flex;"><span>error: git failed with exit code: <span style="color:#f92672">(</span>128<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>fatal: not a tree object: cdeffa673205b611d8ced28468cce6a06f1fdffd</span></span></code></pre></div>
<p>then it could be because you didn&rsquo;t update the <code>git-tree</code> value in that dependency&rsquo;s version JSON in the registry, or perhaps the <code>baseline</code> value in your project&rsquo;s <code>vcpkg-configuration.json</code> points to a wrong commit.</p>
<h5 id="checking-versions-and-hashes">Checking versions and hashes</h5>
<p>It is quite easy to forget to update the <code>git-tree</code> value, so you might end up with a somewhat broken port, like it is shown in the previous section when it fails with an error. But there also might be a different situation: when <code>git-tree</code> points to an existing state of the registry, so there will be no error, but you won&rsquo;t be getting the actually latest ports state for that version either.</p>
<p>And the bigger your registry will get, the harder it will be to watch for potential mismatches, so you&rsquo;ll likely want to automate this somehow. For example, with a <a href="https://github.com/retifrav/vcpkg-registry/blob/master/scripts/check-versions-and-hashes.sh">shell script</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ ./scripts/check-versions-and-hashes.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                port |      version |                                          |
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>                curl |        8.1.2 | 308dc1fccea69d04003fef9103c9d7bd13d0bb32 | 308dc1fccea69d04003fef9103c9d7bd13d0bb32
</span></span><span style="display:flex; background-color:#3c3d38"><span>           dearimgui |       1.88.0 | fda742f0dd720fcd2af3cb8e946173069d70435f | a8838baa1c0125a8a2aaccc3889f8518ecfeac40
</span></span><span style="display:flex;"><span> decovar-vcpkg-cmake |   2022-10-15 | 5b70c3ba46b51c88044c335b8ad030f0edc609e5 | 5b70c3ba46b51c88044c335b8ad030f0edc609e5
</span></span><span style="display:flex;"><span>           e57format |        2.3.0 | e01f35b5353848abef4cb47e8ff9f25dbb05ad81 | e01f35b5353848abef4cb47e8ff9f25dbb05ad81
</span></span><span style="display:flex;"><span>                glad |       0.1.36 | 2341f5144ce8e76a256289517d61abb4ab9fb72c | 2341f5144ce8e76a256289517d61abb4ab9fb72c
</span></span><span style="display:flex; background-color:#3c3d38"><span>                glfw |        3.3.8 | 597fa07e1afd57c50dfdbeb0c0d28f4157748564 | ff428db2871ef4e409c2ea9f29a866b63ba5b90b
</span></span><span style="display:flex;"><span>                 icu |       72.1.0 | 330edeacb91afe9d9aa0007cbacc08f6a2b4a3f3 | 330edeacb91afe9d9aa0007cbacc08f6a2b4a3f3
</span></span><span style="display:flex;"><span>       json-nlohmann |       3.11.2 | 489dbd7358b610e1153e93accf36123a5afe3ce3 | 489dbd7358b610e1153e93accf36123a5afe3ce3
</span></span><span style="display:flex;"><span>                lyra |        1.6.1 | 0cb627c7ee8f8ec2769b41b41f82b335c50e984b | 0cb627c7ee8f8ec2769b41b41f82b335c50e984b
</span></span><span style="display:flex;"><span>                lzma |       22.1.0 | 04277d0cee83f6c4b8ce44f6756ed044b2691fbe | 04277d0cee83f6c4b8ce44f6756ed044b2691fbe
</span></span><span style="display:flex;"><span>              sqlite |       3.41.0 | 765037d4fa9cee6d6c7639006e546cf1ad8d675a | 765037d4fa9cee6d6c7639006e546cf1ad8d675a
</span></span><span style="display:flex;"><span>         vcpkg-cmake |   2022-08-18 | 84c200e8e625d4d99b1649525fcdf81a73197078 | 84c200e8e625d4d99b1649525fcdf81a73197078
</span></span><span style="display:flex;"><span>  vcpkg-cmake-config |   2022-02-06 | e23b39e21f0dd42ecc615262640d211c39696aa1 | e23b39e21f0dd42ecc615262640d211c39696aa1
</span></span><span style="display:flex;"><span>            xerces-c |        3.2.4 | ebfeb33e67607b103c583656109cbfeeb1406260 | ebfeb33e67607b103c583656109cbfeeb1406260
</span></span><span style="display:flex;"><span>                zlib |       1.2.12 | 7feb1b251066f9213881134c320cba2d853d1b45 | 7feb1b251066f9213881134c320cba2d853d1b45
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The following ports have a mismatch between their stated and actual Git hashes:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- dearimgui
</span></span><span style="display:flex;"><span>- glfw</span></span></code></pre></div>
<p>The hashes matching is highlighted with colors, here&rsquo;s a screenshot:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/check-versions-and-hashes.png" alt="vcpkg, check versions and hashes">

<p>Aside from the colors and summary in the end of the output, if there is at least one mismatch, the exit code is set to non-zero, so you can also use this script as a pre-commit <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_client_side_hooks">Git hook</a>.</p>
<p>At the moment the script has a flaw of expecting certain structure of versions file, in particular it will fail to get the <code>git-tree</code> property if it doesn&rsquo;t go right on the next line after the <code>version</code> property (<em>for example, it could be a <code>port-version</code> property there instead</em>).</p>
<h2 id="triplets">Triplets</h2>
<p>A <a href="https://github.com/microsoft/vcpkg/blob/master/docs/users/triplets.md">vcpkg triplet</a> is a file with a set of values that together &ldquo;identify&rdquo; the target platform: CPU architecture, type of linking and so on. One could probably say that it&rsquo;s like <a href="https://docs.conan.io/en/latest/reference/config_files/default_profile.html">Conan profiles</a>, but with fewer(?) parameters.</p>
<p>Default triplets are located here: <code>/path/to/programs/vcpkg/triplets/</code>. If you are not happy with the standard collection, you can add your own triplets as well, but don&rsquo;t edit the default ones, as it will certainly backfire at you at some point later.</p>
<p>I learned about triplets when I noticed that dependencies in one of my Windows projects were built as DLLs (<em><code>SHARED</code> libraries</em>), even though I did not set <code>-DBUILD_SHARED_LIBS=1</code>. And it turned out that on Windows by default vcpkg uses <code>x64-windows.cmake</code> triplet, which contents are:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">x64</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)</span></span></code></pre></div>
<p>Like I said, while you can set <code>static</code> value for the <code>VCPKG_LIBRARY_LINKAGE</code> here, I would definitely not recommend doing that. Instead, for this particular case, you can use another standard triplet - <code>x64-windows-static.cmake</code> - and that one will build your libraries as <code>STATIC</code>. To use that triplet instead of the default one, set <code>-DVCPKG_TARGET_TRIPLET=&quot;x64-windows-static&quot;</code>. And if there wasn&rsquo;t such triplet in the standard collection, then you could have just created one yourself.</p>
<h1 id="creating-your-own-ports">Creating your own ports</h1>
<p>A good portion of this topic is already covered in the section about <a href="#registry">vcpkg registry</a>, but there are some more things to tell about.</p>
<p>The Microsoft&rsquo;s registry already has a good collection of <del>packages</del> ports. If those are not enough, for instance if you&rsquo;d like to build some library differently or if your library of interest is simply missing from the registry, then you can always create your own port and store it in your registry or/and publish it to Microsoft&rsquo;s registry.</p>
<p>When making your own ports, you can use Microsoft&rsquo;s registry as a great source of configuration options, techniques and workarounds for various problems one might encounter. You can literally go from port to port and study the way people configure, build (<em>and patch</em>) sources, instead of trial-and-erroring that yourself for <del>hours</del> days.</p>
<h2 id="portfile">Portfile</h2>
<p>Creating a vcpkg port of a library in simple cases is just a matter of writing a <a href="#portfilecmake">portfile</a> for it and listing its <a href="#versions">version(s)</a>. But it&rsquo;s not often that you&rsquo;ll have such simple cases. Usually you&rsquo;ll need to add new files, patch sources or/and introduce features.</p>
<h3 id="adding-files">Adding files</h3>
<p>Many libraries don&rsquo;t have CMake support out of the box, so often you&rsquo;ll need to create and add <code>CMakeLists.txt</code> for them. To do that you just put it into the port folder and add the following command to the <code>portfile.cmake</code> somewhere before <code>vcpkg_cmake_configure()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex; background-color:#3c3d38"><span>file(<span style="color:#e6db74">COPY</span> <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/CMakeLists.txt&#34;</span> <span style="color:#e6db74">DESTINATION</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_configure(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">SOURCE_PATH</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>That&rsquo;s exactly how I did it for my <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/dearimgui">Dear ImGui port</a>.</p>
<p>Any other files can be added the same way.</p>
<h3 id="patches">Patches</h3>
<p>When you don&rsquo;t need to add new files but would like to change existing ones, you can apply a patch, which is done by simply adding <code>PATCHES</code> argument to <code>vcpkg_from_git()</code>. When I saw how easy this is, I almost couldn&rsquo;t believe it, especially given that with Conan I had to <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#project-files">handle this</a> myself (<em>back then I didn&rsquo;t know that Conan probably <a href="https://docs.conan.io/en/1.43/reference/conanfile/tools/files.html#conan-tools-files-patch">can do it</a> as well</em>).</p>
<p>For example, if we want to patch something in GLFW sources:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>vcpkg_from_git(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">OUT_SOURCE_PATH</span> <span style="color:#e6db74">SOURCE_PATH</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">URL</span> <span style="color:#e6db74">git@github.com:glfw/glfw.git</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">REF</span> <span style="color:#e6db74">45ce5ddd197d5c58f50fdd3296a5131c894e5527</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#e6db74">PATCHES</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">some.patch</span>    <span style="color:#75715e"># ${CMAKE_CURRENT_LIST_DIR}/some.patch
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"></span>        <span style="color:#e6db74">another.patch</span> <span style="color:#75715e"># ${CMAKE_CURRENT_LIST_DIR}/another.patch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)</span></span></code></pre></div>
<p>Important to note here that <code>some.patch</code> must be a <a href="https://git-scm.com/docs/git-diff">Git patch</a>, not a bare <code>diff</code> (<em>from <a href="https://www.gnu.org/software/diffutils/">GNU Diffutils</a></em>) output. To create such a patch, go to your local GLFW&rsquo;s repository (<em>checked out on that particular commit</em>), edit required files, stage your changes and then:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ git diff <span style="color:#f92672">--</span>cached <span style="color:#f92672">--</span>binary <span style="color:#f92672">&gt;</span> some<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span>$ mv <span style="color:#f92672">./</span>some<span style="color:#f92672">.</span>patch <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>your<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>ports<span style="color:#f92672">/</span>glfw<span style="color:#f92672">/</span></span></span></code></pre></div>
<h3 id="features">Features</h3>
<p>You can control the way a project is built via so-called &ldquo;features&rdquo;, which essentially are a simple mapping to CMake <code>-D</code> options.</p>
<p>This is done with <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_check_features.md">vcpkg_check_features()</a> function. For example, I have a port of Dear ImGui library and I added a feature to build it with GLFW support:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># mapping features array from vcpkg.json to a list of CMake options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># already prepended with -D and set to ON
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># and saving that list to FEATURE_OPTIONS variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_check_features(<span style="color:#e6db74">OUT_FEATURE_OPTIONS</span> <span style="color:#e6db74">FEATURE_OPTIONS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">FEATURES</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">backend-glfw</span> <span style="color:#e6db74">BACKEND_GLFW</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_configure(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">SOURCE_PATH</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">OPTIONS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># passing the list of options to CMake configure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">${</span>FEATURE_OPTIONS<span style="color:#f92672">}</span> <span style="color:#75715e"># it now contains -DBACKEND_GLFW=ON
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)</span></span></code></pre></div>
<p>This <code>BACKEND_GLFW</code> option is used in <a href="https://github.com/retifrav/vcpkg-registry/blob/master/ports/dearimgui/CMakeLists.txt#L56">CMakeLists.txt</a> to add GLFW-specific code to the Dear ImGui build.</p>
<p>For this mapping to work the port&rsquo;s <a href="https://github.com/retifrav/vcpkg-registry/blob/master/ports/dearimgui/vcpkg.json">vcpkg.json</a> contains optional <code>backend-glfw</code> feature (<em>along with dependency on <code>glfw</code> port</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;backend-glfw&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Using GLFW as graphics backend&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;glfw&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And so other projects can now depend on this port like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw-imgui-example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;backend-glfw&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="platform-specific-features">Platform-specific features</h4>
<p>It is possible to enable features only for certain platforms. I discovered that when my <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/xerces-c">Xerces-C++</a> port failed to build for iOS (<em>using triplet <code>arm64-ios</code></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">FAILED</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">src/CMakeFiles/xerces-c.dir/xercesc/util/PlatformUtils.cpp.o</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Applications</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Xcode</span><span style="color:#f92672">.</span>app<span style="color:#f92672">/</span><span style="color:#a6e22e">Contents</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Developer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Toolchains</span><span style="color:#f92672">/</span><span style="color:#a6e22e">XcodeDefault</span><span style="color:#f92672">.</span>xctoolchain<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>c<span style="color:#f92672">++</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DHAVE_CONFIG_H</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DXERCES_BUILDING_LIBRARY</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">D_FILE_OFFSET_BITS</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">64</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">D_THREAD_SAFE</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span>I<span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>dbg <span style="color:#f92672">-</span>I<span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src <span style="color:#f92672">-</span>I<span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>dbg<span style="color:#f92672">/</span>src <span style="color:#f92672">-</span>fPIC <span style="color:#f92672">-</span><span style="color:#a6e22e">Wall</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wcast</span><span style="color:#f92672">-</span>align <span style="color:#f92672">-</span><span style="color:#a6e22e">Wcast</span><span style="color:#f92672">-</span>qual <span style="color:#f92672">-</span><span style="color:#a6e22e">Wctor</span><span style="color:#f92672">-</span>dtor<span style="color:#f92672">-</span>privacy <span style="color:#f92672">-</span><span style="color:#a6e22e">Wextra</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wformat</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wimplicit</span><span style="color:#f92672">-</span>atomic<span style="color:#f92672">-</span>properties <span style="color:#f92672">-</span><span style="color:#a6e22e">Wmissing</span><span style="color:#f92672">-</span>declarations <span style="color:#f92672">-</span><span style="color:#a6e22e">Wno</span><span style="color:#f92672">-</span>long<span style="color:#f92672">-</span>long <span style="color:#f92672">-</span><span style="color:#a6e22e">Woverlength</span><span style="color:#f92672">-</span>strings <span style="color:#f92672">-</span><span style="color:#a6e22e">Woverloaded</span><span style="color:#f92672">-</span>virtual <span style="color:#f92672">-</span><span style="color:#a6e22e">Wredundant</span><span style="color:#f92672">-</span>decls <span style="color:#f92672">-</span><span style="color:#a6e22e">Wreorder</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Wswitch</span><span style="color:#f92672">-</span>default <span style="color:#f92672">-</span><span style="color:#a6e22e">Wunused</span><span style="color:#f92672">-</span>variable <span style="color:#f92672">-</span><span style="color:#a6e22e">Wwrite</span><span style="color:#f92672">-</span>strings <span style="color:#f92672">-</span><span style="color:#a6e22e">Wno</span><span style="color:#f92672">-</span>variadic<span style="color:#f92672">-</span>macros <span style="color:#f92672">-</span>fstrict<span style="color:#f92672">-</span>aliasing <span style="color:#f92672">-</span>g <span style="color:#f92672">-</span>arch arm64 <span style="color:#f92672">-</span>isysroot <span style="color:#f92672">/</span><span style="color:#a6e22e">Applications</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Xcode</span><span style="color:#f92672">.</span>app<span style="color:#f92672">/</span><span style="color:#a6e22e">Contents</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Developer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Platforms</span><span style="color:#f92672">/</span>iPhoneOS<span style="color:#f92672">.</span>platform<span style="color:#f92672">/</span><span style="color:#a6e22e">Developer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">SDKs</span><span style="color:#f92672">/</span>iPhoneOS15<span style="color:#f92672">.</span><span style="color:#ae81ff">5.</span>sdk <span style="color:#f92672">-</span>std<span style="color:#66d9ef">=</span>gnu<span style="color:#f92672">++</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">MD</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">MT</span> src<span style="color:#f92672">/</span><span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o <span style="color:#f92672">-</span><span style="color:#a6e22e">MF</span> src<span style="color:#f92672">/</span><span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#f92672">.</span>d <span style="color:#f92672">-</span>o src<span style="color:#f92672">/</span><span style="color:#a6e22e">CMakeFiles</span><span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">.</span>dir<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o <span style="color:#f92672">-</span>c         <span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">In</span> file included from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">82</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">In</span> file included from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">XMLNetAccessor</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">26</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">XMLURL</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">277</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">19</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">warning:</span> <span style="color:#66d9ef">cast</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">xercesc_3_2::XMLURL</span> <span style="color:#66d9ef">*</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">to</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">xercesc_3_2::XMLURL</span> <span style="color:#66d9ef">*</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">drops</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">qualifier</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">-Wcast-qual</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">((</span><span style="color:#a6e22e">XMLURL</span><span style="color:#f92672">*)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)-&gt;</span>buildFullText<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">In</span> file included from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">119</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">99</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">12</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TextEncoding</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">,</span>               <span style="color:#a6e22e">TextEncoding</span>                    textEncoding
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">116</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">CollatorRef</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">CollatorRef</span>     <span style="color:#66d9ef">fCollator</span><span style="color:#f92672">;</span>                                              <span style="color:#75715e">// Our collator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">130</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TextEncoding</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">TextEncoding</span> <span style="color:#66d9ef">discoverLCPEncoding</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">150</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TECObjectRef</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">TECObjectRef</span>                        <span style="color:#66d9ef">textToUnicode</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">151</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TECObjectRef</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">TECObjectRef</span>                        <span style="color:#66d9ef">unicodeToText</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">199</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TECObjectRef</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">TECObjectRef</span>        <span style="color:#66d9ef">mTextToUnicode</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">Transcoders</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">/</span><span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">.</span>hpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">200</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">unknown</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">name</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">TECObjectRef</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">TECObjectRef</span>        <span style="color:#66d9ef">mUnicodeToText</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>xerces<span style="color:#f92672">-</span>c<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>a3919277d9<span style="color:#f92672">-</span>dc0ef85571<span style="color:#f92672">.</span>clean<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>xercesc<span style="color:#f92672">/</span>util<span style="color:#f92672">/</span><span style="color:#a6e22e">PlatformUtils</span><span style="color:#f92672">.</span>cpp<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">485</span><span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">incompatible</span> <span style="color:#66d9ef">pointer</span> <span style="color:#66d9ef">type</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">assigning</span> <span style="color:#66d9ef">to</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">xercesc_3_2::XMLTransService</span> <span style="color:#66d9ef">*</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">xercesc_3_2::MacOSUnicodeConverter</span> <span style="color:#66d9ef">*</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">tc</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MacOSUnicodeConverter</span><span style="color:#f92672">(</span>fgMemoryManager<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#f92672">^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> warning and <span style="color:#ae81ff">8</span> errors generated<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>The problem here is that for building for iOS Xerces-C++ requires ICU dependency. Okay, let&rsquo;s add it to <code>dependencies</code> then, but since it is not needed when building on other platforms, better to do it through an optional feature:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;xerces-c&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;icu&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Enable ICU support&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;icu&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>But how to make this feature enabled only on iOS platform? As I understood it, one option would be to add a dependency on itself, for example like it is done in <a href="https://github.com/microsoft/vcpkg/blob/master/ports/ffmpeg/vcpkg.json">FFmpeg</a> port. But I decided to do it differently - in the manifest of a port (<em><a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/e57format">E57Format</a></em>) that depends on Xerces-C++:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;e57format&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;xerces-c&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;platform&#34;</span>: <span style="color:#e6db74">&#34;!ios&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;xerces-c&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;icu&#34;</span>
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;platform&#34;</span>: <span style="color:#e6db74">&#34;ios&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now iOS is the only target platform where <code>icu</code> feature will be enabled, and Xerces-C++ (<em>starting with version 3.2.4</em>) will be able to build with ICU dependency.</p>
<p>Admittedly, this looks crutchy, but I am yet to find a better way.</p>
<h4 id="feature-dependent-features">Feature-dependent features</h4>
<p>That is something I haven&rsquo;t figured out yet.</p>
<p>At some point we&rsquo;ve got into a situation where one of our projects required <a href="http://ijg.org">JPEG</a> dependency, but we also wanted to have an option to use <a href="https://libjpeg-turbo.org">jpeg-turbo</a> instead. So:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;some&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-features&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;use-jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-original&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use original JPEG library&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-turbo&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And in the project&rsquo;s <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>option(<span style="color:#e6db74">PREFER_JPEG_TURBO</span> <span style="color:#e6db74">&#34;Use jpeg-turbo instead of original JPEG&#34;</span> <span style="color:#e6db74">1</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">PREFER_JPEG_TURBO</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># if it fails to find it, perhaps implement a fallback to the original JPEG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    find_package(<span style="color:#e6db74">jpeg-turbo</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    target_link_libraries(<span style="color:#f92672">${</span>CMAKE_PROJECT_NAME<span style="color:#f92672">}</span> <span style="color:#e6db74">PRIVATE</span> <span style="color:#e6db74">jpeg-turbo::turbojpeg-static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>else()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    find_package(<span style="color:#e6db74">jpeg</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    target_link_libraries(<span style="color:#f92672">${</span>CMAKE_PROJECT_NAME<span style="color:#f92672">}</span> <span style="color:#e6db74">PRIVATE</span> <span style="color:#e6db74">jpeg</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>But that project also depends on <a href="https://pdfium.googlesource.com/pdfium">PDFium</a>, which in turn depends on JPEG/jpeg-turbo too, and in our PDFium port we resolve this the same way via vcpkg (<em>having disabled building those from vendored sources</em>). But the problem now is how to specify which JPEG library should PDFium port use (<em>meaning that it is controlled via PDFium port features</em>)?</p>
<p>I guess, it would be great if one could set dependencies between features within the same manifest, something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;some&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-features&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;use-jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-original&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use original JPEG library&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-turbo&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pdf&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Enable PDF capabilities&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;pdfium&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>                    [
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;if-feature-enabled&#34;</span>: <span style="color:#e6db74">&#34;use-jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;then&#34;</span>: <span style="color:#e6db74">&#34;with-jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;else&#34;</span>: <span style="color:#e6db74">&#34;with-jpeg-original&#34;</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    ]
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>But there is no such thing at the moment, and looking at this construction I doubt that it will ever be added. So for now I guess the only option would be to split <code>pdf</code> feature like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;some&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-features&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;use-jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;pdf-jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-original&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use original JPEG library&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;use-jpeg-turbo&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Use jpeg-turbo&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pdf-jpeg-original&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Enable PDF capabilities (using original JPEG)&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;pdfium&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>                    [
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;with-jpeg-original&#34;</span>
</span></span><span style="display:flex;"><span>                    ]
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pdf-jpeg-turbo&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Enable PDF capabilities (using jpeg-turbo)&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;pdfium&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>                    [
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;with-jpeg-turbo&#34;</span>
</span></span><span style="display:flex;"><span>                    ]
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Which of course means that one can mess-up features by seting for example <code>use-jpeg-turbo</code> and <code>pdf-jpeg-original</code> at the same time, which will collide on dependencies installation.</p>
<h2 id="cmake-helpers">CMake helpers</h2>
<p>As you saw in <a href="#portfilecmake">portfile.cmake</a>, one can use helper packages, which are not libraries for development but CMake modules for extending portfiles functionality. The <code>vcpkg-cmake</code> and <code>vcpkg-cmake-config</code> packages are examples of such helpers.</p>
<p>Naturally, you can <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/authoring-script-ports.md">create a helper</a> like this yourself. Here&rsquo;s a <a href="https://github.com/retifrav/vcpkg-registry/tree/6a1cbcac33a84fad0c577e7aad8b6921ac64162b/ports/decovar-vcpkg-cmake">one I made</a> (<em>this version was not entirely correct, so it got updated later</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">./</span>ports<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">Config</span><span style="color:#f92672">.</span>cmake<span style="color:#f92672">.</span>in
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">Installing</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> decovar_vcpkg_cmake_ololo<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> license<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> portfile<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>port<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>If the helper is supposed to provide CMake function(s) which could be used in portfiles, then it must contain <code>vcpkg-port-config.cmake</code> - these files get automatically imported/included by vcpkg. The contents of that file should be something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include(<span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/decovar_vcpkg_cmake_ololo.cmake&#34;</span>)</span></span></code></pre></div>
<p>The <code>decovar_vcpkg_cmake_ololo.cmake</code> in turn contains the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include_guard(<span style="color:#e6db74">GLOBAL</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>function(<span style="color:#e6db74">decovar_vcpkg_cmake_ololo</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">STATUS</span> <span style="color:#e6db74">&#34;ololo&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endfunction()</span></span></code></pre></div>
<p>So now any package that has <code>decovar-vcpkg-cmake</code> helper as a dependency will be able to call <code>decovar_vcpkg_cmake_ololo()</code> function in its portfile (<em>but not in its <code>CMakeLists.txt</code></em>).</p>
<p>Apart from this module my helper also contains <code>Installing.cmake</code> and <code>Config.cmake.in</code> - my common/shared installation instructions for CMake projects that are lacking those. In order to use them, I thought, a project needs to add the following to its <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e">#list(APPEND CMAKE_MODULE_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/share/decovar-vcpkg-cmake&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include(Installing)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include(<span style="color:#e6db74">&#34;${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/share/decovar-vcpkg-cmake/Installing.cmake&#34;</span>)</span></span></code></pre></div>
<p>But that turned out to be not a correct way of shipping and including common CMake modules. It might work like this, but as you see I am relying on <code>VCPKG_TARGET_TRIPLET</code> here, and so it will fail when host dependencies are installed using a different triplet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>The following packages will be built and installed:
</span></span><span style="display:flex;"><span>    jsoncpp<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-windows-static -&gt; 1.9.5
</span></span><span style="display:flex;"><span>    pdqsort<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-windows-static -&gt; 2021.3.14
</span></span><span style="display:flex;"><span>  * vcpkg-cmake<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-windows -&gt; 2022-08-18
</span></span><span style="display:flex;"><span>  * vcpkg-cmake-config<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-windows -&gt; 2022-02-06
</span></span><span style="display:flex;"><span>    zstd<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-windows-static -&gt; 1.5.2</span></span></code></pre></div>
<p>You see how everything but helpers is using <code>x64-windows-static</code> triplet, and helpers are using <code>x64-windows</code>? That will cause the <code>include()</code> statement to fail, because it will expect helper package to have a different path. To resolve this problem I thought that I could just set them both to the same value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#66d9ef">=</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_HOST_TRIPLET</span><span style="color:#66d9ef">=</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static</span></span></code></pre></div>
<p>And then it works. But! Forcing host and target triplets to match is absolutely not correct, you should certainly not do that. As I later discovered, there is a <a href="https://learn.microsoft.com/en-us/vcpkg/maintainers/variables#current_host_installed_dir">CURRENT_HOST_INSTALLED_DIR</a> variable that can be used in a portfile, and that made everything easier, as you&rsquo;ll soon see.</p>
<p>For now, here&rsquo;s the helper&rsquo;s <code>portfile.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">VCPKG_CROSSCOMPILING</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># should be FATAL_ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    message(<span style="color:#e6db74">WARNING</span> <span style="color:#e6db74">&#34;${PORT} is a host-only port, mark it as a host dependency in your ports&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>file(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">INSTALL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># to be used in other projects CMakeLists.txt project files
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/Installing.cmake&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># to be used in other projects CMakeLists.txt project files
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/Config.cmake.in&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># to be used in other projects portfiles
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/decovar_vcpkg_cmake_ololo.cmake&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># this one just includes decovar_vcpkg_cmake_ololo.cmake
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e"># and itself gets automatically included by vcpkg
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/vcpkg-port-config.cmake&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/${PORT}&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>file(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">INSTALL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/license.txt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/${PORT}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">RENAME</span> <span style="color:#e6db74">copyright</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_POLICY_CMAKE_HELPER_PORT</span> <span style="color:#e6db74">enabled</span>)</span></span></code></pre></div>
<p>The actual port that would be using this helper will be then able to copy the common files into its source directory using that <code>CURRENT_HOST_INSTALLED_DIR</code> variable, as it will always point to the host dependencies path:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>file(<span style="color:#e6db74">COPY</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CURRENT_HOST_INSTALLED_DIR}/share/decovar-vcpkg-cmake/Installing.cmake&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>file(<span style="color:#e6db74">COPY</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CURRENT_HOST_INSTALLED_DIR}/share/decovar-vcpkg-cmake/Config.cmake.in&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>And then in project&rsquo;s <code>CMakeLists.txt</code> it will be just this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include(<span style="color:#e6db74">&#34;${CMAKE_CURRENT_SOURCE_DIR}/Installing.cmake&#34;</span>)</span></span></code></pre></div>
<p>You can take a look at how <a href="https://github.com/retifrav/vcpkg-registry/tree/300646731e809c0a217cf3c133f856be82add3ad/ports/dearimgui">Dear ImGui port</a> does it.</p>
<h2 id="cmake-wrapper">CMake wrapper</h2>
<p>I couldn&rsquo;t find documentation about this functionality, but it&rsquo;s not very complex to figure out on your own. Basically, adding a CMake wrapper into your port allows you to &ldquo;inject&rdquo; CMake statements before or after <code>find_package()</code> call.</p>
<p>For example, let&rsquo;s take <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/xerces-c">Xerces-C++</a> port. It builds fine, but when you&rsquo;ll try to actually use it in some project on Mac OS (<em>using <code>x64-osx</code> or <code>arm64-osx</code> triplets</em>), then you will get the following linking errors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Undefined symbols <span style="color:#66d9ef">for</span> architecture arm64: 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_CFRelease&#34;</span>, referenced from:
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::upperCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::lowerCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_CFStringCreateMutableWithExternalCharactersNoCopy&#34;</span>, referenced from:
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::upperCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::lowerCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_CFStringLowercase&#34;</span>, referenced from:
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::lowerCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_CFStringUppercase&#34;</span>, referenced from:
</span></span><span style="display:flex;"><span>      xercesc_3_2::MacOSUnicodeConverter::upperCase<span style="color:#f92672">(</span>char16_t*<span style="color:#f92672">)</span> in libxerces-c.a<span style="color:#f92672">(</span>MacOSUnicodeConverter.cpp.o<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div>
<p>This is because on Mac OS your project also needs to link to CoreServices framework (<em>or rather Xerces-C++ requires that and so does your project</em>).</p>
<p>Of course, you could resolve this by adding the following to your project&rsquo;s <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">APPLE</span>) <span style="color:#75715e"># probably also check that it&#39;s exactly Mac OS, otherwise this also applies to iOS and others
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    target_link_libraries(<span style="color:#f92672">${</span>CMAKE_PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">PRIVATE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;-framework CoreServices&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>But then you would need to add that to all your projects that depend on Xerces-C++. And a better option would be to do it once in the <a href="https://github.com/retifrav/vcpkg-registry/blob/master/ports/xerces-c/vcpkg-cmake-wrapper.cmake">CMake wrapper</a> that comes from the port.</p>
<p>As I understand it, the way it works is that you add a file named <code>vcpkg-cmake-wrapper.cmake</code> to your port, and it will &ldquo;replace&rdquo; (<em>or actually wrap</em>) the <code>find_package()</code> call. Here&rsquo;s how it looks for Xerces-C++:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># do some stuff before the package will be attempted to be found
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># [stuff]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>_find_package(<span style="color:#f92672">${</span>ARGS<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># or after the package has been found
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># [stuff]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># for instance, add required linking to CoreServices on Mac OS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>if(<span style="color:#e6db74">APPLE</span>) <span style="color:#75715e"># probably also check that it&#39;s exactly Mac OS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    if(<span style="color:#e6db74">TARGET</span> <span style="color:#e6db74">XercesC::XercesC</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        set_target_properties(<span style="color:#e6db74">XercesC::XercesC</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">PROPERTIES</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">INTERFACE_LINK_LIBRARIES</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;-framework CoreServices&#34;</span>
</span></span><span style="display:flex;"><span>        )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        list(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">XercesC_LIBRARIES</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;-framework CoreServices&#34;</span>
</span></span><span style="display:flex;"><span>        )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>In this particular case it might be that linking to CoreServices could have been done in a better way, but it does work like this.</p>
<p>And then you install this wrapper into <code>${CURRENT_PACKAGES_DIR}/share/${PORT}</code> path. But be careful to check that port name and actual package name are the same. If they are different, then it is important that you install the wrapper exacty into the package folder and not into the port folder, otherwise it won&rsquo;t be used. For instance, in my registry Xerces-C++ port name is <code>xerces-c</code> and its package name is <code>XercesC</code>, and so here&rsquo;s how I install the wrapper:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>file(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">INSTALL</span> <span style="color:#e6db74">&#34;${CURRENT_PORT_DIR}/vcpkg-cmake-wrapper.cmake&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DESTINATION</span> <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/XercesC&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<h2 id="multiple-targetscomponents-in-one-project">Multiple targets/components in one project</h2>
<p>I should warn you first that the stuff described in this section is my own understanding of the listed scenarios and how one is supposed to solve them. My understanding might be wrong, and there might be better ways of dealing with this, so perhaps you shouldn&rsquo;t blindly follow these instructions.</p>
<h3 id="making-cmake-configs-discoverable">Making CMake configs discoverable</h3>
<p>Say, your project has several targets/components and the &ldquo;main&rdquo; target depends on some/all of them. For example, here&rsquo;s <code>Config.cmake.in</code> template for the main target <code>SomeLibrary</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">@PACKAGE_INIT</span><span style="color:#66d9ef">@</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>include<span style="color:#f92672">(</span><span style="color:#a6e22e">CMakeFindDependencyMacro</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>find_dependency<span style="color:#f92672">(</span><span style="color:#a6e22e">AnotherLibrary</span> <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>find_dependency<span style="color:#f92672">(</span><span style="color:#a6e22e">DifferentLibrary</span> <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>include<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${CMAKE_CURRENT_LIST_DIR}/@PROJECT_NAME@Targets.cmake&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>check_required_components<span style="color:#f92672">(</span><span style="color:#a6e22e">@PROJECT_NAME</span><span style="color:#f92672">@)</span></span></span></code></pre></div>
<p>So there are two internal targets which it depends on: <code>AnotherLibrary</code> and <code>DifferentLibrary</code>.</p>
<p>If you will make a port for this project as you normally would:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_install()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;cmake&#34;</span> <span style="color:#75715e"># we install CMake configs here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)</span></span></code></pre></div>
<p>&hellip;then projects that depend on this port will fail to configure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>CMake Error at /path/to/vcpkg/scripts/buildsystems/vcpkg.cmake:852 <span style="color:#f92672">(</span>_find_package<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  Could not find a package configuration file provided by <span style="color:#e6db74">&#34;AnotherLibrary&#34;</span> with
</span></span><span style="display:flex;"><span>  any of the following names:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    AnotherLibraryConfig.cmake
</span></span><span style="display:flex;"><span>    AnotherLibrary-config.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Add the installation prefix of <span style="color:#e6db74">&#34;AnotherLibrary&#34;</span> to CMAKE_PREFIX_PATH or set
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;AnotherLibrary_DIR&#34;</span> to a directory containing one of the above files.  If
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;AnotherLibrary&#34;</span> provides a separate development package or SDK, be sure it
</span></span><span style="display:flex;"><span>  has been installed.
</span></span><span style="display:flex;"><span>Call Stack <span style="color:#f92672">(</span>most recent call first<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  /path/to/cmake/share/cmake-3.25/Modules/CMakeFindDependencyMacro.cmake:47 <span style="color:#f92672">(</span>find_package<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  build/vcpkg_installed/x64-windows/share/SomeLibrary/SomeLibraryConfig.cmake:30 <span style="color:#f92672">(</span>find_dependency<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  /path/to/vcpkg/scripts/buildsystems/vcpkg.cmake:852 <span style="color:#f92672">(</span>_find_package<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  CMakeLists.txt:292 <span style="color:#f92672">(</span>find_package<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>&hellip;because <code>AnotherLibrary*.cmake</code> (<em>as well as <code>DifferentLibrary*.cmake</code> and all other targets/components of your <code>SomeLibrary</code> project</em>) configs are located inside <code>build/vcpkg_installed/x64-windows/share/SomeLibrary/</code> folder, while CMake is looking for them one level up - in <code>build/vcpkg_installed/x64-windows/share/COMPONENT-NAME-HERE/</code>.</p>
<p>I do not know what is the proper way of resolving this. I imagine, the installation procedure of <code>SomeLibrary</code> project might need to be different, or maybe the main port needs to be split into several ports (<em>one per component</em>), but I don&rsquo;t like either of these options, as they would require changing the project that installs just fine otherwise. So instead I&rsquo;ve come up with the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_install()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;cmake&#34;</span> <span style="color:#75715e"># we install CMake configs here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># internal components/dependencies CMake configs need to be available in ${CURRENT_PACKAGES_DIR}/share/COMPONENT-NAME-HERE,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># otherwise find_dependency() in consuming project will fail to find them. Until a better/proper way is found,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># they will be moved out to those paths &#34;manually&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># list of components
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>list(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">SomeLibraryComponents</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">AnotherLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">DifferentLibrary</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>foreach(<span style="color:#e6db74">SomeLibraryComponent</span> <span style="color:#f92672">${</span>SomeLibraryComponents<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">#message(STATUS &#34;Moving out ${SomeLibraryComponent}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># collect this component&#39;s CMake configs into a list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    file(<span style="color:#e6db74">GLOB</span> <span style="color:#e6db74">SomeLibraryComponentFiles</span> <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/SomeLibrary/${SomeLibraryComponent}*.cmake&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">#message(STATUS &#34;${SomeLibraryComponent} files: ${SomeLibraryComponentFiles}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># create a folder for its configs where vcpkg would expect them to be
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    file(<span style="color:#e6db74">MAKE_DIRECTORY</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/${SomeLibraryComponent}&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># and move them there
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    foreach(<span style="color:#e6db74">SomeLibraryComponentFile</span> <span style="color:#f92672">${</span>SomeLibraryComponentFiles<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#75715e">#message(STATUS &#34;file: ${SomeLibraryComponentFile}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        get_filename_component(<span style="color:#e6db74">SomeLibraryComponentFileName</span> <span style="color:#f92672">${</span>SomeLibraryComponentFile<span style="color:#f92672">}</span> <span style="color:#e6db74">NAME</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        file(<span style="color:#e6db74">RENAME</span> <span style="color:#f92672">${</span>SomeLibraryComponentFile<span style="color:#f92672">}</span> <span style="color:#e6db74">&#34;${CURRENT_PACKAGES_DIR}/share/${SomeLibraryComponent}/${SomeLibraryComponentFileName}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endforeach()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endforeach()</span></span></code></pre></div>
<p>So right after the usual CMake config fixup for the main target I iterate through the list of all other targets/components and move their configs one level up to their own folders. I know, this looks like a dirty hack, but it works.</p>
<h3 id="partial-components-installation">Partial components installation</h3>
<p>There is a different scenario. It could be that your project contains several targets/components, which can be built and installed without building the entire project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/some/project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>$ cmake -G Ninja -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>Release -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> ..
</span></span><span style="display:flex;"><span>$ cmake --build . --target SomeLibrary
</span></span><span style="display:flex;"><span>$ cmake --install ./libraries/SomeLibrary
</span></span><span style="display:flex;"><span><span style="color:#75715e"># or</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># $ cmake --install . --component SomeLibrary</span>
</span></span></code></pre></div><p>And then let&rsquo;s say one of your customers/users is asking you to make a vcpkg port only for this one library. He doesn&rsquo;t need your entire project (<em>at the very least because it takes too long to build the whole thing</em>), he only needs this one library. So what do you do?</p>
<p>I&rsquo;d say, ideally, it might be a good idea to move them out from your super repository into their own repositories and add them as dependencies to the main repository via vcpkg. But that is not always possible, and it wasn&rsquo;t possible in our case (<em>horrible legacy ways of including internal headers spread around and other stuff like that</em>), so let&rsquo;s see what else can be done here.</p>
<p>As far as I can tell, vcpkg doesn&rsquo;t not have an out-of-the-box functionality for this scenario. As I mentioned earlier, <a href="#vcpkg_cmake_install">vcpkg_cmake_install</a> simply calls the <a href="https://github.com/microsoft/vcpkg/blob/master/docs/maintainers/vcpkg_cmake_build.md">vcpkg_cmake_build()</a> function with <code>TARGET install</code> parameter, which means that you too can set any build target for <code>vcpkg_cmake_build()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># vcpkg_cmake_install() # we don&#39;t need the entire project
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># build only one of the libraries/components
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_build(<span style="color:#e6db74">TARGET</span> <span style="color:#e6db74">SomeLibrary</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>But there is no CMake helper to run the installation (<em>the <code>vcpkg_cmake_install()</code> function doesn&rsquo;t not have such a parameter</em>), so one just has to fallback to running a bare CMake CLI command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/SomeLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Debug</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-SomeLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/SomeLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Release</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-SomeLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;cmake&#34;</span> <span style="color:#75715e"># we install CMake configs here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Yes, you need to install both Debug and Release configurations (<em>and don&rsquo;t forget about <code>--config Debug/Release</code> to account for multi-config generators</em>). As you can see, that certainly doesn&rsquo;t look too nice, but it works. It is probably worth creating a CMake helper to wrap this into something nicer.</p>
<h4 id="internal-dependencies">Internal dependencies</h4>
<p>As a bonus complexity, some of our libraries/components in the main repository in turn depend on other internal libraries/components within that repository, and those need to be installed too. And the problem here is that the consuming project won&rsquo;t be able to discover that other library, because that library&rsquo;s CMake configs for <code>find_package()</code> will end up in the <code>SomeLibrary</code> folder. A resolution/workaround for that would be to add even more crutches, so the whole thing would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># the &#34;main&#34; library
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_build(<span style="color:#e6db74">TARGET</span> <span style="color:#e6db74">SomeLibrary</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/SomeLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Debug</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-SomeLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/SomeLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Release</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-SomeLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># its dependency - another internal library
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_build(<span style="color:#e6db74">TARGET</span> <span style="color:#e6db74">AnotherLibrary</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/AnotherLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Debug</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-AnotherLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-dbg</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">cmake</span> <span style="color:#e6db74">--install</span> <span style="color:#e6db74">./libraries/AnotherLibrary</span> <span style="color:#e6db74">--config</span> <span style="color:#e6db74">Release</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>CURRENT_BUILDTREES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">build-AnotherLibrary-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-rel</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># collect this other library CMake configs into a list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>file(<span style="color:#e6db74">GLOB</span> <span style="color:#e6db74">AnotherLibraryFiles</span> <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/cmake/AnotherLibrary*.cmake</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># create folders for its configs in proper paths, where vcpkg would expect them to be
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>file(<span style="color:#e6db74">MAKE_DIRECTORY</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/share/AnotherLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/debug/share/AnotherLibrary</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># move out every AnotherLibrary&#39;s CMake config from SomeLibrary folder
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># and copy them to both Debug and Release share folders
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>foreach(<span style="color:#e6db74">AnotherLibraryFile</span> <span style="color:#f92672">${</span>AnotherLibraryFiles<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    get_filename_component(<span style="color:#e6db74">AnotherLibraryFileName</span> <span style="color:#f92672">${</span>AnotherLibraryFile<span style="color:#f92672">}</span> <span style="color:#e6db74">NAME</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    file(<span style="color:#e6db74">RENAME</span> <span style="color:#f92672">${</span>AnotherLibraryFile<span style="color:#f92672">}</span> <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/share/AnotherLibrary/</span><span style="color:#f92672">${</span>AnotherLibraryFileName<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    file(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">COPY</span> <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/share/AnotherLibrary/</span><span style="color:#f92672">${</span>AnotherLibraryFileName<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">DESTINATION</span> <span style="color:#f92672">${</span>CURRENT_PACKAGES_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/debug/share/AnotherLibrary/</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endforeach()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># now fix the &#34;main&#34; library configs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CONFIG_PATH</span> <span style="color:#e6db74">&#34;cmake&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># and the other one&#39;s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vcpkg_cmake_config_fixup(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PACKAGE_NAME</span> <span style="color:#e6db74">&#34;AnotherLibrary&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>So now the portfile looks even worse, but it does work fine, so untill a better alternative comes up, that will be the way.</p>
<p>As I already mentioned, it would probably be better to make <code>AnotherLibrary</code> its own port, which <code>SomeLibrary</code> could depend on, but then they might eventually end up having different <code>REF</code> commit values, causing your users to fetch different snapshots of the same repository (<em>which would be the least of potential problems caused by this</em>).</p>
<h5 id="header-only-libraries">Header-only libraries</h5>
<p>In case of a header-only <code>INTERFACE</code> library there is nothing to build, so calling <code>vcpkg_cmake_build(...)</code> is redundant, and so is calling <code>vcpkg_execute_build_process()</code> for Debug configuration, and so there is a &ldquo;shorter&rdquo; way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># the &#34;main&#34; library</span>
</span></span><span style="display:flex;"><span>vcpkg_cmake_build<span style="color:#f92672">(</span>TARGET SomeLibrary<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    COMMAND cmake --install ./libraries/SomeLibrary --config Debug
</span></span><span style="display:flex;"><span>    WORKING_DIRECTORY <span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-dbg
</span></span><span style="display:flex;"><span>    LOGNAME build-SomeLibrary-<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    COMMAND cmake --install ./libraries/SomeLibrary --config Release
</span></span><span style="display:flex;"><span>    WORKING_DIRECTORY <span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-rel
</span></span><span style="display:flex;"><span>    LOGNAME build-SomeLibrary-<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_cmake_config_fixup<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    PACKAGE_NAME <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    CONFIG_PATH <span style="color:#e6db74">&#34;cmake&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># its header-only dependencies within the project</span>
</span></span><span style="display:flex;"><span>list<span style="color:#f92672">(</span>APPEND internalComponents
</span></span><span style="display:flex;"><span>    ThatsOneHeaderOnlyLibrary
</span></span><span style="display:flex;"><span>    ThatsAnotherHeaderOnlyLibrary
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>foreach<span style="color:#f92672">(</span>internalComponent <span style="color:#e6db74">${</span>internalComponents<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># these are header-only INTERFACE libraries, so there is nothing to build</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#vcpkg_cmake_build(TARGET internalComponent)</span>
</span></span><span style="display:flex;"><span>    vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        COMMAND cmake --install . --component <span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span> <span style="color:#75715e"># if it can be installed as component</span>
</span></span><span style="display:flex;"><span>        WORKING_DIRECTORY <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-rel&#34;</span>
</span></span><span style="display:flex;"><span>        LOGNAME <span style="color:#e6db74">&#34;build-</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-rel&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">(</span>GLOB internalComponentFiles <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/cmake/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">*.cmake&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">(</span>MAKE_DIRECTORY
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    foreach<span style="color:#f92672">(</span>internalComponentFile <span style="color:#e6db74">${</span>internalComponentFiles<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        get_filename_component<span style="color:#f92672">(</span>internalComponentFileName <span style="color:#e6db74">${</span>internalComponentFile<span style="color:#e6db74">}</span> NAME<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        file<span style="color:#f92672">(</span>RENAME <span style="color:#e6db74">${</span>internalComponentFile<span style="color:#e6db74">}</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>internalComponentFileName<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    endforeach<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    foreach<span style="color:#f92672">(</span>cmakeConfigSuffix <span style="color:#e6db74">&#34;Config&#34;</span> <span style="color:#e6db74">&#34;Targets&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e"># in case some of those don&#39;t have proper configs</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">(</span>cmakeConfig <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}${</span>cmakeConfigSuffix<span style="color:#e6db74">}</span><span style="color:#e6db74">.cmake&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>EXISTS <span style="color:#e6db74">${</span>cmakeConfig<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># basically, that replaces vcpkg_cmake_config_fixup(), which will actually fail to execute</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># in this case due to missing debug/share/${internalComponent}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># this is also the first time I ever used this &#34;bracket argument&#34; thing: [=[ ... ]=]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># and turns out it is very convenient for such cases with lots of quotes and special symbols</span>
</span></span><span style="display:flex;"><span>            vcpkg_replace_string<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>cmakeConfig<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">[=[</span>get_filename_component<span style="color:#f92672">(</span>_IMPORT_PREFIX <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CMAKE_CURRENT_LIST_FILE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> PATH<span style="color:#f92672">)]=]</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">[=[</span>get_filename_component<span style="color:#f92672">(</span>_IMPORT_PREFIX <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CMAKE_CURRENT_LIST_FILE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> PATH<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>cmake_path<span style="color:#f92672">(</span>GET _IMPORT_PREFIX PARENT_PATH _IMPORT_PREFIX<span style="color:#f92672">)]=]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        endif<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    endforeach<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>endforeach<span style="color:#f92672">()</span>
</span></span></code></pre></div><p>So here we don&rsquo;t build those header-only internal dependencies, as there is nothing to build, and we install only <code>-rel</code>, as <code>-dbg</code> would redundantly install the same things.</p>
<p>If you don&rsquo;t do that <code>vcpkg_replace_string()</code> fixup of paths, then trying to use this port in a project will result in the following error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">Imported</span> target <span style="color:#e6db74">&#34;ThatsOneHeaderOnlyLibrary&#34;</span> includes non<span style="color:#f92672">-</span>existent path
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg_installed<span style="color:#f92672">/</span>x64<span style="color:#f92672">-</span>linux<span style="color:#f92672">/</span>share<span style="color:#f92672">/</span>include<span style="color:#f92672">/</span><span style="color:#a6e22e">ThatsOneHeaderOnlyLibrary</span>
</span></span><span style="display:flex;"><span>in its <span style="color:#a6e22e">INTERFACE_INCLUDE_DIRECTORIES</span>
</span></span></code></pre></div><p>Now, while this &ldquo;shorter&rdquo; way works, it actually isn&rsquo;t that short, and also this self-made paths fixup doesn&rsquo;t look all that reliable, so it&rsquo;s probably better to do this the usual &ldquo;longer&rdquo; way and with using <code>vcpkg_cmake_config_fixup()</code> instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># the &#34;main&#34; library</span>
</span></span><span style="display:flex;"><span>vcpkg_cmake_build<span style="color:#f92672">(</span>TARGET SomeLibrary<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    COMMAND cmake --install ./libraries/SomeLibrary --config Debug
</span></span><span style="display:flex;"><span>    WORKING_DIRECTORY <span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-dbg
</span></span><span style="display:flex;"><span>    LOGNAME build-SomeLibrary-<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    COMMAND cmake --install ./libraries/SomeLibrary --config Release
</span></span><span style="display:flex;"><span>    WORKING_DIRECTORY <span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-rel
</span></span><span style="display:flex;"><span>    LOGNAME build-SomeLibrary-<span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span>-rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>vcpkg_cmake_config_fixup<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    PACKAGE_NAME <span style="color:#e6db74">&#34;SomeLibrary&#34;</span>
</span></span><span style="display:flex;"><span>    CONFIG_PATH <span style="color:#e6db74">&#34;cmake&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># its header-only dependencies within the project</span>
</span></span><span style="display:flex;"><span>list<span style="color:#f92672">(</span>APPEND internalComponents
</span></span><span style="display:flex;"><span>    ThatsOneHeaderOnlyLibrary
</span></span><span style="display:flex;"><span>    ThatsAnotherHeaderOnlyLibrary
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>foreach<span style="color:#f92672">(</span>internalComponent <span style="color:#e6db74">${</span>internalComponents<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># these are header-only INTERFACE libraries, so there is nothing to build</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#vcpkg_cmake_build(TARGET internalComponent)</span>
</span></span><span style="display:flex;"><span>    vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        COMMAND cmake --install . --component <span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span> <span style="color:#75715e"># if it can be installed as component</span>
</span></span><span style="display:flex;"><span>        WORKING_DIRECTORY <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-rel&#34;</span>
</span></span><span style="display:flex;"><span>        LOGNAME <span style="color:#e6db74">&#34;build-</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-rel&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># even though installing Debug configuration is redundant here,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># without it you won&#39;t be able to use vcpkg_cmake_config_fixup()</span>
</span></span><span style="display:flex;"><span>    vcpkg_execute_build_process<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        COMMAND cmake --install . --component <span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span> <span style="color:#75715e"># if it can be installed as component</span>
</span></span><span style="display:flex;"><span>        WORKING_DIRECTORY <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_BUILDTREES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-dbg&#34;</span>
</span></span><span style="display:flex;"><span>        LOGNAME <span style="color:#e6db74">&#34;build-</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>TARGET_TRIPLET<span style="color:#e6db74">}</span><span style="color:#e6db74">-dbg&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">(</span>GLOB internalComponentFiles <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/cmake/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">*.cmake&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">(</span>MAKE_DIRECTORY
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/debug/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    foreach<span style="color:#f92672">(</span>internalComponentFile <span style="color:#e6db74">${</span>internalComponentFiles<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        get_filename_component<span style="color:#f92672">(</span>internalComponentFileName <span style="color:#e6db74">${</span>internalComponentFile<span style="color:#e6db74">}</span> NAME<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        file<span style="color:#f92672">(</span>RENAME <span style="color:#e6db74">${</span>internalComponentFile<span style="color:#e6db74">}</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/share/</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>internalComponentFileName<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        file<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            COPY <span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span>/share/<span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>internalComponentFileName<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>            DESTINATION <span style="color:#e6db74">${</span>CURRENT_PACKAGES_DIR<span style="color:#e6db74">}</span>/debug/share/<span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span>/
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    endforeach<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># that will adjust the paths for INTERFACE_INCLUDE_DIRECTORIES</span>
</span></span><span style="display:flex;"><span>    vcpkg_cmake_config_fixup<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        PACKAGE_NAME <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>internalComponent<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>endforeach<span style="color:#f92672">()</span>
</span></span></code></pre></div><p>So basically we came back to all the same steps as with &ldquo;regular&rdquo; <a href="#internal-dependencies">internal dependencies</a> with the only difference that for header-only libraries you don&rsquo;t execute <code>vcpkg_cmake_build()</code>.</p>
<h4 id="sparse-checkout">Sparse checkout</h4>
<p>While we are here, when you only need to build just some targets of your big project, it might be an overkill to make your users download your entire repository, especially if it&rsquo;s rather big (<em>even as a snapshot</em>).</p>
<p>Partial repository cloning can be done with <a href="https://git-scm.com/docs/git-sparse-checkout">sparse checkout</a>. For example, if I only want to get the <code>SomeLibrary</code> component/target from one of my projects:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ git clone <span style="color:#f92672">--</span>depth <span style="color:#ae81ff">1</span> <span style="color:#f92672">--</span>filter<span style="color:#66d9ef">=</span>blob<span style="color:#66d9ef">:</span><span style="color:#66d9ef">none</span> <span style="color:#66d9ef">--sparse</span> <span style="color:#66d9ef">git@github.com:retifrav/cmake-library-example.git</span>
</span></span><span style="display:flex;"><span>$ cd <span style="color:#f92672">./</span>cmake<span style="color:#f92672">-</span>library<span style="color:#f92672">-</span>example
</span></span><span style="display:flex;"><span>$ git sparse<span style="color:#f92672">-</span>checkout set <span style="color:#f92672">--</span>no<span style="color:#f92672">-</span>cone internal<span style="color:#f92672">-</span>project<span style="color:#f92672">/</span>libraries<span style="color:#f92672">/</span><span style="color:#a6e22e">SomeLibrary</span></span></span></code></pre></div>
<p>But default vcpkg CMake functions such as <a href="https://github.com/microsoft/vcpkg/blob/master/scripts/cmake/vcpkg_from_git.cmake">vcpkg_from_git</a> unfortunately do not have an option for sparse cloning and checkout, so I&rsquo;ll probably implement my own custom function/helper for that (<em>or at least register a feature request for it</em>).</p>
<h2 id="updating-a-port">Updating a port</h2>
<p>Not once and not twice you&rsquo;ll need to change something in your existing port, especially when you are working on the very first version of it.</p>
<p>As a concrete example, I forgot to add <code>include_guard(GLOBAL)</code> in my <code>ports/decovar-vcpkg-cmake</code> helper package. Here&rsquo;s what I needed to do in order to fix that:</p>
<ol>
<li>Edit <code>./ports/decovar-vcpkg-cmake/vcpkg-port-config.cmake</code> and commit this change, but not push yet;</li>
<li>Run <code>git rev-parse HEAD:./ports/decovar-vcpkg-cmake</code> and set the new value to <code>git-tree</code> in <code>./versions/d-/decovar-vcpkg-cmake.json</code>;</li>
<li>Stage that change and amend the commit from the step 1 by running <code>git commit --amend --no-edit</code>;</li>
<li>Push.</li>
</ol>
<p>You can inspect <a href="https://github.com/retifrav/vcpkg-registry/commit/3332ca16e36cf806256e963bfbe9ab2fef7460e0">that commit</a> in my example registry. As you can see, it&rsquo;s almost the same steps as with <a href="#several-versions-of-a-port">adding a new version</a> of a port, except that here the version stays the same.</p>
<p>Also don&rsquo;t forget to update Git hash value (<em>current <code>HEAD</code> of the entire registry repository, not just this dependency</em>) for <code>baseline</code> property in <a href="https://github.com/retifrav/glfw-imgui-example/blob/master/vcpkg-configuration.json#L6">vcpkg-configuration.json</a> of the &ldquo;consuming&rdquo; project, otherwise it will not &ldquo;know&rdquo; about the updated version in the registry. Moreover, if you force-pushed that fix, then vcpkg will simply fail to resolve dependencies, as that commit would no longer exist.</p>
<p>But actually that last bit about changing <code>baseline</code> property in the project&rsquo;s <code>vcpkg-configuration.json</code> when updating the same version of a port in the registry (<em>when the same port v1.2.3 has different configuration/patches/etc in different registry commits/states</em>) is something I am not very confident about, because I am not really sure how exactly the <code>baseline</code> value is used for resolving the port version/state:</p>
<ol>
<li>Does vcpkg look for a version with <code>git-tree</code> value that was available no later than that commit?</li>
<li>Or does vcpkg use that commit hash value only for getting <code>versions/baseline.json</code> from that exact commit (<em>to establish a minimum port version</em>), and then it will still find the latest version&rsquo;s <code>git-tree</code> value that might be pointing to a later repository state and take that one? So one cannot rely on <code>baseline</code> property to &ldquo;prevent&rdquo; vcpkg from getting updated port versions available in the registry?</li>
</ol>
<p>I was hoping it&rsquo;s the former, but looks like it&rsquo;s actually the latter. In that case I now better understand the point of <a href="https://learn.microsoft.com/en-us/vcpkg/users/versioning#port-version">port-version</a>.</p>
<h1 id="installing-ports-from-a-registry">Installing ports from a registry</h1>
<h2 id="without-a-project">Without a project</h2>
<p>You can try to install the <a href="#port-structure">GLFW port</a> even without having a project that would depend on it. It is a convenient ability to have when you want to quickly test your new port:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/your/vcpkg-registry
</span></span><span style="display:flex;"><span>$ vcpkg install glfw --overlay-ports<span style="color:#f92672">=</span>./ports/glfw
</span></span><span style="display:flex;"><span>Computing installation plan...
</span></span><span style="display:flex;"><span>The following packages will be built and installed:
</span></span><span style="display:flex;"><span>    glfw<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 3.3.8 -- /path/to/your/vcpkg-registry/./ports/glfw
</span></span><span style="display:flex;"><span>  * vcpkg-cmake<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 2022-08-18
</span></span><span style="display:flex;"><span>  * vcpkg-cmake-config<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 2022-02-06#1
</span></span><span style="display:flex;"><span>Additional packages <span style="color:#f92672">(</span>*<span style="color:#f92672">)</span> will be modified to complete this operation.
</span></span><span style="display:flex;"><span>Detecting compiler hash <span style="color:#66d9ef">for</span> triplet x64-osx...
</span></span><span style="display:flex;"><span>Restored <span style="color:#ae81ff">1</span> package<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from /Users/USERNAME/.cache/vcpkg/archives in 23.44 ms. Use --debug to see more details.
</span></span><span style="display:flex;"><span>Installing 1/3 vcpkg-cmake:x64-osx...
</span></span><span style="display:flex;"><span>Elapsed time to handle vcpkg-cmake:x64-osx: 7.694 ms
</span></span><span style="display:flex;"><span>Installing 2/3 vcpkg-cmake-config:x64-osx...
</span></span><span style="display:flex;"><span>Building vcpkg-cmake-config<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx...
</span></span><span style="display:flex;"><span>-- Installing: /path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/vcpkg_cmake_config_fixup.cmake
</span></span><span style="display:flex;"><span>-- Installing: /path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/vcpkg-port-config.cmake
</span></span><span style="display:flex;"><span>-- Installing: /path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/copyright
</span></span><span style="display:flex;"><span>-- Performing post-build validation
</span></span><span style="display:flex;"><span>-- Performing post-build validation <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>Stored binary cache: <span style="color:#e6db74">&#34;/Users/USERNAME/.cache/vcpkg/archives/32/32dd70a7ba46fe85a359ed1b3a9b0c98772888eb59daefe61cb52f6560338044.zip&#34;</span>
</span></span><span style="display:flex;"><span>Elapsed time to handle vcpkg-cmake-config:x64-osx: 58.43 ms
</span></span><span style="display:flex;"><span>Installing 3/3 glfw:x64-osx...
</span></span><span style="display:flex;"><span>Building glfw<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx...
</span></span><span style="display:flex;"><span>-- Installing port from location: /path/to/your/vcpkg-registry/./ports/glfw
</span></span><span style="display:flex;"><span>-- Using cached /path/to/programs/vcpkg/downloads/glfw-7482de6071d21db77a7236155da44c172a7f6c9e.tar.gz
</span></span><span style="display:flex;"><span>-- Cleaning sources at /path/to/programs/vcpkg/buildtrees/glfw/src/172a7f6c9e-d7a30c254e.clean. Use --editable to skip cleaning <span style="color:#66d9ef">for</span> the packages you specify.
</span></span><span style="display:flex;"><span>-- Extracting source /path/to/programs/vcpkg/downloads/glfw-7482de6071d21db77a7236155da44c172a7f6c9e.tar.gz
</span></span><span style="display:flex;"><span>-- Using source at /path/to/programs/vcpkg/buildtrees/glfw/src/172a7f6c9e-d7a30c254e.clean
</span></span><span style="display:flex;"><span>-- Found external ninja<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;1.11.1&#39;</span><span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>-- Configuring x64-osx
</span></span><span style="display:flex;"><span>-- Building x64-osx-dbg
</span></span><span style="display:flex;"><span>-- Building x64-osx-rel
</span></span><span style="display:flex;"><span>-- Installing: /path/to/programs/vcpkg/packages/glfw_x64-osx/share/glfw/copyright
</span></span><span style="display:flex;"><span>-- Performing post-build validation
</span></span><span style="display:flex;"><span>-- Performing post-build validation <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>Stored binary cache: <span style="color:#e6db74">&#34;/Users/USERNAME/.cache/vcpkg/archives/c0/c05ed39487e7538dcd2436b1cc00ac256091ec6df15f9dbdd6c71c0f884da654.zip&#34;</span>
</span></span><span style="display:flex;"><span>Elapsed time to handle glfw:x64-osx: 5.9 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total elapsed time: 14.15 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glfw provides CMake targets:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># this is heuristically generated, and may not be correct</span>
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glfw3 CONFIG REQUIRED<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main PRIVATE glfw<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>Here&rsquo;s what it did:</p>
<ol>
<li>Fetched and installed host dependencies (<em><code>vcpkg-cmake</code> and <code>vcpkg-cmake-config</code></em>);</li>
<li>Fetched, configured, built and installed GLFW, both Debug and Release configurations (<em>there will be a note about <code>debug</code> subfolder <a href="#in-a-project">later</a></em>);</li>
<li>Saved the sources and build artifacts in local cache, so they could be restored for later re-use instead of fetching and building them again;</li>
<li>Tried to discover/guess CMake statements for using these packages in your project (<em><code>find_package()</code> and <code>target_link_libraries()</code> commands</em>). In most cases it does that correctly.</li>
</ol>
<p>The resulting binaries are placed here:</p>
<ul>
<li><code>/path/to/programs/vcpkg/packages/glfw_x64-osx</code></li>
<li><code>/path/to/programs/vcpkg/installed/x64-osx</code></li>
<li><code>/Users/USERNAME/.cache/vcpkg/archives/c0/c05ed39487e7538dcd2436b1cc00ac256091ec6df15f9dbdd6c71c0f884da654.zip</code> (<em>that&rsquo;s the cached pre-built package</em>)</li>
</ul>
<p>Note that it installed the artifacts not in the <code>/path/to/your/vcpkg-registry</code>, but to where vcpkg is installed in your system. Later when we&rsquo;ll be resolving dependencies <a href="#in-a-project">for a project</a>, the artifacts will be installed to its build folder.</p>
<p>If we now delete the pre-built artifacts from vcpkg folder (<em>but not from cache</em>) and try to install the package again, this operation will run much faster:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ rm -r /path/to/programs/vcpkg/packages/glfw_x64-osx
</span></span><span style="display:flex;"><span>$ rm -r /path/to/programs/vcpkg/installed/*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vcpkg install glfw --overlay-ports<span style="color:#f92672">=</span>./ports/glfw
</span></span><span style="display:flex;"><span>Computing installation plan...
</span></span><span style="display:flex;"><span>The following packages will be built and installed:
</span></span><span style="display:flex;"><span>    glfw<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 3.3.8 -- /Users/USERNAME/code/cpp/vcpkg-registry/./ports/glfw
</span></span><span style="display:flex;"><span>  * vcpkg-cmake<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 2022-08-18
</span></span><span style="display:flex;"><span>  * vcpkg-cmake-config<span style="color:#f92672">[</span>core<span style="color:#f92672">]</span>:x64-osx -&gt; 2022-02-06#1
</span></span><span style="display:flex;"><span>Additional packages <span style="color:#f92672">(</span>*<span style="color:#f92672">)</span> will be modified to complete this operation.
</span></span><span style="display:flex;"><span>Detecting compiler hash <span style="color:#66d9ef">for</span> triplet x64-osx...
</span></span><span style="display:flex;"><span>Restored <span style="color:#ae81ff">3</span> package<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from /Users/USERNAME/.cache/vcpkg/archives in 24.94 ms. Use --debug to see more details.
</span></span><span style="display:flex;"><span>Installing 1/3 vcpkg-cmake:x64-osx...
</span></span><span style="display:flex;"><span>Elapsed time to handle vcpkg-cmake:x64-osx: 3.579 ms
</span></span><span style="display:flex;"><span>Installing 2/3 vcpkg-cmake-config:x64-osx...
</span></span><span style="display:flex;"><span>Elapsed time to handle vcpkg-cmake-config:x64-osx: 2.45 ms
</span></span><span style="display:flex;"><span>Installing 3/3 glfw:x64-osx...
</span></span><span style="display:flex;"><span>Elapsed time to handle glfw:x64-osx: 6.662 ms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total elapsed time: 2.254 s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glfw provides CMake targets:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># this is heuristically generated, and may not be correct</span>
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glfw3 CONFIG REQUIRED<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main PRIVATE glfw<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>As you can see, this time it just restored pre-built artifacts that were already available in cache.</p>
<h3 id="dummy-installation">Dummy installation</h3>
<p>This still doesn&rsquo;t count as a <a href="#in-a-project">proper project</a>, because there is no CMake project file or anything at all really, but also this is not exactly the same as installing from within a registry using <code>--overlay-ports</code>. This option might be convenient when you want to quickly test not one, not all, but a selected set of ports.</p>
<p>Create an empty <code>dummy</code> folder and put there <code>vcpkg-configuration.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-registry&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;kind&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repository&#34;</span>: <span style="color:#e6db74">&#34;git@github.com:retifrav/vcpkg-registry.git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;4b4ae3fea063fc04c2d5a6089c8aa7c2d0129879&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;registries&#34;</span>: []
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>and <code>vcpkg.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;some&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glad&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glfw&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Here it will go with default versions and features, but you can of course specify anything you&rsquo;d need just like you would do it in an actual project.</p>
<p>And now you can install these ports:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>dummy
</span></span><span style="display:flex;"><span>$ tree <span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>configuration<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet<span style="color:#66d9ef">=</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static <span style="color:#f92672">--</span>host<span style="color:#f92672">-</span>triplet<span style="color:#66d9ef">=</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static</span></span></code></pre></div>
<p>Overriding triplets is here just as an example, especially that you probably will never need to override <code>--host-triplet</code>.</p>
<p>Furthermore, you can now refer to installed libraries from a non-vcpkg project just like you would with any other pre-built dependency:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/dummy/vcpkg_installed/x64-windows-static&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<h2 id="in-a-project">In a project</h2>
<p>I&rsquo;ll use my <a href="https://github.com/retifrav/glfw-imgui-example">GLFW Dear ImGui application</a> created in <a href="https://decovar.dev/blog/2019/08/04/glfw-dear-imgui/">this article</a> as an example. It already has an option of resolving dependencies <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#resolving-dependencies-in-a-project">with Conan</a>, and now I&rsquo;ll add an option of resolving the same dependencies with vcpkg.</p>
<p>Dependencies are listed in the project&rsquo;s <a href="https://github.com/retifrav/glfw-imgui-example/blob/master/vcpkg.json">vcpkg.json</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw-imgui-example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glad&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;backend-glfw&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>The <code>glfw</code> dependency is not really needed here, because it will still be added through <code>dearimgui</code>, as we are saying here that we want it with <code>backend-glfw</code> <a href="#features">feature</a>, and that one adds <code>glfw</code> dependency. But it wouldn&rsquo;t hurt to set it explicitly, as the project does depend on it regardless of Dear ImGui.</p>
<p>To tell vcpkg, which registry I want to use, I&rsquo;ve set the following in the <a href="https://github.com/retifrav/glfw-imgui-example/blob/master/vcpkg-configuration.json">vcpkg-configuration.json</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-registry&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;kind&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repository&#34;</span>: <span style="color:#e6db74">&#34;git@github.com:retifrav/vcpkg-registry.git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;5c1a089c3a542dfbe818625bf4a3dadfb834e2af&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;registries&#34;</span>: []
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Now we should be able to get all the dependencies with vcpkg and configure the project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>glfw<span style="color:#f92672">-</span>imgui<span style="color:#f92672">-</span>example
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DUSING_PACKAGE_MANAGER_VCPKG</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Running</span> vcpkg install
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Fetching</span> registry information from git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">retifrav/vcpkg-registry.git</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">HEAD</span><span style="color:#f92672">)</span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Detecting</span> <span style="color:#66d9ef">compiler</span> <span style="color:#66d9ef">hash</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">triplet</span> <span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">The</span> <span style="color:#66d9ef">following</span> <span style="color:#66d9ef">packages</span> <span style="color:#66d9ef">will</span> <span style="color:#66d9ef">be</span> <span style="color:#66d9ef">built</span> <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">installed:</span>
</span></span><span style="display:flex;"><span>    dearimgui<span style="color:#f92672">[</span><span style="color:#66d9ef">backend-glfw</span>,<span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">88</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/c3282e78368406b65f57ef0e3afa7cda2fc26501</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> decovar<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">10</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">15</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">ceb1e31d28a155bcbeb26382478b024a3d82cd3</span>
</span></span><span style="display:flex;"><span>    glad<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">36</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">2341</span><span style="color:#66d9ef">f5144ce8e76a256289517d61abb4ab9fb72c</span>
</span></span><span style="display:flex;"><span>    glfw<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">8</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">597</span><span style="color:#66d9ef">fa07e1afd57c50dfdbeb0c0d28f4157748564</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">08</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">18</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">84</span><span style="color:#66d9ef">c200e8e625d4d99b1649525fcdf81a73197078</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">02</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">06</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/e23b39e21f0dd42ecc615262640d211c39696aa1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Additional</span> packages <span style="color:#f92672">(*)</span> will be modified to complete <span style="color:#66d9ef">this</span> operation<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Restored</span> <span style="color:#ae81ff">0</span> package<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/.</span>cache<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>archives in <span style="color:#ae81ff">33.41</span> us<span style="color:#f92672">.</span> <span style="color:#a6e22e">Use</span> <span style="color:#f92672">--</span>debug to see more details<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">vcpkg-cmake-config</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/e23b39e21f0dd42ecc615262640d211c39696aa1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/vcpkg_cmake_config_fixup.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/vcpkg-port-config.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake-config_x64-osx/share/vcpkg-cmake-config/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">e/</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">ede033072a78c3aa60ffe343b1248c10ad943b52e64658f524bac40637f500b.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">vcpkg-cmake-config:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">53</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">77</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">vcpkg-cmake</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">84</span><span style="color:#66d9ef">c200e8e625d4d99b1649525fcdf81a73197078</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake_x64-osx/share/vcpkg-cmake/vcpkg_cmake_configure.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake_x64-osx/share/vcpkg-cmake/vcpkg_cmake_build.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake_x64-osx/share/vcpkg-cmake/vcpkg_cmake_install.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake_x64-osx/share/vcpkg-cmake/vcpkg-port-config.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/vcpkg-cmake_x64-osx/share/vcpkg-cmake/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">e/</span><span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">e6061f9ad1b3a6deb062796316d813c6088ecd79e1a5b317f8d61d77720d6e9.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">vcpkg-cmake:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">53</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">31</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> decovar<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">decovar-vcpkg-cmake</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">ceb1e31d28a155bcbeb26382478b024a3d82cd3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/decovar-vcpkg-cmake_x64-osx/share/decovar-vcpkg-cmake/Installing.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/decovar-vcpkg-cmake_x64-osx/share/decovar-vcpkg-cmake/Config.cmake.in</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/decovar-vcpkg-cmake_x64-osx/share/decovar-vcpkg-cmake/decovar_vcpkg_cmake_ololo.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/decovar-vcpkg-cmake_x64-osx/share/decovar-vcpkg-cmake/vcpkg-port-config.cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/decovar-vcpkg-cmake_x64-osx/share/decovar-vcpkg-cmake/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/aa/aa3c4e402f180f3e686bc6fa970e01c69c12dbcef95897634f58e6158fb194fa.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">decovar-vcpkg-cmake:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">93</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">32</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> glfw<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">glfw</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">597</span><span style="color:#66d9ef">fa07e1afd57c50dfdbeb0c0d28f4157748564</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Fetching</span> git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">glfw/glfw.git</span> <span style="color:#960050;background-color:#1e0010">7482</span><span style="color:#66d9ef">de6071d21db77a7236155da44c172a7f6c9e...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Extracting</span> <span style="color:#66d9ef">source</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/downloads/glfw-</span><span style="color:#960050;background-color:#1e0010">7482</span><span style="color:#66d9ef">de6071d21db77a7236155da44c172a7f6c9e.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>glfw<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">172</span>a7f6c9e<span style="color:#f92672">-</span>d7a30c254e<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> external ninja<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">1.11</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/glfw_x64-osx/share/glfw/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">02</span><span style="color:#66d9ef">/</span><span style="color:#960050;background-color:#1e0010">02113</span><span style="color:#66d9ef">b742df9138712913194efa54f3ef51eb01fd3e434fc4be9b406f44161c0.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glfw:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">7</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">773</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> dearimgui<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">dearimgui</span><span style="color:#f92672">[</span><span style="color:#66d9ef">backend-glfw</span>,<span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/c3282e78368406b65f57ef0e3afa7cda2fc26501</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Fetching</span> git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">ocornut/imgui.git</span> <span style="color:#960050;background-color:#1e0010">9</span><span style="color:#66d9ef">aae45eb4a05a5a1f96be1ef37eb503a12ceb889...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Extracting</span> <span style="color:#66d9ef">source</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/downloads/dearimgui-</span><span style="color:#960050;background-color:#1e0010">9</span><span style="color:#66d9ef">aae45eb4a05a5a1f96be1ef37eb503a12ceb889.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>dearimgui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>a12ceb889<span style="color:#f92672">-</span>c011915ee6<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> external ninja<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">1.11</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/dearimgui_x64-osx/share/dearimgui/copyright</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#f92672">--</span> ololo
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/c3/c3ba0c72ccdb98a816bd20555ab9cf5399687d6626bc943501b3ac9529f5cba2.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">dearimgui:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">13</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">51</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> glad<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">glad</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">2341</span><span style="color:#66d9ef">f5144ce8e76a256289517d61abb4ab9fb72c</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Fetching</span> git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">Dav1dde/glad.git</span> <span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">ecd45775d96f35170458e6b148eb0708967e402...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Extracting</span> <span style="color:#66d9ef">source</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/downloads/glad-</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">ecd45775d96f35170458e6b148eb0708967e402.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>glad<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">708967</span>e402<span style="color:#f92672">-</span>a791cb9077<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> external ninja<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">1.11</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/glad_x64-osx/share/glad/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">83</span><span style="color:#66d9ef">/</span><span style="color:#960050;background-color:#1e0010">8309811</span><span style="color:#66d9ef">b7ffd5fa5ee71aada208fab78e9e24cd176ba9083576b00c363bec638.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glad:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">753</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Total</span> elapsed time<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">33</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">97</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span>glfw provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glfw3 <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> glfw<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dearimgui provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>dearimgui <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> dearimgui<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glad provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glad <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> glad<span style="color:#66d9ef">:</span><span style="color:#66d9ef">:glad</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Running</span> vcpkg install <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">The</span> C compiler identification is <span style="color:#a6e22e">AppleClang</span> <span style="color:#ae81ff">14.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.14000029</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">CXX</span> compiler identification is <span style="color:#a6e22e">AppleClang</span> <span style="color:#ae81ff">14.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.14000029</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compiler <span style="color:#a6e22e">ABI</span> info
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compiler <span style="color:#a6e22e">ABI</span> info <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Check</span> <span style="color:#66d9ef">for</span> working C compiler<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc</span> <span style="color:#66d9ef">-</span> <span style="color:#66d9ef">skipped</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compile features
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compile features <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compiler <span style="color:#a6e22e">ABI</span> info
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compiler <span style="color:#a6e22e">ABI</span> info <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Check</span> <span style="color:#66d9ef">for</span> working <span style="color:#a6e22e">CXX</span> compiler<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++</span> <span style="color:#66d9ef">-</span> <span style="color:#66d9ef">skipped</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compile features
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compile features <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> <span style="color:#a6e22e">OpenGL</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX12.</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.sdk/System/Library/Frameworks/OpenGL.framework</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Generating</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Build</span> files have been written to<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/glfw-imgui-example/build</span></span></span></code></pre></div>
<p>It might be rather unexpected, but for Debug configuration vcpkg creates a <code>debug</code> subfolder inside build directory (<em><code>/path/to/glfw-imgui-example/build/vcpkg_installed/x64-osx/debug</code></em>) and puts Debug artifacts there, which can be confusing at first and will cause many projects to produce various vcpkg warnings (<em>redundant <code>include</code>/<code>share</code>/etc folders inside <code>debug</code> and so on</em>). Someone told me that this is the only proper/possible way of building several configurations on different platforms, and so that is why vcpkg does it so. I still don&rsquo;t quite get why then not to just have a folder per configuration instead of nesting <code>debug</code>, but okay.</p>
<p>Unrelated to that, you might have noticed an <code>ololo</code> message being printed out during the installation of <code>dearimgui</code> port (<em>version <a href="https://github.com/retifrav/vcpkg-registry/blob/5c1a089c3a542dfbe818625bf4a3dadfb834e2af/ports/dear-imgui/portfile.cmake#L39">1.88.0</a></em>). That message came from <a href="#cmake-helpers">decovar-vcpkg-cmake</a> helper port, which <code>dearimgui</code> port depends on and calls <code>decovar_vcpkg_cmake_ololo()</code> function from.</p>
<p>The total time to fetch all dependencies sources, configure and build them and install (<em>and cache</em>) the binaries is 34 seconds. If we now remove everything from the <code>build</code> folder and try again:</p>
<p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ rm -r ./*; rm .ninja*; ls -lah</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DUSING_PACKAGE_MANAGER_VCPKG</span><span style="color:#66d9ef">=</span><span style="color:#ae81ff">1</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Running</span> vcpkg install
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Fetching</span> registry information from git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">retifrav/vcpkg-registry.git</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">HEAD</span><span style="color:#f92672">)</span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Detecting</span> <span style="color:#66d9ef">compiler</span> <span style="color:#66d9ef">hash</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">triplet</span> <span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">The</span> <span style="color:#66d9ef">following</span> <span style="color:#66d9ef">packages</span> <span style="color:#66d9ef">will</span> <span style="color:#66d9ef">be</span> <span style="color:#66d9ef">built</span> <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">installed:</span>
</span></span><span style="display:flex;"><span>    dearimgui<span style="color:#f92672">[</span><span style="color:#66d9ef">backend-glfw</span>,<span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">88</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/c3282e78368406b65f57ef0e3afa7cda2fc26501</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> decovar<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">10</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">15</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">ceb1e31d28a155bcbeb26382478b024a3d82cd3</span>
</span></span><span style="display:flex;"><span>    glad<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">36</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">2341</span><span style="color:#66d9ef">f5144ce8e76a256289517d61abb4ab9fb72c</span>
</span></span><span style="display:flex;"><span>    glfw<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">8</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">597</span><span style="color:#66d9ef">fa07e1afd57c50dfdbeb0c0d28f4157748564</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">08</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">18</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">84</span><span style="color:#66d9ef">c200e8e625d4d99b1649525fcdf81a73197078</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">2022</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">02</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">06</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/e23b39e21f0dd42ecc615262640d211c39696aa1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Additional</span> packages <span style="color:#f92672">(*)</span> will be modified to complete <span style="color:#66d9ef">this</span> operation<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Restored</span> <span style="color:#ae81ff">6</span> package<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/.</span>cache<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>archives in <span style="color:#ae81ff">74.03</span> ms<span style="color:#f92672">.</span> <span style="color:#a6e22e">Use</span> <span style="color:#f92672">--</span>debug to see more details<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">vcpkg-cmake-config:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">364</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">vcpkg-cmake:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">532</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> decovar<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">decovar-vcpkg-cmake:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">853</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> glfw<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glfw:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">14</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">2</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> dearimgui<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">dearimgui:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">32</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span> glad<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glad:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">31</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">76</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Total</span> elapsed time<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">4</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">212</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span>glfw provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glfw3 <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> glfw<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dearimgui provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>dearimgui <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> dearimgui<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glad provides <span style="color:#a6e22e">CMake</span> targets<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">#</span> <span style="color:#66d9ef">this</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">heuristically</span> <span style="color:#66d9ef">generated</span><span style="color:#f92672">,</span> and may not be correct
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>glad <span style="color:#a6e22e">CONFIG</span> <span style="color:#a6e22e">REQUIRED</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>main <span style="color:#a6e22e">PRIVATE</span> glad<span style="color:#66d9ef">:</span><span style="color:#66d9ef">:glad</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Running</span> vcpkg install <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">The</span> C compiler identification is <span style="color:#a6e22e">AppleClang</span> <span style="color:#ae81ff">14.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.14000029</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">CXX</span> compiler identification is <span style="color:#a6e22e">AppleClang</span> <span style="color:#ae81ff">14.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.14000029</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compiler <span style="color:#a6e22e">ABI</span> info
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compiler <span style="color:#a6e22e">ABI</span> info <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Check</span> <span style="color:#66d9ef">for</span> working C compiler<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc</span> <span style="color:#66d9ef">-</span> <span style="color:#66d9ef">skipped</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compile features
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> C compile features <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compiler <span style="color:#a6e22e">ABI</span> info
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compiler <span style="color:#a6e22e">ABI</span> info <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Check</span> <span style="color:#66d9ef">for</span> working <span style="color:#a6e22e">CXX</span> compiler<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++</span> <span style="color:#66d9ef">-</span> <span style="color:#66d9ef">skipped</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compile features
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Detecting</span> <span style="color:#a6e22e">CXX</span> compile features <span style="color:#f92672">-</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> <span style="color:#a6e22e">OpenGL</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX12.</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.sdk/System/Library/Frameworks/OpenGL.framework</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Generating</span> done
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Build</span> files have been written to<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/glfw-imgui-example/build</span></span></span></code></pre></div></p>
<p>&hellip;then there is no <code>ololo</code> message being printed anymore, and the whole vcpkg stage took only only 4 seconds, because this time it didn&rsquo;t need to fetch sources and build binaries - it just restored already pre-built ones from cache.</p>
<p>Building the project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ time cmake --build .
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>3/3<span style="color:#f92672">]</span> Linking CXX executable glfw-imgui
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>real    0m0.958s
</span></span><span style="display:flex;"><span>user    0m1.330s
</span></span><span style="display:flex;"><span>sys    0m0.194s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat .ninja_log
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ninja log v5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">585</span>    <span style="color:#ae81ff">1666772953298222365</span>    CMakeFiles/glfw-imgui.dir/functions.cpp.o    38458c79e781fe79
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">794</span>    <span style="color:#ae81ff">1666772953508206892</span>    CMakeFiles/glfw-imgui.dir/main.cpp.o    41b1d124fcaa4881
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">794</span>    <span style="color:#ae81ff">927</span>    <span style="color:#ae81ff">1666772953635024427</span>    glfw-imgui    b12d88b40ff7db85</span></span></code></pre></div>
<p>takes <strong>1 second</strong> (<em>958 ms</em>) and involves compiling only 3 items, instead of the full 29, as <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#why-bother">it is demonstrated</a> with the same project in the article about Conan.</p>
<p>That same article also states that building the project and all its dependencies from sources takes 13.5 seconds, while with vcpkg building the dependencies alone took 34 seconds, so it might look like vcpkg doesn&rsquo;t improve but degrades build time. However, you shouldn&rsquo;t forget that vcpkg builds both Debug and Release configurations, not just one (<em>which, by the way, will catch up with the time when you&rsquo;ll be building the project and dependencies in a different configuration</em>), plus it does packing and cashing, which also takes time. And anyway, this matters only once - when dependencies are built for the first time, while without using pre-built dependencies you&rsquo;ll be wasting time building dependencies over and over again.</p>
<h3 id="locking-on-dependencies-versions">Locking on dependencies versions</h3>
<p>If you&rsquo;d like to lock on specific versions of dependencies (<em>you should</em>), it can be done with <a href="https://github.com/microsoft/vcpkg/blob/master/docs/users/versioning.md#overrides">overrides</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw-imgui-example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glad&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;backend-glfw&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;overrides&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glad&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.1.36&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;1.88.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port-version&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Here you might think that <code>overrides</code> block is redundant and you will probably want to set versions right in the <code>dependencies</code> block like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw-imgui-example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>But that will fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>error: <span style="color:#66d9ef">while</span> loading /path/to/glfw-imgui-example/vcpkg.json:
</span></span><span style="display:flex;"><span>$.dependencies<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>a dependency<span style="color:#f92672">)</span>: unexpected field <span style="color:#e6db74">&#39;version&#39;</span>, did you mean <span style="color:#e6db74">&#39;version&gt;=&#39;</span>?See https://github.com/Microsoft/vcpkg/tree/master/docs/users/manifests.md <span style="color:#66d9ef">for</span> more information.</span></span></code></pre></div>
<p>So it just does not accept this, and indeed, setting it like <code>&quot;version&gt;=&quot;: &quot;3.3.8&quot;</code> will succeed, <del>but then it will accept newer versions too, when they become available in the registry</del> and it should not pick up newer versions, because vcpkg uses a <a href="https://github.com/microsoft/vcpkg/blob/master/docs/specifications/versioning.md#42-declaring-minimum-version-constraints">minimum version approach</a>. Unless, like I said <a href="#baselinejson">before</a>, if you set a dependency version with <code>version&gt;=</code> and that value is lower than baselined version, then vcpkg will skip all the versions between that one and the baselined and will take the baselined version.</p>
<p>And so if you want to pin/lock on <em>exact</em> version of a dependency, then you have to use <a href="https://github.com/microsoft/vcpkg/blob/master/docs/users/manifests.md#overrides">overrides</a>.</p>
<p>In my opinion, this whole system is quite weird and not intuitive.</p>
<h4 id="transitive-dependencies">Transitive dependencies</h4>
<p>&hellip;but weirdness doesn&rsquo;t stop there. You cannot use <code>overrides</code> in ports manifests (<code>vcpkg.json</code>) of dependencies of dependencies (<em>transitive dependencies</em>). Or, rather, you can, but it will be ignored. As explained in <a href="https://github.com/microsoft/vcpkg/discussions/24655#discussioncomment-2735348">this answer</a>:</p>
<blockquote>
<p>You can only use overrides at the root level and not in a port. Within a port you can only use <code>&quot;version&gt;=&quot;: &quot;...&quot;</code>.</p>
<p>If you could use overrides in a port, you could create two ports with a dependency on <code>A</code> where port #1 required version <code>1.0.0</code> and port #2 required version <code>1.0.1</code>. This would result in unsolvable version constraints.</p>
</blockquote>
<p>So, if I&rsquo;d want to lock on <code>glfw</code> version <code>3.3.8</code> in <code>dearimgui</code> port <a href="https://github.com/retifrav/vcpkg-registry/blob/master/ports/dearimgui/vcpkg.json">manifest</a>, then I would need to do it like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;dearimgui&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;backend-glfw&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Using GLFW as graphics backend&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;version&gt;=&#34;</span>: <span style="color:#e6db74">&#34;3.3.8&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>To make things more interesting, if you&rsquo;d like to specify the <a href="https://learn.microsoft.com/en-us/vcpkg/users/versioning#port-version">port version</a> too, this is how you would do it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&gt;=&#34;</span>: <span style="color:#e6db74">&#34;3.3.8#1&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Yeah, no separate field/property - just this <code>#</code> separator followed by the port version.</p>
<h3 id="multiple-registries">Multiple registries</h3>
<p>It is also possible to have <a href="https://github.com/microsoft/vcpkg/blob/master/docs/users/registries.md">multiple registries</a> in a project and specify which packages should be fetched from which registry.</p>
<p>For example, let&rsquo;s say I want my in-house custom registry to be the default one, and for the purpose of testing/comparing my custom ports I&rsquo;d need to be able to get their variants from Microsoft&rsquo;s registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;default-registry&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;kind&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repository&#34;</span>: <span style="color:#e6db74">&#34;git@github.com:retifrav/vcpkg-registry.git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;5c1a089c3a542dfbe818625bf4a3dadfb834e2af&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;registries&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;kind&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;repository&#34;</span>: <span style="color:#e6db74">&#34;https://github.com/microsoft/vcpkg.git&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;baseline&#34;</span>: <span style="color:#e6db74">&#34;71f51b100be2b5d32e3907572d99dc2f97088c8d&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;packages&#34;</span>:
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;glslang&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This is what I had in <code>vcpkg-configuration.json</code> in one of my other projects where I had some problems with linking to <code>HLSL</code> that was installed from <code>glslang</code>. So I tried to use its port from Microsoft&rsquo;s registry to see if it is built differently there (<em>and indeed it was</em>), and while <code>glslang</code> is listed in the <code>dependencies</code> list inside <code>vcpkg.json</code>, here I&rsquo;m telling vcpkg that it should be actually fetched from the Microsoft&rsquo;s registry instead of the default one. As you can see below, now vcpkg uses two registries, and even though I already have <code>glslang</code> pre-built in my local cache (<em>and the same version too</em>), now it will be built anew, for it is a port from a different registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Fetching</span> registry information from git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">retifrav/vcpkg-registry.git</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">HEAD</span><span style="color:#f92672">)</span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Fetching</span> <span style="color:#66d9ef">registry</span> <span style="color:#66d9ef">information</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">https://github.com/microsoft/vcpkg.git</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">HEAD</span><span style="color:#f92672">)</span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Installing</span> <span style="color:#960050;background-color:#1e0010">9</span><span style="color:#66d9ef">/</span><span style="color:#960050;background-color:#1e0010">19</span> <span style="color:#66d9ef">glslang:x64-windows-static...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">glslang</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-windows-static...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">C:\Users\USERNAME\AppData\Local\vcpkg\registries\git-trees\4d7780995e9523d16a56714fcef0159f18ecfa52</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Downloading</span> https<span style="color:#66d9ef">:</span><span style="color:#75715e">//github.com/KhronosGroup/glslang/archive/11.8.0.tar.gz -&gt; KhronosGroup-glslang-11.8.0.tar.gz...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Extracting</span> source D<span style="color:#66d9ef">:</span><span style="color:#66d9ef">/programs/vcpkg/downloads/KhronosGroup-glslang-</span><span style="color:#960050;background-color:#1e0010">11</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Applying</span> patch ignore<span style="color:#f92672">-</span>crt<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Applying</span> patch always<span style="color:#f92672">-</span>install<span style="color:#f92672">-</span>resource<span style="color:#f92672">-</span>limits<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at D<span style="color:#66d9ef">:</span><span style="color:#66d9ef">/programs/vcpkg/buildtrees/glslang/src/</span><span style="color:#960050;background-color:#1e0010">11</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">8</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#66d9ef">-</span><span style="color:#960050;background-color:#1e0010">2</span><span style="color:#66d9ef">a85409eb5.clean</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">D:/programs/vcpkg/packages/glslang_x64-windows-static/share/glslang/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">C:\Users\USERNAME\AppData\Local\vcpkg\archives\8b\8b16920d54a7798ed9edb2c11b8cfe6a824cb4fab31365b9f3fe820486bbd669.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glslang:x64-windows-static:</span> <span style="color:#960050;background-color:#1e0010">46</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">16</span> <span style="color:#66d9ef">s</span></span></span></code></pre></div>
<p>Isn&rsquo;t that beautiful. With Conan I couldn&rsquo;t come up with a working setup for this, and with vcpkg it just works with a minimal effort.</p>
<h3 id="cmake-presets">CMake presets</h3>
<p>In (<em>relatively</em>) recent versions of CMake a new feature has been added - <a href="https://cmake.org/cmake/help/latest/manual/cmake-presets.7.html">CMake presets</a>. It first appeared in version <code>3.19</code>, and then versions <code>3.20</code> and <code>3.21</code> further expended it with newer revisions. I am now using presets revision <code>3</code> (<em>that&rsquo;s the one version <code>3.21</code> brought in</em>), but later CMake versions added even more.</p>
<p>In short, it is a JSON file, in which you can define &ldquo;presets&rdquo; - sets of CMake options for building your project. For example, here are <a href="https://github.com/retifrav/glfw-imgui-example/blob/master/CMakePresets.json">several presets</a> for configuring and building <a href="#in-a-project">that project</a>, and now instead of that long error-prone CMake command I can just do this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/glfw-imgui-example
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cmake --preset vcpkg-default-triplet
</span></span><span style="display:flex;"><span>Preset CMake variables:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  CMAKE_BUILD_TYPE:STRING<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>  CMAKE_INSTALL_PREFIX:PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/glfw-imgui-example/install/vcpkg-default-triplet&#34;</span>
</span></span><span style="display:flex;"><span>  CMAKE_TOOLCHAIN_FILE:FILEPATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/programs/vcpkg/scripts/buildsystems/vcpkg.cmake&#34;</span>
</span></span><span style="display:flex;"><span>  USING_PACKAGE_MANAGER_VCPKG:BOOL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TRUE&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Running vcpkg install
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>-- Configuring <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Generating <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Build files have been written to: /path/to/glfw-imgui-example/build/vcpkg-default-triplet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cmake --build --preset vcpkg-default-triplet
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>3/4<span style="color:#f92672">]</span> Install the project...
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /path/to/glfw-imgui-example/install/vcpkg-default-triplet/bin/glfw-imgui/glfw-imgui
</span></span><span style="display:flex;"><span>-- Installing: /path/to/glfw-imgui-example/install/vcpkg-default-triplet/bin/glfw-imgui/JetBrainsMono-ExtraLight.ttf</span></span></code></pre></div>
<p>Much more convenient, innit. And that way your team members might even &ldquo;not know&rdquo; about vcpkg&rsquo;s existence (<em>after they <a href="#installation">install it</a> on their machines, of course</em>).</p>
<p>The Ninja CMake generator and <code>CMAKE_BUILD_TYPE</code> are set in the presets too, but one can of course override those by explicitly setting them with <code>-G</code> and <code>-D</code> when calling CMake.</p>
<h3 id="updating-a-dependency-version">Updating a dependency version</h3>
<p>When you need to update (<em>or downgrade</em>) one of the project dependencies version (<em>given that new version is available in the registry</em>), you can do it in your project&rsquo;s <code>vcpkg.json</code>. For example, I have <a href="#several-versions-of-a-port">two versions</a> of GLFW in my registry - <code>3.3.7</code> and <code>3.3.8</code> - and the project depends on version <code>3.3.8</code> at the moment:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/glfw-imgui-example-338.png" alt="GLFW v3.3.8">

<p>If I change GLFW dependency version to <code>3.3.7</code> in <code>vcpkg.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw-imgui-example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;overrides&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;glfw&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;3.3.7&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;...&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>and rebuild the project, it will then fetch the GLFW sources for version <code>3.3.7</code> and build it (<em>as there is only <code>3.3.8</code> pre-built in the cache</em>), and it will also re-build Dear ImGui, because it one <a href="#features">depends on GLFW</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">The</span> following packages will be rebuilt<span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">dearimgui</span><span style="color:#f92672">[</span><span style="color:#66d9ef">backend-glfw</span>,<span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">1</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">88</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/c3282e78368406b65f57ef0e3afa7cda2fc26501</span>
</span></span><span style="display:flex;"><span>    glfw<span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span> <span style="color:#66d9ef">-&gt;</span> <span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">3</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">7</span> <span style="color:#66d9ef">--</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">45</span><span style="color:#66d9ef">af0346d2ec926146091ab374c475cac5aaf055</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Removing</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span> dearimgui<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Elapsed</span> time to handle dearimgui<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx:</span> <span style="color:#960050;background-color:#1e0010">6</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">359</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Removing</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span> glfw<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Elapsed</span> time to handle glfw<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx:</span> <span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">831</span> <span style="color:#66d9ef">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Restored</span> <span style="color:#ae81ff">0</span> package<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/.</span>cache<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>archives in <span style="color:#ae81ff">317</span> us<span style="color:#f92672">.</span> <span style="color:#a6e22e">Use</span> <span style="color:#f92672">--</span>debug to see more details<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span> glfw<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">glfw</span><span style="color:#f92672">[</span><span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/</span><span style="color:#960050;background-color:#1e0010">45</span><span style="color:#66d9ef">af0346d2ec926146091ab374c475cac5aaf055</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Fetching</span> git<span style="color:#a6e22e">@github</span><span style="color:#f92672">.</span>com<span style="color:#66d9ef">:</span><span style="color:#66d9ef">glfw/glfw.git</span> <span style="color:#960050;background-color:#1e0010">45</span><span style="color:#66d9ef">ce5ddd197d5c58f50fdd3296a5131c894e5527...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Extracting</span> <span style="color:#66d9ef">source</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/downloads/glfw-</span><span style="color:#960050;background-color:#1e0010">45</span><span style="color:#66d9ef">ce5ddd197d5c58f50fdd3296a5131c894e5527.tar.gz</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>glfw<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>c894e5527<span style="color:#f92672">-</span>e2c903af70<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> external ninja<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">1.11</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/glfw_x64-osx/share/glfw/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">c/</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#66d9ef">ce54de2d8e83e86576a55541e988b827c72567a9bfee05717f103cc04193eff.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">glfw:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">7</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">613</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Installing</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span> dearimgui<span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Building</span> <span style="color:#66d9ef">dearimgui</span><span style="color:#f92672">[</span><span style="color:#66d9ef">backend-glfw</span>,<span style="color:#66d9ef">core</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">x64-osx...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">--</span> <span style="color:#66d9ef">Installing</span> <span style="color:#66d9ef">port</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">location:</span> <span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/registries/git-trees/c3282e78368406b65f57ef0e3afa7cda2fc26501</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> cached <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>downloads<span style="color:#f92672">/</span>dearimgui<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>aae45eb4a05a5a1f96be1ef37eb503a12ceb889<span style="color:#f92672">.</span>tar<span style="color:#f92672">.</span>gz
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Cleaning</span> sources at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>dearimgui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>a12ceb889<span style="color:#f92672">-</span>c011915ee6<span style="color:#f92672">.</span>clean<span style="color:#f92672">.</span> <span style="color:#a6e22e">Use</span> <span style="color:#f92672">--</span>editable to skip cleaning <span style="color:#66d9ef">for</span> the packages you specify<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Extracting</span> source <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>downloads<span style="color:#f92672">/</span>dearimgui<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>aae45eb4a05a5a1f96be1ef37eb503a12ceb889<span style="color:#f92672">.</span>tar<span style="color:#f92672">.</span>gz
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Using</span> source at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>programs<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>dearimgui<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>a12ceb889<span style="color:#f92672">-</span>c011915ee6<span style="color:#f92672">.</span>clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Found</span> external ninja<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">1.11</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Configuring</span> x64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>dbg
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Building</span> x64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>rel
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Installing</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">/path/to/programs/vcpkg/packages/dearimgui_x64-osx/share/dearimgui/copyright</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> ololo
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Performing</span> post<span style="color:#f92672">-</span>build validation done
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Stored</span> binary cache<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">/Users/USERNAME/.cache/vcpkg/archives/</span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#66d9ef">/</span><span style="color:#960050;background-color:#1e0010">00795</span><span style="color:#66d9ef">b05b7197ecba35c066f67adec8cf123fd2d427deeae3921a9f8ec1486c7.zip</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Elapsed</span> <span style="color:#66d9ef">time</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">handle</span> <span style="color:#66d9ef">dearimgui:x64-osx:</span> <span style="color:#960050;background-color:#1e0010">10</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">59</span> <span style="color:#66d9ef">s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span></span></span></code></pre></div>
<p>After the new build the application will report GLFW version <code>3.3.7</code>:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/glfw-imgui-example-337.png" alt="GLFW v3.3.7">

<h3 id="static-crtmsvc-linkage">Static CRT/MSVC linkage</h3>
<p>I&rsquo;ve stumbled upon this problem on Windows with one of the dependencies in one of my other projects. At first that dependency wasn&rsquo;t being handled with vcpkg, I just added path to its installed artifacts into <code>CMAKE_PREFIX_PATH</code>. The project configuration succeeded, but building the project exploded with errors at linking stage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">LINK: command &#34;HERE-GOES-LONG-LINKING-COMMAND&#34; failed (exit code 1120) with the following output:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SomeDependency.lib(API.cpp.obj) : error LNK2038: mismatch detected for &#39;RuntimeLibrary&#39;: value &#39;MD_DynamicRelease&#39; doesn&#39;t match value &#39;MT_StaticRelease&#39; in some.cpp.obj</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SomeDependency.lib(Bitmap.cpp.obj) : error LNK2038: mismatch detected for &#39;RuntimeLibrary&#39;: value &#39;MD_DynamicRelease&#39; doesn&#39;t match value &#39;MT_StaticRelease&#39; in some.cpp.obj</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msvcprt.lib(MSVCP140.dll) : error LNK2005: &#34;public: __cdecl std::_Lockit::_Lockit(int)&#34; (??0_Lockit@std@@QEAA@H@Z) already defined in libcpmt.lib(xlock.obj)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msvcprt.lib(MSVCP140.dll) : error LNK2005: &#34;public: __cdecl std::_Lockit::~_Lockit(void)&#34; (??1_Lockit@std@@QEAA@XZ) already defined in libcpmt.lib(xlock.obj)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msvcprt.lib(MSVCP140.dll) : error LNK2005: &#34;public: struct _Cvtvec __cdecl std::_Locinfo::_Getcvt(void)const &#34; (?_Getcvt@_Locinfo@std@@QEBA?AU_Cvtvec@@XZ) already defined in some.cpp.obj</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msvcprt.lib(MSVCP140.dll) : error LNK2005: &#34;public: unsigned short const * __cdecl std::_Locinfo::_W_Getdays(void)const &#34; (?_W_Getdays@_Locinfo@std@@QEBAPEBGXZ) already defined in libcpmt.lib(wlocale.obj)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LINK : warning LNK4286: symbol &#39;tolower&#39; defined in &#39;libucrt.lib(tolower_toupper.obj)&#39; is imported by &#39;SomeDependency.lib(SourceWeb.cpp.obj)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LINK : warning LNK4286: symbol &#39;calloc&#39; defined in &#39;libucrt.lib(calloc.obj)&#39; is imported by &#39;libtiff.lib(tif_win32.c.obj)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SomeDependency.lib(geos.cpp.obj) : error LNK2001: unresolved external symbol __imp_hypot</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">libpng.lib(pngwrite.c.obj) : error LNK2001: unresolved external symbol __imp_strerror</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">libpng.lib(pngwrite.c.obj) : error LNK2019: unresolved external symbol __imp_ferror referenced in function png_image_write_to_file</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">some-application.exe : fatal error LNK1120: 33 unresolved externals</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ninja: build stopped: subcommand failed.</span></span></span></code></pre></div>
<p>The most important one from all of these:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">mismatch detected for &#39;RuntimeLibrary&#39;: value &#39;MD_DynamicRelease&#39; doesn&#39;t match value &#39;MT_StaticRelease&#39;</span></span></span></code></pre></div>
<p>As it turned out, that dependency was <a href="https://learn.microsoft.com/en-us/cpp/build/reference/md-mt-ld-use-run-time-library">linking CRT/MSVC</a> dynamically, while <code>x64-windows-static</code> triplet does that statically, but in order for linking to succeed, all the targets/objects in the project must have the same type of linking to CRT/MSVC.</p>
<p>So I&rsquo;ve re-built that dependency with static linking to CRT/MSVC by setting <code>/MT</code> flags, but still got errors on linking, however this time the linking was wrong the other way around:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">mismatch detected for &#39;RuntimeLibrary&#39;: value &#39;MT_StaticRelease&#39; doesn&#39;t match value &#39;MD_DynamicRelease&#39;</span></span></span></code></pre></div>
<p>Doesn&rsquo;t make sense, does it, but then I realized that this is because my application is also linking to CRT/MSVC dynamically. This time I decided to google some more, as setting flags didn&rsquo;t feel entirely right, and soon enough I found this solution on <a href="https://discourse.cmake.org/t/mt-staticrelease-doesnt-match-value-md-dynamicrelease/5428/4">CMake&rsquo;s forum</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># is set in vcpkg-windows-static preset (when triplet is x64-windows-static)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>option(<span style="color:#e6db74">CRT_LINKAGE_STATIC</span> <span style="color:#e6db74">&#34;Link MSVC runtime statically&#34;</span> <span style="color:#e6db74">0</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">WIN32</span> <span style="color:#e6db74">AND</span> <span style="color:#e6db74">CRT_LINKAGE_STATIC</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">#add_compile_options(&#34;/MT&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    if(<span style="color:#e6db74">POLICY</span> <span style="color:#e6db74">CMP0091</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        cmake_policy(<span style="color:#e6db74">SET</span> <span style="color:#e6db74">CMP0091</span> <span style="color:#e6db74">NEW</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set_property(<span style="color:#e6db74">TARGET</span> <span style="color:#f92672">${</span>CMAKE_PROJECT_NAME<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">PROPERTY</span> <span style="color:#e6db74">MSVC_RUNTIME_LIBRARY</span> <span style="color:#e6db74">&#34;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>Later on I also made a vcpkg port out of that dependency, so vcpkg would configure and build it under the same triplet together with other dependencies. In that case there is no need to set linking flags in that dependency&rsquo;s <code>CMakeLists.txt</code>, as linkage to CRT/MSVC would be aligned, but of course I still need to align it for my application, which is what I&rsquo;m doing by setting <code>CRT_LINKAGE_STATIC</code> option in <code>vcpkg-windows-static</code> CMake preset.</p>
<h3 id="dynamic-and-static-linking">Dynamic and static linking</h3>
<p>Since we are brought up the subject of <a href="#static-crtmsvc-linkage">linking</a>, in case you are curious, with Windows build as an example, if we build <a href="#in-a-project">that project</a> with <code>vcpkg-default-triplet</code> <a href="#cmake-presets">preset</a>, which uses dynamic linking (<em><code>VCPKG_LIBRARY_LINKAGE</code></em>), then resulting artifacts will be all its dependencies as DLLs and a small executable of the application itself:</p>
<ul>
<li><code>glad.dll</code> - 86 KB</li>
<li><code>glfw3.dll</code> - 211.5 KB</li>
<li><code>dearimgui.dll</code> - 889 KB</li>
<li><code>glfw-imgui.exe</code> - 50.5 KB</li>
</ul>
<p>If we build it with <code>vcpkg-windows-static</code> preset, which uses static linking (<em>both for dependencies and CRT/MSVC</em>), then we&rsquo;ll get just an application executable with everything linked into it:</p>
<ul>
<li><code>glfw-imgui.exe</code>: 1268 KB</li>
</ul>
<p>Finally, using the same <code>vcpkg-windows-static</code> preset but with <code>VCPKG_CRT_LINKAGE</code> set to <code>dynamic</code> (<em>probably redundant for dependencies</em>) and <code>-DCRT_LINKAGE_STATIC=0</code>, we&rsquo;ll still get a single executable with dependencies linked in but without CRT/MSVC:</p>
<ul>
<li><code>glfw-imgui.exe</code> - 947 KB</li>
</ul>
<p>which means that to run on another computer it will require user to have <a href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist">Visual C++ Redistributable</a> installed.</p>
<h4 id="what-if-a-library-is-static-only">What if a library is static only</h4>
<p>Some libraries might not &ldquo;support&rdquo; dynamic linking, which in most cases means that you can&rsquo;t build them as DLLs on Windows, as they don&rsquo;t export any symbols. That&rsquo;s okay, you&rsquo;ll just have to force static linking on them by putting the following in the very beginning of their portfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if (<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">dynamic</span>) <span style="color:#75715e"># probably also check if it is Windows, as it might be fine on other platforms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    message(<span style="color:#e6db74">STATUS</span> <span style="color:#e6db74">&#34;[INFO] ${PORT} doesn&#39;t support building as dynamic library, overriding to static&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>It also won&rsquo;t hurt to check in the library&rsquo;s <code>CMakeLists.txt</code> that its authors don&rsquo;t hardcode the library type in <code>add_library()</code> statements.</p>
<h3 id="mapping-of-release-binaries-in-relwithdebinfo">Mapping of Release binaries in RelWithDebInfo</h3>
<p>If your project has less common configurations than just <code>Debug</code>/<code>Release</code>, for example if you also build <code>RelWithDebInfo</code>, then you might get a linking mismatch when your <code>RelWithDebInfo</code> configuration would try to link with <code>Debug</code> variants of dependencies.</p>
<p>In that case you&rsquo;ll need to set the following <a href="https://github.com/Microsoft/vcpkg/issues/5621#issuecomment-471444498">explicit mapping</a> in your project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">CMAKE_MAP_IMPORTED_CONFIG_MINSIZEREL</span> <span style="color:#e6db74">Release</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_MAP_IMPORTED_CONFIG_RELWITHDEBINFO</span> <span style="color:#e6db74">Release</span>)</span></span></code></pre></div>
<h1 id="per-platform-specifics">Per-platform specifics</h1>
<h2 id="webassembly">WebAssembly</h2>
<h3 id="chainloading-emscripten-toolchain">Chainloading Emscripten toolchain</h3>
<p>Just like with other platforms, targetting WebAssembly (<em>WASM</em>) requires you to use an appropriate <a href="#triplets">triplet</a>. There is no suitable triplet among the &ldquo;official&rdquo; ones at the moment, but there is a community triplet <code>wasm32-emscripten</code>.</p>
<p>And while the dependencies (<em>ports</em>) will (<em>hopefully</em>) build just fine, here&rsquo;s a surprise that will be waiting for you when CMake will try to <code>find_package()</code> them for your main project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>CMake Error at D:/programs/vcpkg/scripts/buildsystems/vcpkg.cmake:843 <span style="color:#f92672">(</span>_find_package<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  Could not find a configuration file <span style="color:#66d9ef">for</span> package <span style="color:#e6db74">&#34;fmt&#34;</span> that is compatible
</span></span><span style="display:flex;"><span>  with requested version <span style="color:#e6db74">&#34;&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  The following configuration files were considered but not accepted:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    D:/temp/emsc/build/vcpkg-default-triplet/vcpkg_installed/wasm32-emscripten/share/fmt/fmt-config.cmake, version: 8.1.1 <span style="color:#f92672">(</span>32bit<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Call Stack <span style="color:#f92672">(</span>most recent call first<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  CMakeLists.txt:8 <span style="color:#f92672">(</span>find_package<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Configuring incomplete, errors occurred!</span></span></code></pre></div>
<p>And this is not just about fmt, you&rsquo;ll get this error for other dependencies too (<em>although not all of them, details below</em>). The actual fuck. Just what am I supposed to do with this?</p>
<p>After some googling I found this <a href="https://stackoverflow.com/questions/74171098/find-package-failed-when-using-vcpkg-with-emscripten">question at StackOverflow</a> with some more details. So apparently this happens when a package contains a version config (<em>fmt does contain one</em>) that is generated by <a href="https://cmake.org/cmake/help/latest/module/CMakePackageConfigHelpers.html#command:write_basic_package_version_file">write_basic_package_version_file()</a> without <code>ARCH_INDEPENDENT</code> being set (<em>and I have never seen it being set in any package</em>), because then the following condition is added to the config:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># check that the installed version has the same 32/64bit-ness as the one which is currently searching:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">CMAKE_SIZEOF_VOID_P</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;4&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  math(<span style="color:#e6db74">EXPR</span> <span style="color:#e6db74">installedBits</span> <span style="color:#e6db74">&#34;4 * 8&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  set(<span style="color:#e6db74">PACKAGE_VERSION</span> <span style="color:#e6db74">&#34;${PACKAGE_VERSION} (${installedBits}bit)&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  set(<span style="color:#e6db74">PACKAGE_VERSION_UNSUITABLE</span> <span style="color:#e6db74">TRUE</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>I also checked what kind of binary I got built, and it was in fact a WebAssembly binary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /tmp
</span></span><span style="display:flex;"><span>$ mkdir fmt-lib-contents <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>$ ar xv /path/to/your-project/build/vcpkg_installed/wasm32-emscripten/lib/libfmt.a
</span></span><span style="display:flex;"><span>x - format.cc.o
</span></span><span style="display:flex;"><span>x - os.cc.o
</span></span><span style="display:flex;"><span>$ ls
</span></span><span style="display:flex;"><span>format.cc.o  os.cc.o
</span></span><span style="display:flex;"><span>$ file ./*
</span></span><span style="display:flex;"><span>./format.cc.o: WebAssembly <span style="color:#f92672">(</span>wasm<span style="color:#f92672">)</span> binary module version 0x1 <span style="color:#f92672">(</span>MVP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>./os.cc.o:     WebAssembly <span style="color:#f92672">(</span>wasm<span style="color:#f92672">)</span> binary module version 0x1 <span style="color:#f92672">(</span>MVP<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>And yet <code>find_package()</code> was failing, because <code>CMAKE_SIZEOF_VOID_P</code> equaled <code>8</code>. So, whose fault is that <code>CMAKE_SIZEOF_VOID_P</code> is set to <code>8</code>, while the package is built for <code>4</code>?</p>
<p>By the way, even if <code>write_basic_package_version_file()</code> did have <code>ARCH_INDEPENDENT</code> set, here&rsquo;s a related <a href="https://gitlab.kitware.com/cmake/cmake/-/issues/24375">CMake bugreport</a>, from which it seems that it wouldn&rsquo;t work anyway (<em>at least not until CMake 3.26 (or even newer) it wouldn&rsquo;t</em>). But this is actually not important, more details to follow.</p>
<p>So what can one do? After some more googling I&rsquo;ve stumbled upon this <a href="https://code.qt.io/cgit/qt/qtbase.git/tree/cmake/QtBuild.cmake?h=wip/cmake&amp;id=0d177053b9406e2fb21802d23f2b2cdc0f974377#n3127">workaround</a> in Qt sources, where they just clear the <code>CMAKE_SIZEOF_VOID_P</code> variable before finding a package and then set it back. In my case it would be like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e">#message(STATUS &#34;CMAKE_SIZEOF_VOID_P: ${CMAKE_SIZEOF_VOID_P}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">BACKUP_CMAKE_SIZEOF_VOID_P</span> <span style="color:#e6db74">&#34;${CMAKE_SIZEOF_VOID_P}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_SIZEOF_VOID_P</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>find_package(<span style="color:#e6db74">fmt</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_SIZEOF_VOID_P</span> <span style="color:#e6db74">&#34;${BACKUP_CMAKE_SIZEOF_VOID_P}&#34;</span>)</span></span></code></pre></div>
<p>Then the package is found, and configuration succeeds. But I have 30+ dependencies in my project, and they are spread across several different subprojects, so I most definitely don&rsquo;t want to wrap every single <code>find_package()</code> like this. And anyway, this doesn&rsquo;t seem like a correct way to deal with the situation.</p>
<p>And then a couple of days later I finally tried to set the <code>VCPKG_CHAINLOAD_TOOLCHAIN_FILE</code> in CLI when running CMake:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>emsdk
</span></span><span style="display:flex;"><span>$ source <span style="color:#f92672">./</span>emsdk_env<span style="color:#f92672">.</span>sh
</span></span><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some<span style="color:#f92672">/</span>project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_CHAINLOAD_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${EMSDK}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wasm32-emscripten&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>I mean, I&rsquo;ve been always setting it with <code>-DDCMAKE_TOOLCHAIN_FILE=&quot;...&quot;</code> when I was building my projects with Emscripten for WASM, but now with vcpkg the <code>wasm32-emscripten</code> triplet already does chainload it, and so I thought that I then should not. But as it turns out, counter-intuitively enough, <em>both</em> of these chainloads are required, because (<em>the way I understand it</em>) the one chainloaded inside the triplet is used for building vcpkg ports, and the one set with <code>-DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=&quot;...&quot;</code> in CLI is used for building the main project.</p>
<p>And what would you know, having done that, I didn&rsquo;t get the errors about non-compatible 32bit packages, as this time <code>CMAKE_SIZEOF_VOID_P</code> equaled <code>4</code>.</p>
<p>It certainly wouldn&rsquo;t hurt to have this documented somewhere.</p>
<h4 id="cmake_prefix_path-isnt-used">CMAKE_PREFIX_PATH isn&rsquo;t used</h4>
<p>That&rsquo;s not exactly related to vcpkg, but since we are on the topic of Emscripten toolchain: when I tried to use vcpkg-resolved dependencies and my library in another project, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some<span style="color:#f92672">/</span>other<span style="color:#f92672">/</span>project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Ninja&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/my/library/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>I suddenly got errors about not finding packages configs, even though <code>CMAKE_PREFIX_PATH</code> is clearly set and is correct.</p>
<p>And it <a href="https://stackoverflow.com/a/40080575/1688203">turned out</a> that Emscripten toolchain sets certain variables which &ldquo;disable&rdquo; using <code>CMAKE_PREFIX_PATH</code> for packages discovery. There are also some more details (<em>and confusion</em>) in <a href="https://github.com/emscripten-core/emscripten/issues/19243">this thread</a>.</p>
<p>Here&rsquo;s that particular fragment from <code>Emscripten.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># Since Emscripten is a cross-compiler, we should never look at the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># system-provided directories like /usr/include and so on. Therefore only
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># CMAKE_FIND_ROOT_PATH should be used as a find directory. See
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># http://www.cmake.org/cmake/help/v3.0/variable/CMAKE_FIND_ROOT_PATH_MODE_INCLUDE.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>if (<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  set(<span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span> <span style="color:#e6db74">ONLY</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if (<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  set(<span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</span> <span style="color:#e6db74">ONLY</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if (<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#960050;background-color:#1e0010"></span>  set(<span style="color:#e6db74">CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</span> <span style="color:#e6db74">ONLY</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>So it&rsquo;s <code>CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</code> being set to <code>ONLY</code> what&rsquo;s causing the problem. And so then there are two &ldquo;solutions&rdquo; for that.</p>
<p>Either provide <code>CMAKE_FIND_ROOT_PATH</code> instead of <code>CMAKE_PREFIX_PATH</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Ninja&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_FIND_ROOT_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/my/library/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>or keep <code>CMAKE_PREFIX_PATH</code> but set <code>CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</code> to <code>BOTH</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Ninja&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_PREFIX_PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/my/library/install&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_FIND_ROOT_PATH_MODE_PACKAGE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;BOTH&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span></span></span></code></pre></div>
<p>I do not know which one is &ldquo;correct&rdquo;. Both of the &ldquo;solutions&rdquo; worked (<em>equally?</em>) fine for me, as I haven&rsquo;t noticed any problems so far.</p>
<h3 id="enabling-pthreads-support">Enabling pthreads support</h3>
<p>Emscripten can compile to <a href="https://emscripten.org/docs/porting/pthreads.html">WASM with pthreads</a> (<em><a href="https://en.wikipedia.org/wiki/Pthreads">POSIX threads</a></em>) support enabled. For that one needs to set <code>-pthread</code> compiler flag when building one&rsquo;s project.</p>
<p>I did set that flag in my main project, started the build, got the ports built, got the project built too, but then I got the following errors on linking:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>wasm-ld: error: --shared-memory is disallowed by png.c.o because it was not compiled with <span style="color:#e6db74">&#39;atomics&#39;</span> or <span style="color:#e6db74">&#39;bulk-memory&#39;</span> features.
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>wasm-ld: error: --shared-memory is disallowed by 4D_api.cpp.o because it was not compiled with <span style="color:#e6db74">&#39;atomics&#39;</span> or <span style="color:#e6db74">&#39;bulk-memory&#39;</span> features.
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>wasm-ld: error: --shared-memory is disallowed by Threads.c.o because it was not compiled with <span style="color:#e6db74">&#39;atomics&#39;</span> or <span style="color:#e6db74">&#39;bulk-memory&#39;</span> features.</span></span></code></pre></div>
<p>From these I realized that adding <code>-pthread</code> flag in the main project is not enough, as it also needs to be set for ports compilation too. To test this theory I&rsquo;ve patched those ports with errors (<em>as you can see, the first one is from PNG and the second one is from PROJ</em>) to set the flags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># string(APPEND ... &#34; ...&#34;) would do fine too</span>
</span></span><span style="display:flex;"><span>set(CMAKE_C_FLAGS           <span style="color:#e6db74">&#34;$</span><span style="color:#e6db74">{CMAKE_C_FLAGS}</span><span style="color:#e6db74"> -pthread&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_C_FLAGS_DEBUG     &#34;${CMAKE_C_FLAGS_DEBUG} -pthread&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_C_FLAGS_RELEASE   &#34;${CMAKE_C_FLAGS_RELEASE} -pthread&#34;)</span>
</span></span><span style="display:flex;"><span>set(CMAKE_CXX_FLAGS         <span style="color:#e6db74">&#34;$</span><span style="color:#e6db74">{CMAKE_CXX_FLAGS}</span><span style="color:#e6db74"> -pthread&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_CXX_FLAGS_DEBUG   &#34;${CMAKE_CXX_FLAGS_DEBUG} -pthread&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_CXX_FLAGS_RELEASE &#34;${CMAKE_CXX_FLAGS_RELEASE} -pthread&#34;)</span></span></span></code></pre></div>
<p>And indeed, after that the first two errors went away, but the third one was still remaining, and I had no idea which port is it from and is it from a port at all.</p>
<p>But okay, at least this confirmed that I was on the right track, just needed to figure out how to set a compiler flag for all the ports at once, as one certainly should not patch the flags in every single port.</p>
<p>So how does one set a &ldquo;global&rdquo; compilation flag to be applied to building all the ports? My first naive idea was to just set these <code>CMAKE_*_FLAGS</code> in the triplet, which I naively did, but as it turned out, they were never passed further, because ports didn&rsquo;t &ldquo;receive&rdquo; them (<em>I checked that by printing out all the flags with <code>message()</code></em>).</p>
<p>Additional googling led me <a href="https://github.com/microsoft/vcpkg/issues/3577">here</a>, and from there I eventually got to an understanding.</p>
<p>Related vcpkg documentation says that &ldquo;<em>when not using <code>VCPKG_CHAINLOAD_TOOLCHAIN_FILE</code></em>&rdquo; compiler flags can be set with <a href="https://github.com/microsoft/vcpkg/blob/d8e60ef4741584f2957788ed0786dd365c92c4d9/docs/users/triplets.md#vcpkg_cxx_flags">VCPKG_*_FLAGS</a> variables in the triplet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">VCPKG_C_FLAGS</span>   <span style="color:#e6db74">&#34;-pthread&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CXX_FLAGS</span> <span style="color:#e6db74">&#34;-pthread&#34;</span>)</span></span></code></pre></div>
<p>and then the toolchain (<em>one of the <code>/path/to/vcpkg/scripts/toolchains/*.cmake</code> ones</em>) will use these variables to set the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_FLAGS_INIT.html">CMAKE_*_FLAGS_INIT</a> variables, which in turn will be used to set the <code>CMAKE_*_FLAGS</code> variables, which are the flags we are after.</p>
<p>But we are in fact using <code>VCPKG_CHAINLOAD_TOOLCHAIN_FILE</code>, so setting <code>VCPKG_*_FLAGS</code> variables in the triplet won&rsquo;t work (<em>certainly didn&rsquo;t work for me</em>), so what does one do then?</p>
<p>It is my understanding (<em>which might be wrong</em>) that in this case one would need to set <code>CMAKE_*_FLAGS_INIT</code> variables in the chainloaded toolchain itself. But we are chainloading the Emscripten toolchain from <code>${EMSDK}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake</code>, and it won&rsquo;t be correct to modify the original file, especially that it is still expected to be used for non-pthreads-enabled WASM builds, so I guess we&rsquo;ll need to copy and modify the original. But then in turn we will need to use a custom triplet too, because the default one chainloads the original Emscripten toolchain.</p>
<p>So, here comes a custom triplet <code>my-wasm32-emscripten-pthreads.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># that is required (only on Windows?), otherwise it won&#39;t get environment variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_ENV_PASSTHROUGH_UNTRACKED</span> <span style="color:#e6db74">EMSCRIPTEN_TOOLCHAIN_FILE_PATH</span> <span style="color:#e6db74">EMSDK</span> <span style="color:#e6db74">PATH</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">ENV{EMSDK}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;[ERROR] The EMSDK environment variable isn&#39;t set, you probably haven&#39;t sourced emsdk_env.sh&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">EMSCRIPTEN_TOOLCHAIN_FILE_PATH</span> <span style="color:#e6db74">&#34;$ENV{EMSDK}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># yet to find a better way to pass this value to the triplet, but so far an environment variable seems to be the way
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">ENV{EMSCRIPTEN_TOOLCHAIN_FILE_PATH}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">STATUS</span> <span style="color:#e6db74">&#34;Didn&#39;t get EMSCRIPTEN_TOOLCHAIN_FILE_PATH from environment, keeping default value: ${EMSCRIPTEN_TOOLCHAIN_FILE_PATH}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>else()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">EMSCRIPTEN_TOOLCHAIN_FILE_PATH</span> <span style="color:#e6db74">&#34;$ENV{EMSCRIPTEN_TOOLCHAIN_FILE_PATH}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">STATUS</span> <span style="color:#e6db74">&#34;Got EMSCRIPTEN_TOOLCHAIN_FILE_PATH from environment: ${EMSCRIPTEN_TOOLCHAIN_FILE_PATH}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">EXISTS</span> <span style="color:#f92672">${</span>EMSCRIPTEN_TOOLCHAIN_FILE_PATH<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;[ERROR] Could not find Emscripten.cmake toolchain file, expected it to be at ${EMSCRIPTEN_TOOLCHAIN_FILE_PATH}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">wasm32</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CMAKE_SYSTEM_NAME</span> <span style="color:#e6db74">Emscripten</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># required, otherwise &#34;Unable to determine toolchain use for my-wasm32-emscripten-pthreads with CMAKE_SYSTEM_NAME Emscripten&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># and yes, for building the main project you&#39;ll yet again need to provide `-DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=&#34;...&#34;` in CLI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_CHAINLOAD_TOOLCHAIN_FILE</span> <span style="color:#f92672">${</span>EMSCRIPTEN_TOOLCHAIN_FILE_PATH<span style="color:#f92672">}</span>)</span></span></code></pre></div>
<p>And the custom Emscripten toolchain (<em>the one passed in <code>EMSCRIPTEN_TOOLCHAIN_FILE_PATH</code> environment variable</em>) is a copy of the original one from <code>$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake</code>, but with the following addition in the end:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># an exact copy of Emscripten.cmake file contents</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pthreads (https://emscripten.org/docs/porting/pthreads.html)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set<span style="color:#f92672">(</span>EMSCRIPTEN_PTHREADS_FLAGS <span style="color:#e6db74">&#34;-pthread&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># it is likely that not all of these need to be set, CMAKE_{C,CXX}_FLAGS_INIT seems to be enough</span>
</span></span><span style="display:flex;"><span>string<span style="color:#f92672">(</span>APPEND CMAKE_C_FLAGS_INIT                     <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>EMSCRIPTEN_PTHREADS_FLAGS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_C_FLAGS_DEBUG_INIT               &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_C_FLAGS_RELEASE_INIT             &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span>string<span style="color:#f92672">(</span>APPEND CMAKE_CXX_FLAGS_INIT                   <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>EMSCRIPTEN_PTHREADS_FLAGS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_CXX_FLAGS_DEBUG_INIT             &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_CXX_FLAGS_RELEASE_INIT           &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_STATIC_LINKER_FLAGS_INIT         &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_STATIC_LINKER_FLAGS_DEBUG_INIT   &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_STATIC_LINKER_FLAGS_RELEASE_INIT &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_SHARED_LINKER_FLAGS_INIT         &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_SHARED_LINKER_FLAGS_DEBUG_INIT   &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_SHARED_LINKER_FLAGS_RELEASE_INIT &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_MODULE_LINKER_FLAGS_INIT         &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_MODULE_LINKER_FLAGS_DEBUG_INIT   &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_MODULE_LINKER_FLAGS_RELEASE_INIT &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_EXE_LINKER_FLAGS_INIT            &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_EXE_LINKER_FLAGS_DEBUG_INIT      &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#string(APPEND CMAKE_EXE_LINKER_FLAGS_RELEASE_INIT    &#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;)</span></span></span></code></pre></div>
<p>But actually instead of copying the entire toolchain file contents wouldn&rsquo;t it be smarter to just include it, right, so here&rsquo;s a better variant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>include<span style="color:#f92672">(</span>$ENV<span style="color:#f92672">{</span>EMSDK<span style="color:#f92672">}</span>/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pthreads (https://emscripten.org/docs/porting/pthreads.html)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set<span style="color:#f92672">(</span>EMSCRIPTEN_PTHREADS_FLAGS <span style="color:#e6db74">&#34;-pthread&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>string<span style="color:#f92672">(</span>APPEND CMAKE_C_FLAGS_INIT   <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>EMSCRIPTEN_PTHREADS_FLAGS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>string<span style="color:#f92672">(</span>APPEND CMAKE_CXX_FLAGS_INIT <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>EMSCRIPTEN_PTHREADS_FLAGS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span></span></span></code></pre></div>
<p>Having saved it somewhere at <code>/path/to/custom/toolchains/Emscripten-pthreads.cmake</code>, we can now configure and build the project like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>emsdk
</span></span><span style="display:flex;"><span>$ source <span style="color:#f92672">./</span>emsdk_env<span style="color:#f92672">.</span>sh
</span></span><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some<span style="color:#f92672">/</span>project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#a6e22e">EMSCRIPTEN</span><span style="color:#f92672">=</span>$<span style="color:#f92672">{</span><span style="color:#a6e22e">EMSDK</span><span style="color:#f92672">}/</span>upstream<span style="color:#f92672">/</span>emscripten <span style="color:#a6e22e">EMSCRIPTEN_TOOLCHAIN_FILE_PATH</span><span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>custom<span style="color:#f92672">/</span>toolchains<span style="color:#f92672">/</span><span style="color:#a6e22e">Emscripten</span><span style="color:#f92672">-</span>pthreads<span style="color:#f92672">.</span>cmake \
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_OVERLAY_TRIPLETS</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/custom/triplets&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-wasm32-emscripten-pthreads&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_CHAINLOAD_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>Some clarification about all that:</p>
<ul>
<li>why I am setting environment variables inline instead of exporting them - because it&rsquo;s better like this for experimentation (<em>so I don&rsquo;t forget them being set in the environment from the previous runs</em>);
<ul>
<li><code>EMSCRIPTEN_TOOLCHAIN_FILE_PATH</code> is set because I haven&rsquo;t found another way to pass the path to my custom Emscripten toolchain into the triplet;</li>
<li><code>EMSCRIPTEN</code> is set because for whatever reason everything fails, complaining that this variable is missing, even though I certainly did not set it when I used the default toolchain/triplet;</li>
</ul>
</li>
<li><code>-DVCPKG_OVERLAY_TRIPLETS=&quot;...&quot;</code> is how you tell vcpkg where to look for additional/custom triplets;</li>
<li><code>-DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=&quot;...&quot;</code> still points to the default Emscripten toolchain because I am already setting <code>-pthread</code> compiler flags (<em>plus some linker flags</em>) inside my main project&rsquo;s <code>CMakeLists.txt</code>, so I don&rsquo;t need a custom toolchain that does that. Although I probably should use the same custom toolchain (<em>the one that is chainloaded inside <code>my-wasm32-emscripten-pthreads</code> triplet for building ports</em>) here too;
<ul>
<li>either way, one of those toolchains has to be chainloaded here, as it is required for building the project itself with Emscripten.</li>
</ul>
</li>
</ul>
<p>Now everything finally builds and links into WASM with pthreads enabled.</p>
<h4 id="side-effect-of-chainloading-a-custom-toolchain">Side-effect of chainloading a custom toolchain</h4>
<p>There is one (<em>but probably more</em>) side-effect of chainloading a custom toolchain and that is detecting the compiler hash: it will remain the same even if you switch to a different Emscripten version (<em>as long as your custom toolchain doesn&rsquo;t change</em>), because apparently it&rsquo;s exactly the chainloaded toolchain that is taking part in the hash calculation.</p>
<p>Compiler hash remaining the same means that vcpkg-resolved dependencies won&rsquo;t get rebuilt, so you&rsquo;ll end up linking your project that was built using one Emscripten version with dependencies that were built using a different Emscripten version.</p>
<p>Obviously, if you are chainloading the standard/default Emscripten toolchain from its original location in <code>$EMSDK/upstream/emscripten/cmake/Modules/Platform/</code>, then it&rsquo;s all good, vcpkg will notice the change and the compiler hash will be different, which will trigger rebuilding the dependencies; but here we are talking about your custom toolchain, which most likely never changes (<em>as there is no need for that</em>).</p>
<p>To make vcpkg re-build the dependencies when you switch to a different Emscripten version, you&rsquo;ll need to change something in your custom toolchain file too, so vcpkg would notice that it has changed. For example, you can just add some comment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include(<span style="color:#f92672">$ENV{</span>EMSDK<span style="color:#f92672">}</span><span style="color:#e6db74">/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># pthreads (https://emscripten.org/docs/porting/pthreads.html)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">EMSCRIPTEN_PTHREADS_FLAGS</span> <span style="color:#e6db74">&#34;-pthread&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>string(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">CMAKE_C_FLAGS_INIT</span>   <span style="color:#e6db74">&#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>string(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">CMAKE_CXX_FLAGS_INIT</span> <span style="color:#e6db74">&#34; ${EMSCRIPTEN_PTHREADS_FLAGS}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># this is a comment for marking this custom toolchain as modified
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"># change the Emscripten version value every time you switch to a different one
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"># Emscripten version 3.1.54
</span></span></span></code></pre></div><p>This probably concerns other platforms/compilers too, and I reckon the workaround would be the same for those as well (<em>adding/modifying a comment every time</em>).</p>
<h2 id="windows">Windows</h2>
<h3 id="msvc-toolset">MSVC toolset</h3>
<p>In one case I needed to build my project with MSVC 141 toolset, which I did by setting <code>-G &quot;Visual Studio 15 2017&quot; -A &quot;x64&quot;</code>, but apparently that only applied to the project itself, and looks like vcpkg built the dependencies with a different toolset (<em>likely with MSVC 143, as that&rsquo;s the latest I have installed</em>), because I got the following errors on linking:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>error <span style="color:#a6e22e">LNK2001</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">unresolved</span> <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">symbol</span> <span style="color:#66d9ef">__</span><span style="color:#66d9ef">CxxFrameHandler4</span>
</span></span><span style="display:flex;"><span>error <span style="color:#a6e22e">LNK2001</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">unresolved</span> <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">symbol</span> <span style="color:#66d9ef">__</span><span style="color:#66d9ef">GSHandlerCheck_EH4</span></span></span></code></pre></div>
<p>As this <a href="https://stackoverflow.com/questions/65672356/what-is-cxxframehandler4-and-what-does-linker-error-unresolved-external-symbo/66028676">StackOverflow thread</a> says, the <code>__CxxFrameHandler4</code> is a part of the newer <a href="https://devblogs.microsoft.com/cppblog/making-cpp-exception-handling-smaller-x64/">FH4 exception handling</a>, which apparently appeared in MSVC 142 toolset and newer, and so the resolution is to tell vcpkg to build dependencies using the same toolset as the one used to build the project.</p>
<p>That can be done on the triplet level, so <a href="#enabling-pthreads-support">yet again</a> I&rsquo;ve created a custom triplet <code>my-x64-windows-v141.cmake</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">x64</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># here you specify the MSVC toolset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_PLATFORM_TOOLSET</span> <span style="color:#e6db74">&#34;v141&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># not sure what this one is for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_DEP_INFO_OVERRIDE_VARS</span> <span style="color:#e6db74">&#34;v141&#34;</span>)</span></span></code></pre></div>
<p>And now I build the whole thing like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some<span style="color:#f92672">/</span>project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 15 2017&#34;</span> <span style="color:#f92672">-</span>A <span style="color:#e6db74">&#34;x64&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_OVERLAY_TRIPLETS</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/custom/triplets&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-x64-windows-v141&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span></span></span></code></pre></div>
<p>As usual, this better to be run from the corresponding MSVC command prompt, so you&rsquo;ll need to adjust the shell-specific things.</p>
<h3 id="release-binaries-size-is-bigger-with-vcpkg">Release binaries size is bigger with vcpkg</h3>
<p>Suddenly I noticed that my Windows build artifacts got bigger in size. They were smaller before I started resolving dependencies with vcpkg, but now they got bigger.</p>
<p>I suspected that there might be some optimization flags not set, and I was almost right, although the other way around - turns out, by default vcpkg sets Debug flag <code>/Z7</code> for Release configuration! See for yourself in the Windows toolchain (<em><code>/path/to/vcpkg/scripts/toolchains/windows.cmake</code></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">CMAKE_CXX_FLAGS_RELEASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${VCPKG_CRT_LINK_FLAG_PREFIX} /O2 /Oi /Gy /DNDEBUG /Z7 ${VCPKG_CXX_FLAGS_RELEASE}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_C_FLAGS_RELEASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${VCPKG_CRT_LINK_FLAG_PREFIX} /O2 /Oi /Gy /DNDEBUG /Z7 ${VCPKG_C_FLAGS_RELEASE}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>From the <a href="https://learn.microsoft.com/en-us/cpp/build/reference/z7-zi-zi-debug-information-format#z7">documentation</a> for <code>/Z7</code> flag:</p>
<blockquote>The <code>/Z7</code> option produces object files that also contain full symbolic debugging information for use with the debugger. These object files and any libraries built from them can be substantially larger than files that have no debugging information.</blockquote>
<p>I mean, sounds useful for Debug configuration, but why is it set for Release configuration too?</p>
<p>Googling this question brought me to <a href="https://github.com/microsoft/vcpkg/issues/9084">this issue</a> in vcpkg repository, so at least I wasn&rsquo;t the only one to question the sanity of this. And here&rsquo;s what one of the vcpkg maintainers said in the discussion thread <a href="https://github.com/microsoft/vcpkg/issues/9084#issuecomment-667347451">over there</a>:</p>
<blockquote>There's no reason to remove debugging information; we believe CMake's default setting which includes not even stripped symbols in release mode is an incorrect default.</blockquote>
<p>Well, I certainly believe that CMake does this absolutely correctly, as there is no bloody point to have anything of the sort in the Release binaries. If you want to debug, you take Debug binaries; that is why Debug/Release separation exists in the first place, is it not? Why on earth would you want to be able to debug with Release binaries? Sweet suffering Jehovah.</p>
<h4 id="removing-z7-flag-from-release-configuration">Removing /Z7 flag from Release configuration</h4>
<p>So, as we don&rsquo;t have unlimited storage for our packages and distributives and in general we don&rsquo;t like wasting network bandwidth transferring useless data, we&rsquo;d like to remove <code>/Z7</code> flag from the default Windows toolchain to reduce our dependencies binaries size back to normal.</p>
<p>The procedure is very similar to how I added <code>-pthread</code> flag to <a href="#enabling-pthreads-support">enable pthreads support</a> in Enscripten/WASM builds. There are several options:</p>
<ol>
<li>Make patches for every single port sources to override flags in their <code>CMakeLists.txt</code> files. That is the worst option out of all listed here;</li>
<li>Modify the flags directly in the default toolchain (<em><code>/path/to/vcpkg/scripts/toolchains/windows.cmake</code></em>). I would not recommend this, because:
<ul>
<li>that modification will get overridden on the next vcpkg update/reinstall;</li>
<li>you&rsquo;ll need to do that on your every machine or/and every buildbot in your CI/CD;</li>
<li>other people with default toolchains will be getting different build artifacts even though they&rsquo;d be using the same triplets as you, and that might backfire at some point;</li>
</ul>
</li>
<li>Copy the default toolchain into your project repository, modify the flags there and chainload it with <code>VCPKG_CHAINLOAD_TOOLCHAIN_FILE</code>. This option is almost good, but dragging around a copy of the default toolchain isn&rsquo;t ideal, at the very least because it will eventually go out of sync with the default one;</li>
<li>Instead of copying the contents of the default toolchain, simply include it in your custom chainloaded toolchain and override the flags right after that.</li>
</ol>
<p>I actually had one more option, which is what I tried first: still create a custom toolchain to be chainloaded but without including the default toolchain - just seting new values to the flags and that&rsquo;s it. But right away I discovered two problems with this:</p>
<ul>
<li>you need to somehow get the current values of the flags that have been already set upper in the chain. You can of course just set the flags to whatever you want, but ideally one would like to preserve all the original flags and just remove the <code>/Z7</code>. And I didn&rsquo;t find a way to do it;</li>
<li>the real showstopper, however, is the fact that if you don&rsquo;t include the default toolchain, then all the flags it sets won&rsquo;t be set at all (<em>for example, <code>/utf-8</code> flag will be missing, so you might get <code>too many characters in constant</code> compilation error</em>). I, for one, was expecting those flags to be set, since my custom toolchain is <em>chainloaded</em> and not <em>loaded instead of</em> the default one, but apparently I&rsquo;m missing something about the way <a href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#using-multiple-toolchain-files">chainloading</a> works.</li>
</ul>
<p>So the 4th option is what I went with (<em>include the default toolchain in a <a href="https://github.com/microsoft/vcpkg/issues/26699#issuecomment-1245130589">custom toolchain</a> and override flags right after</em>). Yes, it seems to be redundant and rather weird to include the exact same toolchain that has been (<em>hasn&rsquo;t it?</em>) just used upper in the chain, but that is what worked for me.</p>
<p>Here&rsquo;s my custom toolchain (<em><code>/path/to/custom/toolchains/windows.cmake</code></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># for $ENV{VCPKG_ROOT} to work the triplet should contain `set(VCPKG_ENV_PASSTHROUGH_UNTRACKED VCPKG_ROOT)`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include(<span style="color:#e6db74">&#34;$ENV{VCPKG_ROOT}/scripts/toolchains/windows.cmake&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># remove /Z7 from the default set of C flags
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>string(<span style="color:#e6db74">REPLACE</span> <span style="color:#e6db74">&#34;/Z7&#34;</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CMAKE_C_FLAGS_RELEASE_WITHOUT_Z7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CMAKE_C_FLAGS_RELEASE}&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># override Release flags variable with the new value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">CMAKE_C_FLAGS_RELEASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CMAKE_C_FLAGS_RELEASE_WITHOUT_Z7}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># it&#39;s important to apply FORCE here, as this variable is CACHE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># and it has been already set in the default toolchain above
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">FORCE</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># and the same for CXX flags
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>string(<span style="color:#e6db74">REPLACE</span> <span style="color:#e6db74">&#34;/Z7&#34;</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CMAKE_CXX_FLAGS_RELEASE_WITHOUT_Z7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CMAKE_CXX_FLAGS_RELEASE}&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_CXX_FLAGS_RELEASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;${CMAKE_CXX_FLAGS_RELEASE_WITHOUT_Z7}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">FORCE</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>And here&rsquo;s my custom triplet (<em><code>/path/to/custom/triplets/my-x64-windows-static-md.cmake</code></em>) that chainloads it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#75715e"># default values from the original x64-windows-static-md.cmake
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">x64</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># without this the VCPKG_ROOT environment variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># won&#39;t be available in the chainloaded toolchain
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_ENV_PASSTHROUGH_UNTRACKED</span> <span style="color:#e6db74">VCPKG_ROOT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># overriding default flags to remove /Z7 from Release builds,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># because no one (except Microsoft) needs Debug stuff in Release binaries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># this could do with a better path instead of ..
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_CHAINLOAD_TOOLCHAIN_FILE</span> <span style="color:#f92672">${</span>CMAKE_CURRENT_LIST_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/../toolchains/windows.cmake</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># on Windows VCPKG_CHAINLOAD_TOOLCHAIN_FILE deactivates VS variables,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># so those need to be loaded again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_LOAD_VCVARS_ENV</span> <span style="color:#e6db74">1</span>)</span></span></code></pre></div>
<p>Two things are important to note here:</p>
<ul>
<li><code>VCPKG_ROOT</code> environment variable needs to be passed through, otherwise chainloaded toolchain won&rsquo;t have it;</li>
<li>unless you&rsquo;ve read about this in <a href="https://learn.microsoft.com/en-us/vcpkg/users/triplets#vcpkg_load_vcvars_env">documentation</a>, you wouldn&rsquo;t know that in case of chainloaded toolchains the <code>VCPKG_LOAD_VCVARS_ENV</code> is set to <code>OFF</code>, which leads to CMake errors like <code>No CMAKE_C_COMPILER could be found</code> and other typical problems of not finding compilers and tools, so you need to set it back to <code>ON</code>/<code>1</code>.</li>
</ul>
<p>Now I can configure and build my project like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>some<span style="color:#f92672">/</span>project
</span></span><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd <span style="color:#a6e22e">$_</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_OVERLAY_TRIPLETS</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/path/to/custom/triplets&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my-x64-windows-static-md&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install</span></span></code></pre></div>
<p>For that to work the custom toolchain needs to be in <code>/path/to/custom/toolchains/</code>, as for triplet the <code>${CMAKE_CURRENT_LIST_DIR}</code> will evaluate to <code>/path/to/custom/triplets/</code>, and so <code>../toolchains/</code> with be the right path.</p>
<h4 id="comparison-of-binary-sizes-with-and-without-z7">Comparison of binary sizes with and without /Z7</h4>
<p>Let&rsquo;s see some real sizes of Release binaries that are built with and without <code>/Z7</code> flag. If you&rsquo;d like to repeat the experiment yourself, here&rsquo;s a <a href="https://github.com/retifrav/vcpkg-registry/tree/acc85097c33bdb528962f0976ddb0c6091204785/examples/z7-binary-size-comparison">dummy project</a> that I used for it.</p>
<p>First build the libraries with default Release flags (<em>so with <code>/Z7</code> among them</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cd <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>z7<span style="color:#f92672">-</span>binary<span style="color:#f92672">-</span>size<span style="color:#f92672">-</span>comparison
</span></span><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>md
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>hs <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>md<span style="color:#f92672">/</span>lib</span></span></code></pre></div>
<p>Then build the same libraries but with a custom triplet to remove <code>/Z7</code> from Release flags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ mv <span style="color:#f92672">./</span>vcpkg_installed <span style="color:#f92672">./</span>vcpkg_installed_z7
</span></span><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>triplets <span style="color:#f92672">./</span>triplets <span style="color:#f92672">--</span>triplet my<span style="color:#f92672">-</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>md
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>hs <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>my<span style="color:#f92672">-</span>x64<span style="color:#f92672">-</span>windows<span style="color:#f92672">-</span>static<span style="color:#f92672">-</span>md<span style="color:#f92672">/</span>lib</span></span></code></pre></div>
<p>In my case the results were:</p>
<div style="overflow-x:auto;">
    <table class="table">
        <thead>
            <tr>
                <th rowspan=2></th>
                <th rowspan=2>Debug</th>
                <th colspan=2>Release</th>
            </tr>
            <tr>
                <th>With <code>/Z7</code></th>
                <th>Without <code>/Z7</code></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>assimp-vc143-mt.lib</th>
                <td style="color:red;">214.9 MB</td>
                <td>195.3 MB</td>
                <td style="color:green;">63.8 MB</td>
            </tr>
            <tr>
                <th>dearimgui.lib</th>
                <td>5.8 MB</td>
                <td style="color:red;">7.4 MB</td>
                <td style="color:green;">3.4 MB</td>
            </tr>
            <tr>
                <th>draco.lib</th>
                <td style="color:red;">109.5 MB</td>
                <td>94.4 MB</td>
                <td style="color:green;">27 MB</td>
            </tr>
            <tr>
                <th>glfw3.lib</th>
                <td>1.9 MB</td>
                <td style="color:red;">2.1 MB</td>
                <td style="color:green;">633.1 KB</td>
            </tr>
            <tr>
                <th>sqlite3.lib</th>
                <td>3.2 MB</td>
                <td style="color:red;">6.5 MB</td>
                <td style="color:green;">2.7 MB</td>
            </tr>
            <tr>
                <th>zlib.lib</th>
                <td>364.1 KB</td>
                <td style="color:red;">441 KB</td>
                <td style="color:green;">186.5 KB</td>
            </tr>
            <tr>
                <th>zstd.lib</th>
                <td>3.8 MB</td>
                <td style="color:red;">6.6 MB</td>
                <td style="color:green;">1.8 MB</td>
            </tr>
            <tr>
                <th colspan=2></th>
                <th style="color:red;">312.74 MB</th>
                <th style="color:green;">99.52 MB</th>
            </tr>
        </tbody>
    </table>
</div>
<p>So not only Release binaries with <code>/Z7</code> flag are more than 3 times bigger than their variants without it, but also for most libraries they are even bigger than the Debug variants.</p>
<p>I mean, goddamn. The only valid reason for setting this flag by default in Release configurations would be if people behind vcpkg were selling data storage or some other hosting services of the kind. Wait&hellip; oh shi~</p>
<h3 id="building-with-clang-instead-of-msvc">Building with Clang instead of MSVC</h3>
<p>Later I needed to build the project and its dependencies with <a href="https://clang.llvm.org">Clang</a> instead of MSVC.</p>
<p>Clang (<em>LLVM</em>) can be downloaded either separately from its <a href="https://releases.llvm.org/download.html">website</a>, or you can install it via <a href="https://learn.microsoft.com/en-us/visualstudio/install/install-visual-studio">Visual Studio Installer</a> as a Visual Studio component.</p>
<p>In case of configuring a CMake project, if you installed LLVM yourself, choosing Clang as compiler can be done with Ninja generator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_C_COMPILER</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/llvm/bin/clang-cl.exe&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_CXX_COMPILER</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/llvm/bin/clang-cl.exe&#34;</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span></span></span></code></pre></div>
<p>or with Visual Studio generator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 17 2022&#34;</span> <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span> <span style="color:#f92672">--</span> <span style="color:#f92672">-</span>p<span style="color:#66d9ef">:</span><span style="color:#66d9ef">CLToolExe</span><span style="color:#f92672">=</span>clang<span style="color:#f92672">-</span>cl<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>p<span style="color:#66d9ef">:</span><span style="color:#66d9ef">CLToolPath</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/llvm/bin&#34;</span></span></span></code></pre></div>
<p>The variant with <code>-p:CLToolExe</code> might be useful if you have <a href="https://clang.llvm.org/docs/MSVCCompatibility.html">MSVC-specific</a> compiler flags hardcoded in your project.</p>
<p>If you installed LLVM via Visual Studio Installer, then it can be just this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 17 2022&#34;</span> <span style="color:#f92672">-</span>T <span style="color:#e6db74">&#34;ClangCL&#34;</span> <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>$ cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span></span></span></code></pre></div>
<p>If it doesn&rsquo;t find the compilers/tools, you can try to set the VS environment (<em>from <code>cmd</code>, that is</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>&gt; call d:\path\to\visual-studio\VC\Auxiliary\Build\vcvars64.bat</span></span></code></pre></div>
<p>Actually, you might want to do this every time you&rsquo;d like to use Visual Studio tools.</p>
<p>If you have both Clang that you installed yourself and Clang which is a part of Visual Studio, you might want to make sure that both your project and vcpkg-resolved dependencies are built with the same one.</p>
<p>Anyway, that was the project itself, but how to build vcpkg-resolved dependencies with Clang as well? As in previous cases, you would need to make a custom toolchain for that and chainload it from a custom triplet.</p>
<p>The <a href="https://github.com/retifrav/vcpkg-registry/blob/895dac39caca16969117d5e5849d55025421a00c/triplets/decovar-x64-windows-static-md-clang.cmake">triplet</a> is simple enough:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">x64</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_PLATFORM_TOOLSET</span> <span style="color:#e6db74">ClangCL</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># otherwise these environment variables won&#39;t be available in the chainloaded toolchain
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_ENV_PASSTHROUGH_UNTRACKED</span> <span style="color:#e6db74">LLVMInstallDir</span> <span style="color:#e6db74">LLVMToolsVersion</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># finding and setting C/CXX compiler to Clang
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># this could do with a better path instead of ..
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_CHAINLOAD_TOOLCHAIN_FILE</span> <span style="color:#f92672">${</span>CMAKE_CURRENT_LIST_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/../toolchains/windows-clang.cmake</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># on Windows VCPKG_CHAINLOAD_TOOLCHAIN_FILE deactivates automatic VS variables, so those need to be loaded again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_LOAD_VCVARS_ENV</span> <span style="color:#e6db74">1</span>)</span></span></code></pre></div>
<p>Its main purpose is to chainload a custom toolchain, which will set Clang as compiler(s). You can take any other default triplet as a base and just add this chainloading there.</p>
<p>The toolchain, on the other hand, is far from being simple. While the essential thing that it does is &ldquo;just&rdquo; setting <code>CMAKE_C_COMPILER</code> and <code>CMAKE_CXX_COMPILER</code> to the discovered Clang executable, there are several other things that need to be taken care of, such as setting C/C++ standards and compiler/linker flags, some of which are necessary for successful compilation of certain sources.</p>
<p>I would have never figured out the full set on my own, but luckily I&rsquo;ve stumbled upon <a href="https://github.com/Neumann-A/my-vcpkg-triplets">this repository</a>, which seems to be all about using Clang with vcpkg in various combinations. The degree of customization and overriding stuff there seems to be rather overcomplicated, or at least it is so for my low ICQ. <em>Так что я ещё ничего, а вот у парняги реально беды с башкой, при всём уважении, и спасибо ему что он есть, мощный тип.</em></p>
<p>I took <a href="https://github.com/Neumann-A/my-vcpkg-triplets/blob/284e937f98f20fe1b35915f3c63c5b4550f55918/x64-win-llvm/x64-win-llvm.toolchain.cmake">this toolchain of his</a> as a base, removed a lot of stuff from it, which I <del>thought was redundant</del> didn&rsquo;t understand the purpose of, and combined it with default Microsoft&rsquo;s <a href="https://github.com/microsoft/vcpkg/blob/8b04a7bd93bef991818fc372bb83ce00ec1c1c16/scripts/toolchains/windows.cmake">Windows toolchain</a>. The resulting toolchain is published <a href="https://github.com/retifrav/vcpkg-registry/blob/895dac39caca16969117d5e5849d55025421a00c/toolchains/windows-clang.cmake">in my registry</a>.</p>
<p>The most important part of this toolchain is setting the compiler(s):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_program(<span style="color:#e6db74">CLANG_CL_EXECUTBALE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">NAMES</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;clang-cl&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;clang-cl.exe&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PATHS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">ENV</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">LLVMInstallDir</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PATH_SUFFIXES</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;bin&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># it is found exactly in default paths, as I am not passing LLVMInstallDir,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># but if you will, then uncomment this
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#NO_DEFAULT_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_C_COMPILER</span> <span style="color:#e6db74">&#34;${CLANG_CL_EXECUTBALE}&#34;</span> <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CMAKE_CXX_COMPILER</span> <span style="color:#e6db74">&#34;${CLANG_CL_EXECUTBALE}&#34;</span> <span style="color:#e6db74">CACHE</span> <span style="color:#e6db74">STRING</span> <span style="color:#e6db74">&#34;&#34;</span>)</span></span></code></pre></div>
<p>But like I said, setting flags is also important, so I&rsquo;d recommend you to take a look at the full toolchain.</p>
<p>The whole thing to configure and build the project now becomes this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> call d<span style="color:#66d9ef">:</span><span style="color:#66d9ef">\path\to\visual-studio\VC\Auxiliary\Build\vcvars64.bat</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cd d<span style="color:#66d9ef">:</span><span style="color:#66d9ef">\path\to\some\project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> mkdir build
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cd build
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cmake <span style="color:#f92672">-</span>G <span style="color:#a6e22e">Ninja</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_BUILD_TYPE</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_C_COMPILER</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/llvm/bin/clang-cl.exe&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_CXX_COMPILER</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/llvm/bin/clang-cl.exe&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%VCPKG_ROOT%/scripts/buildsystems/vcpkg.cmake&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_OVERLAY_TRIPLETS</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/custom/triplets&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;decovar-x64-windows-static-md-clang&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span></span></span></code></pre></div>
<p>You&rsquo;ll probably also need to set <code>LLVMInstallDir</code> environment variable, just to be sure that vcpkg gets to use the same Clang version for building dependencies as the one you&rsquo;ve set for the project. But then for this to work you&rsquo;d need to uncomment <code>NO_DEFAULT_PATH</code> of Clang executable discovery in the toolchain.</p>
<p>Or, if you installed Clang via Visual Studio Installer, then just use the <code>-T</code> variant instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> call d<span style="color:#66d9ef">:</span><span style="color:#66d9ef">\path\to\visual-studio\VC\Auxiliary\Build\vcvars64.bat</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cd d<span style="color:#66d9ef">:</span><span style="color:#66d9ef">\path\to\some\project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> mkdir build
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cd build
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 17 2022&#34;</span> <span style="color:#f92672">-</span>T <span style="color:#e6db74">&#34;ClangCL&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_TOOLCHAIN_FILE</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%VCPKG_ROOT%/scripts/buildsystems/vcpkg.cmake&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_OVERLAY_TRIPLETS</span><span style="color:#66d9ef">:</span><span style="color:#66d9ef">PATH</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d:/path/to/custom/triplets&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">DVCPKG_TARGET_TRIPLET</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;decovar-x64-windows-static-md-clang&#34;</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span></span></span></code></pre></div>
<p>Then there will be no need to set <code>LLVMInstallDir</code> (<em>and no need to uncomment <code>NO_DEFAULT_PATH</code></em>).</p>
<h4 id="lzma-fails-without-avx2-intrinsics">LZMA fails without AVX2 intrinsics</h4>
<p>Not strictly related to vcpkg, but still related. As soon as I&rsquo;ve set Clang for building vcpkg-resolved dependencies, one of them - <a href="https://7-zip.org/sdk.html">LZMA</a> - failed to build.</p>
<p>I&rsquo;ve fetched its sources and tried to build it separately with MSVC, and that still succeeded. But building with Clang was failing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">LzFind</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">641</span>,<span style="color:#ae81ff">3</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">use</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">undeclared</span> <span style="color:#a6e22e">identifier</span> <span style="color:#e6db74">&#39;__m256i&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LzFind</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">646</span>,<span style="color:#ae81ff">5</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">expected</span> <span style="color:#a6e22e">expression</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LzFind</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">630</span>,<span style="color:#ae81ff">33</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">expanded</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">macro</span> <span style="color:#e6db74">&#39;SASUB_256&#39;</span></span></span></code></pre></div>
<p>It turned out that building this project with Clang requires setting <code>/arch:AVX2</code> C flag. Why this is not required when building with MSVC - that I don&rsquo;t know, and I don&rsquo;t see that flag being set in the default Windows vcpkg toolchain either. Also surprisingly, building LZMA on Mac OS with Clang doesn&rsquo;t have this problem either.</p>
<p>I wasn&rsquo;t sure if it is a good idea to set this flag in the toolchain, so I decided to set it in the LZMA&rsquo;s <code>CMakeLists.txt</code> and make it a port feature - here&rsquo;s the <a href="https://github.com/retifrav/vcpkg-registry/commit/a68f46f939b782fc609ef4ed144f4630d3ab980c">commit</a> with this change.</p>
<h2 id="gnulinux">GNU/Linux</h2>
<h3 id="missing-executable-attribute">Missing executable attribute</h3>
<p>Trying to build <a href="https://en.wikipedia.org/wiki/Iconv">iconv</a> port on GNU/Linux I got the following rather unexpected error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/bin/bash: ./../src/133172cac4-7cae2f41cd.clean/configure: Permission denied</span></span></code></pre></div>
<p>And indeed, the <code>configure</code> script doesn&rsquo;t have <code>x</code> attribute/mode, so it is not an executable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ ls -l /path/to/vcpkg/buildtrees/iconv/src/133172cac4-7cae2f41cd.clean | grep config
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> build build  <span style="color:#ae81ff">50810</span> Feb  <span style="color:#ae81ff">2</span> 14:09 config.h.in
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> build build <span style="color:#ae81ff">891440</span> Feb  <span style="color:#ae81ff">2</span> 14:09 configure
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> build build   <span style="color:#ae81ff">6087</span> Feb  <span style="color:#ae81ff">2</span> 14:09 configure.ac</span></span></code></pre></div>
<p>I don&rsquo;t know how is that this attribute is missing, and why I didn&rsquo;t get this problem on Mac OS, but to resolve this I had to to call <code>chmod</code> via <code>vcpkg_execute_build_process()</code> in the iconv portfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">VCPKG_HOST_IS_LINUX</span>) <span style="color:#75715e"># OR VCPKG_HOST_IS_OSX
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># on GNU/Linux (and Mac OS?) the configure script might(?) be not an executable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vcpkg_execute_build_process(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">chmod</span> <span style="color:#e6db74">+x</span> <span style="color:#e6db74">./configure</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#f92672">${</span>SOURCE_PATH<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">LOGNAME</span> <span style="color:#e6db74">config-</span><span style="color:#f92672">${</span>PORT<span style="color:#f92672">}</span><span style="color:#e6db74">-</span><span style="color:#f92672">${</span>TARGET_TRIPLET<span style="color:#f92672">}</span><span style="color:#e6db74">-chmod</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_configure_make(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">SOURCE_PATH</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)</span></span></code></pre></div>
<h2 id="ios">iOS</h2>
<h3 id="combinedfatuniversal-binaries-for-devices-and-simulator">Combined/fat/universal binaries for devices and simulator</h3>
<p>One of our build configurations produces so-called combined/fat/universal binaries for iOS - arm64 for actual devices and x86_64 for simulator - and so vcpkg-managed dependencies also need to be built as such.</p>
<p>To tell CMake to build a universal device/simulator binary one needs to set the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>set(CMAKE_OSX_ARCHITECTURES <span style="color:#e6db74">&#34;arm64;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_ARCHS[sdk<span style="color:#f92672">=</span>iphoneos<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;arm64&#34;</span>)
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_VALID_ARCHS[sdk<span style="color:#f92672">=</span>iphoneos<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;arm64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_ARCHS[sdk<span style="color:#f92672">=</span>iphonesimulator<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_VALID_ARCHS[sdk<span style="color:#f92672">=</span>iphonesimulator<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;x86_64&#34;</span>)</span></span></code></pre></div>
<p>And as usual (<em>as you saw in previous sections</em>), to apply these to every vcpkg-managed build you&rsquo;ll need to chainload a <a href="https://github.com/retifrav/vcpkg-registry/blob/d44a8d0eaab7d60f0a31b8e75d5cd6a241711eff/toolchains/ios-fat.cmake">custom toolchain</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># for $ENV{VCPKG_ROOT} to work the triplet should contain `set(VCPKG_ENV_PASSTHROUGH_UNTRACKED VCPKG_ROOT)`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include(<span style="color:#e6db74">&#34;$ENV{VCPKG_ROOT}/scripts/toolchains/ios.cmake&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to make a Mach-O combined/fat/universal binary, one needs to set both architectures
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(CMAKE_OSX_ARCHITECTURES <span style="color:#e6db74">&#34;arm64;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and set Xcode attributes to specify which architecture is for actual devices
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(CMAKE_XCODE_ATTRIBUTE_ARCHS[sdk<span style="color:#f92672">=</span>iphoneos<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;arm64&#34;</span>)
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_VALID_ARCHS[sdk<span style="color:#f92672">=</span>iphoneos<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;arm64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and which architecture is for simulator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(CMAKE_XCODE_ATTRIBUTE_ARCHS[sdk<span style="color:#f92672">=</span>iphonesimulator<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span>set(CMAKE_XCODE_ATTRIBUTE_VALID_ARCHS[sdk<span style="color:#f92672">=</span>iphonesimulator<span style="color:#f92672">*</span>] <span style="color:#e6db74">&#34;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and probably also set these flags
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_IOS_INSTALL_COMBINED 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#set(CMAKE_XCODE_ATTRIBUTE_ONLY_ACTIVE_ARCH 0)</span></span></span></code></pre></div>
<p>from a <a href="https://github.com/retifrav/vcpkg-registry/blob/d44a8d0eaab7d60f0a31b8e75d5cd6a241711eff/triplets/decovar-arm64-ios-fat.cmake">custom triplet</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>set(<span style="color:#e6db74">VCPKG_TARGET_ARCHITECTURE</span> <span style="color:#e6db74">arm64</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CRT_LINKAGE</span> <span style="color:#e6db74">dynamic</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_LIBRARY_LINKAGE</span> <span style="color:#e6db74">static</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">VCPKG_CMAKE_SYSTEM_NAME</span> <span style="color:#e6db74">iOS</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># without this the VCPKG_ROOT environment variable won&#39;t be available in the chainloaded toolchain
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_ENV_PASSTHROUGH_UNTRACKED</span> <span style="color:#e6db74">VCPKG_ROOT</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># setting Xcode attributes for specifying device/simulator architectures
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(<span style="color:#e6db74">VCPKG_CHAINLOAD_TOOLCHAIN_FILE</span> <span style="color:#f92672">${</span>CMAKE_CURRENT_LIST_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/../toolchains/ios-fat.cmake</span>)</span></span></code></pre></div>
<p>And actually you could probably get away without using a chainloaded toolchain, because you can <a href="https://github.com/retifrav/vcpkg-registry/commit/dd75fdfa5980336891b612654f59c9788079a76c">move</a> <code>CMAKE_OSX_ARCHITECTURES</code> from toolchain to triplet&rsquo;s <code>VCPKG_OSX_ARCHITECTURES</code> variable. But I suspect that <code>CMAKE_XCODE_ATTRIBUTE_*</code> variables still need to be set, and in that case toolchain isn&rsquo;t going away.</p>
<p>Anyway, both variants seem to work equally fine, and to show it in action, if I build my <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/thingy">Thingy</a> port with default <code>arm64-ios</code> triplet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet arm64<span style="color:#f92672">-</span>ios</span></span></code></pre></div>
<p>then here&rsquo;s the binary I will get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>h <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8.0</span>K    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ otool <span style="color:#f92672">-</span>hv <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Archive</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/arm64-ios/lib/libThingy.a</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a<span style="color:#f92672">(</span>thingy<span style="color:#f92672">.</span>cpp<span style="color:#f92672">.</span>o<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Mach</span> <span style="color:#66d9ef">header</span>
</span></span><span style="display:flex;"><span>      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MH_MAGIC_64</span>    <span style="color:#a6e22e">ARM64</span>        <span style="color:#a6e22e">ALL</span>  <span style="color:#ae81ff">0x00</span>      <span style="color:#a6e22e">OBJECT</span>     <span style="color:#ae81ff">5</span>        <span style="color:#ae81ff">776</span> <span style="color:#a6e22e">SUBSECTIONS_VIA_SYMBOLS</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Non</span><span style="color:#f92672">-</span>fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/arm64-ios/lib/libThingy.a</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">architecture:</span> <span style="color:#66d9ef">arm64</span></span></span></code></pre></div>
<p>And if I build it with my custom <code>decovar-arm64-ios-fat</code> triplet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>triplets <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>triplets</span></span></code></pre></div>
<p>then this is the binary I will get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>h <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">12</span>K    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ otool <span style="color:#f92672">-</span>hv <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Archive</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libThingy.a</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">architecture</span> <span style="color:#66d9ef">x86_64</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libThingy.a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">thingy.cpp.o</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">architecture</span> <span style="color:#66d9ef">x86_64</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mach</span> header
</span></span><span style="display:flex;"><span>      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MH_MAGIC_64</span>   X86_64        <span style="color:#a6e22e">ALL</span>  <span style="color:#ae81ff">0x00</span>      <span style="color:#a6e22e">OBJECT</span>     <span style="color:#ae81ff">4</span>        <span style="color:#ae81ff">840</span> <span style="color:#a6e22e">SUBSECTIONS_VIA_SYMBOLS</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Archive</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libThingy.a</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">architecture</span> <span style="color:#66d9ef">arm64</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libThingy.a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">thingy.cpp.o</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">architecture</span> <span style="color:#66d9ef">arm64</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Mach</span> header
</span></span><span style="display:flex;"><span>      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MH_MAGIC_64</span>    <span style="color:#a6e22e">ARM64</span>        <span style="color:#a6e22e">ALL</span>  <span style="color:#ae81ff">0x00</span>      <span style="color:#a6e22e">OBJECT</span>     <span style="color:#ae81ff">5</span>        <span style="color:#ae81ff">776</span> <span style="color:#a6e22e">SUBSECTIONS_VIA_SYMBOLS</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Architectures</span> in the fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libThingy.a</span> <span style="color:#66d9ef">are:</span> <span style="color:#66d9ef">x86_64</span> <span style="color:#66d9ef">arm64</span></span></span></code></pre></div>
<p>For vcpkg this build probably &ldquo;looks&rdquo; like <code>arm64</code>, because <code>VCPKG_TARGET_ARCHITECTURE</code> is set to <code>arm64</code> in the triplet, but what exactly that entitles I don&rsquo;t know, and according to <code>lipo</code> the binaries are indeed combined/fat/universal ones.</p>
<h4 id="merging-different-architectures-into-one-universal-binary">Merging different architectures into one universal binary</h4>
<p>I also saw <a href="https://www.f-ax.de/dev/2022/11/09/how-to-use-vcpkg-with-universal-binaries-on-macos/">this blog post</a>, where the author says that vcpkg doesn&rsquo;t support building libraries as universal binaries, and then he suggests a workaround of building a library using different triplets and &ldquo;merging&rdquo; the results into one universal binary. It might be that in 2022-11-09 there was something different about the process, but as you can see vcpkg can in fact handle the scenario of producing fat binaries.</p>
<p>If anything, the essence of his post is that you can use the very same <code>lipo</code> utility to create a universal binary out of different single-architecture binaries, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libzstd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Non</span><span style="color:#f92672">-</span>fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/arm64-ios/lib/libzstd.a</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">architecture:</span> <span style="color:#66d9ef">arm64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>x64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libzstd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Non</span><span style="color:#f92672">-</span>fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/x64-ios/lib/libzstd.a</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">architecture:</span> <span style="color:#66d9ef">x86_64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>create \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libzstd<span style="color:#f92672">.</span>a \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>x64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libzstd<span style="color:#f92672">.</span>a \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>output <span style="color:#f92672">./</span>libzstd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>libzstd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Architectures</span> in the fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./libzstd.a</span> <span style="color:#66d9ef">are:</span> <span style="color:#66d9ef">x86_64</span> <span style="color:#66d9ef">arm64</span></span></span></code></pre></div>
<p>Another thing to note is that author is describing building a universal binary for Mac OS (<em>Intel/ARM</em>), and I am here dealing with iOS (<em>device/simulator</em>), so just to make sure that there is no difference I tried to do the same <a href="#universal-binaries">for Mac OS</a> as well.</p>
<h4 id="jpeg-turbo-doesnt-support-building-with-more-than-one-architecture">jpeg-turbo doesn&rsquo;t support building with more than one architecture</h4>
<p>All our dependencies were building fine as fat binaries, until <a href="https://libjpeg-turbo.org">jpeg-turbo</a> build had failed. Turns out, it <a href="https://github.com/libjpeg-turbo/libjpeg-turbo/issues/617#issuecomment-1246812411">doesn&rsquo;t support</a> building as universal binary, because it contains assembly code, and &ldquo;<em>different architectures require different SIMD extensions</em>&rdquo;.</p>
<p>And that is a problem, because how does one go about it? All the dependencies need to be built &ldquo;unattended&rdquo;, so they are made ready/available before the main project configuration starts. So it means that <code>jpeg-turbo</code> would require some special treatment, for example building it twice (<em>for each architecture</em>), merging it into one final universal binary using <code>lipo</code> (<em>like it is described <a href="#merging-different-architectures-into-one-universal-binary">above</a></em>), and then some more fucking about to automate the process and make it a part of the normal pre-configuration routine.</p>
<p>Fortunately, before diving into all that, I just tried to simply <a href="https://github.com/retifrav/vcpkg-registry/commit/5e33f3be94767a152d545f99053c1b2b3c7f238e#diff-feb82cabe52a5c61d1b4e00f58bf6a43dd95c77a49922da3ab52184f68032d3dR24">disable that check</a>, and the build went fine, because apparently this target platform does not use assembly code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">CMake</span> <span style="color:#a6e22e">Warning</span> at simd<span style="color:#f92672">/</span><span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">5</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">message</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SIMD</span> extensions not available <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">CPU</span> <span style="color:#f92672">(</span>aarch64<span style="color:#f92672">).</span>  <span style="color:#a6e22e">Performance</span> will
</span></span><span style="display:flex;"><span>  suffer<span style="color:#f92672">.</span></span></span></code></pre></div>
<p>To make sure, just in case, I&rsquo;ve built it for single architecture:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet arm64<span style="color:#f92672">-</span>ios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>h <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">960</span>K    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Non</span><span style="color:#f92672">-</span>fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/arm64-ios/lib/libturbojpeg.a</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">architecture:</span> <span style="color:#66d9ef">arm64</span></span></span></code></pre></div>
<p>and then for combined architectures:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg install <span style="color:#f92672">--</span>triplet decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>triplets <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>triplets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ du <span style="color:#f92672">-</span>h <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.9</span>M    <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lipo <span style="color:#f92672">-</span>info <span style="color:#f92672">./</span>vcpkg_installed<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>ios<span style="color:#f92672">-</span>fat<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>libturbojpeg<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Architectures</span> in the fat file<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">./vcpkg_installed/decovar-arm64-ios-fat/lib/libturbojpeg.a</span> <span style="color:#66d9ef">are:</span> <span style="color:#66d9ef">x86_64</span> <span style="color:#66d9ef">arm64</span></span></span></code></pre></div>
<p>As you can see, it has successfully built into a combined/fat/universal binary. It may be that it will horribly backfire at some point later at application runtime, but it hasn&rsquo;t so far.</p>
<h2 id="mac-os">Mac OS</h2>
<h3 id="universal-binaries">Universal binaries</h3>
<p>As I mentioned in the section about combined/fat/universal binaries <a href="#combinedfatuniversal-binaries-for-devices-and-simulator">for iOS</a>, I wanted to try building universal binaries of vcpkg-resolved dependencies for Mac OS too (<em>for Intel and Apple silicon (ARM) based Macs</em>).</p>
<p>Applying the same &ldquo;trick&rdquo; with chainloaded toolchain didn&rsquo;t work:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>set(VCPKG_TARGET_ARCHITECTURE arm64)
</span></span><span style="display:flex;"><span>set(VCPKG_CRT_LINKAGE dynamic)
</span></span><span style="display:flex;"><span>set(VCPKG_LIBRARY_LINKAGE <span style="color:#66d9ef">static</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set(VCPKG_CMAKE_SYSTEM_NAME Darwin)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set(VCPKG_ENV_PASSTHROUGH_UNTRACKED VCPKG_ROOT)
</span></span><span style="display:flex;"><span>set(VCPKG_CHAINLOAD_TOOLCHAIN_FILE <span style="color:#960050;background-color:#1e0010">$</span>{CMAKE_CURRENT_LIST_DIR}<span style="color:#f92672">/</span>..<span style="color:#f92672">/</span>toolchains<span style="color:#f92672">/</span>osx<span style="color:#f92672">-</span>fat.cmake)</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>include(<span style="color:#e6db74">&#34;$ENV{VCPKG_ROOT}/scripts/toolchains/osx.cmake&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to make an Intel/ARM universal binary, one needs to set both architectures
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set(CMAKE_OSX_ARCHITECTURES <span style="color:#e6db74">&#34;arm64;x86_64&#34;</span>)</span></span></code></pre></div>
<p>as vcpkg still produced non-fat binaries containing only one architecture. Can&rsquo;t say why is that.</p>
<p>What did work is setting <code>VCPKG_OSX_ARCHITECTURES</code> in the <a href="https://github.com/retifrav/vcpkg-registry/blob/aa217cd20ca4c5f8037aa94274edaa5407c22392/triplets/decovar-arm64-osx-fat.cmake#L6">triplet</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>set(VCPKG_TARGET_ARCHITECTURE arm64)
</span></span><span style="display:flex;"><span>set(VCPKG_CRT_LINKAGE dynamic)
</span></span><span style="display:flex;"><span>set(VCPKG_LIBRARY_LINKAGE <span style="color:#66d9ef">static</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set(VCPKG_CMAKE_SYSTEM_NAME Darwin)
</span></span><span style="display:flex;"><span>set(VCPKG_OSX_ARCHITECTURES <span style="color:#e6db74">&#34;arm64;x86_64&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set(VCPKG_ENV_PASSTHROUGH_UNTRACKED VCPKG_ROOT)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># unlike fat iOS toolchain, this one has no effect (but `VCPKG_OSX_ARCHITECTURES` does)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#set(VCPKG_CHAINLOAD_TOOLCHAIN_FILE ${CMAKE_CURRENT_LIST_DIR}/../toolchains/osx-fat.cmake)</span></span></span></code></pre></div>
<p>and then vcpkg produced universal binaries, which I&rsquo;ve successfully tested on both M2 and Intel machines that I have.</p>
<p>So I thought, okay, probably chainloaded toolchain isn&rsquo;t needed at all, so I can just set <code>VCPKG_OSX_ARCHITECTURES</code> for the <a href="#combinedfatuniversal-binaries-for-devices-and-simulator">fat iOS</a> build too without chainloading. And yes, that worked, but just in case I <a href="https://github.com/retifrav/vcpkg-registry/commit/dd75fdfa5980336891b612654f59c9788079a76c">kept the toolchain</a> too, because it sets <code>CMAKE_XCODE_ATTRIBUTE_*</code> variables, and I have a feeling that these variables do mater.</p>
<h4 id="png-fails-to-generate-tf1">PNG fails to generate tf1</h4>
<p>It was all good until the <a href="https://github.com/retifrav/vcpkg-registry/tree/master/ports/png">PNG</a> build had failed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>clang<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">error:</span> <span style="color:#66d9ef">no</span> <span style="color:#66d9ef">such</span> <span style="color:#66d9ef">file</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">directory:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">x86_64</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CMake</span> <span style="color:#66d9ef">Error</span> <span style="color:#66d9ef">at</span> <span style="color:#66d9ef">scripts/genout.cmake:</span><span style="color:#960050;background-color:#1e0010">78</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">message</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Failed</span> to generate
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">/</span>buildtrees<span style="color:#f92672">/</span>png<span style="color:#f92672">/</span>decovar<span style="color:#f92672">-</span>arm64<span style="color:#f92672">-</span>osx<span style="color:#f92672">-</span>fat<span style="color:#f92672">-</span>dbg<span style="color:#f92672">/</span>scripts<span style="color:#f92672">/</span>symbols<span style="color:#f92672">.</span>out<span style="color:#f92672">.</span>tf1</span></span></code></pre></div>
<p>It originates here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>execute_process(<span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">&#34;${CMAKE_C_COMPILER}&#34;</span> <span style="color:#e6db74">&#34;-E&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">${</span>CMAKE_C_FLAGS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">${</span>PLATFORM_C_FLAGS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-I${SRCDIR}&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-I${BINDIR}&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">${</span>INCLUDES<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-DPNGLIB_LIBNAME=PNG${PNGLIB_MAJOR}${PNGLIB_MINOR}_0&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-DPNGLIB_VERSION=${PNGLIB_VERSION}&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-DSYMBOL_PREFIX=${SYMBOL_PREFIX}&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-DPNG_NO_USE_READ_MACROS&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;-DPNG_BUILDING_SYMBOL_TABLE&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">${</span>PNG_PREFIX_DEF<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;${INPUT}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">OUTPUT_FILE</span> <span style="color:#e6db74">&#34;${OUTPUT}.tf1&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#e6db74">&#34;${BINDIR}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">RESULT_VARIABLE</span> <span style="color:#e6db74">CPP_FAIL</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">CPP_FAIL</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;Failed to generate ${OUTPUT}.tf1&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()</span></span></code></pre></div>
<p>So apparently it can&rsquo;t handle <code>arm64;x86_64</code> value.</p>
<p>At the same time, surprisingly, that very same PNG project didn&rsquo;t fail when I was building fat binaries <a href="#combinedfatuniversal-binaries-for-devices-and-simulator">for iOS</a>. I can&rsquo;t think of other reason than different <code>CMAKE_OSX_SYSROOT</code> values: for iOS it was <code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS17.0.sdk</code>, and the build succeeded, but for Mac OS it is <code>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX14.0.sdk</code>, and the build fails. If anything, both iOS and Mac OS builds got the same <code>&quot;arm64;x86_64&quot;</code> value for <code>CMAKE_OSX_ARCHITECTURES</code>.</p>
<p>No idea how to fix it yet, so for now I&rsquo;m just building PNG separately with a single-architecture triplet of interest (<em>and <a href="#merging-different-architectures-into-one-universal-binary">merging the results</a> into a universal binary, when needed</em>).</p>
<h1 id="dependency-graph">Dependency graph</h1>
<p>Conan has a convenient out-of-the-box functionality for generating a <a href="/blog/2022/02/06/cpp-dependencies-with-conan/#dependency-graph">dependency graph</a>, both as a plain-text JSON file and as an interactive HTML page.</p>
<p>The vcpkg&rsquo;s capabilities in that regard are rather modest in comparison. It has a <a href="https://learn.microsoft.com/en-us/vcpkg/commands/depend-info">depend-info</a> command, which can list dependencies either in a somewhat structured plain-text format or in two graph formats: <a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language)">DOT</a> and <a href="https://en.wikipedia.org/wiki/DGML">DGML</a>. Neither of these formats can be customized, and all of them output just port names (<em>no version, license or any other information</em>).</p>
<p>Furthermore, when it comes to graphs, it is still your responsibility to visualize them (<em>with <a href="https://graphviz.org">Graphviz</a> or some other tool</em>), as vcpkg only produces the text representation. For example, let&rsquo;s use the DOT format to build a dependency graph for that project <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/#in-a-project">from before</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg depend<span style="color:#f92672">-</span>info glfw<span style="color:#f92672">-</span>imgui<span style="color:#f92672">-</span>example \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>ports<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>project \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>ports<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>ports \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>dot <span style="color:#f92672">|</span> nop <span style="color:#f92672">&gt;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>Here the first <code>--overlay-ports</code> path points to the project folder (<em>that contains the project&rsquo;s <code>vcpkg.json</code> manifest</em>) and the second <code>--overlay-ports</code> path points to a local clone of my registry. Note that I still needed to provide the <code>glfw-imgui-example</code> project name. The piped <code>nop</code> utility is a part of Graphviz tools and what it does is it formats the graph text into a nicer readable representation.</p>
<p>If I wanted to build a graph not for a project but for a port from registry, then I would&rsquo;ve invoked the command with just one <code>--overlay-ports</code> path, like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg depend<span style="color:#f92672">-</span>info some<span style="color:#f92672">-</span>port \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>ports<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>ports \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>dot <span style="color:#f92672">|</span> nop <span style="color:#f92672">&gt;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>But I don&rsquo;t yet have ports with a lot of dependencies in my registry, so let&rsquo;s continue with the project graph.</p>
<p>The contents of the generated (<em>and formatted</em>) <code>graph.dot</code> are this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">digraph</span> <span style="color:#a6e22e">G</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">graph</span> [<span style="color:#a6e22e">overlap</span><span style="color:#f92672">=</span><span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">rankdir</span><span style="color:#f92672">=</span><span style="color:#a6e22e">LR</span>
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">edge</span> [<span style="color:#a6e22e">minlen</span><span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dearimgui</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">decovar_vcpkg_cmake</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dearimgui</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">glfw</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dearimgui</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dearimgui</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake_config</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glfw</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glfw</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake_config</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glad</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glad</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">vcpkg_cmake_config</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glfw_imgui_example</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">dearimgui</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glfw_imgui_example</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">glfw</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glfw_imgui_example</span> <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">glad</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">empty</span>    [<span style="color:#a6e22e">label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;3 singletons...&#34;</span>];
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>That can be visualized with Graphviz like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ dot <span style="color:#f92672">-</span>T svg <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#a6e22e">Nfontcolor</span><span style="color:#66d9ef">=</span>blue <span style="color:#f92672">-</span><span style="color:#a6e22e">Nshape</span><span style="color:#66d9ef">=</span>rect <span style="color:#f92672">-</span><span style="color:#a6e22e">Grankdir</span><span style="color:#66d9ef">=</span><span style="color:#a6e22e">TB</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">Gsplines</span><span style="color:#66d9ef">=</span>ortho \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>o <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>svg</span></span></code></pre></div>
<p>The result will look like this:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/graph-unprocessed.svg" alt="Graphviz, unprocessed dot-graph of vcpkg dependencies">

<p>So it works, but the visualization could benefit from some improvements, such as removing redundant elements and adding some different colors/accents. To automate the process, modifications in the <code>graph.dot</code> can be done using regular expressions, and for that purpose it would probably be better to re-generate the <code>graph.dot</code> without formatting (<em>without piping to <code>nop</code></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ vcpkg depend<span style="color:#f92672">-</span>info glfw<span style="color:#f92672">-</span>imgui<span style="color:#f92672">-</span>example \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>ports<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>project \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>overlay<span style="color:#f92672">-</span>ports<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>vcpkg<span style="color:#f92672">-</span>registry<span style="color:#f92672">/</span>ports \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>dot <span style="color:#f92672">&gt;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>First thing to get rid of is the &ldquo;<em>3 singletons&hellip;</em>&rdquo; label (<em>the fuck is that, I didn&rsquo;t ask for it</em>). It can be removed with <code>sed</code> (<em>or <code>gsed</code>, in case of Mac OS</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ sed <span style="color:#f92672">-</span>i <span style="color:#e6db74">&#39;s/empty \[label=&#34;[[:digit:]]\+ singletons\.\{3\}&#34;\];//&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>but actually, <code>sed</code> and its crazy regular expressions flavor can go to hell, so do it with Perl instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/empty \[label=&#34;\d+ singletons\.{3}&#34;\];//&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>Next thing you might want to do is to remove helper ports, because they are not actual C++ dependencies, and also every single port depends on them, so they only add noise to the graph, which becomes a bigger problem on bigger graphs. Either remove them one by one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/[\w]+ -&gt; vcpkg_cmake;//g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot
</span></span><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/[\w]+ -&gt; vcpkg_cmake_config;//g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot
</span></span><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/[\w]+ -&gt; decovar_vcpkg_cmake;//g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>or all at once, if they have a common part in their names:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/[\w]+ -&gt; (decovar_)?vcpkg_cmake(_config)?;//g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>Finally, let&rsquo;s color connections to direct dependencies with blue color, and connections to transitive dependencies will be dashed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/(glfw_imgui_example -&gt; .+?(?=;))/$1 [color=blue]/g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot
</span></span><span style="display:flex;"><span>$ perl <span style="color:#f92672">-</span>pi <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;s/((?!glfw_imgui_example\b)\b\w+ -&gt; .+?(?=;))/$1 [style=dashed]/g&#39;</span> <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>dot</span></span></code></pre></div>
<p>Now the visualized graph will look like this:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/graph-processed.svg" alt="Graphviz, processed dot-graph of vcpkg dependencies">

<p>Much cleaner, isn&rsquo;t it. Although, still not as good as what Conan provides (<em>via a single command without additional massaging</em>), but more or less an okay result.</p>
<p>One last thing to note is that on the graph above the <code>glfw</code> port is both a direct and a transitive dependency (<em>through <code>dearimgui</code></em>), so perhaps the point of having differently styled connections to transitive dependencies isn&rsquo;t very clear. But here&rsquo;s a graph for a bigger project:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/graph-bigger-port.svg" alt="Graphviz, dot-graph with more dependencies">

<p>And here we have (<em>just one but nevertheless</em>) a &ldquo;purely&rdquo; transitive dependency - <code>brotli</code> (<em>through <code>cpp_http</code></em>), which is easier to spot thanks to a dashed black connection and no solid blue connections comming to it.</p>
<h1 id="distributing-your-project">Distributing your project</h1>
<p>If your project is meant to be distributed, meaning that you have libraries in it, which your customers/users will be linking to in their projects, then you need to <a href="/blog/2023/07/22/cmake-target-link-libraries-scopes/#so-when-do-i-need-to-deliver-3rd-party-dependencies-to-my-customers">deliver your dependencies</a> together with your project installation.</p>
<p>With <a href="https://github.com/retifrav/vcpkg-registry/tree/bf55caff21bd94659d3764b4fbf11d54c805ca31/examples/installing-vcpkg-artifacts/prjct">this project</a> as an example, after its dependencies are resolved with vcpkg and the project itself is built and installed, the folders structure would look like this (<em>in Release configuration</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">--</span>dirsfirst <span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> build
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> vcpkg_installed
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> arm64<span style="color:#f92672">-</span>osx
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> debug
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> nlohmann
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> json<span style="color:#f92672">-</span>nlohmann
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> nlohmann_json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> info
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> json<span style="color:#f92672">-</span>nlohmann_3<span style="color:#f92672">.</span><span style="color:#ae81ff">11.2</span><span style="color:#a6e22e">_arm64</span><span style="color:#f92672">-</span>osx<span style="color:#f92672">.</span>list
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> thingy_0<span style="color:#f92672">.</span><span style="color:#ae81ff">9.1</span><span style="color:#a6e22e">_arm64</span><span style="color:#f92672">-</span>osx<span style="color:#f92672">.</span>list
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config_2022<span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#a6e22e">_arm64</span><span style="color:#f92672">-</span>osx<span style="color:#f92672">.</span>list
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>cmake_2023<span style="color:#f92672">-</span><span style="color:#ae81ff">05</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#a6e22e">_arm64</span><span style="color:#f92672">-</span>osx<span style="color:#f92672">.</span>list
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> updates
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>lock<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeCache</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> build<span style="color:#f92672">.</span>ninja
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> cmake_install<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> install_manifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>manifest<span style="color:#f92672">-</span>install<span style="color:#f92672">.</span>log
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> install
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> bin
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libSomeLibrary<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>               <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>               <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>               <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>               <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> src
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> some
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Config</span><span style="color:#f92672">.</span>cmake<span style="color:#f92672">.</span>in
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>cpp
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> tool
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> main<span style="color:#f92672">.</span>cpp
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakePresets</span><span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>configuration<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>If you are building your dependencies as part of your project (<em>or/and if you are vendoring them</em>), then most likely you can just pack the <code>./install</code> folder and distribute that package, and it will be enough for consuming projects (<em>as they would only need to set the path to your project package in <code>CMAKE_PREFIX_PATH</code></em>). But here such a package would be missing dependencies that were installed by vcpkg into <code>vcpkg_installed/target-triplet</code>, in particular the <code>Thingy</code> library will be missing, and so your customers/users will get the following error trying to configure their projects:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>CMake Error at <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span>version<span style="color:#f92672">/</span>share<span style="color:#f92672">/</span>cmake<span style="color:#f92672">/</span>Modules<span style="color:#f92672">/</span>CMakeFindDependencyMacro.cmake:<span style="color:#ae81ff">76</span> (find_package)<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  Could not find a package configuration file provided by <span style="color:#e6db74">&#34;Thingy&#34;</span> with any
</span></span><span style="display:flex;"><span>  of the following names:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ThingyConfig.cmake
</span></span><span style="display:flex;"><span>    thingy<span style="color:#f92672">-</span>config.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Add the installation prefix of <span style="color:#e6db74">&#34;Thingy&#34;</span> to CMAKE_PREFIX_PATH or set
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Thingy_DIR&#34;</span> to a directory containing one of the above files.  If <span style="color:#e6db74">&#34;Thingy&#34;</span>
</span></span><span style="display:flex;"><span>  provides a separate development package or SDK, be sure it has been
</span></span><span style="display:flex;"><span>  installed.</span></span></code></pre></div>
<p>So you need to merge <code>vcpkg_installed/target-triplet</code> into your project installation folder. There is no out-of-the-box function for this (<em>I didn&rsquo;t fine one</em>), but I guess this is only because the task is actually very trivial: you just need to copy the entire folder. For example, with <code>cp</code>:</p>
<details>
    <summary>Contents of the installation prefix before</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">./</span>install<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> bin
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libSomeLibrary<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake</span></span></code></pre></div>
</details>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cp -an <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    ./build/vcpkg-default-triplet/vcpkg_installed/arm64-osx/* <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    ./install/vcpkg-default-triplet/</span></span></code></pre></div>
<details>
    <summary>Contents of the installation prefix after</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">./</span>install<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> bin
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> debug
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> libThingyd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> thingy<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> nlohmann
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> adl_serializer<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> byte_container_with_subtype<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> detail
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> abi_macros<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conversions
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> from_json<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> to_chars<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> to_json<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> exceptions<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> hash<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> input
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> binary_reader<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> input_adapters<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> json_sax<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> lexer<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> parser<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> position_t<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> iterators
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> internal_iterator<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> iter_impl<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> iteration_proxy<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> iterator_traits<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> json_reverse_iterator<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> primitive_iterator<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> json_pointer<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> json_ref<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> macro_scope<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> macro_unscope<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> meta
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> call_std
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> begin<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> end<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> cpp_future<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> detected<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> identity_tag<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> is_sax<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> std_fs<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> type_traits<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> void_t<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> output
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> binary_writer<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> output_adapters<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> serializer<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> string_concat<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> string_escape<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> value_t<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> json<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> json_fwd<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> ordered_map<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> thirdparty
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> hedley
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>               <span style="color:#f92672">├──</span> hedley<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>               <span style="color:#f92672">└──</span> hedley_undef<span style="color:#f92672">.</span>hpp
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> libSomeLibrary<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">-</span>debug<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> json<span style="color:#f92672">-</span>nlohmann
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> nlohmann_json
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> nlohmann_jsonConfig<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> nlohmann_jsonConfigVersion<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> nlohmann_jsonTargets<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>port<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg_cmake_build<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> vcpkg_cmake_configure<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> vcpkg_cmake_install<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>cmake<span style="color:#f92672">-</span>config
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">-</span>port<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> vcpkg_cmake_config_fixup<span style="color:#f92672">.</span>cmake</span></span></code></pre></div>
</details>
<p>or with <code>tar</code>, if <code>cp</code> doesn&rsquo;t do the job for some reasons:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ <span style="color:#f92672">(</span>cd ./build/vcpkg-default-triplet/vcpkg_installed/arm64-osx <span style="color:#f92672">&amp;&amp;</span> tar -c .<span style="color:#f92672">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    | <span style="color:#f92672">(</span>cd ./install/vcpkg-default-triplet <span style="color:#f92672">&amp;&amp;</span> tar -xf -<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>And then you will have both the project libraries and their dependencies inside the same prefix, so you&rsquo;ll be able to just pack it and ship to your customers/users.</p>
<p>But, as usual, there is a but. As you can see in the merged installation prefix listing, it contains <code>vcpkg-cmake</code> and <code>vcpkg-cmake-config</code> helper ports, which are of no use for consuming projects; and also it contains <code>json-nlohmann</code> dependency, which is used for building the project&rsquo;s executable <a href="https://github.com/retifrav/vcpkg-registry/blob/bf55caff21bd94659d3764b4fbf11d54c805ca31/examples/installing-vcpkg-artifacts/prjct/src/tool/CMakeLists.txt#L21">some-tool</a>, but isn&rsquo;t used for building the project&rsquo;s library <a href="https://github.com/retifrav/vcpkg-registry/blob/bf55caff21bd94659d3764b4fbf11d54c805ca31/examples/installing-vcpkg-artifacts/prjct/src/some/CMakeLists.txt">SomeLibrary</a>. So including those into the final package is redundant, as end user does not need them to be available for his project to link to yours.</p>
<p>It might be not worth to bother about this, but that&rsquo;s only untill you encounter some ridiculously big dependencies (<em>more than 3 GB of binaries in <a href="https://www.datakit.com/">Datakit</a> package on Windows</em>) or just retarded ones (<em>more than 12 000 of header files in <a href="https://gisinternals.com/archive.php">GDAL</a> package</em>). So you most certainly would like to exclude some dependencies from your package, if they are only used for building executables and not libraries.</p>
<p>Filtering out artifacts of vcpkg-resolved dependencies could have been a challenging task, as one would need to establish which files came from which port, but fortunately vcpkg keeps track of installed artifacts in <code>./build/vcpkg-default-triplet/vcpkg_installed/vcpkg/info/*.list</code> files, making the procedure rather simple. At the same time, certain artifacts you probably would like to keep (<em>such as DLLs</em>), so you&rsquo;ll need to handle such exceptions somehow.</p>
<p>To automate the process of merging installations, filtering blacklisted dependencies and handling exceptions, I first wrote a <a href="https://github.com/retifrav/vcpkg-registry/blob/3b01d0a5c832aa633ebbf059cd6222f7234970de/scripts/install-vcpkg-artifacts.sh">Bash script</a>, but it was deleting files one by one, and in case of GDAL&rsquo;s more-than-12-000-headers deleting all of them was taking about 10 minutes, which is too goddamn slow. Trying to optimize the operation has overcomplicated the script beyond maintainability, so I rewrote it <a href="https://github.com/retifrav/vcpkg-registry/blob/5273c3f0bcdfeeb8b085b324a63e747a9cbc8a6c/scripts/install-vcpkg-artifacts.py">in Python</a>. Here&rsquo;s how to use it:</p>
<details>
    <summary>Contents of the installation prefix before</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">./</span>install<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> bin
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libSomeLibrary<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake</span></span></code></pre></div>
</details>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ python <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>install<span style="color:#f92672">-</span>vcpkg<span style="color:#f92672">-</span>artifacts<span style="color:#f92672">.</span>py \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>cmake<span style="color:#f92672">-</span>preset vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>vcpkg<span style="color:#f92672">-</span>triplet arm64<span style="color:#f92672">-</span>osx \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>blacklist <span style="color:#e6db74">&#34;vcpkg-cmake,json-nlohmann&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">vcpkg-cmake</span><span style="color:#f92672">]*</span> <span style="color:#f92672">(</span>lists found<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">2</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">json-nlohmann</span><span style="color:#f92672">]*</span> <span style="color:#f92672">(</span>lists found<span style="color:#66d9ef">:</span> <span style="color:#960050;background-color:#1e0010">1</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">Copying</span> exceptions<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">Filtering</span> out blacklisted dependencies<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">vcpkg-cmake</span><span style="color:#f92672">]*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> deleting artifacts<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">json-nlohmann</span><span style="color:#f92672">]*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> deleting artifacts<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">Merging</span> vcpkg installed artifacts into project installation<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">INFO</span><span style="color:#f92672">]</span> <span style="color:#a6e22e">Done</span></span></span></code></pre></div>
<details>
    <summary>Contents of the installation prefix after</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">./</span>install<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> vcpkg<span style="color:#f92672">-</span>default<span style="color:#f92672">-</span>triplet
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> bin
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> debug
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> libThingyd<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> some<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> thingy<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> libSomeLibrary<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libThingy<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibrary</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">SomeLibraryTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Thingy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfig</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyConfigVersion</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">-</span>debug<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> <span style="color:#a6e22e">ThingyTargets</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> copyright
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> vcpkg<span style="color:#f92672">.</span>spdx<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> vcpkg_abi_info<span style="color:#f92672">.</span>txt</span></span></code></pre></div>
</details>
<p>As you can see, only the <code>Thingy</code> artifacts were merged into the project installation.</p>
<p>The script expects certain project folders structure, such as having a CMake preset subfolder inside <code>./build/</code>, and so if you are not using CMake presets, then you&rsquo;ll need to do certain adjustments either in your project structure or in the script source code.</p>
<p>Setting exceptions via CLI isn&rsquo;t supported (<em>yet</em>), but you can do that directly <a href="https://github.com/retifrav/vcpkg-registry/blob/5273c3f0bcdfeeb8b085b324a63e747a9cbc8a6c/scripts/install-vcpkg-artifacts.py#L174">in the script</a>.</p>
<h1 id="so-how-is-vcpkg-comparing-with-conan">So, how is vcpkg comparing with Conan</h1>
<h2 id="simplicity">Simplicity</h2>
<p>Like I said, essentially, vspkg is just a combination of CMake and Git (<em>plus some glue provided by the vcpkg CLI tool</em>), which are very common basic instruments everyone is (<em>should be</em>) already familiar with.</p>
<p>They are fewer components or moving parts than it is with Conan. Especially when it comes to registries: there is no need to involve a complex 3rd-party service such as JFrog Artifactory (<em>even though you can host it in-house</em>), because vcpkg registries are just good old plain Git repositories, which are very simple to create and maintain.</p>
<h2 id="speed">Speed</h2>
<p>The &ldquo;speed&rdquo; might not be the right term here, but for me creating vcpkg <del>packages</del> ports and integrating vcpkg into a project was easier to understand and simpler to implement than doing the same with Conan.</p>
<p>For instance, the <a href="/blog/2022/02/06/cpp-dependencies-with-conan/images/dependencies-graph.png">research project</a> that took about two weeks to implement with Conan, with vcpkg it barely took 3 days.</p>
<h2 id="documentation">Documentation</h2>
<p>Paradoxically enough, vcpkg&rsquo;s documentation seems worse than Conan&rsquo;s, or at least less detailed (<em>and sometimes just missing</em>), and yet it was easier to get started with vcpkg than it was with Conan. Things just make sense and many questions/problems you can figure out on your own.</p>
<p>Speaking about documentation, there are 3 different places/domains where you can find it. Certainly, all of them likely have the same source, but still such distribution does not help to inspire confidence:</p>
<ol>
<li><a href="https://github.com/microsoft/vcpkg/blob/master/docs/README.md">https://github.com/microsoft/vcpkg/</a> - probably use this one, for it&rsquo;s the source;</li>
<li><a href="https://vcpkg.io/en/docs/README.html">https://vcpkg.io/</a>;</li>
<li><a href="https://vcpkg.readthedocs.io/en/latest/README/index.html">https://vcpkg.readthedocs.io/</a>.</li>
</ol>
<h2 id="overall-impression">Overall impression</h2>
<p>It seems to me that pretty much everything that vcpkg can do, Conan can do too (<em>or maybe even more, thanks to Python</em>). But somehow with Conan it just didn&rsquo;t take off. I cannot really list clear and exact reasons why I wasn&rsquo;t entirely happy with Conan. I guess, vcpkg just <em>feels</em> better, if one can take a &ldquo;feeling&rdquo; as a base for making such an important decision about one&rsquo;s build system.</p>
<p>Yet again I&rsquo;d like to say once more that our less fortunate experience with Conan might be because we used it wrong, and probably we should have spent some more time reading the documentation. But at the same time with vcpkg we were on the right track from the very beginning, so perhaps one could say that vcpkg is more intuitive to use (<em>when you already have good enough experience with CMake</em>).</p>
<p>I cannot say that Conan is worse. Even though we <a href="#why-we-didnt-proceed-with-conan">did not proceed</a> with it for all our projects, I did add it to some of our smaller projects, mostly tools and demos, where it wasn&rsquo;t so time-consuming to integrate, and there it was doing the job quite nicely. But now we have decided to go with integrating vcpkg in all our projects.</p>
<p>With that said, it&rsquo;s surely nice to have alternatives, and so it&rsquo;s only great that C++ developers have more than one package manager to choose from.</p>
<hr class="updates-separator">
<h1 id="updates">Updates</h1>
<h2 id="2023-09-01--build-time-improvements">2023-09-01 | Build time improvements</h2>
<p>Some months later we finished the work of moving all of our project&rsquo;s bundled/vendored dependencies from the repository and making ports for them in our vcpkg registry. Along the way we also stopped producing object libraries and made all of the dependencies normal libraries.</p>
<p>The total amount of ports in the registry ended up being more than 60 - that is both our direct dependencies and transitive dependencies (<em>dependencies of dependencies</em>). Of course, after excluding platform-specific and feature-specific dependencies the number becomes about 30-40 in average, but still, that is quite a number.</p>
<p>So, naturally, we expected a big improvement in build times, since all the dependencies are now restored from local cache instead of being built every time from sources. And we did get an improvement, but not as big as we thought we would:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/build-time-improvements-buildbots.png" alt="vcpkg, build time improvements on buildbots">

<p>Some clarification:</p>
<ul>
<li>the &ldquo;bundled&rdquo; column shows project build time with dependencies built from bundled sources, and &ldquo;vcpkg&rdquo; column shows project build time when dependencies are restored pre-built from local cache;</li>
<li>not all platforms are building the same amount of components. For example, Windows Clang and some other configurations do not build tools, samples and demos, so they have less work to do;</li>
<li>the project is built on several different buildbots, and not all of them have the same performance (<em>for instance, mac-1 buildbot is considerably faster than mac-8</em>).</li>
</ul>
<p>But why most of the Windows builds got so little improvement - that I cannot explain. Using Ninja instead of Visual Studio would certainly result in faster builds, but unfortunately we are stuck with the latter for now, and anyway the ratio would likely still be the same.</p>
<p>The only guess I have is based on the fact that all of those &ldquo;slow&rdquo; configurations (<em>less than 10% improvement</em>) are building everything (<em>not just our SDK libraries but also tools, samples and demos</em>), and configurations with big improvements (<em>30% and more</em>) are building just our SDK libraries, so no tools, samples or demos. And I am guessing that while <em>compiling</em> time has improved consistently(?) across all platforms, one should not forget that there is also <em>linking</em>, and apparently that process actually degraded in those configurations that build applications (<em>tools/samples/demos</em>). Like I said, we were building part of our dependencies as object libraries, and so now when all of the dependencies became normal libraries, that added more work for the linker (<em>did it really?</em>). I guess. If not that, I don&rsquo;t know what then.</p>
<p>To test that theory I&rsquo;ve run one of the Windows builds on my machine, first with everything enabled and then with disabled tools/samples/demos:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/build-time-improvements-personal.png" alt="vcpkg, build time improvements on personal machine">

<p>Surprisingly, even with the full build there was a 24% improvement on my machine versus 7% improvement on buildbot. Why the hell is it so? Well, I did use Ninja instead of Visual Studio generator, which certainly speeded up the build, but that applies to both build times (<em>with and without vcpkg</em>), so the ratio shouldn&rsquo;t be affected, should it?</p>
<p>If you are curious why the total build time is 15/14 minutes on buildbot and only 10/8 minutes on my machine, that is because buildbots also run certain preparation steps and then do packing and publishing after the build, and all that adds up to the total time.</p>
<p>And then the build without tools/samples/demos got 41% improvement! So that would confirm my theory about &ldquo;degraded&rdquo; linking times, but I am still not sure if it really is the actual reason.</p>
<p>Either way, while it&rsquo;s nice to get faster builds, for us that was not the main goal of using a package manager. We are mostly happy about the fact that we can finally stop bundling/vendoring 3rd-party sources in our repository and resolve the project dependencies like adults.</p>
<h2 id="2024-07-24--tools-as-host-dependencies">2024-07-24 | Tools as host dependencies</h2>
<p>Sometimes your build needs to have a certain tool like cURL, SQLite or some other custom executable to perform various tasks before compiling the project sources. For example, you might need to serialize some binary into C++ sources, such as <a href="https://proj.org/en/latest/resource_files.html#proj-db">proj.db</a>, so it could be &ldquo;compiled in&rdquo; and used from <a href="https://github.com/retifrav/vcpkg-registry/commit/e4c4ce170133eb29f4aaca44cb4668f448fcf587">in-memory VFS</a>.</p>
<p>Often you would just install such tools on your machines / buildbots beforehand, but sometimes, and especially that concerns custom in-house tools, you would want to build those together with your project dependencies, and vcpkg can do that too - this is what <a href="https://learn.microsoft.com/en-us/vcpkg/users/host-dependencies">host dependencies</a> are for.</p>
<p>And it&rsquo;s all good as long as you need to use those tools in ports, because portfiles have <a href="https://learn.microsoft.com/en-us/vcpkg/maintainers/variables#current_host_installed_dir">CURRENT_HOST_INSTALLED_DIR</a> variable, so when you need to pass the path of a tool into the CMake project handled by that portfile, you can simply do something like <a href="https://github.com/retifrav/vcpkg-registry/blob/e9b34ffb119269cbb34e8523ccc3e8df16194245/ports/proj/portfile.cmake#L16-L33">this</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_program(<span style="color:#e6db74">SQLITE_TOOL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">NAMES</span> <span style="color:#e6db74">&#34;sqlite3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">PATHS</span> <span style="color:#e6db74">&#34;${CURRENT_HOST_INSTALLED_DIR}/tools/sqlite&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">NO_DEFAULT_PATH</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">REQUIRED</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>vcpkg_cmake_configure(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">SOURCE_PATH</span> <span style="color:#e6db74">&#34;${SOURCE_PATH}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">OPTIONS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">-DEXE_SQLITE3=</span><span style="color:#f92672">${</span>SQLITE_TOOL<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>But! What if you need to know the paths to those tools in an actual final project that isn&rsquo;t a port? Sure, the project dependencies are resolved with vcpkg, and it does fetch, build and install the tools too, but how do you get the paths to the tools executables in your project&rsquo;s <code>CMakeLists.txt</code>? As you might have guessed, <code>CURRENT_HOST_INSTALLED_DIR</code> variable isn&rsquo;t available there, as it is only set in portfiles.</p>
<p>If those tools weren&rsquo;t host dependencies, then of course you could&rsquo;ve composed the path to a tool as <code>${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/tools/some/</code>, because <a href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#vcpkg_target_triplet">VCPKG_TARGET_TRIPLET</a> variable is set and available in CMake projects. But the problem is that, being host dependencies, those tools aren&rsquo;t installed into the target triplet prefix, they are installed into the host prefix.</p>
<p>Here&rsquo;s an illustration. Having this vcpkg manifest:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;vcpkg-test&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dependencies&#34;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;some-cppgenerator&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;glslang&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;zlib&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>we get the following installation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>├── arm64-osx
</span></span><span style="display:flex;"><span>│   ├── share
</span></span><span style="display:flex;"><span>│   │   ├── ...
</span></span><span style="display:flex;"><span>│   └── tools
</span></span><span style="display:flex;"><span>│       └── some-cppgenerator
</span></span><span style="display:flex;"><span>│           └── cppGenerator
</span></span><span style="display:flex;"><span>├── some-arm64-osx
</span></span><span style="display:flex;"><span>│   ├── debug
</span></span><span style="display:flex;"><span>│   │   └── lib
</span></span><span style="display:flex;"><span>│   │       ├── ...
</span></span><span style="display:flex;"><span>│   ├── include
</span></span><span style="display:flex;"><span>│   │   ├── glslang
</span></span><span style="display:flex;"><span>│   │   │   ├── ...
</span></span><span style="display:flex;"><span>│   │   ├── zlib
</span></span><span style="display:flex;"><span>│   │   │   ├── ...
</span></span><span style="display:flex;"><span>│   ├── lib
</span></span><span style="display:flex;"><span>│   │   ├── ...
</span></span><span style="display:flex;"><span>│   ├── share
</span></span><span style="display:flex;"><span>│   │   ├── glslang
</span></span><span style="display:flex;"><span>│   │   │   ├── ...
</span></span><span style="display:flex;"><span>│   │   └── zlib
</span></span><span style="display:flex;"><span>│   │       ├── ...
</span></span><span style="display:flex;"><span>│   └── tools
</span></span><span style="display:flex;"><span>│       └── glslang
</span></span><span style="display:flex;"><span>│           ├── glslangValidator
</span></span><span style="display:flex;"><span>│           └── spirv-remap
</span></span><span style="display:flex;"><span>└── vcpkg
</span></span><span style="display:flex;"><span>    ├── ...
</span></span></code></pre></div><p>The <code>some-arm64-osx</code> is my custom triplet, which conveniently also serves the purpose of demonstrating different paths/prefixes for the host and target triplets.</p>
<p>So the path to <code>glslangValidator</code> can be obtained with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_program(<span style="color:#e6db74">GLSLANG_VALIDATOR</span> <span style="color:#e6db74">glslangValidator</span> <span style="color:#e6db74">&#34;${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/tools/glslang&#34;</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># or just
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#set(GLSLANG_VALIDATOR &#34;${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/tools/glslang/glslangValidator&#34;) 
</span></span></span></code></pre></div><p>But how to get the path to <code>cppGenerator</code>? Specifically, how to get this <code>arm64-osx</code> value of the host triplet name? It should also be something simple, right? Well&hellip;</p>




<figure class="with-original">
    <img class="image-post" loading="lazy" src="/blog/2022/10/30/cpp-dependencies-with-vcpkg/images/one-does-not-simply.jpg" alt="One does not simply">
    <footer>
        <small>
            <i><a href="https://www.reddit.com/r/lotr/comments/v7tga0/one_does_not_simply_something_something/">original picture</a></i>
        </small>
    </footer>
</figure>

<p>&hellip;it is not.</p>
<p>But wait, you&rsquo;ll say, isn&rsquo;t there a <a href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#vcpkg_host_triplet">VCPKG_HOST_TRIPLET</a> variable on that same documentation page where <code>VCPKG_TARGET_TRIPLET</code> was? Aye, there is, but you&rsquo;ll be surprised to learn that this variable isn&rsquo;t fucking set by default. Apparently, it is only meant to be set by you (<em>in CLI with <code>-D</code>, or in a preset, or as an environment variable</em>), should you ever need that, otherwise it will remain empty, so you won&rsquo;t be able to get the default host triplet name from it.</p>
<p>Okay, you&rsquo;ll say, but there is <a href="https://learn.microsoft.com/en-us/vcpkg/users/host-dependencies#vcpkg_use_host_tools">VCPKG_USE_HOST_TOOLS</a>, which should add the paths to the tools from the host prefix into the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_PROGRAM_PATH.html">CMAKE_PROGRAM_PATH</a>, and then <code>find_program()</code> will find them? Yes, that much is true, but the problem here is that it still relies on the <code>VCPKG_HOST_TRIPLET</code>, which isn&rsquo;t fucking set by default, so what you&rsquo;ll get in <code>CMAKE_PROGRAM_PATH</code> is the target triplet prefix still - the same what you get if you don&rsquo;t set the <code>VCPKG_USE_HOST_TOOLS</code>.</p>
<p>And actually there is another problem with <code>VCPKG_USE_HOST_TOOLS</code>. If we imagine for a second that <code>VCPKG_HOST_TRIPLET</code> is set to something meaningful, and if you set <code>VCPKG_USE_HOST_TOOLS</code>, then it will add the host triplet prefix tools paths to the <code>CMAKE_PROGRAM_PATH</code>, which is good, but at the same time it will not add the target triplet prefix tools paths, which were there before! To illustrate that with the previous illustration, without <code>VCPKG_USE_HOST_TOOLS</code> being set here are the paths that I get in the <code>CMAKE_PROGRAM_PATH</code> (<em>if I check its contents somewhere after the <code>project()</code> call</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/path/to/vcpkg-test/build/macos-arm64/vcpkg_installed/some-arm64-osx/tools
</span></span><span style="display:flex;"><span>/path/to/vcpkg-test/build/macos-arm64/vcpkg_installed/some-arm64-osx/tools/glslang
</span></span></code></pre></div><p>and here are the paths that I get in <code>CMAKE_PROGRAM_PATH</code> when <code>VCPKG_USE_HOST_TOOLS</code> is set (<em>for example, with <code>-DVCPKG_USE_HOST_TOOLS=1</code></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/path/to/vcpkg-test/build/macos-arm64/vcpkg_installed/arm64-osx/tools
</span></span><span style="display:flex;"><span>/path/to/vcpkg-test/build/macos-arm64/vcpkg_installed/arm64-osx/tools/some-cppgenerator
</span></span></code></pre></div><p>Here&rsquo;s also a <a href="https://github.com/microsoft/vcpkg/issues/30220">bugreport</a> from <a href="https://crascit.com">Craig Scott</a>, which, you guessed it right, first got auto-staled and then auto-closed as &ldquo;<em>not planned</em>&rdquo;.</p>
<p>So even if <code>VCPKG_HOST_TRIPLET</code> had a default value (<em>remember, we are only imagining that it has one</em>), you would have not had both the host and triplet tools paths added to <code>CMAKE_PROGRAM_PATH</code>. Well, unless you would have hacked them into there yourself with <code>list(APPEND CMAKE_PROGRAM_PATH ...)</code>, but that you could&rsquo;ve done regardless, so what&rsquo;s the point. And anyway, since <code>VCPKG_HOST_TRIPLET</code> isn&rsquo;t set by default, these mental exercises are purely hypothetical.</p>
<p>Coming back to reality, surely there must be a way to obtain the value of that auto-detected/default host triplet name, because vcpkg itself does get it from somewhere, doesn&rsquo;t it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>-- Running vcpkg install
</span></span><span style="display:flex;"><span>Fetching registry information from git@some.git.repository:some/registry.git <span style="color:#f92672">(</span>HEAD<span style="color:#f92672">)</span>...
</span></span><span style="display:flex;"><span>Detecting compiler hash <span style="color:#66d9ef">for</span> triplet arm64-osx...
</span></span></code></pre></div><p>Here - the <code>arm64-osx</code> value. That is what we want to get, so how does one get it, for fucks sake.</p>
<p style="font-style:italic; color:gray; text-align:center; font-weight:bold;">
    [ here goes that picture with Boromir again ]
<p>
<p>Yeah, there is no way.</p>
<p>&hellip;Except for parsing the output(<em>!</em>) of the undocumented(<em>!!</em>) command <code>z-print-config</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ vcpkg z-print-config
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;buildtrees&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/buildtrees&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;default-triplet&#34;</span>: <span style="color:#e6db74">&#34;arm64-osx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;downloads&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/downloads&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;host-triplet&#34;</span>: <span style="color:#e6db74">&#34;arm64-osx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;installed&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/installed&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;manifest-mode-enabled&#34;</span>: false,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;packages&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/packages&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;tools&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/downloads/tools&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;vcpkg-root&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;versions-output&#34;</span>: <span style="color:#e6db74">&#34;/path/to/vcpkg/buildtrees/versioning_/versions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>There it fucking is! The <code>host-triplet</code> value, hallelujah. And don&rsquo;t let <code>default-triplet</code> confuse you - that&rsquo;s the target triplet, you can check yourself what value it will get if you&rsquo;ll add <code>--triplet arm64-osx-dynamic</code>.</p>
<p>So one more time, just to underline it for the absolute clarity: to get the target triplet prefix path you have <code>${VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}</code> ready to be used right away, and to get the host triplet prefix path you apparently are supposed to do something similar to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">VCPKG_HOST_TRIPLET</span> <span style="color:#e6db74">OR</span> <span style="color:#e6db74">&#34;${VCPKG_HOST_TRIPLET}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># https://learn.microsoft.com/en-us/vcpkg/users/config-environment#vcpkg_default_host_triplet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    set(<span style="color:#e6db74">VCPKG_DEFAULT_HOST_TRIPLET</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    if(<span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">ENV{VCPKG_DEFAULT_HOST_TRIPLET}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        set(<span style="color:#e6db74">VCPKG_DEFAULT_HOST_TRIPLET</span> <span style="color:#f92672">$ENV{</span>VCPKG_DEFAULT_HOST_TRIPLET<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    if(<span style="color:#e6db74">&#34;${VCPKG_DEFAULT_HOST_TRIPLET}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;VCPKG_DEFAULT_HOST_TRIPLET is empty, getting host triplet from vcpkg CLI tool directly...&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#75715e"># right now this seems to be the only (and undocumented?) way to obtain the auto-detected/default host triplet name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        execute_process(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">vcpkg</span> <span style="color:#e6db74">z-print-config</span> <span style="color:#75715e"># might want to prepend `vcpkg` with `$ENV{VCPKG_ROOT}/`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#e6db74">OUTPUT_VARIABLE</span> <span style="color:#e6db74">VCPKG_PRINTED_CONFIG</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">COMMAND_ERROR_IS_FATAL</span> <span style="color:#e6db74">ANY</span>
</span></span><span style="display:flex;"><span>        )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#75715e">#message(DEBUG &#34;VCPKG_PRINTED_CONFIG: ${VCPKG_PRINTED_CONFIG}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        string(<span style="color:#e6db74">JSON</span> <span style="color:#e6db74">VCPKG_DEFAULT_HOST_TRIPLET</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ERROR_VARIABLE</span> <span style="color:#e6db74">VCPKG_DEFAULT_HOST_TRIPLET_ERROR</span> <span style="color:#75715e"># to prevent it from failing right away
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#e6db74">GET</span> <span style="color:#f92672">${</span>VCPKG_PRINTED_CONFIG<span style="color:#f92672">}</span> <span style="color:#e6db74">&#34;host-triplet&#34;</span>
</span></span><span style="display:flex;"><span>        )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">&#34;${VCPKG_DEFAULT_HOST_TRIPLET_ERROR}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;NOTFOUND&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>            <span style="color:#75715e"># older versions of vcpkg use underscore symbol instead of dash (ну блять),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e"># so you need to check for that variant too, and this time it should
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e"># abort on error, so no ERROR_VARIABLE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            string(<span style="color:#e6db74">JSON</span> <span style="color:#e6db74">VCPKG_DEFAULT_HOST_TRIPLET</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">GET</span> <span style="color:#f92672">${</span>VCPKG_PRINTED_CONFIG<span style="color:#f92672">}</span> <span style="color:#e6db74">&#34;host_triplet&#34;</span>
</span></span><span style="display:flex;"><span>            )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;Got the following default host triplet from vcpkg CLI tool output: ${VCPKG_DEFAULT_HOST_TRIPLET}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    else()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;Got the following default host triplet from environment variable: ${VCPKG_DEFAULT_HOST_TRIPLET}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">VCPKG_HOST_TRIPLET</span> <span style="color:#f92672">${</span>VCPKG_DEFAULT_HOST_TRIPLET<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>The motherfucking 34 lines just to get one value. Christ almighty. And let&rsquo;s not forget that <code>z-print-config</code> is undocumented, and being a seemingly internal thing (<em>bacause it is prefixed with <code>z-</code>?</em>), it might change its output format or even completely disappear at some point in future versions. Заебись!</p>
<p>On the bright side though, now that you have the host triplet name value, you can finally compose paths to the host tools:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">VCPKG_HOST_TRIPLET</span> <span style="color:#e6db74">OR</span> <span style="color:#e6db74">&#34;${VCPKG_HOST_TRIPLET}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;The host vcpkg triplet is not set (or this host is not supported)&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">CPP_GENERATOR</span> <span style="color:#e6db74">&#34;${VCPKG_INSTALLED_DIR}/${VCPKG_HOST_TRIPLET}/tools/some-cppgenerator/cppGenerator&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#find_program(CPP_GENERATOR cppGenerator &#34;${VCPKG_INSTALLED_DIR}/${VCPKG_HOST_TRIPLET}/tools/some-cppgenerator&#34; REQUIRED)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;Path to cppGenerator: ${CPP_GENERATOR}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>But that&rsquo;s not the end of it, hehe. Well, it is, but there exists a (<em>not very unlikely</em>) scenario, in which your project might be added as a sub-project into another project, which won&rsquo;t be using vcpkg. And as your project (<em>being a sub-project</em>) will be built from sources, it will need a different way to obtain the path to that <code>cppGenerator</code> tool, as there will be no vcpkg stuff around. And of course, let&rsquo;s imagine that all the other dependencies that your project has are somehow already resolved. Who knows, maybe those people resolved your project dependencies on their own or maybe took your project <a href="#distributing-your-project">distribution</a>, kept only the dependencies and are now building your sources as a sub-project in their project. Either way, to account for this scenario, the following condition should do:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>if(<span style="color:#e6db74">PROJECT_IS_TOP_LEVEL</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    if(<span style="color:#e6db74">NOT</span> <span style="color:#e6db74">DEFINED</span> <span style="color:#e6db74">VCPKG_HOST_TRIPLET</span> <span style="color:#e6db74">OR</span> <span style="color:#e6db74">&#34;${VCPKG_HOST_TRIPLET}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;The host vcpkg triplet is not set (or this host is not supported)&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">CPP_GENERATOR</span> <span style="color:#e6db74">&#34;${VCPKG_INSTALLED_DIR}/${VCPKG_HOST_TRIPLET}/tools/some-cppgenerator/cppGenerator&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;Path to cppGenerator: ${CPP_GENERATOR}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>else() <span style="color:#75715e"># so we are in a sub-project and we assume that vcpkg isn&#39;t used
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    find_program(<span style="color:#e6db74">CPP_GENERATOR</span> <span style="color:#e6db74">cppGenerator</span> <span style="color:#f92672">${</span>CPP_GENERATOR_PATH<span style="color:#f92672">}</span>) <span style="color:#75715e"># REQUIRED
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    if(<span style="color:#e6db74">&#34;${CPP_GENERATOR}&#34;</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;CPP_GENERATOR-NOTFOUND&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">FATAL_ERROR</span> <span style="color:#e6db74">&#34;Couldn&#39;t find cppGenerator, did you provide -DCPP_GENERATOR_PATH?&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    else()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        message(<span style="color:#e6db74">DEBUG</span> <span style="color:#e6db74">&#34;Found cppGenerator: ${CPP_GENERATOR}&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>which, naturally, will require the parent/main project configuration to have one new configuration argument: <code>-DCPP_GENERATOR_PATH=&quot;/path/to/some-cppgenerator&quot;</code>.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/cpp/">cpp</a><a class="tag" href="https://retifrav.github.io/tags/cmake/">cmake</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <div style="border:2px orange solid; background-color: floralwhite; border-radius:0.5rem; padding: 10px 14px; font-style:italic; font-size:0.9em;">
              If you'd like to comment the article, you can do it on the
              <a href="https://decovar.dev/blog/2022/10/30/cpp-dependencies-with-vcpkg/#remark42" style="font-weight:bold;">
                  original website</a>. This one is just a mirror without comments.
          </div>
      
      </div>
    </div>
  </div>

        <div id="footer">
          <div>
              2014 - 2024,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <a href="/index.xml" title="Subscribe to RSS"><img src="/images/rss.png" width="50px"></a>
              <a style="margin-left: 5px;" href="https://t.me/decovar" title="Telegram channel"><img src="/images/telegram.png" width="50px"></a>
            </div>
            <div id="telegramWidgetBlock" class="sidebar-section"></div>
            <div class="sidebar-section">
                <h3>Stuff</h3>
                <ul class="sidebar-list">
                    <li><a href="/stuff/kakoi-jvotne-vi-kysaiti/index.html">КАКОИ ЖВОТНЕ ВЫ КУСАИТИ?</a></li>
                </ul>
            </div>
            <div id="social-networks" class="sidebar-section">
              <h3>Social networks</h3>
              <div style="font-family:Courier New;">
                  Zuck: <i>Yeah so if you ever need info about anyone at Harvard</i><br/>
                  Zuck: <i>Just ask</i><br/>
                  Zuck: <i>I have over 4,000 emails, pictures, addresses, SNS</i><br/>
                  smb: <i>What? How'd you manage that one?</i><br/>
                  Zuck: <i>People just submitted it.</i><br/>
                  Zuck: <i>I don't know why.</i><br/>
                  Zuck: <i>They "trust me"</i><br/>
                  Zuck: <i>Dumb fucks</i>
              </div>
            </div>
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (67)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (36)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/linux">linux (28)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (11)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/ios">ios (7)</a></li>
                  
                  <li><a href="/tags/apple">apple (6)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/home-automation">home-automation (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53340325-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "UA-53340325-1");
    </script>

    <script>
        const telegramBlock = document.getElementById("telegramWidgetBlock");
        window.onload = () =>
        {
            const pinnedTelegramPosts = [306,319,323]
            const randomedPostID = pinnedTelegramPosts[
                Math.floor(Math.random() * pinnedTelegramPosts.length)
            ];
            const telegramWidgetScript = document.createElement("script");
            telegramWidgetScript.src = "https://telegram.org/js/telegram-widget.js?21";
            telegramWidgetScript.dataset["telegramPost"] = `decovar/${randomedPostID}`;
            telegramWidgetScript.dataset["color"] = "1E8448";
            telegramWidgetScript.dataset["width"] = "100%";
            telegramWidgetScript.dataset["userpic"] = "false";
            telegramBlock.appendChild(telegramWidgetScript);
        }
    </script>

    
    
  </body>
</html>

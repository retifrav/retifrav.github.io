<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Conan and resolving dependencies in a C&#43;&#43; project | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2022/02/06/cpp-dependencies-with-conan/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="Managing 3rd-party dependencies in a C&#43;&#43; project with Conan: automatic builds and deployment in TeamCity, storing artifacts in JFrog Artifactory and fetching them for CMake" />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2022/02/06/cpp-dependencies-with-conan/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="Conan and resolving dependencies in a C&#43;&#43; project">
  <meta property="og:description" content="Managing 3rd-party dependencies in a C&#43;&#43; project with Conan: automatic builds and deployment in TeamCity, storing artifacts in JFrog Artifactory and fetching them for CMake">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-02-06T14:47:47+01:00">
    <meta property="article:modified_time" content="2022-02-06T14:47:47+01:00">
    <meta property="article:tag" content="Cpp">
    <meta property="article:tag" content="Cmake">
    <meta property="article:tag" content="Devops">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2022/02/06/cpp-dependencies-with-conan/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Conan and resolving dependencies in a C&#43;&#43; project</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2022-02-06 14:47:47 &#43;0100</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 62 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>Like many other teams, we have a fair amount of 3rd-party dependencies in our project (<em>a C++-based SDK, that is</em>). Like fewer other teams, we store those dependencies source code right in our project repository and we build them together with the project sources every time. This is of course a tremendous waste of time and CPU cycles, as it would be much more efficient to build dependencies just once (<em>per version</em>) and link to already pre-built binaries.</p>




<figure class="with-original">
    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/conan-the-librarian.png" alt="Conan The Librarian">
    <footer>
        <small>
            <i><a href="https://igorcomics.blogspot.com/2017/11/conan-librarian.html">original picture</a></i>
        </small>
    </footer>
</figure>

<p>But where to store pre-built dependencies and how to fetch the correct variants for various platforms, toolchains and configurations? Our investigation on the matter led us to <a href="https://conan.io/">Conan</a> package manager.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#why-bother">Why bother</a></li>
    <li><a href="#conan">Conan</a></li>
    <li><a href="#packages-storage">Packages storage</a>
      <ul>
        <li><a href="#conan_server">conan_server</a></li>
        <li><a href="#conan-center">Conan Center</a></li>
        <li><a href="#jfrog-artifactory">JFrog Artifactory</a></li>
      </ul>
    </li>
    <li><a href="#dependencies">Dependencies</a>
      <ul>
        <li><a href="#source-code-repositories">Source code repositories</a></li>
        <li><a href="#project-files">Project files</a>
          <ul>
            <li><a href="#conanfile">conanfile</a></li>
          </ul>
        </li>
        <li><a href="#cicd">CI/CD</a>
          <ul>
            <li><a href="#projects-and-configurations">Projects and configurations</a></li>
            <li><a href="#building">Building</a>
              <ul>
                <li><a href="#dependencies-of-dependencies">Dependencies of dependencies</a></li>
              </ul>
            </li>
            <li><a href="#packing">Packing</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#resolving-dependencies-in-a-project">Resolving dependencies in a project</a></li>
    <li><a href="#dependency-graph">Dependency graph</a></li>
    <li><a href="#updates">Updates</a>
      <ul>
        <li><a href="#2022-03-03--once-more-about-self-hosting">2022-03-03 | Once more about self-hosting</a></li>
        <li><a href="#2022-10-30--started-using-vcpkg-instead-of-conan">2022-10-30 | Started using vcpkg instead of Conan</a></li>
        <li><a href="#2023-01-12--an-e-mail-from-jfrog">2023-01-12 | An e-mail from JFrog</a></li>
        <li><a href="#2026-02-23--giving-it-another-go-with-modern-conan">2026-02-23 | Giving it another go with modern Conan</a>
          <ul>
            <li><a href="#building-packages-from-source-in-conan-1x">Building packages from source in Conan 1.x</a></li>
            <li><a href="#building-packages-from-source-in-conan-2x">Building packages from source in Conan 2.x</a>
              <ul>
                <li><a href="#making-sure-that-build-missing-works">Making sure that build missing works</a></li>
                <li><a href="#making-sure-that-requirements-use-proper-cmake-configs">Making sure that requirements use proper CMake configs</a></li>
              </ul>
            </li>
            <li><a href="#and-so-how-is-it">And so how is it</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="why-bother">Why bother</h1>
<p>Straight to the point, here&rsquo;s a build of my <a href="/blog/2019/08/04/glfw-dear-imgui/">simple application</a> that has a few dependencies: <a href="https://github.com/Dav1dde/glad">glad</a>, <a href="https://www.glfw.org/">GLFW</a> and <a href="https://github.com/ocornut/imgui">Dear ImGui</a> - everything is built from sources:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ time cmake --build .
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>29/29<span style="color:#f92672">]</span> Linking CXX executable glfw-imgui
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>real    0m13.472s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat .ninja_log
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ninja log v5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">344</span>    <span style="color:#ae81ff">1643144116191484343</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_impl_glfw.cpp.o    538b240abc3a3bc4
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    <span style="color:#ae81ff">386</span>    <span style="color:#ae81ff">1643144116228441376</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_impl_opengl3.cpp.o    cb2977cd0cf0a02
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">838</span>    <span style="color:#ae81ff">1643144116674414843</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_stdlib.cpp.o    72c8c50464634e52
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    <span style="color:#ae81ff">1459</span>    <span style="color:#ae81ff">1643144117295845649</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/init.c.o    ec7a84d90e09be1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">1473</span>    <span style="color:#ae81ff">1643144117313538409</span>    CMakeFiles/glfw-imgui.dir/functions.cpp.o    369a9f32cfe69e82
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    <span style="color:#ae81ff">1600</span>    <span style="color:#ae81ff">1643144117436078293</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/context.c.o    2ae159d1c31a5c3c
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">386</span>    <span style="color:#ae81ff">1707</span>    <span style="color:#ae81ff">1643144117535843892</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/vulkan.c.o    e5f6409e22e990ab
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">345</span>    <span style="color:#ae81ff">1855</span>    <span style="color:#ae81ff">1643144117682858278</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/monitor.c.o    aa0b3f727ad17763
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>    <span style="color:#ae81ff">1972</span>    <span style="color:#ae81ff">1643144117794902750</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/input.c.o    556c75d1b24c1fec
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">2122</span>    <span style="color:#ae81ff">1643144117958231086</span>    CMakeFiles/glfw-imgui.dir/main.cpp.o    3c409eca7f63548
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">841</span>    <span style="color:#ae81ff">2612</span>    <span style="color:#ae81ff">1643144118445759410</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/window.c.o    4cd69de2cf698676
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">3040</span>    <span style="color:#ae81ff">1643144118878103647</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_tables.cpp.o    d613d3d1e47520ee
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1855</span>    <span style="color:#ae81ff">3420</span>    <span style="color:#ae81ff">1643144119254115013</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/cocoa_time.c.o    8fe5aa7e55c4a4ee
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1973</span>    <span style="color:#ae81ff">3522</span>    <span style="color:#ae81ff">1643144119337803512</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/posix_thread.c.o    ca35990aafd46022
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2613</span>    <span style="color:#ae81ff">4220</span>    <span style="color:#ae81ff">1643144120055526527</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/egl_context.c.o    4a0f25900af8ffc7
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    <span style="color:#ae81ff">4312</span>    <span style="color:#ae81ff">1643144120151590718</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_demo.cpp.o    ad04f8180049818f
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1474</span>    <span style="color:#ae81ff">4379</span>    <span style="color:#ae81ff">1643144120210864651</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/cocoa_joystick.m.o    8f8a50953484faa7
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1467</span>    <span style="color:#ae81ff">4428</span>    <span style="color:#ae81ff">1643144120252642979</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/cocoa_init.m.o    ec5d33d5098b5c52
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1600</span>    <span style="color:#ae81ff">4543</span>    <span style="color:#ae81ff">1643144120379829813</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/cocoa_monitor.m.o    eb2653b5a4204ff1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3043</span>    <span style="color:#ae81ff">4578</span>    <span style="color:#ae81ff">1643144120418062550</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/osmesa_context.c.o    7d802e40cc6041e4
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2123</span>    <span style="color:#ae81ff">4695</span>    <span style="color:#ae81ff">1643144120536939362</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/nsgl_context.m.o    787dd493c62ff124
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1708</span>    <span style="color:#ae81ff">4810</span>    <span style="color:#ae81ff">1643144120650860676</span>    _dependencies/glfw/src/CMakeFiles/glfw.dir/cocoa_window.m.o    5bd62d5af52211f1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4810</span>    <span style="color:#ae81ff">4863</span>    <span style="color:#ae81ff">1643144120718256000</span>    _dependencies/glfw/src/libglfw3.a    39988b2ad15bd49d
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    <span style="color:#ae81ff">5676</span>    <span style="color:#ae81ff">1643144121524078659</span>    CMakeFiles/glad.dir/_dependencies/glad/src/glad.c.o    4875fb68b660e707
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5676</span>    <span style="color:#ae81ff">5716</span>    <span style="color:#ae81ff">1643144121571422000</span>    libglad.a    af027585fb9b185b
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">5824</span>    <span style="color:#ae81ff">1643144121672025107</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_widgets.cpp.o    ce787c92a020884c
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">7045</span>    <span style="color:#ae81ff">1643144122892928204</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui.cpp.o    6d6193214989032
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">12906</span>    <span style="color:#ae81ff">1643144128754775483</span>    CMakeFiles/glfw-imgui.dir/_dependencies/DearImGui/imgui_draw.cpp.o    ed7c0bc7c73c224b
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12906</span>    <span style="color:#ae81ff">13075</span>    <span style="color:#ae81ff">1643144128921561250</span>    glfw-imgui    c2d88c723185913b</span></span></code></pre></div>
<p>So it is 29 items to build and <strong>13.5 seconds</strong> of building time.</p>
<p>And here&rsquo;s the same project building only the project sources, while all the dependencies are already pre-built:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ time cmake --build .
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>3/3<span style="color:#f92672">]</span> Linking CXX executable glfw-imgui
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>real    0m1.068s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat .ninja_log
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ninja log v5</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">727</span>    <span style="color:#ae81ff">1643144024851560807</span>    CMakeFiles/glfw-imgui.dir/functions.cpp.o    abc14ffe6cd16ea3
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">958</span>    <span style="color:#ae81ff">1643144025083386756</span>    CMakeFiles/glfw-imgui.dir/main.cpp.o    49263edbd6a7bdab
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">958</span>    <span style="color:#ae81ff">1174</span>    <span style="color:#ae81ff">1643144025294166462</span>    glfw-imgui    eb2bea70f24ef99e</span></span></code></pre></div>
<p>Only 3 items to build and <strong>1 second</strong> of building time - 13 times faster! Certainly worth the effort, intit? And for bigger projects the gain can be even greater.</p>
<p>For us this became especially important, as our project is re-built on every commit in our CI/CD to run all the QA tests, so the builds are run many times a day, wasting a lot of resources re-building non-changing dependencies over and over.</p>
<p>But pre-building dependencies is not enough, it isn&rsquo;t even a half of the job. First of all, dependencies need to be built for several platforms and different toolchains. Then every dependency can (<em>will</em>) have different versions and also dependencies of its own. And finally, you need to store pre-built artifacts somewhere and fetch the right variant for the build.</p>
<p>To handle/manage all that you&rsquo;ll need a combination of CI/CD builbots, an artifacts storage and a package manager.</p>
<h1 id="conan">Conan</h1>
<p><a href="https://docs.conan.io/en/latest/introduction.html">Conan</a> is a package/dependency manager, mostly for C++ development. It has a good and easy enough integration with CMake (<em>and seemingly other build systems too</em>).</p>
<p>In short, Conan packages are regular <code>bin</code>/<code>cmake</code>/<code>include</code>/<code>lib</code>/<code>etc</code> folder structures packed into <code>.tgz</code> compressed archives, accompanied with various metadata. Conan client uses that metadata to determine correct packages for concrete platforms/toolchains/configurations, resolve dependencies, etc.</p>
<p>What might come as a shock for some is that Conan is written in Python. I&rsquo;ve seen people looking down on it because of that and saying something like &ldquo;<em>how can this pitiful indent-based scripting language handle dependencies for our mighty C++</em>&rdquo;. But after testing Conan for a couple of months, I can say that it is doing a good job. There are not that many package managers for C++ projects, and out of those that I tried so far I like Conan the most.</p>
<p>I suggest you to get familiar with Conan by reading <a href="https://docs.conan.io/en/latest/cheatsheet.html">its documentation</a> and trying out their examples, as it&rsquo;s too much to cover in one article.</p>
<p>Out of all the functionality that Conan provides, at the moment we are using only <a href="https://docs.conan.io/en/latest/creating_packages/existing_binaries.html#packaging-pre-built-binaries">packing pre-built binaries</a> and of course <a href="https://docs.conan.io/en/latest/getting_started.html">installing dependencies</a>.</p>
<h1 id="packages-storage">Packages storage</h1>
<p>There are <a href="https://docs.conan.io/en/latest/uploading_packages/remotes.html">several options</a> for where the Conan packages can be hosted and fetched from.</p>
<h2 id="conan_server">conan_server</h2>
<p>The default option is to use <a href="https://docs.conan.io/en/latest/uploading_packages/running_your_server.html">conan_server</a> that comes out of the box. If you decide to use that one, as usual, I would recommend not to expose it to the internet directly but rather via a reverse-proxy, such as NGINX.</p>
<p>In short, this would be your <code>server.conf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[server]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ssl_enabled: False</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">port: 9300</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">host_name: your.host</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[write_permissions]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">*/*@*/*: ADMIN-USER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[read_permissions]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">*/*@*/*: ?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[users]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ADMIN-USER: HERE-GOES-ADMIN-PASSWORD</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># has nothing to do with the system user</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">packages: HERE-GOES-USER-PASSWORD</span></span></span></code></pre></div>
<p>this is systemd service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-systemd" data-lang="systemd"><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Conan server</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># isn&#39;t really used, set just in case</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WorkingDirectory</span><span style="color:#f92672">=</span><span style="color:#e6db74">/var/www/conan-server/</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#e6db74">/usr/local/bin/conan_server</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Restart</span><span style="color:#f92672">=</span><span style="color:#e6db74">always</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RestartSec</span><span style="color:#f92672">=</span><span style="color:#e6db74">10</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SyslogIdentifier</span><span style="color:#f92672">=</span><span style="color:#e6db74">conan_server</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#e6db74">packages</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WantedBy</span><span style="color:#f92672">=</span><span style="color:#e6db74">multi-user.target</span></span></span></code></pre></div>
<p>and that&rsquo;s NGINX config:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">location</span> <span style="color:#e6db74">/packages/conan/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Conan server has its own authentication
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">#auth_basic           &#34;restricted area&#34;;
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">#auth_basic_user_file /etc/nginx/packages.htpasswd;
</span></span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:9300/</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># these might not be needed
</span></span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">keep-alive</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_cache_bypass</span> $http_upgrade;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> $scheme;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>We started with <code>conan_server</code>, and it was working fine, but then we discovered that despite <code>read_permissions</code> is set to <code>*/*@*/*: ?</code>, which means allowing access only for authenticated users(?), the server was still available to anonymous users too, so everyone could list and download our packages, which certainly was not the intention. I thought about reporting this in the Conan bugtracker, but when I had <a href="https://github.com/conan-io/conan/issues/9664">another question</a>, along with the answer I got a recommendation to start using JFrog Artifactory, so I reckoned it won&rsquo;t be worth wasting everyone&rsquo;s time asking about <code>conan_server</code> any more.</p>
<h2 id="conan-center">Conan Center</h2>
<p>Not much to say here - it&rsquo;s a public <a href="https://conan.io/center/">Conan packages storage</a>, a great source of lots of pre-built libraries.</p>
<p>But we are not using it. First of all, because of the same reasons listed <a href="#source-code-repositories">below</a>; and secondly, we&rsquo;d like to ensure that both our project and all the dependencies are built in the same environment, on the same buildbots, and in general we prefer to build our dependencies ourselves.</p>
<h2 id="jfrog-artifactory">JFrog Artifactory</h2>
<p><a href="https://jfrog.com/artifactory/">JFrog Artifactory</a> is a great piece of software for hosting packages, either in their cloud (<em>no</em>) or on your own server (<em>yes</em>). Probably that is what&rsquo;s running behind the <a href="#conan-center">Conan Center</a> too.</p>
<p>You can take the <a href="https://docs.conan.io/en/latest/uploading_packages/artifactory/artifactory_ce.html">Community Edition</a>, which is graciously available free of charge (<em>and limited to Conan packages only</em>). Trying to find it using the links from the <a href="https://www.jfrog.com/confluence/">referred documentation</a> if futile, so here&rsquo;s the <a href="https://conan.io/downloads.html">downloads page</a>.</p>
<p>As we need to distribute many other package formats beside Conan (<em><a href="/blog/2021/09/23/cmake-cpack-package-deb-apt/#hosting-deb-packages-for-apt">deb</a>, <a href="/blog/2020/03/05/azure-devops-nuget-npm-cpp/#azure-devops-feed">NuGet</a>, <a href="/blog/2020/03/05/azure-devops-nuget-npm-cpp/#azure-devops-feed-1">npm</a>, Maven, etc</em>), it was grand time for us to get a full-featured Artifactory, which supports <a href="https://www.jfrog.com/confluence/display/JFROG/Package+Management#PackageManagement-SupportedPackageTypes">all these formats</a>:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/artifactory-supported-packages.png" alt="JFrog Artifactory, supported packages">

<p>It is <a href="https://jfrog.com/pricing/#hosted">expensive</a> (<em>cheapest variant is 3200 USD per year!</em>), but it saves a lot of trouble for maintaining several different storages/services - instead you only need to maintain one Artifactory. Also it nicely integrates with <a href="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/jfrog-artifactory-tutorial">Azure AD SAML SSO</a>, which helps a lot too.</p>
<h1 id="dependencies">Dependencies</h1>
<h2 id="source-code-repositories">Source code repositories</h2>
<p>Now we have a place for storing pre-built dependencies in packages, but where to store their source code?</p>
<p>If you are your own evil twin (<em>сам себе злой Буратино</em>), then you can just fetch it from original repositories on GitHub, GitLab or wherever. If you really are an enemy to yourself, then you can also store your own project source code in an external repository too.</p>
<p>The main reason why this is not a great idea is that any external resource might suddenly become unavailable, and you can&rsquo;t do anything about it, as that&rsquo;s not your server and you have no control over it. Here are some examples of such unavailability:</p>
<ul>
<li>any service can go down anytime, including <a href="https://github.blog/2021-12-01-github-availability-report-november-2021/">GitHub</a>;</li>
<li>Facebook can <a href="https://blog.cloudflare.com/october-2021-facebook-outage/">update its DNS records</a> and bring the rest of the internet down;</li>
<li>malicious/righteous person(s) can <a href="https://www.zdnet.com/article/when-open-source-developers-go-bad/">commit destructive changes</a> into a repository;</li>
<li>a <a href="https://en.wikinews.org/wiki/GitHub_blocks_public_access_to_youtube-dl_after_RIAA_issues_DMCA_notice">repository can be blocked</a> on whatever grounds;</li>
<li>just as well users from certain sanctioned countries can be <a href="https://www.cnet.com/tech/computing/github-blocked-developer-in-iran-syria-and-crimea-due-to-us-sanctions/">denied using a service</a>;</li>
<li>the entire country can <a href="https://blog.cloudflare.com/internet-shut-down-in-kazakhstan-amid-unrest/">lose internet completely</a>, because authorities shut it down;</li>
<li>fucking sharks can <a href="https://www.forbes.com/sites/melissacristinamarquez/2020/07/20/our-underwater-world-is-full-of-cables-that-are-sometimes-attacked-by-sharks/">destroy internet cables</a>.</li>
</ul>
<p>A better idea would be to store copies (<em>clones</em>) of your dependencies source code in a self-hosted in-house repository. It can be the <a href="https://about.gitlab.com/install/">GitLab</a>, <a href="https://gitea.io/en-us/">Gitea</a>, some other service or just <a href="http://git-scm.com/book/en/v2/Git-on-the-Server-Getting-Git-on-a-Server">bare Git repositories</a>.</p>
<p>An even better idea would be to have those repositories not as mirrors, but as regular clones, so they are updated to the next version manually, once it is verified to be safe/stable to use. And that is what we started doing by gradually moving 3rd-party sources out from our main repository to their own repositories:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/dependencies-repositories.png" alt="Dependencies repositories">

<h2 id="project-files">Project files</h2>
<p>Almost always libraries sources already have project files for various build systems. Ideally that would be CMake, because that is our main build system.</p>
<p>If a library doesn&rsquo;t have a project file, then it could be that author intended it to be built as a part of your project, for example Dear ImGui is like that. But you still might want to pre-build it separately, so creating a <code>CMakeLists.txt</code> for it will be on you.</p>
<p>Another scenario would be so-called &ldquo;header-only&rdquo; libraries, such as <a href="https://github.com/orlp/pdqsort">pdqsort</a>, so there is nothing to build there. But even in that case you might want to consider making <code>CMakeLists.txt</code> for it with install instructions to generate CMake configs. Furthermore, some header-only libraries, for example <a href="https://json.nlohmann.me/">json-nlohmann</a>, do have <code>CMakeLists.txt</code> and sometimes even include a number of tests.</p>
<p>For storing those missing <code>CMakeLists.txt</code>&rsquo;s, <a href="#conanfile">conanfiles</a>, shared CMake modules and also patches for special cases we created a separate repository called &ldquo;<em>Dependencies resources</em>&rdquo;, which looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">README</span><span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">_cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Config</span><span style="color:#f92672">.</span>cmake<span style="color:#f92672">.</span>in
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Installing</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">_conan</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> functions<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> cpp<span style="color:#f92672">-</span>base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> dear<span style="color:#f92672">-</span>imgui
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> e57format
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> <span style="color:#ae81ff">2.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> glad
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> glfw
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> json<span style="color:#f92672">-</span>nlohmann
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> jsoncpp
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> pdqsort
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> poco
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> rapidxml
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> xerces<span style="color:#f92672">-</span>c
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> <span style="color:#ae81ff">3.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> <span style="color:#a6e22e">CMakeLists</span><span style="color:#f92672">.</span>txt<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> zstandard
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py</span></span></code></pre></div>
<p>That way we don&rsquo;t interfere with the original repositories/clones and keep all the dependencies-related resources in one place.</p>
<h3 id="conanfile">conanfile</h3>
<p>The <code>conanfile.py</code> contains various information about the package and it is almost the same for all the dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> conans <span style="color:#f92672">import</span> ConanFile, tools
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalizeVersion</span>(rawVersion):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> rawVersion<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;v&#34;</span>):
</span></span><span style="display:flex;"><span>        rawVersion <span style="color:#f92672">=</span> rawVersion[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> rawVersion<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;.&#34;</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        rawVersion <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>rawVersion<span style="color:#e6db74">}</span><span style="color:#e6db74">.0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> rawVersion
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DearImGuiConan</span>(ConanFile):
</span></span><span style="display:flex;"><span>    projectName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DearImGui&#34;</span>
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> projectName
</span></span><span style="display:flex;"><span>    version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.0&#34;</span>
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;YOUR-PREFIX&#34;</span>
</span></span><span style="display:flex;"><span>    channel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;public&#34;</span>
</span></span><span style="display:flex;"><span>    settings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;os&#34;</span>, <span style="color:#e6db74">&#34;compiler&#34;</span>, <span style="color:#e6db74">&#34;build_type&#34;</span>, <span style="color:#e6db74">&#34;arch&#34;</span>
</span></span><span style="display:flex;"><span>    description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Bloat-free Graphical User interface for C++ with minimal dependencies&#34;</span>
</span></span><span style="display:flex;"><span>    homepage <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://github.com/ocornut/imgui&#34;</span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://github.com/ocornut/imgui&#34;</span>
</span></span><span style="display:flex;"><span>    license <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://github.com/ocornut/imgui/blob/master/LICENSE.txt&#34;</span>
</span></span><span style="display:flex;"><span>    author <span style="color:#f92672">=</span> projectName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_version</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>version <span style="color:#f92672">=</span> normalizeVersion(self<span style="color:#f92672">.</span>version)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>copy(<span style="color:#e6db74">&#34;*&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package_info</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cpp_info<span style="color:#f92672">.</span>libs <span style="color:#f92672">=</span> tools<span style="color:#f92672">.</span>collect_libs(self)</span></span></code></pre></div>
<p>You will be right to assume that <code>normalizeVersion</code> function is redundantly duplicated across all of them. This is because sadly Conan does not support <a href="https://github.com/conan-io/conan/issues/39">importing relative files/modules</a>. There is <a href="https://docs.conan.io/en/latest/extending/python_requires.html">Python requires</a> functionality, but it looks too complex for such a purpose and also it is marked as experimental at the moment, so we haven&rsquo;t tried it yet.</p>
<p>Why <code>version</code> is set to <code>0.0.0</code>? At first we were setting it based in Git tags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getVersionFromGit</span>():
</span></span><span style="display:flex;"><span>    rawVersion <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    git <span style="color:#f92672">=</span> tools<span style="color:#f92672">.</span>Git(folder<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>recipe_folder)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># rawVersion = git.run(&#34;describe --tags --abbrev=0&#34;)</span>
</span></span><span style="display:flex;"><span>        rawVersion <span style="color:#f92672">=</span> normalizeVersion(git<span style="color:#f92672">.</span>get_tag())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> ex:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Exception: </span><span style="color:#e6db74">{</span>str(ex)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># rawVersion = &#34;0.0.0&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;##teamcity[message text=&#39;Package version identification failed&#39; &#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;errorDetails=&#39;Conan couldn&#39;t get the version tag from Git&#39; &#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;status=&#39;ERROR&#39;]&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> rawVersion</span></span></code></pre></div>
<p>But that is not very reliable (<em>different tag formats, missing tags, etc</em>), and so now we set it explicitly from CI/CD variable by replacing <code>version = &quot;0.0.0&quot;</code> pattern with <code>sed</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/version = \&#34;0\.0\.0\&#34;$/version = \&#34;%system.current-version%\&#34;/&#39;</span> ./conanfile.py</span></span></code></pre></div>
<p>In addition, if you are checking out sources from different repositories into a common path, there might be no <code>.git</code> data available.</p>
<p>The <code>name</code>, <code>version</code>, <code>user</code> and <code>channel</code> properties comprise the package formula/reference, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">DearImGui</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.86</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#a6e22e">@YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span><span style="color:#f92672">/</span>public</span></span></code></pre></div>
<p>You might want to use <code>channel</code> property for organizing packages by platforms, but that would be redundant and rather confusing, as that is already taken care of by Conan via so-called <a href="https://docs.conan.io/en/latest/reference/config_files/default_profile.html#default-profile">profiles</a> (<em>there is an illustration for that on the last screenshot in the <a href="#packing">packing</a> section</em>).</p>
<p>What <code>user</code> and <code>channel</code> properties should be used for is identifying your package as yours to <a href="https://docs.conan.io/en/latest/faq/using.html#faq-recommendation-user-channel">prevent possible collisions</a> with other people packages. The <code>user</code> property here (<code>YOUR-PREFIX</code>) can be your company or team name, and <code>channel</code> can be whatever you&rsquo;d like (<em><code>public</code>, <code>experimental</code>, <code>customerspecific</code></em>).</p>
<h2 id="cicd">CI/CD</h2>
<h3 id="projects-and-configurations">Projects and configurations</h3>
<p>Hopefully your infrastructure already has dedicated buildbots for building, testing and packing your product, managed by a CI/CD system.</p>
<p>We use <a href="https://www.jetbrains.com/teamcity/">TeamCity</a>, so instructions below will be mostly TeamCity-specific, but it&rsquo;s rather trivial to apply them to whatever CI/CD you might have.</p>
<p>As we build and distribute our SDK for several platforms/toolchains, there is a configuration for every target:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-dependencies-project.png" alt="TeamCity, dependencies project">

<p>Libraries have versions, and usually those are marked with Git tags, which can be used as branch specifications. We set a project parameter <code>current-version</code> for each dependency:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-project-parameters.png" alt="Project parameters in TeamCity" style="border:1px solid black;">

<p>This parameter can be then used in VCS root default branch specification:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-vsc-root.png" alt="TeamCity, VSC root" style="border:1px solid black;">

<p>Note the <code>v</code> in <code>refs/tags/v%system.current-version%</code>. Different repositories have different naming schema for tags: some add <code>v</code> to the version number, some don&rsquo;t and others do something else (<em>like <a href="https://github.com/libsdl-org/SDL/tags">SDL</a> or <a href="https://github.com/ReneNyffenegger/cpp-base64/tags">cpp-base64</a></em>). So for consistency we have a &ldquo;plain&rdquo; version set as a system variable in <a href="https://semver.org/">SemVer</a> format and then prefix it with necessary values. If the original tags format is absolutely horrible (<em>or if they are no tags at all</em>), then you&rsquo;ll need to add the tags with versions yourself (<em>it&rsquo;s your clone, after all</em>).</p>
<p>Once you set the VCS root like that, you&rsquo;ll be able to build the specific version of a library, instead of looking for the commit of interest:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-build-versions.png" alt="TeamCity, choosing specific version">

<p>Quite handy, wouldn&rsquo;t you say. And here&rsquo;s how the builds will look like:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-library-versions.png" alt="TeamCity, library versions builds" style="border:1px solid black;">

<p>The <code>START</code> configuration generates a common build number (<em>optional</em>) and triggers the builds themselves:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-configuration-trigger.png" alt="TeamCity, configuration trigger">

<p>Here you can specify that builds won&rsquo;t trigger for any version other than the default one that is set in the project parameters (<em>note the <code>v</code> prefix again</em>).</p>
<p>Finally, how to organize the sources checkout:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/teamcity-checkout.png" alt="TeamCity, checkout" style="border:1px solid black;">

<p>The library sources checkout rule is trivial:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">+:.</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">./</span></span></span></code></pre></div>
<p>And dependencies resources are checked out like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">+:%</span>system<span style="color:#f92672">.</span>projectNameNormalized<span style="color:#f92672">%</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">./</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+:</span><span style="color:#a6e22e">_cmake</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">./</span>cmake</span></span></code></pre></div>
<p>So everything specific to this library (<em><code>CMakeLists.txt</code>, <code>conanfile.py</code>, patches, etc</em>) is fetched to the top level, and common resources (<em>CMake modules</em>) are fetched into subfolders.</p>
<p>Since it&rsquo;s two different repositories that are fetched into a common path, you won&rsquo;t have <code>.git</code> data there, so if you do need it, then you&rsquo;ll need to checkout those into separate paths.</p>
<h3 id="building">Building</h3>
<p>The build step in most cases is simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>mkdir install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 16 2019&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_DEBUG_POSTFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d&#34;</span> <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Debug</span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp ./install_manifest.txt ../install-manifest-debug.txt&#34;</span>
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp ./install_manifest.txt ../install-manifest-release.txt&#34;</span></span></span></code></pre></div>
<p>The <code>install_manifest.txt</code> files are a very useful feature of CMake: when you build <code>install</code> target (<em>or run <code>cmake --install</code></em>), CMake generates a list of files that were installed. These files can be then used to separate Debug and Release build artifacts, which is what&rsquo;s happening here.</p>
<p>You can of course set different installation prefixes for Debug/Release configurations, but we need them in one folder (<em>that way you also avoid duplication of some files between configurations</em>).</p>
<p>On GNU/Linux the build step is somewhat less simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>mkdir install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cmake -G Ninja -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>Debug -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> -DCMAKE_DEBUG_POSTFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;d&#34;</span> ..
</span></span><span style="display:flex;"><span>cmake --build . --target install
</span></span><span style="display:flex;"><span>cp ./install_manifest.txt ../install-manifest-debug.txt
</span></span><span style="display:flex;"><span>rm -r ./* <span style="color:#f92672">&amp;&amp;</span> rm .ninja*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cmake -G Ninja -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>Release -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> ..
</span></span><span style="display:flex;"><span>cmake --build . --target install
</span></span><span style="display:flex;"><span>cp ./install_manifest.txt ../install-manifest-release.txt</span></span></code></pre></div>
<p>Without cleaning the build folder (<em><code>rm -r ./* &amp;&amp; rm .ninja*</code></em>) after building and installing Debug configuration you&rsquo;ll get a surprising result on installing the Release configuration:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Old</span> export file <span style="color:#e6db74">&#34;/home/build/buildAgent/work/externals/dear-imgui/src/install/cmake/DearImGuiConfig.cmake&#34;</span> will be replaced
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Removing</span> files <span style="color:#f92672">[</span><span style="color:#66d9ef">/home/build/buildAgent/work/externals/dear-imgui/src/install/cmake/DearImGuiConfig-debug.cmake</span><span style="color:#f92672">]</span></span></span></code></pre></div>
<p>And so you&rsquo;ll be missing that file in your package (<em>thanks a lot!</em>).</p>
<h4 id="dependencies-of-dependencies">Dependencies of dependencies</h4>
<p>If (<em>when</em>) a dependency has dependencies of its own, the project configuration and build become slightly more complicated, but thanks to Conan not too complicated.</p>
<p>For example, let&rsquo;s take <a href="https://github.com/asmaloney/libE57Format">E57Format</a> library, which depends on <a href="https://xerces.apache.org/xerces-c/">Xerces-C++</a> library and expects to discover it with <code>find_package()</code>.</p>
<p>In that case, naturally, first you need to build Xerces-C++ and publish it to your Conan packages storage. Then add the following to E57Format&rsquo;s <code>conanfile.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">E57FormatConan</span>(ConanFile):
</span></span><span style="display:flex;"><span>    projectName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;E57Format&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>    requires <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Xerces-C/3.2.3@YOUR-PREFIX/public&#34;</span>
</span></span><span style="display:flex;"><span>    ]</span></span></code></pre></div>
<p>But that&rsquo;s not enough, because E57Format&rsquo;s <code>CMakeLists.txt</code> does not contain required commands for running Conan stuff, and that means that we need to make a patch (<em><code>dependencies-resources/e57format/patches/2.2.0/CMakeLists.txt.patch</code></em>) for adding them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-patch" data-lang="patch"><span style="display:flex;"><span><span style="color:#75715e">44a45,47
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">&gt; include(${CMAKE_BINARY_DIR}/conanbuildinfo.cmake)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">&gt; conan_basic_setup()
</span></span></span><span style="display:flex;"><span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">106c109
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;         DEBUG_POSTFIX &#34;-d&#34;
</span></span></span><span style="display:flex;"><span><span style="font-weight:bold">---
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">&gt;         DEBUG_POSTFIX &#34;d&#34;
</span></span></span></code></pre></div>
<p>Here we also override their hardcoded <code>DEBUG_POSTFIX</code>, because we use <code>d</code> in our libraries and we would like this to be consistent. By the way, that hardcoding is a good example of doing bad things in CMake, because in that case user loses the ability to override this value with a <code>-D</code> argument (<em>so a better patch would be to delete this line instead of replacing it</em>).</p>
<p>The build step for E57Format project in CI/CD looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>mkdir install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;patch ./CMakeLists.txt ./patches/%system.current-version%/CMakeLists.txt.patch&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>conan install <span style="color:#f92672">..</span> <span style="color:#f92672">-</span>s compiler<span style="color:#f92672">.</span>version<span style="color:#66d9ef">=</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">-</span>s build_type<span style="color:#66d9ef">=</span><span style="color:#a6e22e">Debug</span> <span style="color:#f92672">-</span>r <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span>
</span></span><span style="display:flex;"><span>conan install <span style="color:#f92672">..</span> <span style="color:#f92672">-</span>s compiler<span style="color:#f92672">.</span>version<span style="color:#66d9ef">=</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">-</span>s build_type<span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span>r <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">-</span>G <span style="color:#e6db74">&#34;Visual Studio 16 2019&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">DCMAKE_INSTALL_PREFIX</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Debug</span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp ./install_manifest.txt ../install-manifest-debug.txt&#34;</span>
</span></span><span style="display:flex;"><span>cmake <span style="color:#f92672">--</span>build <span style="color:#f92672">.</span> <span style="color:#f92672">--</span>target install <span style="color:#f92672">--</span>config <span style="color:#a6e22e">Release</span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp ./install_manifest.txt ../install-manifest-release.txt&#34;</span></span></span></code></pre></div>
<h3 id="packing">Packing</h3>
<p>When creating Conan package, you can put both Debug and Release configurations into one package. Thanks to CMake this work work just fine: <code>find_package()</code> will find both Debug (<em><code>DearImGuiTargets-debug.cmake</code></em>) and Release (<em><code>DearImGuiTargets-release.cmake</code></em>) configurations. And <code>conan export-pkg</code> wouldn&rsquo;t care, as it packs everything it finds in the path specified in <code>-pf</code> argument.</p>
<p>But that would not be exactly correct, because if one tries to install such package like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ conan install <span style="color:#f92672">-</span>s build_type<span style="color:#66d9ef">=</span><span style="color:#a6e22e">Debug</span> <span style="color:#f92672">-</span>r <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span></span></span></code></pre></div>
<p>then Conan will say that there are no available packages for this configuration. And why it works without providing <code>-s build_type</code> is because it defaults to <code>Release</code> (<em>both for <code>conan export-pkg</code> and <code>conan install</code></em>).</p>
<p>It is actually possible to have Debug and Release <a href="https://docs.conan.io/en/latest/creating_packages/package_approaches.html#n-configs-1-package">in one package</a>, so it would work for any <code>-s build_type</code>, but it&rsquo;s not as simple as just splitting configurations into different packages.</p>
<p>The splitting can be done by using <code>install-manifest-*.txt</code> lists produced on the <a href="#building">building step</a>. But they store absolute paths to the files, and so we need to trim them with <code>sed</code>. After that the installation folder can be split into Debug/Release with <code>cp --parents</code> to preserve the folders structure.</p>
<p>After splitting is done, you can create packages with <code>conan export-pkg</code> and publish them to your Artifactory with <code>conan upload</code>.</p>
<p>Here are all the commands executing on the packing step:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>mkdir package<span style="color:#f92672">-</span>debug
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;sed -i &#39;s/.*install\///g&#39; ./install-manifest-debug.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir package<span style="color:#f92672">-</span>release
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;sed -i &#39;s/.*install\///g&#39; ./install-manifest-release.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd install
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp --parents $(&lt;../install-manifest-debug.txt) ../package-debug || :&#34;</span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;cp --parents $(&lt;../install-manifest-release.txt) ../package-release || :&#34;</span>
</span></span><span style="display:flex;"><span>cd <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sh<span style="color:#f92672">.</span>exe <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;sed -i &#39;s/version = \&#34;0\.0\.0\&#34;$/version = \&#34;%system.current-version%\&#34;/&#39; ./conanfile.py&#34;</span>
</span></span><span style="display:flex;"><span>conan export<span style="color:#f92672">-</span>pkg conanfile<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>s compiler<span style="color:#f92672">.</span>toolset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v142&#34;</span> <span style="color:#f92672">-</span>pf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./package-debug&#34;</span> <span style="color:#f92672">-</span>s build_type<span style="color:#66d9ef">=</span><span style="color:#a6e22e">Debug</span> <span style="color:#f92672">-</span>f <span style="color:#f92672">&amp;&amp;</span> conan upload <span style="color:#f92672">%</span>system<span style="color:#f92672">.</span>projectName<span style="color:#f92672">%</span> <span style="color:#f92672">--</span>all <span style="color:#f92672">--</span>remote<span style="color:#66d9ef">=</span><span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span> <span style="color:#f92672">--</span>check <span style="color:#f92672">--</span>confirm
</span></span><span style="display:flex;"><span>conan export<span style="color:#f92672">-</span>pkg conanfile<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>s compiler<span style="color:#f92672">.</span>toolset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;v142&#34;</span> <span style="color:#f92672">-</span>pf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./package-release&#34;</span> <span style="color:#f92672">-</span>s build_type<span style="color:#66d9ef">=</span><span style="color:#a6e22e">Release</span> <span style="color:#f92672">-</span>f <span style="color:#f92672">&amp;&amp;</span> conan upload <span style="color:#f92672">%</span>system<span style="color:#f92672">.</span>projectName<span style="color:#f92672">%</span> <span style="color:#f92672">--</span>all <span style="color:#f92672">--</span>remote<span style="color:#66d9ef">=</span><span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span> <span style="color:#f92672">--</span>check <span style="color:#f92672">--</span>confirm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>conan remove <span style="color:#e6db74">&#34;%system.projectName%*&#34;</span> <span style="color:#f92672">-</span>f</span></span></code></pre></div>
<p>Setting the package version with <code>sed</code> is explained in <a href="#conanfile">conanfile</a> description.</p>
<p>Removing the package (<em><code>conan remove</code></em>) from <a href="https://docs.conan.io/en/latest/cheatsheet.html?highlight=cache#the-local-cache">local cache</a> after publishing it to Artifactory is optional.</p>
<p>As usual, on Mac OS Bash commands behave differently, so you&rsquo;ll need to adjust <code>sed</code> arguments and use <code>rsync</code> instead of <code>cp</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir ./package-debug
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;&#34;</span> -E <span style="color:#e6db74">&#39;s/.*install\///g&#39;</span> ./install-manifest-debug.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir ./package-release
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;&#34;</span> -E <span style="color:#e6db74">&#39;s/.*install\///g&#39;</span> ./install-manifest-release.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd install
</span></span><span style="display:flex;"><span>rsync -R <span style="color:#66d9ef">$(</span>&lt;../install-manifest-debug.txt<span style="color:#66d9ef">)</span> ../package-debug <span style="color:#f92672">||</span> :
</span></span><span style="display:flex;"><span>rsync -R <span style="color:#66d9ef">$(</span>&lt;../install-manifest-release.txt<span style="color:#66d9ef">)</span> ../package-release <span style="color:#f92672">||</span> :
</span></span><span style="display:flex;"><span>cd ..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#34;&#34;</span> -E <span style="color:#e6db74">&#39;s/version = &#34;0\.0\.0&#34;$/version = &#34;%system.current-version%&#34;/&#39;</span> ./conanfile.py
</span></span><span style="display:flex;"><span>conan export-pkg conanfile.py -s arch<span style="color:#f92672">=</span>armv8 -pf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./package-debug&#34;</span> -s build_type<span style="color:#f92672">=</span>Debug -f <span style="color:#f92672">&amp;&amp;</span> conan upload %system.projectName% --all --remote<span style="color:#f92672">=</span>YOUR-CONAN-REMOTE --check --confirm
</span></span><span style="display:flex;"><span>conan export-pkg conanfile.py -s arch<span style="color:#f92672">=</span>armv8 -pf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./package-release&#34;</span> -s build_type<span style="color:#f92672">=</span>Release -f <span style="color:#f92672">&amp;&amp;</span> conan upload %system.projectName% --all --remote<span style="color:#f92672">=</span>YOUR-CONAN-REMOTE --check --confirm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>conan remove <span style="color:#e6db74">&#34;%system.projectName%*&#34;</span> -f</span></span></code></pre></div>
<p>By the way, since we are talking about Mac OS special needs, if you&rsquo;ll need to RegEx a <code>\w+</code> pattern, for example this one: <code>'s/.*install\/\w\+\///g'</code>, then you&rsquo;ll have to do it like that: <code>'s/.*install\/[a-zA-Z0-9_]+\///g'</code>.</p>
<p>After you run building and packing steps on all the platforms/targets, here&rsquo;s what you&rsquo;ll get in the Artifactory:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/artifactory-conan-package.png" alt="JFrog Artifactory, Conan package">

<p>So it is 10 packages in total: 5 platforms, each having 2 configurations (<em>Debug/Release</em>).</p>
<h1 id="resolving-dependencies-in-a-project">Resolving dependencies in a project</h1>
<p>As an example, let&rsquo;s take the <a href="https://github.com/retifrav/glfw-imgui-example">same application</a> that was used for benchmarking build times <a href="#why-bother">in the beginning</a>.</p>
<p>I have all of its dependencies pre-built and published in Artifactory, so I can fetch them with Conan. For that I can either create <a href="https://docs.conan.io/en/latest/reference/conanfile_txt.html">conanfile.txt</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[requires]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">glad/0.1.36@YOUR-PREFIX/public</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GLFW/3.3.5@YOUR-PREFIX/public</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">DearImGui/1.86.0@YOUR-PREFIX/public</span></span></span></code></pre></div>
<p>or <a href="https://docs.conan.io/en/latest/reference/conanfile.html">conanfile.py</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> conans <span style="color:#f92672">import</span> ConanFile, CMake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>prefixChannel <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;@YOUR-PREFIX/public&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SandboxConan</span>(ConanFile):
</span></span><span style="display:flex;"><span>    settings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;os&#34;</span>, <span style="color:#e6db74">&#34;arch&#34;</span>, <span style="color:#e6db74">&#34;compiler&#34;</span>
</span></span><span style="display:flex;"><span>    generators <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cmake&#34;</span>
</span></span><span style="display:flex;"><span>    requires <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;glad/0.1.36</span><span style="color:#e6db74">{</span>prefixChannel<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;GLFW/3.3.5</span><span style="color:#e6db74">{</span>prefixChannel<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;DearImGui/1.86.0</span><span style="color:#e6db74">{</span>prefixChannel<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    ]</span></span></code></pre></div>
<p>Now I can fetch them all:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ conan install <span style="color:#f92672">..</span> <span style="color:#f92672">-</span>r YOUR<span style="color:#f92672">-</span>CONAN<span style="color:#f92672">-</span>REMOTE
</span></span><span style="display:flex;"><span>Configuration:
</span></span><span style="display:flex;"><span>[settings]
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>x86_64
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>apple<span style="color:#f92672">-</span>clang
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">.</span>libcxx<span style="color:#f92672">=</span>libc<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">.</span>version<span style="color:#f92672">=</span><span style="color:#ae81ff">12.0</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>[options]
</span></span><span style="display:flex;"><span>[build_requires]
</span></span><span style="display:flex;"><span>[env]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.94</span>k]
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.86</span>k]
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.92</span>k]
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Installing <span style="color:#66d9ef">package</span>
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>    GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>    glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>Packages
</span></span><span style="display:flex;"><span>    DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public:f83037eff23ab3a94190d7f3f7b37a2d6d522241 <span style="color:#f92672">-</span> Download
</span></span><span style="display:flex;"><span>    GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public:f83037eff23ab3a94190d7f3f7b37a2d6d522241 <span style="color:#f92672">-</span> Download
</span></span><span style="display:flex;"><span>    glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public:f83037eff23ab3a94190d7f3f7b37a2d6d522241 <span style="color:#f92672">-</span> Download
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Installing (downloading, building) binaries<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Retrieving <span style="color:#66d9ef">package</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241 from remote <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.63</span>k]
</span></span><span style="display:flex;"><span>Downloading conaninfo<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.40</span>k]
</span></span><span style="display:flex;"><span>Downloading conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">577.86</span>k]
</span></span><span style="display:flex;"><span>Decompressing conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">0.00</span>k]
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Package installed f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Downloaded <span style="color:#66d9ef">package</span> revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Retrieving <span style="color:#66d9ef">package</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241 from remote <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.56</span>k]
</span></span><span style="display:flex;"><span>Downloading conaninfo<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.40</span>k]
</span></span><span style="display:flex;"><span>Downloading conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">123.99</span>k]
</span></span><span style="display:flex;"><span>Decompressing conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">0.00</span>k]
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Package installed f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Downloaded <span style="color:#66d9ef">package</span> revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Retrieving <span style="color:#66d9ef">package</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241 from remote <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.39</span>k]
</span></span><span style="display:flex;"><span>Downloading conaninfo<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.40</span>k]
</span></span><span style="display:flex;"><span>Downloading conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">333.16</span>k]
</span></span><span style="display:flex;"><span>Decompressing conan_package<span style="color:#f92672">.</span>tgz completed [<span style="color:#ae81ff">0.00</span>k]
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Package installed f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Downloaded <span style="color:#66d9ef">package</span> revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Generator cmake created conanbuildinfo<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Generator txt created conanbuildinfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Aggregating env generators
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Generated conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Generated graphinfo</span></span></code></pre></div>
<p>Lucky me, the auto-generated Conan profile for my environment matches the one on the buildbots, so I got everything found and installed.</p>
<p>But actually it doesn&rsquo;t match, and here&rsquo;s what I was really getting with auto-generated profile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span>Configuration:
</span></span><span style="display:flex;"><span>[settings]
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>x86_64
</span></span><span style="display:flex;"><span>arch_build<span style="color:#f92672">=</span>x86_64
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>clang
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">.</span>libcxx<span style="color:#f92672">=</span>libstdc<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">.</span>version<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>os_build<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>[options]
</span></span><span style="display:flex;"><span>[build_requires]
</span></span><span style="display:flex;"><span>[env]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.94</span>k]
</span></span><span style="display:flex;"><span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.86</span>k]
</span></span><span style="display:flex;"><span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Retrieving from server <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Trying with <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>Downloading conanmanifest<span style="color:#f92672">.</span>txt completed [<span style="color:#ae81ff">0.06</span>k]
</span></span><span style="display:flex;"><span>Downloading conanfile<span style="color:#f92672">.</span>py completed [<span style="color:#ae81ff">0.92</span>k]
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: Downloaded recipe revision <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>conanfile<span style="color:#f92672">.</span>py: Installing <span style="color:#66d9ef">package</span>
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>    GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>    glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public from <span style="color:#e6db74">&#39;YOUR-CONAN-REMOTE&#39;</span> <span style="color:#f92672">-</span> Downloaded
</span></span><span style="display:flex;"><span>Packages
</span></span><span style="display:flex;"><span>    DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4 <span style="color:#f92672">-</span> Missing
</span></span><span style="display:flex;"><span>    GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4 <span style="color:#f92672">-</span> Missing
</span></span><span style="display:flex;"><span>    glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4 <span style="color:#f92672">-</span> Missing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Installing (downloading, building) binaries<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>ERROR: Missing binary: DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4
</span></span><span style="display:flex;"><span>ERROR: Missing binary: GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4
</span></span><span style="display:flex;"><span>ERROR: Missing binary: glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public:c48a49ca4467bb2c7f002b84b691f213c49e91b4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public: WARN: Can<span style="color:#e6db74">&#39;t find a &#39;</span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public<span style="color:#e6db74">&#39; package for the specified settings, options and dependencies:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- Settings: arch=x86_64, build_type=Release, compiler=clang, compiler.libcxx=libstdc++, compiler.version=13, os=Macos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- Options:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- Dependencies:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- Requirements:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- Package ID: c48a49ca4467bb2c7f002b84b691f213c49e91b4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ERROR: Missing prebuilt package for &#39;</span>DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public<span style="color:#e6db74">&#39;, &#39;</span>GLFW<span style="color:#e6db74">/3.3.5@YOUR-PREFIX/</span>public<span style="color:#e6db74">&#39;, &#39;</span>glad<span style="color:#e6db74">/0.1.36@YOUR-PREFIX/</span>public<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Use &#39;</span>conan search DearImGui<span style="color:#e6db74">/1.86.0@YOUR-PREFIX/</span>public <span style="color:#f92672">--</span>table<span style="color:#f92672">=</span>table<span style="color:#f92672">.</span>html <span style="color:#f92672">-</span>r<span style="color:#f92672">=</span>remote<span style="color:#e6db74">&#39; and open the table.html file to see available packages
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Or try to build locally from sources with &#39;</span><span style="color:#f92672">--</span>build<span style="color:#f92672">=</span>DearImGui <span style="color:#f92672">--</span>build<span style="color:#f92672">=</span>GLFW <span style="color:#f92672">--</span>build<span style="color:#f92672">=</span>glad<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">More Info at &#39;</span>https:<span style="color:#e6db74">//</span>docs<span style="color:#f92672">.</span>conan<span style="color:#f92672">.</span>io<span style="color:#e6db74">/en/</span>latest<span style="color:#e6db74">/faq/</span>troubleshooting<span style="color:#f92672">.</span>html<span style="color:#75715e">#error-missing-prebuilt-package&#39;</span></span></span></code></pre></div>
<p>This command, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ conan search <span style="color:#a6e22e">DearImGui</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.86</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#a6e22e">@YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span><span style="color:#f92672">/</span>public <span style="color:#f92672">--</span>table<span style="color:#66d9ef">=</span>table<span style="color:#f92672">.</span>html <span style="color:#f92672">-</span>r <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span></span></span></code></pre></div>
<p>will generate a table of all the packages available for Dear ImGui in your Conan remote:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/all-available-packages.png" alt="Conan, listing all available packages">

<p>Ideally, I would need to add a build environment on the buildbots that matches mine, build all dependencies with it and publish them to Artifactory too, but it&rsquo;s bloody impossible to cover all possible configurations that users might have, so instead users (<em>and I</em>) can just adjust their local Conan profiles. In my case it would be <code>~/.conan/profiles/artifactory</code> with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[settings]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">arch</span><span style="color:#f92672">=</span><span style="color:#e6db74">x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    build_type=Release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    compiler=apple-clang
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    compiler.libcxx=libc++
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    compiler.version=12.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    os=Macos</span></span></span></code></pre></div>
<p>And then I can use this profile like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ conan install <span style="color:#f92672">..</span> <span style="color:#f92672">--</span>profile artifactory <span style="color:#f92672">-</span>r <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">CONAN</span><span style="color:#f92672">-</span><span style="color:#a6e22e">REMOTE</span></span></span></code></pre></div>
<p>However, getting ahead of myself a bit, while this helps to convince Conan to install the packages, such profile tinkering will cause CMake to fail on configuration with the following error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">CMake</span> <span style="color:#a6e22e">Error</span> at build<span style="color:#f92672">/</span>conanbuildinfo<span style="color:#f92672">.</span>cmake<span style="color:#66d9ef">:</span><span style="color:#960050;background-color:#1e0010">731</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">message</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Detected</span> a mismatch <span style="color:#66d9ef">for</span> the compiler version between your conan profile
</span></span><span style="display:flex;"><span>  settings and <span style="color:#a6e22e">CMake</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Compiler</span> <span style="color:#66d9ef">version</span> <span style="color:#66d9ef">specified</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">your</span> <span style="color:#66d9ef">conan</span> <span style="color:#66d9ef">profile:</span> <span style="color:#960050;background-color:#1e0010">12</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">Compiler</span> <span style="color:#66d9ef">version</span> <span style="color:#66d9ef">detected</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">CMake:</span> <span style="color:#960050;background-color:#1e0010">13</span><span style="color:#66d9ef">.</span><span style="color:#960050;background-color:#1e0010">0</span></span></span></code></pre></div>
<p>But it&rsquo;s no worries, as this can be overcome with <code>-DCONAN_DISABLE_CHECK_COMPILER=1</code>.</p>
<p>When the <code>conan install</code> succeeds, packages are installed to the local cache on your machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">-</span>L <span style="color:#ae81ff">7</span> <span style="color:#f92672">~/.</span>conan<span style="color:#f92672">/</span>data<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/.</span>conan<span style="color:#f92672">/</span>data<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">DearImGui</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#ae81ff">1.86</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> public
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> dl
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> pkg
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> locks
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#66d9ef">package</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│           │       └── </span>f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> public<span style="color:#f92672">.</span>count
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> public<span style="color:#f92672">.</span>count<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">GLFW</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#ae81ff">3.3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> public
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> dl
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> pkg
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> locks
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#66d9ef">package</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│           │       └── </span>f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> public<span style="color:#f92672">.</span>count
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> public<span style="color:#f92672">.</span>count<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> glad
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> <span style="color:#ae81ff">0.1</span><span style="color:#f92672">.</span><span style="color:#ae81ff">36</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> public
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> dl
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> pkg
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> export
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> locks
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> metadata<span style="color:#f92672">.</span>json<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#66d9ef">package</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">│       └── </span>f83037eff23ab3a94190d7f3f7b37a2d6d522241
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> cmake
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>           <span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">│</span>           <span style="color:#f92672">└──</span> lib
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">├──</span> public<span style="color:#f92672">.</span>count
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> public<span style="color:#f92672">.</span>count<span style="color:#f92672">.</span>lock</span></span></code></pre></div>
<p>You can also list them like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> conan search
</span></span><span style="display:flex;"><span>Existing package recipes:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DearImGui/<span style="color:#ae81ff">1.86</span>.<span style="color:#ae81ff">0</span>@YOUR-PREFIX/<span style="color:#66d9ef">public</span>
</span></span><span style="display:flex;"><span>GLFW/<span style="color:#ae81ff">3.3</span>.<span style="color:#ae81ff">5</span>@YOUR-PREFIX/<span style="color:#66d9ef">public</span>
</span></span><span style="display:flex;"><span>glad/<span style="color:#ae81ff">0.1</span>.<span style="color:#ae81ff">36</span>@YOUR-PREFIX/<span style="color:#66d9ef">public</span></span></span></code></pre></div>
<p>And the project build directory now looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ ls <span style="color:#f92672">-</span>L1 <span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>conan<span style="color:#f92672">.</span>lock
</span></span><span style="display:flex;"><span>conanbuildinfo<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>conanbuildinfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>graph_info<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<p>The <code>conanbuildinfo.cmake</code> contains auto-generated CMake instructions for finding all the installed dependencies, and you need to add it to your project&rsquo;s <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>include(<span style="color:#f92672">${</span>CMAKE_CURRENT_BINARY_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/conanbuildinfo.cmake</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span>conan_basic_setup()</span></span></code></pre></div>
<p>After that you can call <code>find_package()</code> as usual, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">glfw3</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)</span></span></code></pre></div>
<p>And this is it, the project is ready to build, and it will only build its own sources and link to pre-built dependencies.</p>
<p>Here are all the commands from the creation of the build folder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ mkdir build <span style="color:#f92672">&amp;&amp;</span> cd $_
</span></span><span style="display:flex;"><span>$ conan install .. --profile artifactory -r YOUR-CONAN-REMOTE
</span></span><span style="display:flex;"><span>$ cmake -G Ninja -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>Release -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../install&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -DUSING_CONAN<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -DCONAN_DISABLE_CHECK_COMPILER<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ time cmake --build . --target install
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>3/4<span style="color:#f92672">]</span> Install the project...
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /path/to/glfw-imgui/install/bin/glfw-imgui/glfw-imgui
</span></span><span style="display:flex;"><span>-- Installing: /path/to/glfw-imgui/install/bin/glfw-imgui/JetBrainsMono-ExtraLight.ttf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>real    0m1.166s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ../install/bin/glfw-imgui/glfw-imgui</span></span></code></pre></div>
<p>Absolutely magnificent.</p>
<h1 id="dependency-graph">Dependency graph</h1>
<p>Speaking about <a href="#dependencies-of-dependencies">dependencies of dependencies</a>, here&rsquo;s another nice feature of Conan - it can generate a <a href="https://docs.conan.io/en/1.45/reference/commands/consumer/info.html">dependency graph</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ conan info <span style="color:#f92672">../</span>conanfile<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>g <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>html
</span></span><span style="display:flex;"><span>$ open <span style="color:#f92672">./</span>graph<span style="color:#f92672">.</span>html</span></span></code></pre></div>
<p>Here&rsquo;s an example of a graph from one of our projects that actually depends on E57Format library:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/dependencies-graph.png" alt="Conan dependencies graph">

<p>As you can see, E57Format is a direct dependency of the project and in turn E57Format has Xerces-C++ as its own dependency. You can also click on any node and get some more information about it (<em>Zstandard is clicked on that screenshot</em>).</p>
<p>In our project&rsquo;s <code>conanfile.py</code> we only list direct dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>requires <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Zstandard/1.5.2@YOUR-PREFIX/public&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;pdqsort/1.0.0@YOUR-PREFIX/public&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;JsonCpp/1.9.5@YOUR-PREFIX/public&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;E57Format/2.2.0@YOUR-PREFIX/public&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># no Xerces-C/3.2.3@YOUR-PREFIX/public&#34;</span>
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div>
<p>And Conan then takes care of fetching dependencies of dependencies, how convenient is that.</p>
<p>If you add <code>-j</code> argument to <code>conan info</code>, then you&rsquo;ll get a JSON representation of the graph, which you can easily parse to generate a report about your dependencies (<em>versions, licenses, etc</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ conan info <span style="color:#f92672">../</span>conanfile<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>j <span style="color:#f92672">./</span>dependencies<span style="color:#f92672">.</span>json</span></span></code></pre></div>
<hr class="updates-separator">
<h1 id="updates">Updates</h1>
<h2 id="2022-03-03--once-more-about-self-hosting">2022-03-03 | Once more about self-hosting</h2>
<p>Just a month after I wrote this:</p>
<blockquote>If you are your own evil twin (<i>сам себе злой Буратино</i>), then you can just fetch it from original repositories on GitHub, GitLab or wherever. If you really are an enemy to yourself, then you can also store your own project source code in an external repository too.</blockquote>
<p>&hellip;Russia attacked Ukraine and started a proper retarded war. Shortly after that several IT companies began to block users with russian IP addresses or russian billing addresses. No one cared whether those users were against the war themselves or not, as the companies apparently figured that collective responsibility is okay in the 21th century. Thus, hosting 3rd-party dependencies (<em>both sources and pre-built binaries</em>) in one&rsquo;s own in-house IT infrastructure has already become a (<em>very sudden</em>) reality for at least russian users, so it&rsquo;s no longer a theoretical possibility anymore.</p>
<h2 id="2022-10-30--started-using-vcpkg-instead-of-conan">2022-10-30 | Started using vcpkg instead of Conan</h2>
<p>More than half a year after trying out Conan we started looking into resolving dependencies with <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/">vcpkg</a> and then decided to adopt it as our main package manager.</p>
<h2 id="2023-01-12--an-e-mail-from-jfrog">2023-01-12 | An e-mail from JFrog</h2>
<p>A couple of months after <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/">that article</a> about vcpkg I got an e-mail from someone at JFrog. I won&rsquo;t disclose his name, just in case, but the address was <code>@jfrog.com</code> and he represented himself as someone working with Conan.</p>
<p>It is nothing secret really, he just wanted to know a bit more details about why it took so long for me to resolve the project dependencies with Conan: I <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/#speed">wrote</a> in the article that it took 3 days with vcpkg versus 2 weeks with Conan to resolve the same <a href="/blog/2022/02/06/cpp-dependencies-with-conan/images/dependencies-graph.png">set of dependencies</a>. Apparently, he was under impression that I was trying to use ready-made packages that were already available in Conan Center, and in that case 2 weeks would indeed look like a crazy long period of time for such a trivial task.</p>
<p>So I explained again that we needed to make our own packages of 3rd-party dependencies for publishing them in our internal Artifactory, how in general the slowdown was likely due to the wrong approach that we took (<em>where instead of packing pre-built binaries we should have probably tried to integrate Conan into the project&rsquo;s build system</em>), and also how Conan seemed less intuitive comparing with vcpkg.</p>
<h2 id="2026-02-23--giving-it-another-go-with-modern-conan">2026-02-23 | Giving it another go with modern Conan</h2>
<p>Some years have passed by, and we are still using vcpkg for managing our project dependencies, which works pretty splendid.</p>
<p>However, from time to time we get requests to provide Conan packages for some of our libraries, and by now we&rsquo;ve accumulated enough of those requests for the task to become important enough and worth putting effort into.</p>
<p>Meanwhile, Conan has got version <a href="https://docs.conan.io/2/changelog.html#feb-2023">2.0</a>, which introduced <a href="https://docs.conan.io/2/whatsnew.html">certain changes</a>, so it was a good opportunity to give it another go with modern Conan and this time try building packages from sources instead of just packing pre-built binaries.</p>
<h3 id="building-packages-from-source-in-conan-1x">Building packages from source in Conan 1.x</h3>
<p>To warm-up, let&rsquo;s see how we could/should have done it with Conan 1.x. Specifically, the version I&rsquo;ll be using in the example below is <a href="https://docs.conan.io/1/changelog.html#dec-2024">1.66.0</a> (<em>the latest in the 1.x branch at the moment</em>). And the example itself will be making a package for <a href="https://zlib.net/">zlib</a>.</p>
<p>The very first thing is naturally the sources, which we of course will be getting from Git repositories via SSH. It is assumed that you already have SSH connection established, so your <code>~/.ssh/config</code> contains a record for your Git host (<em>and you have the keys in place too</em>).</p>
<p>Also, despite what I said about self-hosting earlier, in the examples below I will be using GitHub, but do keep in mind that this is just for the sake of demonstration/simplicity, and in production you should really consider relying on your own Git hosting.</p>
<p>Alright, how does one tell Conan where to get the sources from? Well, one way is to use a special file - <a href="https://docs.conan.io/en/1.66/reference/config_files/conandata.yml.html">conandata.yml</a> - where sources URLs can be nicely listed, and it looked so nice that I wrongly assumed that I can list the cloning URLs and commit hashes in there too, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.2.12&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sha1</span>: <span style="color:#e6db74">&#34;21767c654d31d2dccdde4330529775c6c5fd5389&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.3.1&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sha1</span>: <span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>
</span></span></code></pre></div><p>It was already slightly confusing that different versions can have different URLs/repositories, and that actually should have given me a hint that I am doing something wrong. Fast-forwarding a little bit, trying to use those in <a href="https://docs.conan.io/1/reference/conanfile/methods.html#source">source()</a> (<em>the recipe method for declaring package sources</em>) like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">source</span>(self):
</span></span><span style="display:flex;"><span>    get(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">**</span>self<span style="color:#f92672">.</span>conan_data[<span style="color:#e6db74">&#34;sources&#34;</span>][self<span style="color:#f92672">.</span>version],
</span></span><span style="display:flex;"><span>        strip_root<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><p>resulted in errors like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: ERROR: Error downloading file git@github.com:madler/zlib.git: <span style="color:#e6db74">&#39;No connection adapters were found for &#39;</span>git@github.com:madler/zlib.git<span style="color:#e6db74">&#39;&#39;</span>
</span></span></code></pre></div><p>I also tried different URLs like:</p>
<ul>
<li><code>git@github.com:madler/zlib.git</code></li>
<li><code>ssh://git@github.com:madler/zlib.git</code></li>
<li><code>git+ssh://git@github.com:madler/zlib.git</code></li>
<li><code>ssh://github.com:madler/zlib.git</code></li>
<li><code>git+ssh://github.com:madler/zlib.git</code></li>
</ul>
<p>but the error was stull the same. Which should have not come as a surprise, because <code>conandata.yml</code> file is not meant for listing repositories and commit hashes for cloning. As I realized, those <code>url</code> values are meant to be mere download URLs of the sources snapshots/archives, and <code>sha1</code> values are checksums of those files. So a correct list of sources in <code>conandata.yml</code> would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.2.12&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;https://github.com/madler/zlib/archive/refs/tags/v1.2.12.zip&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sha1</span>: <span style="color:#e6db74">&#34;35c02072f6e3d673f01df54735d5b6af786e0e84&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.3.1&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;https://github.com/madler/zlib/archive/refs/tags/v1.3.1.zip&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sha1</span>: <span style="color:#e6db74">&#34;aafd4f6196c7024a81d3268bf0b777c9b814cf2c&#34;</span>
</span></span></code></pre></div><p>and then <a href="https://docs.conan.io/1/reference/conanfile/tools/files/downloads.html#conan-tools-files-get">get()</a> would be able to work with those.</p>
<p>Okay, but what if I want to clone a Git repository and checkout a specific version tag/commit, how is that done then? Turns out, there is a special <a href="https://docs.conan.io/en/1.66/reference/conanfile/attributes.html#scm">scm</a> thing for that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">zlibConan</span>(ConanFile):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;zlib&#34;</span>
</span></span><span style="display:flex;"><span>    version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.3.1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    scm <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;subfolder&#34;</span>: <span style="color:#e6db74">&#34;src&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;revision&#34;</span>: <span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>This will get you zlib sources for version <a href="https://github.com/madler/zlib/releases/tag/v1.3.1">1.3.1</a>. And if you will need version <a href="https://github.com/madler/zlib/releases/tag/v1.2.12">1.2.12</a>, then you&rsquo;ll need to edit the recipe and replace the version and Git commit hash. But then if you&rsquo;ll need to make changes in <code>1.3.1</code> again and make a new package, there doesn&rsquo;t seem to be a way to quickly find that particular revision of the recipe, so I guess one would have to go through the file history in Git log (<em>that is if recipes are tracked with any VCS at all</em>).</p>
<p>It is quite a shame that <code>conandata.yml</code> is not meant for listing cloning URLs and commit hashes. One could probably try to somewhat replicate it like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">zlibConan</span>(ConanFile):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;zlib&#34;</span>
</span></span><span style="display:flex;"><span>    version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.3.1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex; background-color:#3c3d38"><span>    versionsHashes <span style="color:#f92672">=</span> {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;1.2.12&#34;</span>: <span style="color:#e6db74">&#34;21767c654d31d2dccdde4330529775c6c5fd5389&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;1.3.1&#34;</span>: <span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    scm <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;subfolder&#34;</span>: <span style="color:#e6db74">&#34;src&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;revision&#34;</span>: versionsHashes[version]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>so the commit hash would be looked up in <code>versionsHashes</code> dictionary, but that doesn&rsquo;t strike me as a great solution. Besides, editing the <code>version</code> value in the recipe file would still be required, wouldn&rsquo;t it, unless there is already a CLI argument for it?</p>
<p>Anyway, we got the sources, now let&rsquo;s apply the patches (<em>of course we have patches</em>). Those can be listed in the same <code>conandata.yml</code>, and in this case it is intuitive enough:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.3.1&#34;</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch_file</span>: <span style="color:#e6db74">&#34;../patches/1.3.1/001-single-target-and-installation.patch&#34;</span>
</span></span></code></pre></div><p>The relative path with <code>../</code> here is because the recipe folder structure is like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#ae81ff">1.</span>x
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conandata<span style="color:#f92672">.</span>yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#ae81ff">2.</span>x
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> conandata<span style="color:#f92672">.</span>yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> patches
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> <span style="color:#ae81ff">1.3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#ae81ff">001</span><span style="color:#f92672">-</span>single<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>and<span style="color:#f92672">-</span>installation<span style="color:#f92672">.</span>patch
</span></span></code></pre></div><p>because I intend to re-use those patches later for the <a href="#building-packages-from-source-in-conan-2x">Conan 2.x</a> recipe too.</p>
<p>Next, patches are applied with <a href="https://docs.conan.io/1/reference/conanfile/tools/files/patches.html#conan-tools-files-apply-conandata-patches">apply_conandata_patches()</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">source</span>(self):
</span></span><span style="display:flex;"><span>    apply_conandata_patches(self)
</span></span></code></pre></div><p>But if you do it like this straight away, it will fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ERROR: zlib/1.3.1@YOUR-PREFIX/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>        apply_conandata_patches<span style="color:#f92672">(</span>self<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        FileNotFoundError: <span style="color:#f92672">[</span>Errno 2<span style="color:#f92672">]</span> No such file or directory: <span style="color:#e6db74">&#39;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/source/patches/1.3.1/001-single-target-and-installation.patch&#39;</span>
</span></span></code></pre></div><p>because, as you can see, it tries to use that <code>../patches/</code> path to find the patch in the sources folder that was created in Conan&rsquo;s own internal directory. To make that work, you first need to &ldquo;export&rdquo; the patches with <a href="https://docs.conan.io/1/reference/conanfile/tools/files/patches.html#conan-tools-files-export-conandata-patches">export_conandata_patches()</a> in the <a href="https://docs.conan.io/1/reference/conanfile/methods.html#export-sources">export_sources()</a> recipe method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span></code></pre></div><p>While we are here, the build will also need <code>Config.cmake.in</code> and <code>Installing.cmake</code> files that are not part of the original zlib repository, and such additional files are also supposed to be &ldquo;exported&rdquo; to that internal sources folder in the same <code>export_sources()</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span><span style="display:flex; background-color:#3c3d38"><span>    self<span style="color:#f92672">.</span>copy(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../../_cmake&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><p>As you might have guessed, the recipes repository folder structure looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">_cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Config</span><span style="color:#f92672">.</span>cmake<span style="color:#f92672">.</span>in
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Installing</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">README</span><span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> zlib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> <span style="color:#ae81ff">1.</span>x
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> <span style="color:#ae81ff">2.</span>x
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> patches
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>where <code>_cmake</code> folder is dedicated for storing common files that might be used in more than one recipe/package.</p>
<p>The rest of the recipe is simple enough (<em>if anything, the full recipe file is <a href="https://github.com/retifrav/conan-recipes/blob/2ca553a3e4e16c97c7129e1899bfdfe55da8d517/zlib/1.x/conanfile.py">here</a></em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># not sure what is the point of this</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">layout</span>(self):
</span></span><span style="display:flex;"><span>    cmake_layout(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># one would guess that this is for configuring the project with CMake,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and choosing Ninja generator points out to that, but no,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># this is not the configuration yet</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate</span>(self):
</span></span><span style="display:flex;"><span>    tc <span style="color:#f92672">=</span> CMakeToolchain(self, generator<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ninja&#34;</span>)
</span></span><span style="display:flex;"><span>    tc<span style="color:#f92672">.</span>generate()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...because CMake configuration options are provided here,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># such as `-DZLIB_BUILD_EXAMPLES=&#34;NO&#34;`, so apparently</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># project configuration and actual build both happen here</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build</span>(self):
</span></span><span style="display:flex;"><span>    cmake <span style="color:#f92672">=</span> CMake(self)
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>configure(
</span></span><span style="display:flex;"><span>        variables<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ZLIB_BUILD_EXAMPLES&#34;</span>: <span style="color:#e6db74">&#34;NO&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>build()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and this is apparently where `cmake --install ...` is executed</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package</span>(self):
</span></span><span style="display:flex;"><span>    cmake <span style="color:#f92672">=</span> CMake(self)
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>install()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># but what is this one for - I still don&#39;t exactly understand</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package_info</span>(self):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cpp_info<span style="color:#f92672">.</span>libs <span style="color:#f92672">=</span> collect_libs(self)
</span></span></code></pre></div><p>Now, to make a package out of it:</p>
<details>
    <summary>conan create . -s build_type=Release</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ cd /path/to/conan-recipes/zlib/1.x/
</span></span><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARN: **************************************************
</span></span><span style="display:flex;"><span>WARN: *** Conan <span style="color:#ae81ff">1</span> is legacy and on a deprecation path **
</span></span><span style="display:flex;"><span>WARN: *********** Please upgrade to Conan <span style="color:#ae81ff">2</span> ************
</span></span><span style="display:flex;"><span>WARN: **************************************************
</span></span><span style="display:flex;"><span>Exporting package recipe
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public exports: File <span style="color:#e6db74">&#39;conandata.yml&#39;</span> found. Exporting it...
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public exports: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.yml&#39;</span> file: conandata.yml
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Calling export_sources<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public export_sources<span style="color:#f92672">()</span> method: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.cmake&#39;</span> file: Installing.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public export_sources<span style="color:#f92672">()</span> method: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.in&#39;</span> file: Config.cmake.in
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: A new conanfile.py version was exported
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Folder: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/export
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Exported revision: 5e30e473e81f6d582d21db72125c9108
</span></span><span style="display:flex;"><span>Configuration:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>arch_build<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>apple-clang
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>os_build<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>build_requires<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>env<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Forced build from source
</span></span><span style="display:flex;"><span>Installing package: zlib/1.3.1@YOUR-PREFIX/public
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@YOUR-PREFIX/public from local cache - Cache
</span></span><span style="display:flex;"><span>Packages
</span></span><span style="display:flex;"><span>    zlib/1.3.1@YOUR-PREFIX/public:b630615c359f51b1f6e37bde5d0a2d8a1dcd4438 - Build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Installing <span style="color:#f92672">(</span>downloading, building<span style="color:#f92672">)</span> binaries...
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Configuring sources in /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/source/.
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: SCM: Getting sources from url: <span style="color:#e6db74">&#39;git@github.com:madler/zlib.git&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Copying sources to build folder
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Building your package in /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Generator txt created conanbuildinfo.txt
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Calling generate<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: WARN: Using the new toolchains and generators without specifying a build profile <span style="color:#f92672">(</span>e.g: -pr:b<span style="color:#f92672">=</span>default<span style="color:#f92672">)</span> is discouraged and might cause failures and unexpected behavior
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Preset <span style="color:#e6db74">&#39;release&#39;</span> added to CMakePresets.json. Invoke it manually using <span style="color:#e6db74">&#39;cmake --preset release&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: If your CMake version is not compatible with CMakePresets <span style="color:#f92672">(</span>&lt;3.19<span style="color:#f92672">)</span> call cmake like: <span style="color:#e6db74">&#39;cmake &lt;path&gt; -G Ninja -DCMAKE_TOOLCHAIN_FILE=/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release/generators/conan_toolchain.cmake -DCMAKE_POLICY_DEFAULT_CMP0091=NEW -DCMAKE_BUILD_TYPE=Release&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Aggregating env generators
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Calling build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: CMake command: cmake -G <span style="color:#e6db74">&#34;Ninja&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release/generators/conan_toolchain.cmake&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438&#34;</span> -DCMAKE_POLICY_DEFAULT_CMP0091<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NEW&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Release&#34;</span> -DZLIB_BUILD_EXAMPLES<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NO&#34;</span> <span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/.&#34;</span>
</span></span><span style="display:flex;"><span>-- Using Conan toolchain: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release/generators/conan_toolchain.cmake
</span></span><span style="display:flex;"><span>-- The C compiler identification is AppleClang 17.0.0.17000603
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Check <span style="color:#66d9ef">for</span> working C compiler: /opt/homebrew/opt/ccache/libexec/cc - skipped
</span></span><span style="display:flex;"><span>-- Detecting C compile features
</span></span><span style="display:flex;"><span>-- Detecting C compile features - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h - found
</span></span><span style="display:flex;"><span>-- Check size of off64_t
</span></span><span style="display:flex;"><span>-- Check size of off64_t - failed
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h - found
</span></span><span style="display:flex;"><span>-- Configuring <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>1.2s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- Generating <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>0.0s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>CMake Warning:
</span></span><span style="display:flex;"><span>  Manually-specified variables were not used by the project:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CMAKE_POLICY_DEFAULT_CMP0091
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Build files have been written to: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: CMake command: cmake --build <span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release&#34;</span> <span style="color:#e6db74">&#39;--&#39;</span> <span style="color:#e6db74">&#39;-j12&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>16/16<span style="color:#f92672">]</span> Linking C static library libz.a
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Package <span style="color:#e6db74">&#39;b630615c359f51b1f6e37bde5d0a2d8a1dcd4438&#39;</span> built
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Build folder /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Generated conaninfo.txt
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Generated conanbuildinfo.txt
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Generating the package
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Package folder /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Calling package<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: CMake command: cmake --install <span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/build/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/build/Release&#34;</span> --prefix <span style="color:#e6db74">&#34;/Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438&#34;</span>
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/lib/libz.a
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/include/zlib/zconf.h
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/include/zlib/zlib.h
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/share/zlib/zlibTargets.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/share/zlib/zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/share/zlib/zlibConfig.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan/data/zlib/1.3.1/YOUR-PREFIX/public/package/b630615c359f51b1f6e37bde5d0a2d8a1dcd4438/share/zlib/zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#39;.h&#39;</span> files: zlib.h, zconf.h
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.a&#39;</span> file: libz.a
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">4</span> <span style="color:#e6db74">&#39;.cmake&#39;</span> files: zlibConfig.cmake, zlibTargets.cmake, zlibConfigVersion.cmake, zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Package <span style="color:#e6db74">&#39;b630615c359f51b1f6e37bde5d0a2d8a1dcd4438&#39;</span> created
</span></span><span style="display:flex;"><span>zlib/1.3.1@YOUR-PREFIX/public: Created package revision b5b84e57be5a98e7edadf57a952a1a52
</span></span><span style="display:flex;"><span>WARN: Revisions are disabled. Using Conan without revisions enabled is deprecated</span></span></code></pre></div>
</details>
<p>Resulting package will look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">/</span><span style="color:#a6e22e">Users</span><span style="color:#f92672">/</span><span style="color:#a6e22e">USERNAME</span><span style="color:#f92672">/.</span>conan<span style="color:#f92672">/</span>data<span style="color:#f92672">/</span>zlib<span style="color:#f92672">/</span><span style="color:#ae81ff">1.3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#a6e22e">YOUR</span><span style="color:#f92672">-</span><span style="color:#a6e22e">PREFIX</span><span style="color:#f92672">/</span>public<span style="color:#f92672">/</span>package<span style="color:#f92672">/</span>b630615c359f51b1f6e37bde5d0a2d8a1dcd4438
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> conaninfo<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> conanmanifest<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> include
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> zlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">├──</span> zconf<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>       <span style="color:#f92672">└──</span> zlib<span style="color:#f92672">.</span>h
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> lib
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> libz<span style="color:#f92672">.</span>a
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> share
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> zlib
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> zlibConfig<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> zlibConfigVersion<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">├──</span> zlibTargets<span style="color:#f92672">-</span>release<span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> zlibTargets<span style="color:#f92672">.</span>cmake
</span></span></code></pre></div><p>That is for Release configuration, and let&rsquo;s make one for Debug too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Debug
</span></span></code></pre></div><p>Now it is ready to be published to a Conan remote. We are using <a href="https://docs.gitea.com/usage/packages/conan">Gitea</a>, so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan remote add our-gitea https://gitea.OUR.HOST/api/packages/OUR-ORGANIZATION/conan
</span></span><span style="display:flex;"><span>$ conan user SOME-BUILDBOT --remote our-gitea -p SOME-BUILDBOT-ACCESS-TOKEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ conan upload zlib/1.3.1@YOUR-PREFIX/public --all -r our-gitea
</span></span></code></pre></div><p>If will execute without errors, but the published package will have <a href="https://github.com/go-gitea/gitea/issues/33847#issuecomment-3636384496">zero size</a> for all of its files:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/gitea-conan-package-zero-size.png" alt="Gitea, Conan package of zero size">

<p>which clearly makes it unusable. Why did it even upload anything at all instead of just failing - that puzzles me to no end.</p>
<p>Moreover, trying to execute the same command again will fail like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan upload zlib/1.3.1@YOUR-PREFIX/public --all -r our-gitea
</span></span><span style="display:flex;"><span>Uploading to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span>:
</span></span><span style="display:flex;"><span>Uploading zlib/1.3.1@YOUR-PREFIX/public to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span>
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@YOUR-PREFIX/public: Upload recipe to <span style="color:#e6db74">&#39;our-gitea&#39;</span> failed: invalid literal <span style="color:#66d9ef">for</span> int<span style="color:#f92672">()</span> with base 10: <span style="color:#e6db74">&#39;&#39;</span>. <span style="color:#f92672">[</span>Remote: our-gitea<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ERROR: Errors uploading some packages
</span></span></code></pre></div><p>Don&rsquo;t know who screwed up what, Conan or Gitea, but the(?) workaround seems to be setting the <code>CONAN_REVISIONS_ENABLED</code> environment variable before uploading (<em>but first remove the invalid package from remote, just in case</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ CONAN_REVISIONS_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> conan upload zlib/1.3.1@YOUR-PREFIX/public --all -r our-gitea
</span></span></code></pre></div><p>Then it will upload okay:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/06/cpp-dependencies-with-conan/images/gitea-conan-package.png" alt="Gitea, Conan package">

<p>And trying to execute the same command once more will no longer be failing either:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ CONAN_REVISIONS_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> conan upload zlib/1.3.1@YOUR-PREFIX/public --all -r our-gitea
</span></span><span style="display:flex;"><span>Uploading to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span>:
</span></span><span style="display:flex;"><span>Uploading zlib/1.3.1@YOUR-PREFIX/public to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span>
</span></span><span style="display:flex;"><span>Recipe is up to date, upload skipped
</span></span></code></pre></div><p>Now it&rsquo;s all done, but <strong>be aware</strong> that this package is likely to fail with <code>--build missing</code> in other environments/platforms/profiles because of the&hellip; missing patches (<em>surprise!</em>), but more on that <a href="#making-sure-that-build-missing-works">later</a>.</p>
<h3 id="building-packages-from-source-in-conan-2x">Building packages from source in Conan 2.x</h3>
<p>Alright, now let&rsquo;s see how things are in Conan 2.x. Specifically, I&rsquo;ll be using version <a href="https://docs.conan.io/2/changelog.html#feb-2026">2.25.2</a>.</p>
<p>First thing of note is that <code>YOUR-PREFIX</code> is now required to be lower-cased. In fact, the entire <code>zlib/1.3.1@your-prefix/public</code> specification string must be lower-cased, and that is a good requirement, I welcome it very much.</p>
<p>Then what I noticed right away is that there is no <code>scm</code> thing anymore. It doesn&rsquo;t print any errors but it also does not do shit, and there is no 2.x documentation for it either. To be fair, it was marked as deprecated already in 1.x documentation, so this was more or less expected. From what I gather, instead of <code>scm</code> one should use the <a href="https://docs.conan.io/2/reference/tools/scm/git.html">Git module</a> now:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>git <span style="color:#f92672">=</span> Git(self)
</span></span><span style="display:flex;"><span>git<span style="color:#f92672">.</span>clone(url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>)
</span></span><span style="display:flex;"><span>git<span style="color:#f92672">.</span>checkout(<span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>)
</span></span></code></pre></div><p>But the checkout will fail, because default cloned folder name will be - you guessed it right - <code>zlib</code>, and it will do fuck all about letting you know about this. So you will want/need to add a <code>target</code> parameter, in order to introduce some consistency, and then also add one more step for changing the path into that directory, so the checkout could actually work:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>git <span style="color:#f92672">=</span> Git(self)
</span></span><span style="display:flex;"><span>git<span style="color:#f92672">.</span>clone(
</span></span><span style="display:flex;"><span>    url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>,
</span></span><span style="display:flex;"><span>    hide_url<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, <span style="color:#75715e"># why would I want to hide the repository URL?</span>
</span></span><span style="display:flex;"><span>    target<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>git<span style="color:#f92672">.</span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>git<span style="color:#f92672">.</span>checkout(<span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>)
</span></span></code></pre></div><p>Since we are now dealing with sources being one level deeper - in that <code>src</code> subfolder - the <code>build()</code> method needs to be adjusted with <code>build_script_folder</code> parameter, otherwise it will quite naturally fail with something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>CMake Error: The source directory <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlib40f82666a9fd6/b&#34;</span> does not appear to contain CMakeLists.txt.
</span></span></code></pre></div><p>It is added here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build</span>(self):
</span></span><span style="display:flex;"><span>    cmake <span style="color:#f92672">=</span> CMake(self)
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>configure(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        build_script_folder<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;src&#34;</span>,
</span></span><span style="display:flex;"><span>        variables<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ZLIB_BUILD_EXAMPLES&#34;</span>: <span style="color:#e6db74">&#34;NO&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>build()
</span></span></code></pre></div><p>Okay, we can get the sources, and the project even configures - great success. But we also need to apply patches, so let&rsquo;s try the same way how we did it in Conan 1.x:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">source</span>(self):
</span></span><span style="display:flex;"><span>    git <span style="color:#f92672">=</span> Git(self)
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>clone(
</span></span><span style="display:flex;"><span>        url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>,
</span></span><span style="display:flex;"><span>        hide_url<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        target<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>checkout(<span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    apply_conandata_patches(self)
</span></span></code></pre></div><p>But that will fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>zlib<span style="color:#f92672">/</span><span style="color:#ae81ff">1.3.1</span><span style="color:#a6e22e">@your</span><span style="color:#f92672">-</span>prefix<span style="color:#f92672">/</span>public: Apply patch (file): <span style="color:#f92672">../</span>patches<span style="color:#f92672">/</span><span style="color:#ae81ff">001</span><span style="color:#f92672">-</span>single<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span><span style="color:#f92672">and</span><span style="color:#f92672">-</span>installation<span style="color:#f92672">.</span>patch
</span></span><span style="display:flex;"><span>ERROR: zlib<span style="color:#f92672">/</span><span style="color:#ae81ff">1.3.1</span><span style="color:#a6e22e">@your</span><span style="color:#f92672">-</span>prefix<span style="color:#f92672">/</span>public: Error <span style="color:#f92672">in</span> source() method, line <span style="color:#ae81ff">62</span>
</span></span><span style="display:flex;"><span>        apply_conandata_patches(self)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">FileNotFoundError</span>: [Errno <span style="color:#ae81ff">2</span>] No such file <span style="color:#f92672">or</span> directory: <span style="color:#e6db74">&#39;/Users/USERNAME/.conan2/p/zlibf89b3b2101d0a/s/../patches/001-single-target-and-installation.patch&#39;</span>
</span></span></code></pre></div><p>&hellip;because the patches need to exported first, duh, how could you forget:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span></code></pre></div><p>It will get a bit further after that, but will still fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Apply patch <span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>: ../patches/1.3.1/001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: /Users/USERNAME/.conan2/p/zlib0e8f55016cf98/s/../patches/1.3.1/001-single-target-and-installation.patch: source/target file does not exist:
</span></span><span style="display:flex;"><span>  --- b<span style="color:#e6db74">&#39;CMakeLists.txt&#39;</span>
</span></span><span style="display:flex;"><span>  +++ b<span style="color:#e6db74">&#39;CMakeLists.txt&#39;</span>
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@your-prefix/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">62</span>
</span></span><span style="display:flex;"><span>        apply_conandata_patches<span style="color:#f92672">(</span>self<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        ConanException: Failed to apply patch: /Users/USERNAME/.conan2/p/zlib0e8f55016cf98/s/../patches/1.3.1/001-single-target-and-installation.patch
</span></span></code></pre></div><p>&hellip;because it tries to apply the patch in a wrong directory, as sources are now in the <code>src</code> subfolder, keep up! Unexpectedly and conveniently enough, <code>conandata.yml</code> can accommodate for that with the <code>base_path</code> parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">patches</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1.3.1&#34;</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">patch_file</span>: <span style="color:#e6db74">&#34;../patches/1.3.1/001-single-target-and-installation.patch&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">base_path</span>: <span style="color:#e6db74">&#34;src&#34;</span>
</span></span></code></pre></div><p>so that is nice. By the way, the <code>conandata.yml</code> file seems to be documented only in Conan <a href="https://docs.conan.io/en/1.66/reference/config_files/conandata.yml.html">1.x</a>, as there is no such article in the documentation for version <a href="https://docs.conan.io/2/reference/config_files.html">2.x</a>.</p>
<p>Anyway, now <code>apply_conandata_patches()</code> will succeed. But we also need those common CMake files - <code>Config.cmake.in</code> and <code>Installing.cmake</code> - so let&rsquo;s export them too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    copy(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        self,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../../_cmake&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        dst<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>export_sources_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/src&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    )
</span></span></code></pre></div><p>But while that part will work fine, now it&rsquo;s cloning the repository who will fail, even though it was working with no problems just moments ago:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Cloning git repo
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git clone <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>  <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@your-prefix/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">58</span>
</span></span><span style="display:flex;"><span>        git.clone<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        ConanException: Command <span style="color:#e6db74">&#39;git clone &#34;git@github.com:madler/zlib.git&#34;  &#34;src&#34;&#39;</span> failed with errorcode <span style="color:#e6db74">&#39;128&#39;</span>
</span></span><span style="display:flex;"><span>b<span style="color:#e6db74">&#34;fatal: destination path &#39;src&#39; already exists and is not an empty directory.\n&#34;</span>
</span></span></code></pre></div><p>No fucking shit! Destination already exists, really? How then am I supposed to get these files into the sources folder, if <code>export_sources()</code> runs before <code>source()</code>? I don&rsquo;t fucking know, so here go the crutches:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    copy(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../../_cmake&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#75715e">#dst=f&#34;{self.export_sources_folder}/src&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        dst<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>export_sources_folder
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">source</span>(self):
</span></span><span style="display:flex;"><span>    git <span style="color:#f92672">=</span> Git(self)
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>clone(
</span></span><span style="display:flex;"><span>        url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>,
</span></span><span style="display:flex;"><span>        hide_url<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        target<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>    git<span style="color:#f92672">.</span>checkout(<span style="color:#e6db74">&#34;51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    apply_conandata_patches(self)
</span></span><span style="display:flex; background-color:#3c3d38"><span>    copy(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        self,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        self<span style="color:#f92672">.</span>export_sources_folder,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>export_sources_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/src&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    )
</span></span></code></pre></div><p>Only now the entire bloody thing will finally work:</p>
<details>
    <summary>conan create . -s build_type=Release</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Exporting recipe to the cache <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Exporting package recipe: /Users/USERNAME/code/cpp/conan-recipes/zlib/2.x/conanfile.py
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: exports: File <span style="color:#e6db74">&#39;conandata.yml&#39;</span> found. Exporting it...
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling export_sources<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.py&#39;</span> file: conanfile.py
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.yml&#39;</span> file: conandata.yml
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.cmake&#39;</span> file: Installing.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copied <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.in&#39;</span> file: Config.cmake.in
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Exported to cache folder: /Users/USERNAME/.conan2/p/zlib6cd1a0937cc6f/e
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Exported: zlib/1.3.1@your-prefix/public#e1951630376fcb6909b3f71fdac74dbe <span style="color:#f92672">(</span>2026-02-21 20:34:51 UTC<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Input profiles <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>Profile host:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>apple-clang
</span></span><span style="display:flex;"><span>compiler.cppstd<span style="color:#f92672">=</span>gnu17
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Profile build:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>apple-clang
</span></span><span style="display:flex;"><span>compiler.cppstd<span style="color:#f92672">=</span>gnu17
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Macos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing dependency graph <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>Graph root
</span></span><span style="display:flex;"><span>    cli
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#e1951630376fcb6909b3f71fdac74dbe - Cache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing necessary packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Forced build from source
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#e1951630376fcb6909b3f71fdac74dbe:b1ff6692ad7a5f789d07f1524fdaaba7e0428c67 - Build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Installing packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling source<span style="color:#f92672">()</span> in /Users/USERNAME/.conan2/p/zlib6cd1a0937cc6f/s
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Cloning git repo
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git clone <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>  <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checkout: 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git checkout 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Apply patch <span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>: ../patches/1.3.1/001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Installing package zlib/1.3.1@your-prefix/public <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> of 1<span style="color:#f92672">)</span> --------
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Building from source
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package zlib/1.3.1@your-prefix/public:b1ff6692ad7a5f789d07f1524fdaaba7e0428c67
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: settings: os<span style="color:#f92672">=</span>Macos arch<span style="color:#f92672">=</span>armv8 compiler<span style="color:#f92672">=</span>apple-clang compiler.cppstd<span style="color:#f92672">=</span>gnu17 compiler.libcxx<span style="color:#f92672">=</span>libc++ compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span> build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copying sources to build folder
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Building your package in /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling generate<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generators folder: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release/generators
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: CMakeToolchain generated: conan_toolchain.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: CMakeToolchain generated: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release/generators/CMakePresets.json
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generating aggregated env files
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generated aggregated env files: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;conanbuild.sh&#39;</span>, <span style="color:#e6db74">&#39;conanrun.sh&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.configure<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake -G <span style="color:#e6db74">&#34;Ninja&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;generators/conan_toolchain.cmake&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p&#34;</span> -DCMAKE_POLICY_DEFAULT_CMP0091<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NEW&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Release&#34;</span> -DZLIB_BUILD_EXAMPLES<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NO&#34;</span> <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/src&#34;</span>
</span></span><span style="display:flex;"><span>-- Using Conan toolchain: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release/generators/conan_toolchain.cmake
</span></span><span style="display:flex;"><span>-- Conan toolchain: Defining libcxx as C++ flags: -stdlib<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>-- Conan toolchain: C++ Standard <span style="color:#ae81ff">17</span> with extensions ON
</span></span><span style="display:flex;"><span>-- The C compiler identification is AppleClang 17.0.0.17000603
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Check <span style="color:#66d9ef">for</span> working C compiler: /opt/homebrew/opt/ccache/libexec/cc - skipped
</span></span><span style="display:flex;"><span>-- Detecting C compile features
</span></span><span style="display:flex;"><span>-- Detecting C compile features - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h - found
</span></span><span style="display:flex;"><span>-- Check size of off64_t
</span></span><span style="display:flex;"><span>-- Check size of off64_t - failed
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h - found
</span></span><span style="display:flex;"><span>-- Configuring <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>1.2s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- Generating <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>0.0s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- Build files have been written to: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake --build <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release&#34;</span> -- -j12
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>16/16<span style="color:#f92672">]</span> Linking C static library libz.a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package <span style="color:#e6db74">&#39;b1ff6692ad7a5f789d07f1524fdaaba7e0428c67&#39;</span> built
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Build folder /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generating the package
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Packaging in folder /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling package<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.install<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake --install <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/b/build/Release&#34;</span> --prefix <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p&#34;</span>
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/lib/libz.a
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/include/zlib/zconf.h
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/include/zlib/zlib.h
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/share/zlib/zlibTargets.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/share/zlib/zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/share/zlib/zlibConfig.cmake
</span></span><span style="display:flex;"><span>-- Installing: /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p/share/zlib/zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#39;.h&#39;</span> files: zlib.h, zconf.h
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.a&#39;</span> file: libz.a
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">4</span> <span style="color:#e6db74">&#39;.cmake&#39;</span> files: zlibConfig.cmake, zlibTargets.cmake, zlibConfigVersion.cmake, zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Created package revision 130179c00685fb7a3ebd57b51e19a425
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package <span style="color:#e6db74">&#39;b1ff6692ad7a5f789d07f1524fdaaba7e0428c67&#39;</span> created
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Full package reference: zlib/1.3.1@your-prefix/public#e1951630376fcb6909b3f71fdac74dbe:b1ff6692ad7a5f789d07f1524fdaaba7e0428c67#130179c00685fb7a3ebd57b51e19a425
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package folder /Users/USERNAME/.conan2/p/b/zlibb69029c81b6f1/p</span></span></code></pre></div>
</details>
<p><a href="https://github.com/retifrav/conan-recipes/blob/6a0672c5e07a4373735460e29c57f8be443b6720/zlib/2.x/conanfile.py">Here</a> you can take a look at how the full recipe file looks like at this point (<em>and so just you know, it is not entirely correct, but more on that <a href="#making-sure-that-build-missing-works">later</a></em>).</p>
<p>The resulting package will be this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ tree /Users/USERNAME/.conan2/p/b/zlib1f9e8e16e0f1d/p
</span></span><span style="display:flex;"><span>├── conaninfo.txt
</span></span><span style="display:flex;"><span>├── conanmanifest.txt
</span></span><span style="display:flex;"><span>├── include
</span></span><span style="display:flex;"><span>│   └── zlib
</span></span><span style="display:flex;"><span>│       ├── zconf.h
</span></span><span style="display:flex;"><span>│       └── zlib.h
</span></span><span style="display:flex;"><span>├── lib
</span></span><span style="display:flex;"><span>│   └── libz.a
</span></span><span style="display:flex;"><span>└── share
</span></span><span style="display:flex;"><span>    └── zlib
</span></span><span style="display:flex;"><span>        ├── zlibConfig.cmake
</span></span><span style="display:flex;"><span>        ├── zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>        ├── zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>        └── zlibTargets.cmake
</span></span></code></pre></div><p>Same as before, make a package for Debug configuration too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Debug
</span></span></code></pre></div><p>and then the commands for adding a new remote and publishing the package are a little bit different from 1.x:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan remote add our-gitea https://gitea.OUR.HOST/api/packages/OUR-ORGANIZATION/conan
</span></span><span style="display:flex;"><span>$ conan remote login our-gitea SOME-BUILDBOT -p SOME-BUILDBOT-ACCESS-TOKEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ conan upload zlib/1.3.1@YOUR-PREFIX/public -r our-gitea
</span></span></code></pre></div><p>In particular, there is no <code>--all</code> parameter anymore, as both Debug and Release are uploaded by default:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">========</span> Uploading to remote our-gitea <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Checking server <span style="color:#66d9ef">for</span> existing packages --------
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking which revisions exist in the remote server
</span></span><span style="display:flex;"><span>Connecting to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span> with user <span style="color:#e6db74">&#39;SOME-BUILDBOT&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Preparing artifacts <span style="color:#66d9ef">for</span> upload --------
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Compressing conan_export.tgz
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Compressing conan_sources.tgz
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public:b1ff6692ad7a5f789d07f1524fdaaba7e0428c67: Compressing conan_package.tgz
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public:b4653e854542d65f58ec9b607521d1c6da3dd37f: Compressing conan_package.tgz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Uploading artifacts --------
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Uploading recipe <span style="color:#e6db74">&#39;zlib/1.3.1@your-prefix/public#8c9021bf2f5c373e741a59f6341556f0&#39;</span> <span style="color:#f92672">(</span>4.4KB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Uploading package <span style="color:#e6db74">&#39;zlib/1.3.1@your-prefix/public#8c9021bf2f5c373e741a59f6341556f0:b1ff6692ad7a5f789d07f1524fdaaba7e0428c67#21d4bf703f1ef737e09cfe72a5dd13c0&#39;</span> <span style="color:#f92672">(</span>80.2KB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Uploading package <span style="color:#e6db74">&#39;zlib/1.3.1@your-prefix/public#8c9021bf2f5c373e741a59f6341556f0:b4653e854542d65f58ec9b607521d1c6da3dd37f#c88b3c405b4fd5824f77dc6a6c13e410&#39;</span> <span style="color:#f92672">(</span>128.4KB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Upload completed in 0s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Upload summary --------
</span></span><span style="display:flex;"><span>our-gitea
</span></span><span style="display:flex;"><span>  zlib/1.3.1@your-prefix/public
</span></span><span style="display:flex;"><span>    revisions
</span></span><span style="display:flex;"><span>      8c9021bf2f5c373e741a59f6341556f0 <span style="color:#f92672">(</span>Uploaded<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        packages
</span></span><span style="display:flex;"><span>          b1ff6692ad7a5f789d07f1524fdaaba7e0428c67
</span></span><span style="display:flex;"><span>            revisions
</span></span><span style="display:flex;"><span>              21d4bf703f1ef737e09cfe72a5dd13c0 <span style="color:#f92672">(</span>Uploaded<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>          b4653e854542d65f58ec9b607521d1c6da3dd37f
</span></span><span style="display:flex;"><span>            revisions
</span></span><span style="display:flex;"><span>              c88b3c405b4fd5824f77dc6a6c13e410 <span style="color:#f92672">(</span>Uploaded<span style="color:#f92672">)</span>
</span></span></code></pre></div><h4 id="making-sure-that-build-missing-works">Making sure that build missing works</h4>
<p>Now let&rsquo;s verify that it all was not for nothing, so users will be able build the package from sources in their environments too (<em>when there are no pre-built binaries available in the remote</em>).</p>
<p>My original Conan profile was on Mac OS, as you could see, and I will be testing the package on a different host with GNU/Linux:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan profile detect
</span></span><span style="display:flex;"><span>detect_api: Found cc<span style="color:#f92672">=</span>gcc-13.3.0
</span></span><span style="display:flex;"><span>detect_api: gcc&gt;<span style="color:#f92672">=</span>5, using the major as version
</span></span><span style="display:flex;"><span>detect_api: gcc C++ standard library: libstdc++11
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Detected profile:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>gcc
</span></span><span style="display:flex;"><span>compiler.cppstd<span style="color:#f92672">=</span>gnu17
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libstdc++11
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Linux
</span></span></code></pre></div><p>The <code>conanfile.txt</code> is simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[requires]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">zlib/1.3.1@your-prefix/public</span>
</span></span></code></pre></div><p>And here we go:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan remote add our-gitea https://gitea.OUR.HOST/api/packages/OUR-ORGANIZATION/conan
</span></span><span style="display:flex;"><span>$ conan remote login our-gitea SOME-BUILDBOT -p SOME-BUILDBOT-ACCESS-TOKEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ conan install . -s build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing dependency graph <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Not found in local cache, looking in remotes...
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking remote: conancenter
</span></span><span style="display:flex;"><span>Connecting to remote <span style="color:#e6db74">&#39;conancenter&#39;</span> anonymously
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking remote: our-gitea
</span></span><span style="display:flex;"><span>Connecting to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span> with user <span style="color:#e6db74">&#39;SOME-BUILDBOT&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Downloaded recipe revision 8c9021bf2f5c373e741a59f6341556f0
</span></span><span style="display:flex;"><span>Graph root
</span></span><span style="display:flex;"><span>    conanfile.txt: /tmp/tst/conanfile.txt
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#8c9021bf2f5c373e741a59f6341556f0 - Downloaded <span style="color:#f92672">(</span>our-gitea<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing necessary packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Main binary package <span style="color:#e6db74">&#39;7e86c4b3602206723f284fdfdde6a34cf597348b&#39;</span> missing
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking <span style="color:#ae81ff">11</span> compatible configurations
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Compatible configurations not found in cache, checking servers
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;8aaaffb6879050f7935d3eb75886df5c364ef04d&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">98</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;98c5b5e12c29fd04618c3271f52eb5cc86525ac0&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu98
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;2f963acd1db98563cdd4cb8c668c074ccb2f6a0e&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;095cbcae727f77a229cd27f333336466c57fb945&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu11
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;c3c1c9c37a8b7a1bf5fe9560f790b4db9fbef4e7&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;ad16df6c61867c7bce3d99cac8156bbc0f4c35fa&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu14
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;fbfc70eb56ad38e231d8c02e8588785062b4605c&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;40e4da6a63e5ecc66fe5cb1eefd3e01a64401d4e&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;9f9ec3b60ea1e556cd8b4c1526d1f0a232742c36&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu20
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;c06a3ccc19b7b3dbbcf4c95b073c5adf7b0b066b&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">23</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;dc4a3934e08b94e0d9da65b7303adf4b1921e2ce&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu23
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: No compatible configuration found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A new experimental approach <span style="color:#66d9ef">for</span> binary compatibility detection is available.
</span></span><span style="display:flex;"><span>    Enable it by setting the core.graph:compatibility_mode<span style="color:#f92672">=</span>optimized conf
</span></span><span style="display:flex;"><span>    and get improved performance when querying multiple compatible binaries in remotes.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#8c9021bf2f5c373e741a59f6341556f0:7e86c4b3602206723f284fdfdde6a34cf597348b - Missing
</span></span><span style="display:flex;"><span>ERROR: Missing binary: zlib/1.3.1@your-prefix/public:7e86c4b3602206723f284fdfdde6a34cf597348b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: WARN: Can<span style="color:#e6db74">&#39;t find a &#39;</span>zlib/1.3.1@your-prefix/public<span style="color:#e6db74">&#39; package binary &#39;</span>7e86c4b3602206723f284fdfdde6a34cf597348b<span style="color:#e6db74">&#39; for the configuration:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[settings]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">arch=armv8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">build_type=Release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compiler=gcc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compiler.cppstd=gnu17
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compiler.libcxx=libstdc++11
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compiler.version=13
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">os=Linux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ERROR: Missing prebuilt package for &#39;</span>zlib/1.3.1@your-prefix/public<span style="color:#e6db74">&#39;. You can try:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - List all available packages using &#39;</span>conan list <span style="color:#e6db74">&#34;zlib/1.3.1@your-prefix/public:*&#34;</span> -r<span style="color:#f92672">=</span>remote<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Explain missing binaries: replace &#39;</span>conan install ...<span style="color:#e6db74">&#39; with &#39;</span>conan graph explain ...<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Try to build locally from sources using the &#39;</span>--build<span style="color:#f92672">=</span>zlib/1.3.1@your-prefix/public<span style="color:#e6db74">&#39; argument
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">More Info at &#39;</span>https://docs.conan.io/2/knowledge/faq.html#error-missing-prebuilt-package<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span></code></pre></div><p>As expected, no pre-built binaries for this platform/profile yet, so we need to explicitly tell Conan that we want to build the package from sources (<em>should be the default behaviour, in my opinion</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan install . -s build_type<span style="color:#f92672">=</span>Release --build missing
</span></span></code></pre></div><p>&hellip;aaaaand it fucking failed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">========</span> Installing packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Sources downloaded from <span style="color:#e6db74">&#39;our-gitea&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling source<span style="color:#f92672">()</span> in /home/USERNAME/.conan2/p/zlibf05b26372de83/s
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Cloning git repo
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git clone <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>  <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checkout: 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git checkout 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Apply patch <span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>: ../patches/1.3.1/001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@your-prefix/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">58</span>
</span></span><span style="display:flex;"><span>    apply_conandata_patches<span style="color:#f92672">(</span>self<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    FileNotFoundError: <span style="color:#f92672">[</span>Errno 2<span style="color:#f92672">]</span> No such file or directory: <span style="color:#e6db74">&#39;/home/USERNAME/.conan2/p/zlibf05b26372de83/s/../patches/1.3.1/001-single-target-and-installation.patch&#39;</span>
</span></span></code></pre></div><p>&hellip;because patches were not distributed together with the package. At first I thought that I should have added them in <code>package()</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package</span>(self):
</span></span><span style="display:flex;"><span>    cmake <span style="color:#f92672">=</span> CMake(self)
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>install()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    copy(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        self,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#75715e"># yet again, this `recipe_folder` here is not where the `conanfile.py` is</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../patches&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        dst<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>package_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/patches&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    )
</span></span></code></pre></div><p>which will indeed add them to the package:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Debug
</span></span><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tree /Users/USERNAME/.conan2/p/b/zlib1495b2f7e6558/p
</span></span><span style="display:flex;"><span>├── conaninfo.txt
</span></span><span style="display:flex;"><span>├── conanmanifest.txt
</span></span><span style="display:flex;"><span>├── include
</span></span><span style="display:flex;"><span>│   └── zlib
</span></span><span style="display:flex;"><span>│       ├── zconf.h
</span></span><span style="display:flex;"><span>│       └── zlib.h
</span></span><span style="display:flex;"><span>├── lib
</span></span><span style="display:flex;"><span>│   └── libz.a
</span></span><span style="display:flex; background-color:#3c3d38"><span>├── patches
</span></span><span style="display:flex; background-color:#3c3d38"><span>│   └── 1.3.1
</span></span><span style="display:flex; background-color:#3c3d38"><span>│       └── 001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>└── share
</span></span><span style="display:flex;"><span>    └── zlib
</span></span><span style="display:flex;"><span>        ├── zlibConfig.cmake
</span></span><span style="display:flex;"><span>        ├── zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>        ├── zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>        └── zlibTargets.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ conan upload zlib/1.3.1@YOUR-PREFIX/public -r our-gitea
</span></span></code></pre></div><p>and they will be packed into the <code>conan_package.tgz</code> archive, but they will still be nowhere to find during the package build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">2</span> /home/USERNAME/.conan2/p/zlib3a471b8319eee/
</span></span><span style="display:flex;"><span>├── d
</span></span><span style="display:flex;"><span>│ ├── conan_export.tgz
</span></span><span style="display:flex;"><span>│ ├── conan_sources.tgz
</span></span><span style="display:flex;"><span>│ └── metadata
</span></span><span style="display:flex;"><span>├── e
</span></span><span style="display:flex;"><span>│ ├── conandata.yml
</span></span><span style="display:flex;"><span>│ ├── conanfile.py
</span></span><span style="display:flex;"><span>│ └── conanmanifest.txt
</span></span><span style="display:flex;"><span>├── es
</span></span><span style="display:flex;"><span>│ ├── Config.cmake.in
</span></span><span style="display:flex;"><span>│ └── Installing.cmake
</span></span><span style="display:flex;"><span>├── s
</span></span><span style="display:flex;"><span>│ ├── Config.cmake.in
</span></span><span style="display:flex;"><span>│ ├── Installing.cmake
</span></span><span style="display:flex;"><span>│ └── src
</span></span><span style="display:flex;"><span>└── s.dirty
</span></span></code></pre></div><p>Only then I realized that <code>package()</code> method is not meant for adding patches into the package, although its name (<em>which is <code>package</code></em>) is really deceiving in that regard. What&rsquo;s getting packed in this method is really just the build/install artifacts of the library, such as public headers, binaries, CMake configs and so on. Patches simply do not belong here, as they are needed only for building the library itself, or actually even earlier than that - before the project is configured for the build.</p>
<p>So then my next guess was that since those additional files <code>Config.cmake.in</code> and <code>Installing.cmake</code> are present on the target host after unpacking, then maybe I should &ldquo;export&rdquo; the patches in <code>export_sources()</code> too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_sources</span>(self):
</span></span><span style="display:flex;"><span>    export_conandata_patches(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    copy(
</span></span><span style="display:flex; background-color:#3c3d38"><span>        self,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../patches&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        dst<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>export_sources_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/patches&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    copy(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;*&#34;</span>, <span style="color:#75715e"># or do it with explicit files names in several `copy()` calls</span>
</span></span><span style="display:flex;"><span>        src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>recipe_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../../_cmake&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># trying to &#34;export&#34; additional files directly into `src` folder</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># will prevent `git.clone()` from cloning the repository,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># because `src` folder will already exist by that moment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#dst=f&#34;{self.export_sources_folder}/src&#34;</span>
</span></span><span style="display:flex;"><span>        dst<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>export_sources_folder
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package</span>(self):
</span></span><span style="display:flex;"><span>    cmake <span style="color:#f92672">=</span> CMake(self)
</span></span><span style="display:flex;"><span>    cmake<span style="color:#f92672">.</span>install()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e"># delete that as this is wrong</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#copy(</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#    self,</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#    &#34;*&#34;,</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#    # yet again, don&#39;t forget that `recipe_folder` here is not where the `conanfile.py` is</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#    src=f&#34;{self.recipe_folder}/../patches&#34;,</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#    dst=f&#34;{self.package_folder}/patches&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e">#)</span>
</span></span></code></pre></div><p>Then after re-making and re-publishing the package the unpacked files on the target computer will contain the patches:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">2</span> /home/USERNAME/.conan2/p/zlib25c7db754f26d/
</span></span><span style="display:flex;"><span>├── d
</span></span><span style="display:flex;"><span>│   ├── conan_export.tgz
</span></span><span style="display:flex;"><span>│   ├── conan_sources.tgz
</span></span><span style="display:flex;"><span>│   └── metadata
</span></span><span style="display:flex;"><span>├── e
</span></span><span style="display:flex;"><span>│   ├── conandata.yml
</span></span><span style="display:flex;"><span>│   ├── conanfile.py
</span></span><span style="display:flex;"><span>│   └── conanmanifest.txt
</span></span><span style="display:flex;"><span>├── es
</span></span><span style="display:flex;"><span>│   ├── Config.cmake.in
</span></span><span style="display:flex;"><span>│   ├── Installing.cmake
</span></span><span style="display:flex; background-color:#3c3d38"><span>│   └── patches
</span></span><span style="display:flex; background-color:#3c3d38"><span>│       └── 1.3.1
</span></span><span style="display:flex; background-color:#3c3d38"><span>│           └── 001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>├── s
</span></span><span style="display:flex;"><span>│   ├── Config.cmake.in
</span></span><span style="display:flex;"><span>│   ├── Installing.cmake
</span></span><span style="display:flex; background-color:#3c3d38"><span>│   ├── patches
</span></span><span style="display:flex; background-color:#3c3d38"><span>│   │   └── 1.3.1
</span></span><span style="display:flex; background-color:#3c3d38"><span>│   │       └── 001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>│   └── src
</span></span><span style="display:flex;"><span>│       ├── ...
</span></span><span style="display:flex;"><span>└── s.dirty
</span></span></code></pre></div><p>&hellip;but the build will still fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Apply patch <span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>: ../patches/1.3.1/001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@your-prefix/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">67</span>
</span></span><span style="display:flex;"><span>    apply_conandata_patches<span style="color:#f92672">(</span>self<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    FileNotFoundError: <span style="color:#f92672">[</span>Errno 2<span style="color:#f92672">]</span> No such file or directory: <span style="color:#e6db74">&#39;/home/USERNAME/.conan2/p/zlib25c7db754f26d/s/../patches/1.3.1/001-single-target-and-installation.patch&#39;</span>
</span></span></code></pre></div><p>because now all of the bloody sudden it constructs the path to patches differently. In the original environment it puts them one level up relative to <code>s</code> directory, and while that works there, it does not work with <code>--build missing</code> in other environments. So, unless I have messed up something somewhere, <code>conandata.yml</code> and <code>export_conandata_patches()</code>/<code>apply_conandata_patches()</code> apparently were not designed to work with <code>../</code> paths, so me trying to reuse the same set of patches for 1.x and 2.x recipes broke that fragily thingy.</p>
<p>One way to resolve this would be to add one more <code>copy()</code> in <code>export_sources()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">source</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># guarding the copy operation with this condition doesn&#39;t seem to be a reliable way</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># of determining that we are not in the original environment, but actually it is fine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># even without it, as `copy()` just silently continues when it can&#39;t find anything</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#if self.build_policy == &#34;missing&#34;:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        copy(
</span></span><span style="display:flex;"><span>            self,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>            src<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>export_sources_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/patches&#34;</span>,
</span></span><span style="display:flex;"><span>            dst<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>export_sources_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/../patches&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    apply_conandata_patches(self)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>But it is likely a bad idea. So maybe it is better not to challenge the poor thing beyond its little capabilities and just <a href="https://github.com/retifrav/conan-recipes/commit/127f1c86c37c33f9e937ebc4b3c1488c674797d2">restructure</a> the recipe folder the way it is expected:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>conan<span style="color:#f92672">-</span>recipes<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">_cmake</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> <span style="color:#a6e22e">Config</span><span style="color:#f92672">.</span>cmake<span style="color:#f92672">.</span>in
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> <span style="color:#a6e22e">Installing</span><span style="color:#f92672">.</span>cmake
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> <span style="color:#a6e22e">README</span><span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> zlib
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> conandata<span style="color:#f92672">.</span>yml
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> conanfile<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> patches
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">└──</span> <span style="color:#ae81ff">1.3</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">└──</span> <span style="color:#ae81ff">001</span><span style="color:#f92672">-</span>single<span style="color:#f92672">-</span>target<span style="color:#f92672">-</span>and<span style="color:#f92672">-</span>installation<span style="color:#f92672">.</span>patch
</span></span></code></pre></div><p>Now there will also be no need to <code>copy()</code> the patches in <code>export_sources()</code> or anywhere else, as it will all be nicely handled by <code>export_conandata_patches()</code>/<code>apply_conandata_patches()</code> out of the box.</p>
<p>Then, after re-making and re-publishing the package, the package will work fine with <code>--build missing</code> too:</p>
<details>
    <summary>conan install . -s build_type=Release --build missing</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan install . -s build_type<span style="color:#f92672">=</span>Release --build missing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Input profiles <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>Profile host:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>gcc
</span></span><span style="display:flex;"><span>compiler.cppstd<span style="color:#f92672">=</span>gnu17
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libstdc++11
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Linux
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Profile build:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>settings<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span>armv8
</span></span><span style="display:flex;"><span>build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>compiler<span style="color:#f92672">=</span>gcc
</span></span><span style="display:flex;"><span>compiler.cppstd<span style="color:#f92672">=</span>gnu17
</span></span><span style="display:flex;"><span>compiler.libcxx<span style="color:#f92672">=</span>libstdc++11
</span></span><span style="display:flex;"><span>compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">=</span>Linux
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing dependency graph <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Not found in local cache, looking in remotes...
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking remote: conancenter
</span></span><span style="display:flex;"><span>Connecting to remote <span style="color:#e6db74">&#39;conancenter&#39;</span> anonymously
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking remote: our-gitea
</span></span><span style="display:flex;"><span>Connecting to remote <span style="color:#e6db74">&#39;our-gitea&#39;</span> with user <span style="color:#e6db74">&#39;SOME-BUILDBOT&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Downloaded recipe revision 29c8feca6abac3bceb76569245d8acc4
</span></span><span style="display:flex;"><span>Graph root
</span></span><span style="display:flex;"><span>    conanfile.txt: /tmp/tst/conanfile.txt
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#29c8feca6abac3bceb76569245d8acc4 - Downloaded <span style="color:#f92672">(</span>our-gitea<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Computing necessary packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Main binary package <span style="color:#e6db74">&#39;7e86c4b3602206723f284fdfdde6a34cf597348b&#39;</span> missing
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checking <span style="color:#ae81ff">11</span> compatible configurations
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Compatible configurations not found in cache, checking servers
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;8aaaffb6879050f7935d3eb75886df5c364ef04d&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">98</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;98c5b5e12c29fd04618c3271f52eb5cc86525ac0&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu98
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;2f963acd1db98563cdd4cb8c668c074ccb2f6a0e&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;095cbcae727f77a229cd27f333336466c57fb945&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu11
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;c3c1c9c37a8b7a1bf5fe9560f790b4db9fbef4e7&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;ad16df6c61867c7bce3d99cac8156bbc0f4c35fa&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu14
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;fbfc70eb56ad38e231d8c02e8588785062b4605c&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;40e4da6a63e5ecc66fe5cb1eefd3e01a64401d4e&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;9f9ec3b60ea1e556cd8b4c1526d1f0a232742c36&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu20
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;c06a3ccc19b7b3dbbcf4c95b073c5adf7b0b066b&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span><span style="color:#ae81ff">23</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: <span style="color:#e6db74">&#39;dc4a3934e08b94e0d9da65b7303adf4b1921e2ce&#39;</span>: compiler.cppstd<span style="color:#f92672">=</span>gnu23
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: No compatible configuration found
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A new experimental approach <span style="color:#66d9ef">for</span> binary compatibility detection is available.
</span></span><span style="display:flex;"><span>    Enable it by setting the core.graph:compatibility_mode<span style="color:#f92672">=</span>optimized conf
</span></span><span style="display:flex;"><span>    and get improved performance when querying multiple compatible binaries in remotes.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Requirements
</span></span><span style="display:flex;"><span>    zlib/1.3.1@your-prefix/public#29c8feca6abac3bceb76569245d8acc4:7e86c4b3602206723f284fdfdde6a34cf597348b - Build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Installing packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Sources downloaded from <span style="color:#e6db74">&#39;our-gitea&#39;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling source<span style="color:#f92672">()</span> in /home/USERNAME/.conan2/p/zlib2b7271a1100fd/s
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Cloning git repo
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git clone <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>  <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Checkout: 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git checkout 51b7f2abdade71cd9bb0e7a373ef2610ec6f9daf
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Apply patch <span style="color:#f92672">(</span>file<span style="color:#f92672">)</span>: patches/1.3.1/001-single-target-and-installation.patch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------- Installing package zlib/1.3.1@your-prefix/public <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> of 1<span style="color:#f92672">)</span> --------
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Building from source
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package zlib/1.3.1@your-prefix/public:7e86c4b3602206723f284fdfdde6a34cf597348b
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: settings: os<span style="color:#f92672">=</span>Linux arch<span style="color:#f92672">=</span>armv8 compiler<span style="color:#f92672">=</span>gcc compiler.cppstd<span style="color:#f92672">=</span>gnu17 compiler.libcxx<span style="color:#f92672">=</span>libstdc++11 compiler.version<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span> build_type<span style="color:#f92672">=</span>Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Copying sources to build folder
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Building your package in /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling generate<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generators folder: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release/generators
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: CMakeToolchain generated: conan_toolchain.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: CMakeToolchain generated: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release/generators/CMakePresets.json
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generating aggregated env files
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generated aggregated env files: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;conanbuild.sh&#39;</span>, <span style="color:#e6db74">&#39;conanrun.sh&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.configure<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake -G <span style="color:#e6db74">&#34;Ninja&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;generators/conan_toolchain.cmake&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p&#34;</span> -DCMAKE_POLICY_DEFAULT_CMP0091<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NEW&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Release&#34;</span> -DZLIB_BUILD_EXAMPLES<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NO&#34;</span> <span style="color:#e6db74">&#34;/home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/src&#34;</span>
</span></span><span style="display:flex;"><span>-- Using Conan toolchain: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release/generators/conan_toolchain.cmake
</span></span><span style="display:flex;"><span>-- Conan toolchain: C++ Standard <span style="color:#ae81ff">17</span> with extensions ON
</span></span><span style="display:flex;"><span>-- The C compiler identification is GNU 13.3.0
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Check <span style="color:#66d9ef">for</span> working C compiler: /usr/bin/cc - skipped
</span></span><span style="display:flex;"><span>-- Detecting C compile features
</span></span><span style="display:flex;"><span>-- Detecting C compile features - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> sys/types.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stdint.h - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> stddef.h - found
</span></span><span style="display:flex;"><span>-- Check size of off64_t
</span></span><span style="display:flex;"><span>-- Check size of off64_t - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> fseeko - found
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h
</span></span><span style="display:flex;"><span>-- Looking <span style="color:#66d9ef">for</span> unistd.h - found
</span></span><span style="display:flex;"><span>-- Configuring <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>0.2s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- Generating <span style="color:#66d9ef">done</span> <span style="color:#f92672">(</span>0.0s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- Build files have been written to: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake --build <span style="color:#e6db74">&#34;/home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release&#34;</span> -- -j4
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>16/16<span style="color:#f92672">]</span> Linking C static library libz.a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package <span style="color:#e6db74">&#39;7e86c4b3602206723f284fdfdde6a34cf597348b&#39;</span> built
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Build folder /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Generating the package
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Packaging in folder /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling package<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.install<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake --install <span style="color:#e6db74">&#34;/home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/b/build/Release&#34;</span> --prefix <span style="color:#e6db74">&#34;/home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p&#34;</span>
</span></span><span style="display:flex;"><span>-- Install configuration: <span style="color:#e6db74">&#34;Release&#34;</span>
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/lib/libz.a
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/include/zlib/zconf.h
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/include/zlib/zlib.h
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/share/zlib/zlibTargets.cmake
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/share/zlib/zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/share/zlib/zlibConfig.cmake
</span></span><span style="display:flex;"><span>-- Installing: /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p/share/zlib/zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">4</span> <span style="color:#e6db74">&#39;.cmake&#39;</span> files: zlibConfigVersion.cmake, zlibConfig.cmake, zlibTargets.cmake, zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;.a&#39;</span> file: libz.a
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: package<span style="color:#f92672">()</span>: Packaged <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#39;.h&#39;</span> files: zlib.h, zconf.h
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Created package revision 5136954c6fc51833ca445f2655fcf691
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package <span style="color:#e6db74">&#39;7e86c4b3602206723f284fdfdde6a34cf597348b&#39;</span> created
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Full package reference: zlib/1.3.1@your-prefix/public#29c8feca6abac3bceb76569245d8acc4:7e86c4b3602206723f284fdfdde6a34cf597348b#5136954c6fc51833ca445f2655fcf691
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Package folder /home/USERNAME/.conan2/p/b/zlib1fbb527e4c153/p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">========</span> Finalizing install <span style="color:#f92672">(</span>deploy, generators<span style="color:#f92672">)</span> <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>conanfile.txt: Generating aggregated env files
</span></span><span style="display:flex;"><span>conanfile.txt: Generated aggregated env files: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;conanbuild.sh&#39;</span>, <span style="color:#e6db74">&#39;conanrun.sh&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Install finished successfully</span></span></code></pre></div>
</details>
<p>Fucking finally! The full updated/corrected recipe file is <a href="https://github.com/retifrav/conan-recipes/blob/127f1c86c37c33f9e937ebc4b3c1488c674797d2/zlib/conanfile.py">here</a>.</p>
<p>One more thing, because we are so curious: how to build/make a package with a shared/dynamic library? Quick googling revealed that merely adding <code>-o *:shared=True</code> should be enough:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Release -o *:shared<span style="color:#f92672">=</span>True
</span></span></code></pre></div><p>but no, it still produced <code>libz.a</code>, which is a static library. I&rsquo;d like to be wrong, but apparently (<em>every</em>) recipe must explicitly <a href="https://github.com/retifrav/conan-recipes/commit/777f2c07332aeb4af70c42fcd5b2a468e0eccd34">state</a> that it cares about this option, otherwise <code>-o *:shared=True</code> has no effect on it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>options <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;shared&#34;</span>: [<span style="color:#66d9ef">True</span>, <span style="color:#66d9ef">False</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>default_options <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;shared&#34;</span>: <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And indeed, this time package produced a shared library:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ conan create . -s build_type<span style="color:#f92672">=</span>Release -o *:shared<span style="color:#f92672">=</span>True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tree /Users/USERNAME/.conan2/p/b/zlib0cf72d632a88e/p
</span></span><span style="display:flex;"><span>├── conaninfo.txt
</span></span><span style="display:flex;"><span>├── conanmanifest.txt
</span></span><span style="display:flex;"><span>├── include
</span></span><span style="display:flex;"><span>│ └── zlib
</span></span><span style="display:flex;"><span>│     ├── zconf.h
</span></span><span style="display:flex;"><span>│     └── zlib.h
</span></span><span style="display:flex;"><span>├── lib
</span></span><span style="display:flex; background-color:#3c3d38"><span>│ ├── libz.1.3.1.dylib
</span></span><span style="display:flex; background-color:#3c3d38"><span>│ ├── libz.1.dylib -&gt; libz.1.3.1.dylib
</span></span><span style="display:flex; background-color:#3c3d38"><span>│ └── libz.dylib -&gt; libz.1.dylib
</span></span><span style="display:flex;"><span>└── share
</span></span><span style="display:flex;"><span>    └── zlib
</span></span><span style="display:flex;"><span>        ├── zlibConfig.cmake
</span></span><span style="display:flex;"><span>        ├── zlibConfigVersion.cmake
</span></span><span style="display:flex;"><span>        ├── zlibTargets-release.cmake
</span></span><span style="display:flex;"><span>        └── zlibTargets.cmake
</span></span></code></pre></div><p>What&rsquo;s convenient here is that the recipe maintainer does not need to set <code>BUILD_SHARED_LIBS</code> in <code>cmake.configure()</code>, because Conan will do that automatically (<em>I could only find <a href="https://docs.conan.io/1/reference/build_helpers/cmake.html#definitions">documentation</a> for it in version 1.x, but it seems to work fine in 2.x</em>), although it happens somewhere on the toolchain level:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Running CMake.configure<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: cmake -G <span style="color:#e6db74">&#34;Ninja&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;generators/conan_toolchain.cmake&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlib0cf72d632a88e/p&#34;</span> -DCMAKE_POLICY_DEFAULT_CMP0091<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NEW&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Release&#34;</span> -DZLIB_BUILD_EXAMPLES<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NO&#34;</span> <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/zlib0cf72d632a88e/b/src&#34;</span>
</span></span><span style="display:flex;"><span>-- Using Conan toolchain: /Users/USERNAME/.conan2/p/b/zlib0cf72d632a88e/b/build/Release/generators/conan_toolchain.cmake
</span></span><span style="display:flex;"><span>-- Conan toolchain: Defining libcxx as C++ flags: -stdlib<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>-- Conan toolchain: C++ Standard <span style="color:#ae81ff">17</span> with extensions ON
</span></span><span style="display:flex; background-color:#3c3d38"><span>-- Conan toolchain: Setting BUILD_SHARED_LIBS <span style="color:#f92672">=</span> ON
</span></span><span style="display:flex;"><span>-- The C compiler identification is AppleClang 17.0.0.17000603
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>but that is probably okay.</p>
<h4 id="making-sure-that-requirements-use-proper-cmake-configs">Making sure that requirements use proper CMake configs</h4>
<p>I was about to start celebrating, but then I discovered another nasty thing. If one generates and exports CMake configs as a part of the <a href="https://github.com/retifrav/conan-recipes/blob/209148df29894c0b979bfe8431a4cd3605ef650f/_cmake/Installing.cmake#L25-L74">installation steps</a> when building the project with CMake, then one will be very surprised to learn that by default Conan does not use those configs.</p>
<p>For instance, let&rsquo;s make a package for <a href="https://libpng.org/pub/png/libpng.html">png</a>, whose only dependency is zlib, which is going to be discovered in png&rsquo;s CMake project like this, as one would expect:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span>find_package(<span style="color:#e6db74">zlib</span> <span style="color:#e6db74">CONFIG</span> <span style="color:#e6db74">REQUIRED</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Then in the png&rsquo;s Conan recipe we declare the dependency like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">requirements</span>(self):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>requires(<span style="color:#e6db74">&#34;zlib/1.3.1@your-prefix/public&#34;</span>)
</span></span></code></pre></div><p>But even though our zlib package does contains proper CMake configs (<em>as you could see above in the <code>/Users/USERNAME/.conan2/p/b/zlib1f9e8e16e0f1d/p</code> tree</em>), the Conan-managed build of png failed to discover those CMake configs for zlib:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: Running CMake.configure<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: RUN: cmake -G <span style="color:#e6db74">&#34;Ninja&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;generators/conan_toolchain.cmake&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/pngdb349cb03f4e6/p&#34;</span> -DCMAKE_POLICY_DEFAULT_CMP0091<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NEW&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Debug&#34;</span> -DPNG_TESTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> -DPNG_TOOLS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> -DPNG_STATIC<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> -DPNG_SHARED<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/pngdb349cb03f4e6/b/src&#34;</span>
</span></span><span style="display:flex;"><span>-- Using Conan toolchain: /Users/USERNAME/.conan2/p/b/png624dddf43c215/b/build/Debug/generators/conan_toolchain.cmake
</span></span><span style="display:flex;"><span>-- Conan toolchain: Defining libcxx as C++ flags: -stdlib<span style="color:#f92672">=</span>libc++
</span></span><span style="display:flex;"><span>-- Conan toolchain: C++ Standard <span style="color:#ae81ff">17</span> with extensions ON
</span></span><span style="display:flex;"><span>-- Conan toolchain: Setting BUILD_SHARED_LIBS <span style="color:#f92672">=</span> OFF
</span></span><span style="display:flex;"><span>-- The C compiler identification is AppleClang 17.0.0.17000603
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info
</span></span><span style="display:flex;"><span>-- Detecting C compiler ABI info - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Check <span style="color:#66d9ef">for</span> working C compiler: /opt/homebrew/opt/ccache/libexec/cc - skipped
</span></span><span style="display:flex;"><span>-- Detecting C compile features
</span></span><span style="display:flex;"><span>-- Detecting C compile features - <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>-- Building <span style="color:#66d9ef">for</span> target architecture: arm64
</span></span><span style="display:flex; background-color:#3c3d38"><span>CMake Error at CMakeLists.txt:120 <span style="color:#f92672">(</span>find_package<span style="color:#f92672">)</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>  Could not find a package configuration file provided by <span style="color:#e6db74">&#34;zlib&#34;</span> with any of
</span></span><span style="display:flex; background-color:#3c3d38"><span>  the following names:
</span></span><span style="display:flex; background-color:#3c3d38"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    zlibConfig.cmake
</span></span><span style="display:flex; background-color:#3c3d38"><span>    zlib-config.cmake
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Add the installation prefix of <span style="color:#e6db74">&#34;zlib&#34;</span> to CMAKE_PREFIX_PATH or set
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;zlib_DIR&#34;</span> to a directory containing one of the above files.  If <span style="color:#e6db74">&#34;zlib&#34;</span>
</span></span><span style="display:flex;"><span>  provides a separate development package or SDK, be sure it has been
</span></span><span style="display:flex;"><span>  installed.
</span></span></code></pre></div><p>That felt somewhat surreal, because this is the last kind of error I&rsquo;d expect to see using a <em>package manager</em>, whose job is to make <em>resolving dependencies</em> easier, not more difficult. I ran to documentation faster than light, and surely enough it turned out that it was just me being stupid, because if I wanted to <a href="https://docs.conan.io/2/tutorial/creating_packages/add_dependencies_to_packages.html">resolve dependencies</a>, then <code>requirements()</code> alone is not good enough, and I should have <em>also</em> declared <a href="https://docs.conan.io/2/reference/tools/cmake/cmakedeps.html#conan-tools-cmakedeps">CMakeDeps</a> generator in the png&rsquo;s recipe:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>generators <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CMakeDeps&#34;</span>
</span></span></code></pre></div><p>Or, actually, looks like it should be <a href="https://docs.conan.io/2/reference/tools/cmake/cmakeconfigdeps.html#conan-tools-cmakeconfigdeps">CMakeConfigDeps</a> instead, because apparently there is something wrong with <code>CMakeDeps</code>, but at the same time <code>CMakeConfigDeps</code> is marked as experimental, sooooo what do I&hellip; jesus christ, I guess I&rsquo;ll go with <code>CMakeDeps</code>.</p>
<p>So I added that, and then the build progressed further, but failed with a different error - something I have expected even less:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: Running CMake.build<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: RUN: cmake --build <span style="color:#e6db74">&#34;/Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release&#34;</span> -- -j12
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>6/32<span style="color:#f92672">]</span> Generating pnglibconf.out
</span></span><span style="display:flex;"><span>FAILED: <span style="color:#f92672">[</span>code<span style="color:#f92672">=</span>1<span style="color:#f92672">]</span> pnglibconf.out /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/pnglibconf.out
</span></span><span style="display:flex;"><span>cd /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release <span style="color:#f92672">&amp;&amp;</span> /opt/homebrew/bin/cmake -DINPUT<span style="color:#f92672">=</span>/Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/pnglibconf.c -DOUTPUT<span style="color:#f92672">=</span>/Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/pnglibconf.out -P /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/scripts/cmake/genout.cmake
</span></span><span style="display:flex;"><span>/Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/pnglibconf.c:34:11: fatal error: <span style="color:#e6db74">&#39;zlib/zlib.h&#39;</span> file not found
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">34</span> | <span style="color:#75715e"># include &lt;zlib/zlib.h&gt;</span>
</span></span><span style="display:flex;"><span>      |           ^~~~~~~~~~~~~
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> error generated.
</span></span><span style="display:flex;"><span>CMake Error at scripts/cmake/genout.cmake:88 <span style="color:#f92672">(</span>message<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  Failed to generate
</span></span><span style="display:flex;"><span>  /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/pnglibconf.out.tf1
</span></span></code></pre></div><p>The <code>zlib/zlib.h</code> include pattern is <a href="https://github.com/retifrav/conan-recipes/blob/d3f72a83b729e5686cf355d62257915d4c5a368b/png/patches/1.6.53/001-single-unsuffixed-target-dependencies-installation.patch#L401-L439">my doing</a>, because I don&rsquo;t like every other library trying to take a dump with its headers into the top level of <code>include</code> - fuck that noise, no bare files without subfolder allowed in there. And that is addressed in CMake configs that are generated in my zlib package, which means that Conan still did not use CMake configs from the package. But what did it use then, since <code>find_package(zlib CONFIG REQUIRED)</code> succeeded?</p>
<p>Conan output contains a hint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: Generator <span style="color:#e6db74">&#39;CMakeDeps&#39;</span> calling <span style="color:#e6db74">&#39;generate()&#39;</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: CMakeDeps necessary find_package<span style="color:#f92672">()</span> and targets <span style="color:#66d9ef">for</span> your CMakeLists.txt
</span></span><span style="display:flex;"><span>    find_package<span style="color:#f92672">(</span>zlib<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    target_link_libraries<span style="color:#f92672">(</span>... zlib::zlib<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: Calling generate<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>png/1.6.53@your-prefix/public: Generators folder: /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/generators
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>Whaaaat the fuck is this <code>find_package(zlib)</code>, where are <code>CONFIG</code> and <code>REQUIRED</code> keywords/options? Why the target name is <code>zlib::zlib</code>, I never called it so (<em>although, in general, namespaced targets is a good practice, just not when they are set against my will</em>). And what is this bunch of crap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ ls -L1 /Users/USERNAME/.conan2/p/b/png098b4bf951dc7/b/build/Release/generators
</span></span><span style="display:flex;"><span>cmakedeps_macros.cmake
</span></span><span style="display:flex;"><span>CMakePresets.json
</span></span><span style="display:flex;"><span>conan_toolchain.cmake
</span></span><span style="display:flex;"><span>conanbuild.sh
</span></span><span style="display:flex;"><span>conanbuildenv-release-armv8.sh
</span></span><span style="display:flex;"><span>conandeps_legacy.cmake
</span></span><span style="display:flex;"><span>conanrun.sh
</span></span><span style="display:flex;"><span>conanrunenv-release-armv8.sh
</span></span><span style="display:flex;"><span>deactivate_conanbuild.sh
</span></span><span style="display:flex;"><span>deactivate_conanbuildenv-release-armv8.sh
</span></span><span style="display:flex;"><span>deactivate_conanrun.sh
</span></span><span style="display:flex;"><span>zlib-config-version.cmake
</span></span><span style="display:flex;"><span>zlib-config.cmake
</span></span><span style="display:flex;"><span>zlib-release-armv8-data.cmake
</span></span><span style="display:flex;"><span>zlib-Target-release.cmake
</span></span><span style="display:flex;"><span>zlibTargets.cmake
</span></span></code></pre></div><p>I could barely believe it - motherfucker generated its own CMake configs! In those configs it creates <code>zlib::zlib</code> target and it is this one who gets <code>INTERFACE_INCLUDE_DIRECTORIES</code> target property with the path to headers, but in the png&rsquo;s CMake project I link to <code>zlib</code> target, which simply does not exist in those configs, so compiler does not get to know where to find <code>zlib/zlib.h</code> header.</p>
<p>Sweet suffering Jehovah, whose dick do I gotta suck to get Conan use my pre-made CMake configs from the package instead of those smart-ass-generated ones? But as it has already become a recurring theme, that was just me being stupid again, because documentation <a href="https://docs.conan.io/2/reference/tools/cmake/cmakedeps.html#disable-cmakedeps-for-installed-cmake-configuration-files">clearly describes</a> this exact scenario:</p>
<blockquote>Some projects may want to disable the <code>CMakeDeps</code> generator for downstream consumers. This can be done by settings <code>cmake_find_mode</code> to <code>none</code>. If the project wants to provide its own configuration targets, it should append them to the <code>buildirs</code> attribute of <code>cpp_info</code>.</blockquote>
<p>I&rsquo;d probably replace &ldquo;<em>Some projects may want to</em>&rdquo; with &ldquo;<em>Everyone should absolutely</em>&rdquo;, but that&rsquo;s just me (<em>being stupid</em>). Next, that last part about appending targets I did not understand at first, as it does not make sense, but later I realized that they actually meant not targets but folders inside the package where your CMake configs are. Specifically, <a href="https://github.com/retifrav/conan-recipes/commit/41d0f23704f61ee5701db3b7b1af40fc2ef6843a">this</a> is what needs to be done:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">package_info</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># do not let Conan try to be smarter than CMake or/and maintainer,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># otherwise it will generate some bizarre CMake configs of its own</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># based on god knows what</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cpp_info<span style="color:#f92672">.</span>set_property(<span style="color:#e6db74">&#34;cmake_find_mode&#34;</span>, <span style="color:#e6db74">&#34;none&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># this is required too, otherwise consumers won&#39;t be able to find CMake configs,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># and obviously if you are installing package configs to a different path,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># then you will need to replace `share` with whichever you are using</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>cpp_info<span style="color:#f92672">.</span>builddirs<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;share&#34;</span>)
</span></span></code></pre></div><p>After re-making and re-publishing this updated zlib package I could then make a png package, as it finally used CMake configs from the package.</p>
<p>In case it isn&rsquo;t obvious, the <a href="https://github.com/retifrav/conan-recipes/tree/d3f72a83b729e5686cf355d62257915d4c5a368b/png">png package</a> itself (<em>and any other package, for that matter</em>) also needs to perform the <a href="https://github.com/retifrav/conan-recipes/blob/d3f72a83b729e5686cf355d62257915d4c5a368b/png/conanfile.py#L117-L119">same ritual passes</a> in its <code>package_info()</code> method, otherwise its own CMake configs are going to suffer the same fate.</p>
<p>If you&rsquo;d like to see how Conan resolves dependencies in an actual CMake project, you can take a look at <a href="https://github.com/retifrav/MREs/tree/36782ba21b961572df8a9bc881440588612098c5/cyberforum-ru/3213759">this example</a>. It demonstrates resolving the same set of dependencies either with bare <code>FetchContent</code>, or with vcpkg, or with Conan (<em>build instructions are in <code>README.md</code></em>).</p>
<h3 id="and-so-how-is-it">And so how is it</h3>
<p>Indeed, building packages from sources is definitily the way to go. Bare packing of pre-built binaries with <code>export-pkg</code> <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/#why-we-didnt-proceed-with-conan">won&rsquo;t get you far</a>, so we really did take a wrong approach to it back then.</p>
<p>Presumably, that was the main reason why we did not proceed with Conan and chose vcpkg instead. However, with all the current knowledge that I have now, if I needed to choose between Conan and vcpkg today, I would absolutely pick vcpkg again. The reasons are still the <a href="/blog/2022/10/30/cpp-dependencies-with-vcpkg/#overall-impression">same</a>: vcpkg is more intuitive (<em>it is for me, at least</em>), and I had considerably fewer &ldquo;chances&rdquo; to do something wrong, as most of the time things just made sense and felt like a natural way to go.</p>
<p>With Conan, those dances around <code>export_sources()</code> and <code>source()</code> alone were tiresome enough. I had a hard time wrapping my head around what goes where and how do I place additional files into the sources (<em>which I still don&rsquo;t know how it is supposed to be done without introducing intermediate crutches</em>).</p>
<p>I&rsquo;d say that Conan being less intuitive was the major slowdown again, as way too often I needed to either browse the documentation, or go through their <a href="https://github.com/conan-io/conan/issues">issue tracker</a>, or just google the wild internets (<em>the latter has proven to be the least useful</em>). With zlib as a concrete example, it took me about 3 days to make a Conan recipe/package for it (<em>first for version 1.x and then adapting it to 2.x</em>), while when I was learning vcpkg my zlib port was done in about half a day, as I recall.</p>
<p>What especially threw me off the trail is how Conan <a href="#making-sure-that-requirements-use-proper-cmake-configs">tries to be a smart-ass</a> and generates its own CMake configs instead of using pre-made ones from the packages. That was a real WTF moment for me, though perhaps this is due to my perception being somewhat deformed in that regard (<em>spent too much time with CMake</em>).</p>
<p>Figuring out the way patches are supposed to work was rather difficult too. And by the way, while I was struggling with that, I stumbled upon this <a href="https://github.com/conan-io/conan-center-index/blob/919d894e778c287cb597be248a81c67089e26409/docs/adding_packages/sources_and_patches.md#policy-on-patches">majestic policy</a> of Conan Center:</p>
<blockquote>In general, patches to source code should be avoided and only done as a last resort.
<p>[&hellip;]</p>
<p>Patches that affect C and C++ code are strongly discouraged and will only be accepted at the discretion of the Conan Team, after a strict validation process.</blockquote></p>
<p>U wot m8? Patches should be avoided and are strongly discouraged? Yeah, it&rsquo;s like these people live on a different planet. I don&rsquo;t know, I almost gave up at that point.</p>
<p>It is also worth to mention that so far I have only dealt with rather basic stuff, I haven&rsquo;t even touched more advanced topics like building WebAssembly with Emscripten (<em>and pthreads enabled</em>), universal/combined binaries on Apple platforms, using Clang instead of MSVC on Windows and so on - those were not easy to figure out with vcpkg, and I dread the amount of time it might require with Conan (<em>but I sure do hope that it will be a pleasant surprise of everything just working out of the box</em>).</p>
<p>Speaking about basic stuff, I find it very suboptimal that <code>git.clone()</code> does a full clone of the repository every bloody time you run <code>conan create</code>, even though there is already a local clone (<em>and more than one!</em>) for it. What&rsquo;s more ridiculous is that I haven&rsquo;t even touched a single thing in the recipe, everything is the absolute same, and yet <code>conan create</code> still wants to do a new clone, giving zero fucks about already existing local clone(s). This is such a waste of disk space, network traffic and time (<em>especially if that repository size is in gigabytes range</em>). And if you are not connected to the internet, then making a package will simply fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">========</span> Installing packages <span style="color:#f92672">========</span>
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Calling source<span style="color:#f92672">()</span> in /Users/USERNAME/.conan2/p/zlib0f49e294544ad/s
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: Cloning git repo
</span></span><span style="display:flex;"><span>zlib/1.3.1@your-prefix/public: RUN: git clone <span style="color:#e6db74">&#34;git@github.com:madler/zlib.git&#34;</span>  <span style="color:#e6db74">&#34;src&#34;</span>
</span></span><span style="display:flex;"><span>ERROR: zlib/1.3.1@your-prefix/public: Error in source<span style="color:#f92672">()</span> method, line <span style="color:#ae81ff">46</span>
</span></span><span style="display:flex;"><span>        git.clone<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        ConanException: Command <span style="color:#e6db74">&#39;git clone &#34;git@github.com:madler/zlib.git&#34;  &#34;src&#34;&#39;</span> failed with errorcode <span style="color:#e6db74">&#39;128&#39;</span>
</span></span><span style="display:flex;"><span>b<span style="color:#e6db74">&#34;Cloning into &#39;src&#39;...\nssh: connect to host github.com port 22: Undefined error: 0\r\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n&#34;</span>
</span></span></code></pre></div><p>which would be understandable if you were doing it for the very first time, but not when you have made more than one package for this library, so there are already plenty of local clones lying around on your disk.</p>
<p>By the way, what is all this garbage piling up in my home folder:</p>
<details>
    <summary>tree -L 2 ~/.conan2/p</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ tree <span style="color:#f92672">-</span>L <span style="color:#ae81ff">2</span> <span style="color:#f92672">~/.</span>conan2<span style="color:#f92672">/</span>p
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> b
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib01e3a8684a1fe
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib0253b28cb8f5e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib13c81295918f8
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib1495b2f7e6558
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib1f9e8e16e0f1d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib2db0b858bac65
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib313083ba0537b
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib40e90c6283e14
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib40f82666a9fd6
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib432db857a739c
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib45b698073225a
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib49cf05222680e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib53f27f984c843
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib5494213ec52d7
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib76e800322290c
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib86a3192917c60
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib8a5b3f281a001
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlib967f8b16fac65
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibb332fd00a0e2f
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibb69029c81b6f1
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibbce02886baaed
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibc333a16bc14b8
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibcabcbd1bde233
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibe04d02c8dccf3
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> zlibe3937c7d10a89
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> zlibe9e53be228959
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> cache<span style="color:#f92672">.</span>sqlite3
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> t
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib0e8f55016cf98
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib23d8dfdd3f280
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib25c7db754f26d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib267fe345e150f
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib2b7271a1100fd
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib2f5c478a7b2a8
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib30f31b3eeabcc
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib396f152b26702
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib3a471b8319eee
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib480c4ef66fb3d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib5975343740cef
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib66f56a18eebc9
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib6cd1a0937cc6f
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib70c8e8a1b8eff
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib712baa18e4991
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib71d56d0bd9fc1
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib731644a94ff1b
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib8086d90ce6aee
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib8af255aeff044
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlib9271a59df71d4
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zliba4b2619cab5a9
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibb34810cc451ce
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibdb773489e313a
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibe064db47df5b8
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibf05b26372de83
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibf622c518a8bc7
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">├──</span> zlibf89b3b2101d0a
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">├──</span> s
</span></span><span style="display:flex;"><span><span style="color:#f92672">│</span>   <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty
</span></span><span style="display:flex;"><span><span style="color:#f92672">└──</span> zlibfefdd977772c9
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> d
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> es
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> patches
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">├──</span> s
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">└──</span> s<span style="color:#f92672">.</span>dirty</span></span></code></pre></div>
</details>
<p>All of that is from just zlib package alone. Sure, I had a lot of failed attempts, but it is still surprising to see how much crap is preserved in the filesystem. Imagine what will become of it when I&rsquo;ll start making packages for other libraries too.</p>
<p>But in general, despite all the negative aspects that I&rsquo;ve discovered / struggled with, I will still say that Conan is a pretty decent package manager for C++ projects, and I can definitely see us using it in production. Hell, if vcpkg did not exist, I would probably even call Conan the best one there is (<em>partly because there simply isn&rsquo;t an awful lot of C++ package managers out there</em>).</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/cpp/">cpp</a><a class="tag" href="https://retifrav.github.io/tags/cmake/">cmake</a><a class="tag" href="https://retifrav.github.io/tags/devops/">devops</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <div style="border:2px orange solid; background-color: floralwhite; border-radius:0.5rem; padding: 10px 14px; font-style:italic; font-size:0.9em;">
              If you'd like to comment the article, you can do it on the
              <a href="https://decovar.dev/blog/2022/02/06/cpp-dependencies-with-conan/#remark42" style="font-weight:bold;">
                  original website</a>. This one is just a mirror without comments.
          </div>
      
      </div>
    </div>
  </div>

  
        <div id="footer">
          <div>
              2014 - 2026,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <div class="sidebar-row">
                <a href="/index.xml" title="Subscribe to RSS">
                  <img src="/images/rss.png" class="sidebar-row-icon">
                </a>
                
                <a href="https://t.me/decovar" title="Telegram channel">
                  <img src="/images/telegram.png" class="sidebar-row-icon">
                </a>
              </div>
            </div>
            
            
            
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (68)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (38)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/linux">linux (28)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (13)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/ios">ios (8)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/apple">apple (7)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/home-automation">home-automation (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    

    <script>
        
        window.onload = () =>
        {
            
            
            
            
            
            
            
            
            
            
            
        }
    </script>

    
    
  </body>
</html>

<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Querying astronomy databases in ADQL via TAP | Declaration of VAR</title>
    <link rel="canonical" href="https://decovar.dev/blog/2022/02/26/astronomy-databases-tap-adql/" />

    <meta name="generator" content="Hugo" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon">

    <meta name="author" content="retif" />
    <meta name="description" content="There are astronomy databases that store information about space objects such as stars and planets. Quite often they allow to query their data via TAP interface using ADQL, which many astronomers / planetary scientists do." />

    <link rel="alternate" type="application/rss+xml" href="/index.xml" title="Declaration of VAR" />

    <meta property="og:url" content="https://retifrav.github.io/blog/2022/02/26/astronomy-databases-tap-adql/">
  <meta property="og:site_name" content="Declaration of VAR">
  <meta property="og:title" content="Querying astronomy databases in ADQL via TAP">
  <meta property="og:description" content="There are astronomy databases that store information about space objects such as stars and planets. Quite often they allow to query their data via TAP interface using ADQL, which many astronomers / planetary scientists do.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-02-26T18:34:15+01:00">
    <meta property="article:modified_time" content="2022-02-26T18:34:15+01:00">
    <meta property="article:tag" content="Science">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Mestuff">


    <link rel="stylesheet" href="https://retifrav.github.io/css/main.min.2a28493e0b91076cde9fb52cb7fec81f63f685a6965e6a9df1179ec846b9141f.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/page.css" />
    <link rel="stylesheet" href="/css/comments.css" />

    <script src="/js/mark.js"></script>

    
    
  </head>
  <body>
    <div id="body-hat">
      <div id="title-block">
        <h1 id="blog-title"><a href="/">Declaration of VAR</a></h1>
        <p>and some other stuff</p>
      </div>
    </div>
    <div style="background-color:orange; padding:4px 16px; font-size:0.8em; text-align:center; font-style:italic;">
        On 19.05.2021 the website was moved to
        <a href="https://decovar.dev/blog/2022/02/26/astronomy-databases-tap-adql/" style="color:black; font-weight:bold;">
            https://decovar.dev/</a>. This is just a mirror now.
    </div>
    <div id="body-flex">
      <main class="app-container">
        
  <div id="main-container">
    <article class="post">
      <header class="post-header">
        <h1 class ="post-title">Querying astronomy databases in ADQL via TAP</h1>
        <div class="post-meta">
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> 2022-02-26 18:34:15 &#43;0100</div>
          <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 38 min read</div>
        </div>
      </header>
      <div class="post-content">
        <p>There are several astronomy databases that store various information about space objects such as stars and planets. Some (<em>most?</em>) of those databases expose their data via <a href="https://www.ivoa.net/documents/TAP/">TAP</a> interface, so it can be queried using <a href="https://www.ivoa.net/documents/ADQL/">ADQL</a>.</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/tap-adql-sandbox.png" alt="TAP ADQL sandbox">

<p>Here I&rsquo;ll be telling about how to get data from such sources and what sort of issues/problems one can encounter.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-query-data">How to query data</a>
      <ul>
        <li><a href="#sending-requests">Sending requests</a></li>
        <li><a href="#pyvo">PyVO</a></li>
        <li><a href="#a-sandbox-application">A sandbox application</a></li>
      </ul>
    </li>
    <li><a href="#tap-services-with-astronomical-data">TAP services with astronomical data</a>
      <ul>
        <li><a href="#about-access-and-not-abusing-the-service">About access and (not) abusing the service</a></li>
      </ul>
    </li>
    <li><a href="#problems-and-challenges">Problems and challenges</a>
      <ul>
        <li><a href="#nasa-exoplanet-archive">NASA Exoplanet Archive</a>
          <ul>
            <li><a href="#ps-vs-pscomppars">PS vs PSCompPars</a>
              <ul>
                <li><a href="#no-simple-mass-values">No simple mass values</a></li>
                <li><a href="#calculated-values">Calculated values</a></li>
                <li><a href="#missing-values">Missing values</a></li>
              </ul>
            </li>
            <li><a href="#planetary-data-is-organized-by-publications">Planetary data is organized by publications</a></li>
            <li><a href="#planets-from-the-same-system-have-different-stellar-data">Planets from the same system have different stellar data</a></li>
            <li><a href="#no-way-to-get-the-latest-data">No way to get the latest data</a></li>
            <li><a href="#top-clause-is-broken">TOP clause is broken</a></li>
            <li><a href="#missing-uncertainties-columns">Missing uncertainties columns</a></li>
            <li><a href="#inconsistent-date-format">Inconsistent date format</a></li>
            <li><a href="#float-values-are-rounded-on-select-but-compared-to-originals-in-where">Float values are rounded on SELECT but compared to originals in WHERE</a></li>
            <li><a href="#casting-float-values-to-varchar-drops-the-leading-zero">Casting float values to VARCHAR drops the leading zero</a></li>
          </ul>
        </li>
        <li><a href="#paris-astronomical-data-centre">Paris Astronomical Data Centre</a>
          <ul>
            <li><a href="#obsolete-data">Obsolete data</a></li>
            <li><a href="#untrustworthy-data">Untrustworthy data</a></li>
            <li><a href="#different-names-for-star-and-planets">Different names for star and planets</a></li>
          </ul>
        </li>
        <li><a href="#simbad">SIMBAD</a>
          <ul>
            <li><a href="#does-not-support-cast">Does not support CAST</a></li>
            <li><a href="#some-problems-with-strings">Some problems with strings</a></li>
          </ul>
        </li>
        <li><a href="#overall">Overall</a></li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="how-to-query-data">How to query data</h1>
<h2 id="sending-requests">Sending requests</h2>
<p>Very simplified description for how this works is that you send <a href="https://en.wikipedia.org/wiki/SQL">SQL-like queries</a> as a part of <a href="https://en.wikipedia.org/wiki/Query_string">query string</a> to a TAP-endpoint URL of a database/datasource via HTTP POST request (<em>or HTTP GET, if you are fine with <a href="https://www.ivoa.net/documents/TAP/20190927/REC-TAP-1.1.html#tth_sEc2.1">cached results</a></em>).</p>
<p>An example of one such request being sent with cURL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ curl -X <span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#e6db74">&#34;http://voparis-tap-planeto.obspm.fr/tap/sync?REQUEST=doQuery&amp;LANG=ADQL&amp;FORMAT=JSON&amp;QUERY=SELECT%20granule_uid,%20mass,%20radius%20FROM%20exoplanet.epn_core%20WHERE%20star_name%20%3D%20%27Kepler-107%27%20ORDER%20BY%20granule_uid&#34;</span></span></span></code></pre></div>
<p>Here&rsquo;s the same request in a more readable form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>POST http:<span style="color:#f92672">//</span>voparis<span style="color:#f92672">-</span>tap<span style="color:#f92672">-</span>planeto.obspm.fr<span style="color:#f92672">/</span>tap<span style="color:#f92672">/</span>sync
</span></span><span style="display:flex;"><span><span style="color:#f92672">?</span>REQUEST<span style="color:#f92672">=</span>doQuery
</span></span><span style="display:flex;"><span><span style="color:#f92672">&amp;</span>LANG<span style="color:#f92672">=</span>ADQL
</span></span><span style="display:flex;"><span><span style="color:#f92672">&amp;</span>FORMAT<span style="color:#f92672">=</span>JSON
</span></span><span style="display:flex;"><span><span style="color:#f92672">&amp;</span>QUERY<span style="color:#f92672">=</span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, radius <span style="color:#66d9ef">FROM</span> exoplanet.epn_core <span style="color:#66d9ef">WHERE</span> star_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107&#39;</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid</span></span></code></pre></div>
<p>As you can see, the <code>QUERY</code> parameter is indeed a pretty much regular SQL query (<em>but here&rsquo;s some <a href="https://www.gaia.ac.uk/data/gaia-data-release-1/adql-cookbook">more information</a> about ADQL specifics</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> star_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid</span></span></code></pre></div>
<p>And as the <code>FORMAT</code> parameter is set to <code>JSON</code>, the response to this request will look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>Date: Sun, <span style="color:#ae81ff">20</span> Feb <span style="color:#ae81ff">2022</span> 17:31:52 GMT
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>Server: TwistedWeb/18.9.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;data&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Kepler-107 b&#34;</span>,
</span></span><span style="display:flex;"><span>            0.01104,
</span></span><span style="display:flex;"><span>            0.137
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Kepler-107 c&#34;</span>,
</span></span><span style="display:flex;"><span>            0.02954,
</span></span><span style="display:flex;"><span>            0.142
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Kepler-107 d&#34;</span>,
</span></span><span style="display:flex;"><span>            0.01196,
</span></span><span style="display:flex;"><span>            0.077
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Kepler-107 e&#34;</span>,
</span></span><span style="display:flex;"><span>            0.02706,
</span></span><span style="display:flex;"><span>            0.259
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;contains&#34;</span>: <span style="color:#e6db74">&#34;table&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;contains&#34;</span>: <span style="color:#e6db74">&#34;params&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;columns&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;dbtype&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;xtype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;utype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Internal table row index Unique ID in data service, also in v2. Can be alphanumeric.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;granule_uid&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;datatype&#34;</span>: <span style="color:#e6db74">&#34;char&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ucd&#34;</span>: <span style="color:#e6db74">&#34;meta.id&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;arraysize&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ref&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;granule_uid&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;unit&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;dbtype&#34;</span>: <span style="color:#e6db74">&#34;double precision&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;xtype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;utype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Mass of the planet&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;mass&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;datatype&#34;</span>: <span style="color:#e6db74">&#34;double&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ucd&#34;</span>: <span style="color:#e6db74">&#34;phys.mass&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;arraysize&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ref&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;mass&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;unit&#34;</span>: <span style="color:#e6db74">&#34;&#39;jupiterMass&#39;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;dbtype&#34;</span>: <span style="color:#e6db74">&#34;double precision&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;xtype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;utype&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Radius of the planet&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;radius&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;datatype&#34;</span>: <span style="color:#e6db74">&#34;double&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ucd&#34;</span>: <span style="color:#e6db74">&#34;phys.size.radius&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;arraysize&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;ref&#34;</span>: null,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;radius&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;unit&#34;</span>: <span style="color:#e6db74">&#34;&#39;jupiterRad&#39;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div>
<p>But be aware that not all the services support JSON output. Other possible formats are CSV, XML and <a href="https://www.ivoa.net/documents/VOTable/">VOTable</a> - a semi-binary format (<em>meta-information in XML and Base64-encoded data</em>), which is actually the only format that <a href="https://www.ivoa.net/documents/TAP/20190927/REC-TAP-1.1.html#tth_sEc1">is required</a> to be supported by every TAP service (<em>all other formats are optional</em>).</p>
<p>Sure enough, I needed an programmatic way to work with these queries, and as I wasn&rsquo;t too eager to implement sending requests and processing results myself, I started looking for a library that would do that for me, and preferably that would be a Python library, as I&rsquo;m doing my data analysis in <a href="/blog/2020/05/27/jupyter-notebook-nginx/">Jupyter notebooks</a>.</p>
<h2 id="pyvo">PyVO</h2>
<p>Almost immediately I discovered The Extrasolar Planets Encyclopaedia <a href="http://exoplanet.eu/API/">API tutorial</a>, which is referring to <a href="https://pypi.org/project/pyvo/">PyVO</a> library.</p>
<p>It is rather easy to use. First, install it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ pip install pyvo</span></span></code></pre></div>
<p>and then you can use it in your Python code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> pyvo
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tabulate <span style="color:#f92672">import</span> tabulate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>service <span style="color:#f92672">=</span> pyvo<span style="color:#f92672">.</span>dal<span style="color:#f92672">.</span>TAPService(<span style="color:#e6db74">&#34;http://voparis-tap-planeto.obspm.fr/tap&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tableName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;exoplanet.epn_core&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fields <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;star_name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;star_teff&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;granule_uid&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;mass&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#&#34;mass_error_min&#34;,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#&#34;mass_error_max&#34;,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;radius&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#&#34;radius_error_min&#34;,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#&#34;radius_error_max&#34;,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#&#34;semi_major_axis&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>starName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Kepler-106&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>queryPlanets <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">.</span>join((
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;SELECT </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(fields)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;FROM </span><span style="color:#e6db74">{</span>tableName<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;WHERE star_name = &#39;</span><span style="color:#e6db74">{</span>starName<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ORDER BY granule_uid&#34;</span>
</span></span><span style="display:flex;"><span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># check the final query string</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(&#34;Query to execute: &#34;, queryPlanets)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># execute the query</span>
</span></span><span style="display:flex;"><span>results <span style="color:#f92672">=</span> service<span style="color:#f92672">.</span>search(queryPlanets)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Total planets found:&#34;</span>, len(results))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># fields datatypes can be extracted too</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(resultPlanets.fielddescs)</span></span></span></code></pre></div>
<p>The <a href="https://pyvo.readthedocs.io/en/latest/api/pyvo.dal.DALResults.html">PyVO results</a> can be then printed using <a href="https://pypi.org/project/tabulate/">tabulate</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># print results as a table</span>
</span></span><span style="display:flex;"><span>print(
</span></span><span style="display:flex;"><span>    tabulate(
</span></span><span style="display:flex;"><span>        resultPlanets<span style="color:#f92672">.</span>to_table(),
</span></span><span style="display:flex;"><span>        headers<span style="color:#f92672">=</span>resultPlanets<span style="color:#f92672">.</span>fieldnames,
</span></span><span style="display:flex;"><span>        tablefmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;psql&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># +-------------+-------------+---------------+---------+----------+</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | star_name   |   star_teff | granule_uid   |    mass |   radius |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |-------------+-------------+---------------+---------+----------|</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | Kepler-106  |        5858 | Kepler-106 b  | 0.01668 |    0.073 |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | Kepler-106  |        5858 | Kepler-106 c  | 0.033   |    0.223 |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | Kepler-106  |        5858 | Kepler-106 d  | 0.02549 |    0.085 |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># | Kepler-106  |        5858 | Kepler-106 e  | 0.035   |    0.228 |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># +-------------+-------------+---------------+---------+----------+</span></span></span></code></pre></div>
<p>or, better yet, it can be turned into a <a href="https://pypi.org/project/pandas/">Pandas</a> object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>resultPandas <span style="color:#f92672">=</span> results<span style="color:#f92672">.</span>to_table()<span style="color:#f92672">.</span>to_pandas(<span style="color:#e6db74">&#34;granule_uid&#34;</span>)</span></span></code></pre></div>
<p>which can be displayed in a nicer manner, if you are using a Jupyter notebook client that supports <code>display()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> pandas<span style="color:#f92672">.</span>option_context(<span style="color:#e6db74">&#39;display.max_rows&#39;</span>, <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;display.max_columns&#39;</span>, <span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    display(resultPandas)</span></span></code></pre></div>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/dataspell-pandas-display.png" alt="DataSpell, displaying Pandas" style="border:1px solid black;">

<p>This screenshot is taken from <a href="https://www.jetbrains.com/dataspell/">DataSpell</a>, but <a href="https://code.visualstudio.com/docs/datascience/jupyter-notebooks">VS Code</a> supports <code>display()</code> too (<em>even though it might be underlined there as unknown</em>).</p>
<p>Finally, results can be saved to a file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># as a NumPy object</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import numpy</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#numpy.save(&#34;./results.npy&#34;, resultPlanets.to_table())</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tbl = numpy.load(&#34;./results.npy&#34;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># or as a pickle (it&#39;s a pickle! pickle fiiiiiile!)</span>
</span></span><span style="display:flex;"><span>resultPandas<span style="color:#f92672">.</span>to_pickle(<span style="color:#e6db74">&#34;./results.pkl&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tbl = pandas.read_pickle(&#34;./results.pkl&#34;)</span></span></span></code></pre></div>
<p>If you haven&rsquo;t used Pandas before, you absolutely definitely should, as it makes <a href="https://pandas.pydata.org/docs/getting_started/intro_tutorials/03_subset_data.html#min-tut-03-subset">working with table data</a> very <a href="https://github.com/retifrav/scraps/blob/master/python/pandas.md">convenient</a>.</p>
<h2 id="a-sandbox-application">A sandbox application</h2>
<p>Soon enough I discovered that I need a faster way to query data, for when I&rsquo;d like to quickly check some values.</p>
<p>Opening a Jupyter notebook in Java-based DataSpell or in Electron-based VS Code is too damn slow. All the waiting for the environment to load and for Jupyter server to start, modifying queries in cells and scrolling between results and code, urgh.</p>
<p>Running bare Python scripts from terminal is faster, but then viewing the results isn&rsquo;t that nice, especially if there are a lot of columns in the resulting table, so it gets wrapped in the terminal window. And again, constantly switching between code editor and terminal window isn&rsquo;t very convenient.</p>
<p>Having been annoyed enough by the inconveniences of both options, I decided to write a small GUI application for the sole purpose of executing ADQL queries and browsing results in a scrollable table. There surely must be at least several already existing applications for that, but I&rsquo;ve managed to find only <a href="http://www.star.bristol.ac.uk/~mbt/topcat/">TOPCAT</a>, which in my opinion is quite ugly, clumsy (<em>no offense, that&rsquo;s just the way Java-based applications usually are</em>) and too overloaded with functionality (<em>but that&rsquo;s more of a compliment, really</em>). So yeah, I decided to make one of my own.</p>
<p>At first I wanted to create a native Mac OS application using <a href="https://developer.apple.com/xcode/swiftui/">SwiftUI</a>, which I&rsquo;ve been wanting to try out for a long time. But even though Mac OS is my main environment, I often work on Windows too, and sometimes on GNU/Linux too, so a cross-platform framework would be a better choice.</p>
<p>The next candidate was Qt, but then I remembered that I read about Python binding for <a href="https://github.com/ocornut/imgui">Dear ImGui</a> - <a href="https://github.com/hoffstadt/DearPyGui">Dear PyGui</a> - which was a perfect variant, because most of the work would be then taken care of by PyVO, and I&rsquo;d only need to handle the GUI part. It&rsquo;s true that I could&rsquo;ve taken <a href="https://doc.qt.io/qtforpython/">PySide</a> or <a href="https://riverbankcomputing.com/software/pyqt/">PyQt</a> and still benefit from relying on PyVO, but I reckoned that ImGui-based application will be more lightweight and responsive, plus I wanted to try something new.</p>
<p>And so here&rsquo;s what I&rsquo;ve come up with:</p>







    <video  controls="yes"   class="video">
        <source src="/blog/2022/02/26/astronomy-databases-tap-adql/video/tap-adql-sandbox.mp4" type="video/mp4">
    </video>
    
    <p class="video-fallback">If video doesnâ€™t play in your browser, you can download it <a href="/blog/2022/02/26/astronomy-databases-tap-adql/video/tap-adql-sandbox.mp4">here</a>.</p>
    


<p>Very nice indeed! Cross-platform application (<em>powered by <a href="https://www.glfw.org/">GLFW</a></em>), with almost native performance (<em>but not quite, as I notice Python ears here and there</em>) and not too horrible GUI. Some might even say, beautifully ascetic.</p>
<p>While we are here, I can say that Dear PyGui turned out to be even better than I expected. It is quite an easy and comfortable tooling for creating GUI application. It took me just <a href="https://github.com/retifrav/tap-adql-sandbox/commit/e3c6df19329f312e1b992bb2885ab81fde99c656">3 days</a> to get from the very scratch to the working application that was executing queries and displaying results in a table widget. And most of that time I was working on styling and theme customization, rather than on the actual functionality.</p>
<p>You can install the current application version <a href="https://pypi.org/project/tap-adql-sandbox/">from PyPI</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>$ pip install tap<span style="color:#f92672">-</span>adql<span style="color:#f92672">-</span>sandbox
</span></span><span style="display:flex;"><span>$ tap<span style="color:#f92672">-</span>adql<span style="color:#f92672">-</span>sandbox <span style="color:#f92672">--</span>help</span></span></code></pre></div>
<p>And here&rsquo;s the project <a href="https://github.com/retifrav/tap-adql-sandbox">source code</a>.</p>
<h1 id="tap-services-with-astronomical-data">TAP services with astronomical data</h1>
<p>There are several astronomical databases that expose their data via TAP interface. So far I&rsquo;ve been working with these ones:</p>
<ul>
<li><a href="https://exoplanetarchive.ipac.caltech.edu/">NASA Exoplanet Archive</a>: <code>https://exoplanetarchive.ipac.caltech.edu/TAP</code></li>
<li><a href="https://padc.obspm.fr/">Paris Astronomical Data Centre</a>: <code>http://voparis-tap-planeto.obspm.fr/tap</code></li>
<li><a href="https://cosmos.esa.int/web/gaia-users/archive/programmatic-access">Gaia</a>: <code>https://gea.esac.esa.int/tap-server/tap</code> (<em>also some <a href="https://cosmos.esa.int/web/gaia-users/archive/writing-queries">ADQL examples</a></em>)</li>
<li><a href="https://simbad.u-strasbg.fr/simbad/">SIMBAD</a>: <code>http://simbad.cds.unistra.fr/simbad/sim-tap/sync</code></li>
</ul>
<p>All of the TAP-services (<em>should</em>) support a certain set of standard functions. For instance, you can query the service availability:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>$ curl http://voparis-tap-planeto.obspm.fr/tap/availability
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;avl:availability</span> <span style="color:#a6e22e">xmlns:avl=</span><span style="color:#e6db74">&#34;http://www.ivoa.net/xml/VOSIAvailability/v1.0&#34;</span> <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://www.ivoa.net/xml/VOSIAvailability/v1.0 http://vo.ari.uni-heidelberg.de/docs/schemata/VOSIAvailability-v1.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;avl:available&gt;</span>true<span style="color:#f92672">&lt;/avl:available&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;avl:upSince&gt;</span>2022-02-05T12:44:11Z<span style="color:#f92672">&lt;/avl:upSince&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/avl:availability&gt;</span></span></span></code></pre></div>
<p>And get a list of available tables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ curl http://voparis-tap-planeto.obspm.fr/tap/tables</span></span></code></pre></div>
<p>which can also be queried with ADQL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">table_name</span>, description
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> tap_schema.tables
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">table_name</span></span></span></code></pre></div>
<p>as well as columns from a particular table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column_name</span>, datatype, description
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> tap_schema.columns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;exoplanet.epn_core&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">column_name</span></span></span></code></pre></div>
<h2 id="about-access-and-not-abusing-the-service">About access and (not) abusing the service</h2>
<p>I haven&rsquo;t yet encountered a service that would limit access to its data, and I believe that this is the way things should be - that kind of data must remain open for the scientific community.</p>
<p>In turn, you too need to be a responsible user - do not execute crazy queries that fetch a milliard of columns with bazillion of rows. If your query doesn&rsquo;t have narrow enough <code>WHERE</code> clause, do add a <code>TOP</code> limiter to your <code>SELECT</code>, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> TOP <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    star_name, granule_uid, mass, radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core</span></span></code></pre></div>
<h1 id="problems-and-challenges">Problems and challenges</h1>
<p>Working with the data, I did stumble upon various differences and peculiarities among TAP services.</p>
<h2 id="nasa-exoplanet-archive">NASA Exoplanet Archive</h2>
<p>Almost all the problems I had were with NASA Exoplanet Archive database. At the same time, the data from NASA seems to be the most updated and trustworthy, so I have mixed feelings about this source.</p>
<h3 id="ps-vs-pscomppars">PS vs PSCompPars</h3>
<p>There are two main tables in the database that you are likely to use: <code>PS</code> and <code>PSCompPars</code>. The difference between them is described in the <a href="https://exoplanetarchive.ipac.caltech.edu/docs/API_PS_columns.html">Choosing the Right Table For Your Needs</a> section. In short, the <code>PS</code> table is organized in a way that there is a row for every publication and the set of parameters described in that publication, so there can be several rows per planet (<em>and star?</em>); while <code>PSCompPars</code> has exactly one row per planet, and every parameter should have a value from the latest publication, and the publication is provided in the <code>PARAMETER-NAME_reflink</code> field/column.</p>
<p>So it&rsquo;s obvious that one should use <code>PSCompPars</code>, right? Well, for me it was not so obvious, and I actually went with <code>PS</code> (<em>details below</em>).</p>
<h4 id="no-simple-mass-values">No simple mass values</h4>
<p>Unlike <code>ps</code> table, <code>pscomppars</code> doesn&rsquo;t have &ldquo;simple&rdquo; mass (<em>and probably other</em>) values, for instance <code>pl_massj</code> and <code>pl_msinij</code>. Instead, the mass-related parameters are stored like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column_name</span>, datatype, description
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> tap_schema.columns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pscomppars&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;pl_bmass%&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">column_name</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>+-------------------+------------+------------------------------------------------------+
</span></span><span style="display:flex;"><span>| column_name       | datatype   | description                                          |
</span></span><span style="display:flex;"><span>|-------------------+------------+------------------------------------------------------|
</span></span><span style="display:flex;"><span>| pl_bmasse         | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span>              |
</span></span><span style="display:flex;"><span>| pl_bmasse_reflink | char       | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span> Reference    |
</span></span><span style="display:flex;"><span>| pl_bmasseerr1     | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span> Upper Unc.   |
</span></span><span style="display:flex;"><span>| pl_bmasseerr2     | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span> Lower Unc.   |
</span></span><span style="display:flex;"><span>| pl_bmasselim      | int        | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span> Limit Flag   |
</span></span><span style="display:flex;"><span>| pl_bmassestr      | char       | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Earth Mass<span style="color:#f92672">]</span>              |
</span></span><span style="display:flex;"><span>| pl_bmassj         | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span>            |
</span></span><span style="display:flex;"><span>| pl_bmassj_reflink | char       | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span> Reference  |
</span></span><span style="display:flex;"><span>| pl_bmassjerr1     | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span> Upper Unc. |
</span></span><span style="display:flex;"><span>| pl_bmassjerr2     | double     | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span> Lower Unc. |
</span></span><span style="display:flex;"><span>| pl_bmassjlim      | int        | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span> Limit Flag |
</span></span><span style="display:flex;"><span>| pl_bmassjstr      | char       | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Jupiter Mass<span style="color:#f92672">]</span>            |
</span></span><span style="display:flex;"><span>| pl_bmassprov      | char       | Planet Mass or Mass*sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> Provenance                |
</span></span><span style="display:flex;"><span>+-------------------+------------+------------------------------------------------------+</span></span></code></pre></div>
<p>So instead of <code>pl_massj</code> one should use <code>pl_bmassj</code>, right, but then what does one suppose to use instead of <code>pl_msinij</code>? Turns out, it&rsquo;s the same <code>pl_bmassj</code>! And the type of what is stored in <code>pl_bmassj</code> is provided in <code>pl_bmassprov</code> (<em>does it also correspond for <code>pl_bmasse</code>?</em>). Here all the possible values of <code>pl_bmassprov</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> <span style="color:#e6db74">&#34;How many&#34;</span>, pl_bmassprov
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> pscomppars
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> pl_bmassprov</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+------------+------------------+
</span></span><span style="display:flex;"><span>|   how many | pl_bmassprov     |
</span></span><span style="display:flex;"><span>|------------+------------------|
</span></span><span style="display:flex;"><span>|        <span style="color:#ae81ff">872</span> | Msini            |
</span></span><span style="display:flex;"><span>|       <span style="color:#ae81ff">1335</span> | Mass             |
</span></span><span style="display:flex;"><span>|         <span style="color:#ae81ff">21</span> | Msin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>/sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>   |
</span></span><span style="display:flex;"><span>|       <span style="color:#ae81ff">2786</span> | M-R relationship |
</span></span><span style="display:flex;"><span>+------------+------------------+</span></span></code></pre></div>
<p>So okay, apparently you&rsquo;d need to add some more complexity to your queries and additionally check whether the value in <code>pl_bmassj</code> is of type <code>Mass</code> (<em>for <code>pl_massj</code> in <code>ps</code></em>) or <code>Msini</code> (<em>for <code>pl_msinij</code> in <code>ps</code></em>)? And what are the <code>Msin(i)/sin(i)</code> and <code>M-R relationship</code> types? By the way, there is <a href="#missing-values">another issue</a> related to that.</p>
<p>Finally, as you can see, the <code>pl_bmassprov</code> field/column is not a dictionary value but a mere string! Needless to say how that adds to unreliability of querying the data.</p>
<h4 id="calculated-values">Calculated values</h4>
<p>If we query <code>pl_radj</code> for <code>HD 95872 b</code> planet from <code>ps</code> table, then we&rsquo;ll see that out of all publications there is no known value for it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 95872 b&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>+------------+------------+-----------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name    |   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+------------+-----------+--------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">95872</span>   | HD <span style="color:#ae81ff">95872</span> b |       nan | 2017-03      |
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">95872</span>   | HD <span style="color:#ae81ff">95872</span> b |       nan | 2016-02      |
</span></span><span style="display:flex;"><span>+------------+------------+-----------+--------------+</span></span></code></pre></div>
<p>However, if we query the same from the <code>pscomppars</code> table, then suddenly there is a value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_radj, pl_radj_reflink
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> pscomppars
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 95872 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------+------------+-----------+----------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name    |   pl_radj | pl_radj_reflink                                                                              |
</span></span><span style="display:flex;"><span>|------------+------------+-----------+----------------------------------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">95872</span>   | HD <span style="color:#ae81ff">95872</span> b |      1.16 | &lt;a refstr<span style="color:#f92672">=</span>CALCULATED_VALUE href<span style="color:#f92672">=</span>/docs/composite_calc.html target<span style="color:#f92672">=</span>_blank&gt;Calculated Value&lt;/a&gt; |
</span></span><span style="display:flex;"><span>+------------+------------+-----------+----------------------------------------------------------------------------------------------+</span></span></code></pre></div>
<p>which, according to <code>reflink</code>, is a &ldquo;<a href="https://exoplanetarchive.ipac.caltech.edu/docs/composite_calc.html">calculated value</a>&rdquo;, so it is questionable whether one can rely on it or not. And if you&rsquo;d like to exclude &ldquo;calculated values&rdquo; from your results, then apparently you&rsquo;d need to add a (<em>reliable enough</em>) condition for <code>*_reflink</code> fields, which are strings, of course. Oh joy.</p>
<h4 id="missing-values">Missing values</h4>
<p>If we query <code>pl_msinij</code> for <code>HD 10180 d</code> planet from <code>ps</code> table, then we&rsquo;ll get values from two publications:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, pl_msinij, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 10180 d&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>+------------+------------+------------+-------------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name    |   pl_massj |   pl_msinij | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+------------+------------+-------------+--------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">10180</span>   | HD <span style="color:#ae81ff">10180</span> d |        nan |     0.0378  | 2014-09      |
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">10180</span>   | HD <span style="color:#ae81ff">10180</span> d |        nan |     0.03697 | 2011-04      |
</span></span><span style="display:flex;"><span>+------------+------------+------------+-------------+--------------+</span></span></code></pre></div>
<p>So the latest value is <code>0.0378</code> from <code>2014-09</code> publication. But if we query this from <code>pscomppars</code>, then we&rsquo;ll only get <code>0.03697</code> value, which is from <code>2011-04</code> publication, so it is not the latest one available:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_bmassprov, pl_bmassj, pl_bmassj_reflink
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> pscomppars
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 10180 d&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------+------------+----------------+-------------+--------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name    | pl_bmassprov   |   pl_bmassj | pl_bmassj_reflink                                                                                                                    |
</span></span><span style="display:flex;"><span>|------------+------------+----------------+-------------+--------------------------------------------------------------------------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">10180</span>   | HD <span style="color:#ae81ff">10180</span> d | Msin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>/sin<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> |     0.03697 | &lt;a refstr<span style="color:#f92672">=</span>LOVIS_ET_AL__2011 href<span style="color:#f92672">=</span>https://ui.adsabs.harvard.edu/abs/2011A%26A...528A.112L/abstract target<span style="color:#f92672">=</span>ref&gt; Lovis et al. <span style="color:#ae81ff">2011</span> &lt;/a&gt; |
</span></span><span style="display:flex;"><span>+------------+------------+----------------+-------------+--------------------------------------------------------------------------------------------------------------------------------------+</span></span></code></pre></div>
<p>On top of that, the <code>pl_bmassprov</code> says that <code>pl_bmassj</code> is of <code>Msin(i)/sin(i)</code> type, and so if we were looking for the <code>Msini</code> type, then we&rsquo;d miss it. And by the way, if according to <code>pscomppars</code> that is <code>Msin(i)/sin(i)</code> type, then how can one know that this value in <code>ps</code> table is of that type and not of <code>pl_msinij</code>/<code>Msini</code>? Or are <code>Msini</code> and <code>Msin(i)/sin(i)</code> actually the same type? Why then it&rsquo;s two different types in <code>pscomppars</code> table? Argh&hellip;</p>
<p>Okay, now back to general issues with the NASA database.</p>
<h3 id="planetary-data-is-organized-by-publications">Planetary data is organized by publications</h3>
<p>Say you&rsquo;d like to get mass and radius of the <code>Kepler-107 b</code> planet. With PADC service the query will be this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> star_name, granule_uid, mass, radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+-------------+---------------+---------+----------+
</span></span><span style="display:flex;"><span>| star_name   | granule_uid   |    mass |   radius |
</span></span><span style="display:flex;"><span>|-------------+---------------+---------+----------|
</span></span><span style="display:flex;"><span>| Kepler-107  | Kepler-107 b  | 0.01104 |    0.137 |
</span></span><span style="display:flex;"><span>+-------------+---------------+---------+----------+</span></span></code></pre></div>
<p>If you&rsquo;ll try to execute a similar query with NASA service, then all of a sudden you&rsquo;ll get more than one result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, pl_radj
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>+------------+--------------+------------+-----------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name      |   pl_massj |   pl_radj |
</span></span><span style="display:flex;"><span>|------------+--------------+------------+-----------|
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.138 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.142 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.139 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.141 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |    0.01104 |     0.137 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     |
</span></span><span style="display:flex;"><span>+------------+--------------+------------+-----------+</span></span></code></pre></div>
<p>What the hell, right? 13 results instead of just one. Turns out, the data is stored by publications, which can be determined by the <code>pl_pubdate</code> column. Let&rsquo;s add it to the query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>+------------+--------------+------------+-----------+------------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name      |   pl_massj |   pl_radj | pl_pubdate       |
</span></span><span style="display:flex;"><span>|------------+--------------+------------+-----------+------------------|
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2019-03          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |    0.01104 |     0.137 | 2019-02          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.142 | 2018-10          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2018-08-16       |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2017-08-31 00:00 |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2016-07          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.138 | 2016-05          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2015-09-24       |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.141 | 2015-08          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2014-12-18       |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2014-12-04       |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |     0.139 | 2014-03          |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |  nan       |   nan     | 2014-01-08       |
</span></span><span style="display:flex;"><span>+------------+--------------+------------+-----------+------------------+</span></span></code></pre></div>
<p>That is something you need to know about NASA&rsquo;s database, otherwise you might fetch obsolete/inaccurate data for your research.</p>
<p>Furthermore, if you&rsquo;ll need the latest <code>pl_radj</code> value, then you would execute the following query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> TOP <span style="color:#ae81ff">1</span> pl_radj
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span> <span style="color:#66d9ef">AND</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<p>&hellip;you would, but the results will surprise you once again, because NASA&rsquo;s <a href="#top-clause-is-broken">TOP clause is broken</a>!</p>
<p>It becomes especially complicated if you need to get the latest value of a parameter for all the planets in the system. For now, I&rsquo;ve come up with the following CTE (<em><a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/with-common-table-expression-transact-sql">common table expression</a></em>) using ranking:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">WITH</span> latestEntries <span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_radj, pl_pubdate,
</span></span><span style="display:flex;"><span>    ROW_NUMBER() OVER(
</span></span><span style="display:flex;"><span>        PARTITION <span style="color:#66d9ef">BY</span> pl_name <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>, pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> ps <span style="color:#66d9ef">WHERE</span> hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_radj, pl_pubdate <span style="color:#66d9ef">FROM</span> latestEntries <span style="color:#66d9ef">WHERE</span> rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_name)</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>+------------+--------------+-----------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name      |   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+--------------+-----------+--------------|
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 b |     0.137 | 2019-02      |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 c |     0.142 | 2019-02      |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 d |     0.077 | 2019-02      |
</span></span><span style="display:flex;"><span>| Kepler-107 | Kepler-107 e |     0.259 | 2019-02      |
</span></span><span style="display:flex;"><span>+------------+--------------+-----------+--------------+</span></span></code></pre></div>
<p>Looks pretty complex, but I am not sure if there is any other way.</p>
<p>The documentation says that there is <code>default_flag</code> field/column, which you could think to use to query the latest data, but (<em>and I wonder if database maintainers are aware of this</em>) this obviously won&rsquo;t work in case when a planet has its parameters spread across several publications. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, pl_radj, pl_pubdate, default_flag
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HR 8799 b&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>+------------+-----------+------------+-----------+--------------+----------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name   |   pl_massj |   pl_radj | pl_pubdate   |   default_flag |
</span></span><span style="display:flex;"><span>|------------+-----------+------------+-----------+--------------+----------------|
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> b |        nan |     nan   | 2016-08      |              <span style="color:#ae81ff">0</span> |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> b |        nan |     nan   | 2016-03      |              <span style="color:#ae81ff">0</span> |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> b |        nan |       0.6 | 2016-03      |              <span style="color:#ae81ff">0</span> |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> b |          <span style="color:#ae81ff">7</span> |       1.2 | 2008-11      |              <span style="color:#ae81ff">1</span> |
</span></span><span style="display:flex;"><span>+------------+-----------+------------+-----------+--------------+----------------+</span></span></code></pre></div>
<p>So if you trusted blindly the <code>default_flag</code> and took the values from <code>2008-11</code> publication, then you&rsquo;d miss the newer <code>pl_radj</code> value from <code>2016-03</code> publication.</p>
<h3 id="planets-from-the-same-system-have-different-stellar-data">Planets from the same system have different stellar data</h3>
<p>If we take <code>HR 8799</code> system as an example, then its planet <code>HR 8799 b</code> has <code>st_teff</code> value of <code>7204.58</code> from the publication on <code>2016-08</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">WITH</span> latestEntries <span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">SELECT</span> hostname, pl_name, st_teff, pl_pubdate,
</span></span><span style="display:flex;"><span>    ROW_NUMBER() OVER(
</span></span><span style="display:flex;"><span>        PARTITION <span style="color:#66d9ef">BY</span> pl_name <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> st_teff <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>, pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> ps <span style="color:#66d9ef">WHERE</span> hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HR 8799&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, st_teff, pl_pubdate <span style="color:#66d9ef">FROM</span> latestEntries <span style="color:#66d9ef">WHERE</span> rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_name)</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>+------------+-----------+-----------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name   |   st_teff | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+-----------+-----------+--------------|
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> b |   7204.58 | 2016-08      |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> c |   7204.58 | 2016-08      |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> d |   7204.58 | 2016-08      |
</span></span><span style="display:flex;"><span>| HR <span style="color:#ae81ff">8799</span>    | HR <span style="color:#ae81ff">8799</span> e |   <span style="color:#ae81ff">7400</span>    | 2019-03      |
</span></span><span style="display:flex;"><span>+------------+-----------+-----------+--------------+</span></span></code></pre></div>
<p>As this is a stellar parameter, one would expect it to be the same for every planet in the system, but as you can see other planets in that system, such as <code>HR 8799 e</code>, have different values (<em>there also might be no value at all</em>). How to know which one is the right one? Because <code>pl_pubdate</code> filed name implies that it applies to planetary parameters, and there are no <code>host_pubdate</code> or <code>star_pubdate</code> fields in the table.</p>
<p>So we can only assume that <code>pl_pubdate</code> applies to stellar parameters too, and that means that if you are working with just <code>HR 8799 b</code>, and you are not interested in other planets, still you cannot just take <code>7204.58</code> value, you&rsquo;ll need to execute an additional query to get the first not null <code>st_teff</code> value ordered by publication date (<em>yes, also with CTE and ranking, because <a href="#top-clause-is-broken">TOP is broken</a></em>) from all the planets in the system.</p>
<h3 id="no-way-to-get-the-latest-data">No way to get the latest data</h3>
<p>Following the previous issue, there actually seems to be no way to get data from the latest available publication. For instance, on <a href="https://exoplanetarchive.ipac.caltech.edu/overview/HR%208799">this page</a> we can see that this very same <code>HR 8799</code> star has even newer publication from <a href="https://iopscience.iop.org/article/10.3847/1538-3881/abd802/pdf">Swastik et al. 2021</a>, which states <code>st_teff</code> value of <code>7339</code>:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/nasa-hr-8799-st_teff.png" alt="Unavailable st_teff values in NASA database">

<p>How can one get this value from via TAP interface? Or the <code>7376.66</code> value from &ldquo;<em>Gaia DR2</em>&rdquo;, for that matter? Neither of these are available in the <code>ps</code> table. Is there some other table with all the stellar data? And can it be joined with <code>ps</code> table by the <code>hostname</code> or some other identifier? I didn&rsquo;t find answers to that.</p>
<p>Here&rsquo;s another example. If we take <a href="https://exoplanetarchive.ipac.caltech.edu/overview/Kepler-450">Kepler-450</a> system, then web-interface says that the latest publication on <code>Kepler-450 b</code> is <a href="https://ui.adsabs.harvard.edu/abs/2021ApJ...908..114Y/abstract">Yoffe et al. 2021</a>, and there <code>pl_radj</code>, <code>pl_radjerr2</code>, <code>pl_radjerr1</code> have values of <code>0.54272</code> (<code>-0.00020</code>/<code>+0.00020</code>):</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/nasa-kepler-450b-pl_radj.png" alt="Unavailable pl_radj values in NASA database">

<p>But if we&rsquo;ll query those via TAP, then here&rsquo;s what we&rsquo;ll get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_radj, pl_radjerr2, pl_radjerr1, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-450 b&#39;</span> <span style="color:#66d9ef">AND</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>+------------+--------------+-----------+---------------+---------------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name      |   pl_radj |   pl_radjerr2 |   pl_radjerr1 | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+--------------+-----------+---------------+---------------+--------------|
</span></span><span style="display:flex;"><span>| Kepler-450 | Kepler-450 b |     0.543 |        -0     |         <span style="color:#ae81ff">0</span>     | 2020-11      |
</span></span><span style="display:flex;"><span>| Kepler-450 | Kepler-450 b |     0.561 |        -0.026 |         0.036 | 2018-10      |
</span></span><span style="display:flex;"><span>| Kepler-450 | Kepler-450 b |     0.531 |        -0.03  |         0.031 | 2016-05      |
</span></span><span style="display:flex;"><span>| Kepler-450 | Kepler-450 b |     0.548 |        -0.029 |         0.029 | 2015-08      |
</span></span><span style="display:flex;"><span>+------------+--------------+-----------+---------------+---------------+--------------+</span></span></code></pre></div>
<p>So, again, it does not return values from <code>Yoffe et al. 2021</code>, and in fact the latest that it does return is some publication from <code>2020-11</code>, which is not shown via the web-interface and simply is nowhere to find! On top of that, <code>pl_radjerr2</code>/<code>pl_radjerr1</code> have the values of <code>0</code>, like there is no error at all. And it is like that for <code>Kepler-450 c</code> and <code>Kepler-450 d</code> planets too.</p>
<p>So not only you cannot get the latest data (<em>which is available via web-interface</em>), it even may return incorrect values from some unknown publications, messing up your data. A-fucking-mazing, innit.</p>
<h3 id="top-clause-is-broken">TOP clause is broken</h3>
<p>So yeah, here are the radius values for the <code>Kepler-107 b</code> planet by publication date:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>+-----------+------------------+
</span></span><span style="display:flex;"><span>|   pl_radj | pl_pubdate       |
</span></span><span style="display:flex;"><span>|-----------+------------------|
</span></span><span style="display:flex;"><span>|   nan     | 2019-03          |
</span></span><span style="display:flex;"><span>|     0.137 | 2019-02          |
</span></span><span style="display:flex;"><span>|     0.142 | 2018-10          |
</span></span><span style="display:flex;"><span>|   nan     | 2018-08-16       |
</span></span><span style="display:flex;"><span>|   nan     | 2017-08-31 00:00 |
</span></span><span style="display:flex;"><span>|   nan     | 2016-07          |
</span></span><span style="display:flex;"><span>|     0.138 | 2016-05          |
</span></span><span style="display:flex;"><span>|   nan     | 2015-09-24       |
</span></span><span style="display:flex;"><span>|     0.141 | 2015-08          |
</span></span><span style="display:flex;"><span>|   nan     | 2014-12-18       |
</span></span><span style="display:flex;"><span>|   nan     | 2014-12-04       |
</span></span><span style="display:flex;"><span>|     0.139 | 2014-03          |
</span></span><span style="display:flex;"><span>|   nan     | 2014-01-08       |
</span></span><span style="display:flex;"><span>+-----------+------------------+</span></span></code></pre></div>
<p>As you want to get the latest value, that would be the query you&rsquo;d normally execute:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> TOP <span style="color:#ae81ff">1</span> pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span> <span style="color:#66d9ef">AND</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<p>but here are the results that you will actually get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+-----------+--------------+
</span></span><span style="display:flex;"><span>|   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|-----------+--------------|
</span></span><span style="display:flex;"><span>|     0.138 | 2016-05      |
</span></span><span style="display:flex;"><span>+-----------+--------------+</span></span></code></pre></div>
<p>I know, right, why in the ass did it return <code>0.138</code> value from <code>2016-05</code> instead of <code>0.137</code> from <code>2019-02</code>? Go figure!</p>
<p>I sent a detailed bugreport with steps to reproduce the problem to <a href="https://exoplanetarchive.ipac.caltech.edu/cgi-bin/Helpdesk/nph-genTicketForm">their support</a> more than a month ago, but the issue is still not fixed. I did, however, received two e-mails from the support system with notifications that my bugreport is still being processed, so hopefully eventually this will be fixed. And who knows for how long it has been present already (<em>from the very beginning, I imagine</em>)? Could it even be that I&rsquo;m the first one who noticed and/or bothered to report it?</p>
<p>As a workaround one can use the following CTE with ranking:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">WITH</span> latestEntries <span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">SELECT</span> pl_radj, pl_pubdate,
</span></span><span style="display:flex;"><span>    ROW_NUMBER() OVER(
</span></span><span style="display:flex;"><span>        PARTITION <span style="color:#66d9ef">BY</span> pl_name <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">THEN</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">END</span>, pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#66d9ef">AS</span> rank
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> ps <span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-107 b&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_radj, pl_pubdate <span style="color:#66d9ef">FROM</span> latestEntries <span style="color:#66d9ef">WHERE</span> rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+-----------+--------------+
</span></span><span style="display:flex;"><span>|   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|-----------+--------------|
</span></span><span style="display:flex;"><span>|     0.137 | 2019-02      |
</span></span><span style="display:flex;"><span>+-----------+--------------+</span></span></code></pre></div>
<p>Yes, it is overcomplicated, but it works.</p>
<h3 id="missing-uncertainties-columns">Missing uncertainties columns</h3>
<p>Documentation <a href="https://exoplanetarchive.ipac.caltech.edu/docs/API_PS_columns.html">claims</a> that there are uncertainties values for parameters like <code>ra</code>, <code>dec</code>, <code>glat</code>, <code>glon</code> and others:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/nasa-missing-uncertainties.png" alt="NASA, missing uncertainties columns">

<p>However, in reality you will get the following error trying to <code>SELECT</code> them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ORA-00904: <span style="color:#e6db74">&#39;DECERR1&#39;</span>: invalid identifier</span></span></code></pre></div>
<p>And indeed, there are no such columns in the table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column_name</span>, datatype, description
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> tap_schema.columns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ps&#39;</span> <span style="color:#66d9ef">AND</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;ra%&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;dec%&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;glat%&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;glon%&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;elat%&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">column_name</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;elon%&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">column_name</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+------------+--------------------------+
</span></span><span style="display:flex;"><span>| column_name   | datatype   | description              |
</span></span><span style="display:flex;"><span>|---------------+------------+--------------------------|
</span></span><span style="display:flex;"><span>| dec           | double     | Dec <span style="color:#f92672">[</span>decimal<span style="color:#f92672">]</span>            |
</span></span><span style="display:flex;"><span>| elat          | double     | Ecliptic Latitude <span style="color:#f92672">[</span>deg<span style="color:#f92672">]</span>  |
</span></span><span style="display:flex;"><span>| elon          | double     | Ecliptic Longitude <span style="color:#f92672">[</span>deg<span style="color:#f92672">]</span> |
</span></span><span style="display:flex;"><span>| glat          | double     | Galactic Latitude <span style="color:#f92672">[</span>deg<span style="color:#f92672">]</span>  |
</span></span><span style="display:flex;"><span>| glon          | double     | Galactic Longitude <span style="color:#f92672">[</span>deg<span style="color:#f92672">]</span> |
</span></span><span style="display:flex;"><span>| ra            | double     | RA <span style="color:#f92672">[</span>decimal<span style="color:#f92672">]</span>             |
</span></span><span style="display:flex;"><span>+---------------+------------+--------------------------+</span></span></code></pre></div>
<p>Why then they are listed in the documentation?</p>
<h3 id="inconsistent-date-format">Inconsistent date format</h3>
<p>In particular, within <code>pl_pubdate</code> column:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span>(pl_pubdate)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">LENGTH</span>(pl_pubdate) <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">289</span>
</span></span><span style="display:flex;"><span>+------------------+
</span></span><span style="display:flex;"><span>| pl_pubdate       |
</span></span><span style="display:flex;"><span>|------------------|
</span></span><span style="display:flex;"><span>| 2017-08-31 00:00 |
</span></span><span style="display:flex;"><span>| 2014-12-04       |
</span></span><span style="display:flex;"><span>| 2018-08-16       |
</span></span><span style="display:flex;"><span>| 2014-01-08       |
</span></span><span style="display:flex;"><span>| 2015-09-24       |
</span></span><span style="display:flex;"><span>| 2014-12-18       |
</span></span><span style="display:flex;"><span>| 2016-03          |
</span></span><span style="display:flex;"><span>| 2016-05          |
</span></span><span style="display:flex;"><span>| 2019-09          |
</span></span><span style="display:flex;"><span>| 2017-07          |
</span></span><span style="display:flex;"><span>| 2015-11          |
</span></span><span style="display:flex;"><span>| 2024-07          |
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Fucking hell.</p>
<h3 id="float-values-are-rounded-on-select-but-compared-to-originals-in-where">Float values are rounded on SELECT but compared to originals in WHERE</h3>
<p>This was such a shocking discovery when I noticed it <em>more than 2 years</em> after I started fetching data from these services. As it turns out (<em>and this applies not only to NASA, but also to PADC and probably to other services too</em>), float values are returned rounded on <code>SELECT</code>. That would be half of the problem, but NASA went an extra mile here too, and in their database these values are actually used with their full original values in <code>WHERE</code> clauses!</p>
<p>Here&rsquo;s a demonstration. Let&rsquo;s say we&rsquo;d like to get <code>pl_massj</code> value for the <code>KOI-4777.01</code> planet from the NASA database:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-4777.01&#39;</span> <span style="color:#66d9ef">AND</span> pl_massj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------+-------------+------------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name     |   pl_massj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+-------------+------------+--------------|
</span></span><span style="display:flex;"><span>| KOI-4777   | KOI-4777.01 |    0.31212 | 2022-01      |
</span></span><span style="display:flex;"><span>+------------+-------------+------------+--------------+
</span></span></code></pre></div><p>Okay, the value is <code>0.31212</code>. And then some time later we&rsquo;d like to get the publication reference for this value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_refname
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-4777.01&#39;</span> <span style="color:#66d9ef">AND</span> pl_massj <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">31212</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>And that query returns no results! But how is it possible? I have gotten this <code>0.31212</code> value just now, why the comparison in <code>WHERE</code> clause did not succeed?</p>
<p>I&rsquo;ll tell you why: this is because the actual value that is stored in this particular <code>pl_massj</code> field is actually much longer, and what we got on <code>SELECT</code> was just a rounded value, but the comparison in <code>WHERE</code> uses the original non-rounded value, so the query quite naturally fails to find matching results. ÐÑƒ Ñ€Ð°Ð·Ð²Ðµ Ð½Ðµ Ð¿Ð¸Ð·Ð´ÐµÑ†?</p>
<p>But okay, then what is the actual value, how does one get it? I had no idea, so I just tried to cast it to <code>REAL</code> type on <code>SELECT</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, <span style="color:#66d9ef">CAST</span>(pl_massj <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">as</span> pl_massj_real, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-4777.01&#39;</span> <span style="color:#66d9ef">AND</span> pl_massj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------+-------------+------------+--------------------------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name     |   pl_massj |            pl_massj_real | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+-------------+------------+--------------------------+--------------|
</span></span><span style="display:flex;"><span>| KOI-4777   | KOI-4777.01 |    0.31212 |        0.312118104660166 | 2022-01      |
</span></span><span style="display:flex;"><span>+------------+-------------+------------+--------------------------+--------------+
</span></span></code></pre></div><p>And here it is - <code>0.312118104660166</code>! How the hell was one supposed to know that?</p>
<p>Just to make sure, let&rsquo;s now try to get the publication reference again with this &ldquo;new&rdquo; value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_refname
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-4777.01&#39;</span> <span style="color:#66d9ef">AND</span> pl_massj <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">312118104660166</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| pl_refname                                                                                                                                     |
</span></span><span style="display:flex;"><span>|------------------------------------------------------------------------------------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>| &lt;a refstr<span style="color:#f92672">=</span>CA_NTILDE_AS_ET_AL__2022 href<span style="color:#f92672">=</span>https://ui.adsabs.harvard.edu/abs/2022AJ....163....3C/abstract target<span style="color:#f92672">=</span>ref&gt;Ca&amp;ntilde;as et al. 2022&lt;/a&gt; |
</span></span><span style="display:flex;"><span>+------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></code></pre></div><p>Yes, now it did find a matching record.</p>
<p>You might say, but this can&rsquo;t be right, maybe it&rsquo;s the library&rsquo;s fault, so it&rsquo;s <a href="#pyvo">PyVO</a> who does the rounding. I certainly agree that this can&rsquo;t be right, but it is not the PyVO&rsquo;s fault, because here&rsquo;s a bare cURL request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ curl -X <span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#e6db74">&#34;https://exoplanetarchive.ipac.caltech.edu/TAP/sync?REQUEST=doQuery&amp;LANG=ADQL&amp;FORMAT=JSON&amp;QUERY=SELECT%20hostname,%20pl_name,%20pl_massj,%20pl_pubdate%20FROM%20ps%20WHERE%20pl_name%20=%20&#39;KOI-4777.01&#39;%20AND%20pl_massj%20IS%20NOT%20NULL%20ORDER%20BY%20pl_pubdate%20DESC&#34;</span>
</span></span></code></pre></div><p>and here&rsquo;s what it returns:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;hostname&#34;</span>: <span style="color:#e6db74">&#34;KOI-4777&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pl_name&#34;</span>: <span style="color:#e6db74">&#34;KOI-4777.01&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pl_massj&#34;</span>: <span style="color:#ae81ff">0.31212</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pl_pubdate&#34;</span>: <span style="color:#e6db74">&#34;2022-01&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>So it really is the NASA&rsquo;s ADQL backend who returns the rounded <code>0.31212</code> instead of the actual <code>0.312118104660166</code>.</p>
<p>To be entirely fair, NASA does somewhat warn about this, because if you check the data type for this column:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column_name</span>, datatype, format
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> tap_schema.columns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ps&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#66d9ef">column_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;pl_massj&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">column_name</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>+---------------+------------+----------+
</span></span><span style="display:flex;"><span>| column_name   | datatype   | format   |
</span></span><span style="display:flex;"><span>|---------------+------------+----------|
</span></span><span style="display:flex;"><span>| pl_massj      | double     | 8.5f     |
</span></span><span style="display:flex;"><span>| pl_massj      | double     | 8.5f     |
</span></span><span style="display:flex;"><span>+---------------+------------+----------+
</span></span></code></pre></div><p>then you&rsquo;ll see that it is of <code>double</code> type and has the <code>8.5f</code> format, which apparently means that it is rounded to the 5 digits after the comma/dot. So there is that, but firstly, one is supposed to somehow know that one needs to consult with this table first, and secondly, <strong>why the fuck</strong> there are two records here for the same <code>pl_massj</code> column in here?! If you do <code>SELECT *</code>, then you&rsquo;ll see that all other columns in both of these <code>pl_massj</code> records hold the same values, so then why there are two identical records for it?</p>
<p>&hellip;Anyway, like I said in the beginning, the &ldquo;problem&rdquo; of rounded floats is present in PADC database too (<em>although they do not have a <code>format</code> column in their <code>tap_schema.columns</code>, so there is no way to know the rounding precision</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> star_name, granule_uid, mass, <span style="color:#66d9ef">CAST</span>(mass <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">AS</span> mass_real, radius, <span style="color:#66d9ef">CAST</span>(radius <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">AS</span> radius_real
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 219134 b&#39;</span> <span style="color:#66d9ef">AND</span> mass <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">AND</span> radius <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+-------------+---------------+---------+---------------------+--------+--------------------+
</span></span><span style="display:flex;"><span>| star_name   | granule_uid   |    mass |           mass_real | radius |        radius_real |
</span></span><span style="display:flex;"><span>|-------------+---------------+---------+---------------------+--------+--------------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">219134</span>   | HD <span style="color:#ae81ff">219134</span> b   | 0.01343 | 0.01343000028282404 |  0.134 | 0.1340000033378601 |
</span></span><span style="display:flex;"><span>+-------------+---------------+---------+---------------------+--------+--------------------+
</span></span></code></pre></div><p>&hellip;however, this is fine, because unlike NASA they do compare with the same rounded value. Look:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> star_name, granule_uid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> star_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 219134&#39;</span> <span style="color:#66d9ef">AND</span> mass <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01343000028282404</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>so no results when comparing with the actual non-rounded value, because:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> star_name, granule_uid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> star_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;HD 219134&#39;</span> <span style="color:#66d9ef">AND</span> mass <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01343</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+-------------+---------------+
</span></span><span style="display:flex;"><span>| star_name   | granule_uid   |
</span></span><span style="display:flex;"><span>|-------------+---------------|
</span></span><span style="display:flex;"><span>| HD <span style="color:#ae81ff">219134</span>   | HD <span style="color:#ae81ff">219134</span> b   |
</span></span><span style="display:flex;"><span>+-------------+---------------+
</span></span></code></pre></div><p>it compares with the same rounded value that is returned on <code>SELECT</code>. As one would expect! So why isn&rsquo;t it so in NASA database?</p>
<p>Moreover, Gaia database even returns the actual non-rounded values right away, so there is no problem there in the first place:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> mass_flame, <span style="color:#66d9ef">CAST</span>(mass_flame <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">as</span> mass_flame_real, radius_flame, <span style="color:#66d9ef">CAST</span>(radius_flame <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">AS</span> radius_flame_real
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> gaiadr3.astrophysical_parameters
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> source_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">3145754895088191744</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+--------------------+--------------------+--------------------+--------------------+
</span></span><span style="display:flex;"><span>|         mass_flame |    mass_flame_real |       radius_flame |  radius_flame_real |
</span></span><span style="display:flex;"><span>|--------------------+--------------------+--------------------+--------------------|
</span></span><span style="display:flex;"><span>| 0.8714732527732849 | 0.8714732527732849 | 0.9770743250846863 | 0.9770743250846863 |
</span></span><span style="display:flex;"><span>+--------------------+--------------------+--------------------+--------------------+
</span></span></code></pre></div><p>And so what a fucking retarded piece of shit is this NASA database.</p>
<p>I would submit a bugreport to them, but from my experience it is pointless, because I already tried that with one <a href="#top-clause-is-broken">other problem</a> before, and it was never fixed (<em>neither did I get any response</em>).</p>
<h3 id="casting-float-values-to-varchar-drops-the-leading-zero">Casting float values to VARCHAR drops the leading zero</h3>
<p>Yet another thing where NASA&rsquo;s database dropped the ball is how they cast floats to strings. The numbers not less than <code>1</code> are casted fine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: 1.2345
</span></span></span></code></pre></div><p>but numbers that are less than <code>0</code> are casted with dropping the leading <code>0</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: .2345
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: -.2345
</span></span></span></code></pre></div><p>So if you are to cast the floats to <code>VARCHAR</code> instead of <code>REAL</code> to work around <a href="#float-values-are-rounded-on-select-but-compared-to-originals-in-where">that problem</a> with inconsistent values in <code>SELECT</code>/<code>WHERE</code>, then you&rsquo;d be getting different values:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> hostname, pl_name, pl_massj, <span style="color:#66d9ef">CAST</span>(pl_massj <span style="color:#66d9ef">AS</span> REAL) <span style="color:#66d9ef">as</span> pl_massj_real, <span style="color:#66d9ef">CAST</span>(pl_massj <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">30</span>)) <span style="color:#66d9ef">as</span> pl_massj_string, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-4777.01&#39;</span> <span style="color:#66d9ef">AND</span> pl_massj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Results found: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+------------+-------------+----------+-------------------+------------------+--------------+
</span></span><span style="display:flex;"><span>| hostname   | pl_name     | pl_massj |     pl_massj_real |  pl_massj_string | pl_pubdate   |
</span></span><span style="display:flex;"><span>|------------+-------------+----------+-------------------+------------------+--------------|
</span></span><span style="display:flex;"><span>| KOI-4777   | KOI-4777.01 |  0.31212 | 0.312118104660166 | .312118104660166 | 2022-01      |
</span></span><span style="display:flex;"><span>+------------+-------------+----------+-------------------+------------------+--------------+
</span></span></code></pre></div><p>The motherfucking piece of shit. ÐšÐ°Ðº Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑÑ, Ñ Ð¸ Ð±Ð°Ð».</p>
<p>Other databases don&rsquo;t have this issue, for instance here is what you&rsquo;ll get in PADC and Gaia:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: 1.2345
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: 0.2345
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CAST</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">2345</span> <span style="color:#66d9ef">AS</span> VARCHAR(<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- result: -0.2345
</span></span></span></code></pre></div><h2 id="paris-astronomical-data-centre">Paris Astronomical Data Centre</h2>
<p>The PADC database has issues too.</p>
<h3 id="obsolete-data">Obsolete data</h3>
<p>Quite often the data is just obsolete. If you compare mass, radius and other parameters for the same planets in PADC and then in NASA, you&rsquo;ll see that PADC data lags behind (<em>with years of delay</em>).</p>
<p>Let&rsquo;s take <code>Kepler-11 d</code> planet as an example. Here are its mass and radius from PADC:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-11 d&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+--------+----------+
</span></span><span style="display:flex;"><span>| granule_uid   |   mass |   radius |
</span></span><span style="display:flex;"><span>|---------------+--------+----------|
</span></span><span style="display:flex;"><span>| Kepler-11 d   |  0.023 |    0.278 |
</span></span><span style="display:flex;"><span>+---------------+--------+----------+</span></span></code></pre></div>
<p>and here are its mass and radius from NASA:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_name, pl_massj, pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-11 d&#39;</span> <span style="color:#66d9ef">AND</span> (pl_massj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">OR</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+-------------+------------+-----------+--------------+
</span></span><span style="display:flex;"><span>| pl_name     |   pl_massj |   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|-------------+------------+-----------+--------------|
</span></span><span style="display:flex;"><span>| Kepler-11 d |   nan      |     0.3   | 2018-10      |
</span></span><span style="display:flex;"><span>| Kepler-11 d |     0.0214 |     0.294 | 2017-07      |
</span></span><span style="display:flex;"><span>| Kepler-11 d |   nan      |     0.301 | 2016-05      |
</span></span><span style="display:flex;"><span>| Kepler-11 d |     0.0228 |   nan     | 2014-08      |
</span></span><span style="display:flex;"><span>| Kepler-11 d |     0.021  |     0.265 | 2014-05      |
</span></span><span style="display:flex; background-color:#3c3d38"><span>| Kepler-11 d |     0.023  |     0.278 | 2013-06      |
</span></span><span style="display:flex;"><span>| Kepler-11 d |     0.019  |     0.306 | 2011-02      |
</span></span><span style="display:flex;"><span>+-------------+------------+-----------+--------------+</span></span></code></pre></div>
<p>So what PADC has is the data from <code>2013-06</code> publication, while there were at least 5 new publications with updated data since then!</p>
<p>Here&rsquo;s another example - planet <code>Kepler-10 b</code>. Data from PADC:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, radius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-10 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+--------+----------+
</span></span><span style="display:flex;"><span>| granule_uid   |   mass |   radius |
</span></span><span style="display:flex;"><span>|---------------+--------+----------|
</span></span><span style="display:flex;"><span>| Kepler-10 b   | 0.0145 |    0.132 |
</span></span><span style="display:flex;"><span>+---------------+--------+----------+</span></span></code></pre></div>
<p>and data from NASA:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_name, pl_massj, pl_radj, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-10 b&#39;</span> <span style="color:#66d9ef">AND</span> (pl_massj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">OR</span> pl_radj <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+-------------+------------+-----------+--------------+
</span></span><span style="display:flex;"><span>| pl_name     |   pl_massj |   pl_radj | pl_pubdate   |
</span></span><span style="display:flex;"><span>|-------------+------------+-----------+--------------|
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.01123 |     0.133 | 2019-09      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |  nan       |     0.133 | 2018-10      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.01019 |   nan     | 2017-10      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |  nan       |     0.135 | 2016-05      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.0117  |     0.131 | 2016-03      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |  nan       |     0.131 | 2015-08      |
</span></span><span style="display:flex; background-color:#3c3d38"><span>| Kepler-10 b |    0.0145  |     0.132 | 2015-05      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.01    |     0.131 | 2014-07      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.01447 |     0.13  | 2014-02      |
</span></span><span style="display:flex;"><span>| Kepler-10 b |    0.014   |     0.126 | 2011-03      |
</span></span><span style="display:flex;"><span>+-------------+------------+-----------+--------------+</span></span></code></pre></div>
<p>Again, PADC&rsquo;s data is from <code>2015-05</code>, and since then there were at least 6 new publications with updated data!</p>
<p>There are many planets whose data is like that in PADC. To make things worse, there is no way to determine in automated manner how old the data in PADC is, because it doesn&rsquo;t have a field similar to NASA&rsquo;s <code>pl_pubdate</code>. There are <code>updated</code> and <code>modification_date</code> fields, which look promising, but here&rsquo;s what they return for the <code>Kepler-10 b</code> planet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, radius, updated, modification_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-10 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+--------+----------+-----------+---------------------+
</span></span><span style="display:flex;"><span>| granule_uid   |   mass |   radius | updated   | modification_date   |
</span></span><span style="display:flex;"><span>|---------------+--------+----------+-----------+---------------------|
</span></span><span style="display:flex;"><span>| Kepler-10 b   | 0.0145 |    0.132 |           | 2021-02-05T07:00:00 |
</span></span><span style="display:flex;"><span>+---------------+--------+----------+-----------+---------------------+</span></span></code></pre></div>
<p>So <code>updated</code> is just empty, and <code>modification_date</code> states a date that is later than the latest <code>pl_pubdate</code> from NASA, but still PADC stores values that have been obsolete for several years, so you cannot rely on this field either.</p>
<h3 id="untrustworthy-data">Untrustworthy data</h3>
<p>With <a href="http://exoplanet.eu/catalog/k2-266_b/">K2-266 b</a> planet as an example, there is mass value of <code>0.0355</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;K2-266 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+--------+
</span></span><span style="display:flex;"><span>| granule_uid   |   mass |
</span></span><span style="display:flex;"><span>|---------------+--------|
</span></span><span style="display:flex;"><span>| K2-266 b      | 0.0355 |
</span></span><span style="display:flex;"><span>+---------------+--------+</span></span></code></pre></div>
<p>but there is no referred article, so it is unknown where this value originates from.</p>
<p>If we query the same data from NASA, then it returns null/nan, which is correct, as there is no publication stating this mass:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_name, pl_massj
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;K2-266 b&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+-----------+------------+
</span></span><span style="display:flex;"><span>| pl_name   |   pl_massj |
</span></span><span style="display:flex;"><span>|-----------+------------|
</span></span><span style="display:flex;"><span>| K2-266 b  |        nan |
</span></span><span style="display:flex;"><span>+-----------+------------+</span></span></code></pre></div>
<p>So where did PADC got the <code>0.0355</code> value from?</p>
<p>Or here&rsquo;s another example, with <a href="http://exoplanet.eu/catalog/kepler-167_e/">Kepler-167 e</a> planet. This one does have a <a href="https://arxiv.org/pdf/1603.00042.pdf">source article</a>, but in there it&rsquo;s only a theory that this planet mass might be in a range from 0.3 to 50 mass of Jupiter, and yet PADC states that the mass is <code>4.0</code> (<em>why on earth exactly <code>4.0</code>?</em>) with the error of <code>-3.7</code>/<code>+46.0</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid, mass, mass_error_min, mass_error_max
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> granule_uid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-167 e&#39;</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+--------+------------------+------------------+
</span></span><span style="display:flex;"><span>| granule_uid   |   mass |   mass_error_min |   mass_error_max |
</span></span><span style="display:flex;"><span>|---------------+--------+------------------+------------------|
</span></span><span style="display:flex;"><span>| Kepler-167 e  |      <span style="color:#ae81ff">4</span> |              3.7 |               <span style="color:#ae81ff">46</span> |
</span></span><span style="display:flex;"><span>+---------------+--------+------------------+------------------+</span></span></code></pre></div>
<p>Here&rsquo;s what NASA has for this planet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_name, pl_massj, pl_massjerr2, pl_massjerr1, pl_pubdate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pl_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kepler-167 e&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_pubdate <span style="color:#66d9ef">DESC</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+--------------+------------+----------------+----------------+------------------+
</span></span><span style="display:flex;"><span>| pl_name      |   pl_massj |   pl_massjerr2 |   pl_massjerr1 | pl_pubdate       |
</span></span><span style="display:flex;"><span>|--------------+------------+----------------+----------------+------------------|
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2019-03          |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2018-10          |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2018-08-16       |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2017-08-31 00:00 |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2016-04          |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2014-12-18       |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2014-12-04       |
</span></span><span style="display:flex;"><span>| Kepler-167 e |        nan |            nan |            nan | 2014-01-08       |
</span></span><span style="display:flex;"><span>+--------------+------------+----------------+----------------+------------------+</span></span></code></pre></div>
<p>null/nan values for mass and errors, as it should be, because neither of the publications states these values.</p>
<h3 id="different-names-for-star-and-planets">Different names for star and planets</h3>
<p>In NASA database there is a system <a href="https://exoplanetarchive.ipac.caltech.edu/overview/Kepler-89">Kepler-89</a>. It&rsquo;s a binary system, meaning that it has 2 stars, <code>Kepler-89 B</code> and <code>KOI-94</code>:</p>


    <img class="image-post" loading="lazy" src="/blog/2022/02/26/astronomy-databases-tap-adql/images/nasa-binary-system.png" alt="Binary system in NASA" style="border:1px solid black;">

<p>If you query planets from <code>KOI-94</code> system in NASA database, then you&rsquo;ll get this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pl_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> ps
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-94&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> pl_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> pl_name</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+-----------+
</span></span><span style="display:flex;"><span>| pl_name   |
</span></span><span style="display:flex;"><span>|-----------|
</span></span><span style="display:flex;"><span>| KOI-94 b  |
</span></span><span style="display:flex;"><span>| KOI-94 c  |
</span></span><span style="display:flex;"><span>| KOI-94 d  |
</span></span><span style="display:flex;"><span>| KOI-94 e  |
</span></span><span style="display:flex;"><span>+-----------+</span></span></code></pre></div>
<p>But if you query the same from PADC:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> granule_uid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> exoplanet.epn_core
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> star_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KOI-94&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> granule_uid</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>+---------------+
</span></span><span style="display:flex;"><span>| granule_uid   |
</span></span><span style="display:flex;"><span>|---------------|
</span></span><span style="display:flex;"><span>| Kepler-89 b   |
</span></span><span style="display:flex;"><span>| Kepler-89 c   |
</span></span><span style="display:flex;"><span>| Kepler-89 d   |
</span></span><span style="display:flex;"><span>| Kepler-89 e   |
</span></span><span style="display:flex;"><span>+---------------+</span></span></code></pre></div>
<p>then all of the sudden the planets names are different. Wut.</p>
<p>And so if you&rsquo;ll want to cross-check or enrich the data you got from one database with the data from another, you&rsquo;ll need to keep in mind that that the planets might have different names there. For automated processing that means that you&rsquo;ll need to keep a list of such mismatches to map names between databases (<em>as if you didn&rsquo;t have enough things to worry about already</em>).</p>
<h2 id="simbad">SIMBAD</h2>
<h3 id="does-not-support-cast">Does not support CAST</h3>
<p>Yeah, you cannot use <code>CAST</code> in SIMBAD ADQL queries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>Incorrect ADQL query:  Encountered <span style="color:#e6db74">&#34;CAST&#34;</span>. Was expecting one <span style="color:#66d9ef">of</span>: <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#e6db74">&#34;+&#34;</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#f92672">&lt;</span>QUANTIFIER<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;TOP&#34;</span> <span style="color:#e6db74">&#34;AVG&#34;</span> <span style="color:#e6db74">&#34;MAX&#34;</span> <span style="color:#e6db74">&#34;MIN&#34;</span> <span style="color:#e6db74">&#34;SUM&#34;</span> <span style="color:#e6db74">&#34;COUNT&#34;</span> <span style="color:#e6db74">&#34;BOX&#34;</span> <span style="color:#e6db74">&#34;CENTROID&#34;</span> <span style="color:#e6db74">&#34;CIRCLE&#34;</span> <span style="color:#e6db74">&#34;POINT&#34;</span> <span style="color:#e6db74">&#34;POLYGON&#34;</span> <span style="color:#e6db74">&#34;REGION&#34;</span> <span style="color:#e6db74">&#34;CONTAINS&#34;</span> <span style="color:#e6db74">&#34;INTERSECTS&#34;</span> <span style="color:#e6db74">&#34;AREA&#34;</span> <span style="color:#e6db74">&#34;COORD1&#34;</span> <span style="color:#e6db74">&#34;COORD2&#34;</span> <span style="color:#e6db74">&#34;COORDSYS&#34;</span> <span style="color:#e6db74">&#34;DISTANCE&#34;</span> <span style="color:#e6db74">&#34;ABS&#34;</span> <span style="color:#e6db74">&#34;CEILING&#34;</span> <span style="color:#e6db74">&#34;DEGREES&#34;</span> <span style="color:#e6db74">&#34;EXP&#34;</span> <span style="color:#e6db74">&#34;FLOOR&#34;</span> <span style="color:#e6db74">&#34;LOG&#34;</span> <span style="color:#e6db74">&#34;LOG10&#34;</span> <span style="color:#e6db74">&#34;MOD&#34;</span> <span style="color:#e6db74">&#34;PI&#34;</span> <span style="color:#e6db74">&#34;POWER&#34;</span> <span style="color:#e6db74">&#34;RADIANS&#34;</span> <span style="color:#e6db74">&#34;RAND&#34;</span> <span style="color:#e6db74">&#34;ROUND&#34;</span> <span style="color:#e6db74">&#34;SQRT&#34;</span> <span style="color:#e6db74">&#34;TRUNCATE&#34;</span> <span style="color:#e6db74">&#34;ACOS&#34;</span> <span style="color:#e6db74">&#34;ASIN&#34;</span> <span style="color:#e6db74">&#34;ATAN&#34;</span> <span style="color:#e6db74">&#34;ATAN2&#34;</span> <span style="color:#e6db74">&#34;COS&#34;</span> <span style="color:#e6db74">&#34;COT&#34;</span> <span style="color:#e6db74">&#34;SIN&#34;</span> <span style="color:#e6db74">&#34;TAN&#34;</span> <span style="color:#e6db74">&#34;\&#39;&#34;</span> <span style="color:#f92672">&lt;</span>SCIENTIFIC_NUMBER<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>UNSIGNED_FLOAT<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>UNSIGNED_INTEGER<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;\&#34;&#34; &lt;REGULAR_IDENTIFIER_CANDIDATE&gt; &lt;REGULAR_IDENTIFIER_CANDIDATE&gt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>(HINT: <span style="color:#e6db74">&#34;CAST&#34;</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">not</span> supported <span style="color:#66d9ef">in</span> ADQL, but <span style="color:#66d9ef">is</span> however a reserved word. <span style="color:#66d9ef">To</span> use it <span style="color:#66d9ef">as</span> a <span style="color:#66d9ef">column</span><span style="color:#f92672">/</span><span style="color:#66d9ef">table</span><span style="color:#f92672">/</span><span style="color:#66d9ef">schema</span> name<span style="color:#f92672">/</span><span style="color:#66d9ef">alias</span>, <span style="color:#66d9ef">write</span> it <span style="color:#66d9ef">between</span> double quotes.)
</span></span></code></pre></div><h3 id="some-problems-with-strings">Some problems with strings</h3>
<p>There are some strange problems with with queries that are using <code>main_ID</code> column in <code>WHERE</code> clause, for instance this query returns no results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SZ  77&#39;</span>
</span></span></code></pre></div><p>If anything, yes, those are two spaces in the identifier. Here&rsquo;s also a <a href="https://simbad.cds.unistra.fr/simbad/sim-tap/?txtQuery=SELECT+oid,+main_ID+FROM+basic+WHERE+main_ID+=+'SZ++77'">pre-filled query</a> on the CDS/SIMBAD website.</p>
<p>But if I replace <code>=</code> with <code>LIKE</code>, then the query does return a result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;SZ  77&#39;</span>
</span></span></code></pre></div><p>So for some reason a wildcard (<em>even though there is no actual wildcard pattern here</em>) query with <code>LIKE</code> does find a match, but an explicit <code>=</code> does not. What the fucking fuck!</p>
<p>It can also be reproduced with <code>SZ  66</code> identifier, so explicit query returns no results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SZ  66&#39;</span>
</span></span></code></pre></div><p>but wildcard query does return a result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;SZ  66&#39;</span>
</span></span></code></pre></div><p>So far I&rsquo;ve only noticed this issue with the IDs that start with <code>SZ  *</code> pattern, but there might be more problematic identifiers like this. What&rsquo;s common among these identifiers is that they all have two spaces, so maybe that is part of the problem somehow?</p>
<p>I&rsquo;ve reported all that to <a href="mailto:cds-question@unistra.fr">cds-question@unistra.fr</a> (<em>on 2025-12-13</em>), and while I was waiting for a response, I had to implement an <a href="https://github.com/retifrav/phab-utils/commit/7d1d41fc9f78d549ea4cb6b06cd3ecf28a6c1610">crutched workaround</a> in one of my other projects. In about a month (<em>on 2026-01-07</em>) they did reply and said the following:</p>
<blockquote>Those identifiers were not encoded correctly in the database, because, it should have been written "Sz" and not "SZ". Anyway, it is working better now.</blockquote>
<p>That does not sound exactly trustworthy or at the very least there might be something else to it, because I can almost swear that I did try the <code>Sz</code> (<em>small <code>z</code></em>) identifiers too, and it did not make any difference back then. But okay, something was indeed &ldquo;fixed&rdquo;, because now a query with strict <code>=</code> operator works fine (<em>with small <code>z</code>, like they said</em>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Sz  66&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>+---------+-----------+
</span></span><span style="display:flex;"><span>|     oid | main_id   |
</span></span><span style="display:flex;"><span>|---------+-----------|
</span></span><span style="display:flex;"><span>| 2325762 | Sz  66    |
</span></span><span style="display:flex;"><span>+---------+-----------+
</span></span></code></pre></div><p>But a query with capital <code>Z</code> works too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SZ  66&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>+---------+-----------+
</span></span><span style="display:flex;"><span>|     oid | main_id   |
</span></span><span style="display:flex;"><span>|---------+-----------|
</span></span><span style="display:flex;"><span>| 2325762 | Sz  66    |
</span></span><span style="display:flex;"><span>+---------+-----------+
</span></span></code></pre></div><p>which means that string comparison is case-insensitive (<em>is it a common thing in SQL databases?</em>), however this case-insensitivity isn&rsquo;t the same for <code>LIKE</code> queries, because a query with small <code>z</code> finds the result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;Sz  66&#39;</span>
</span></span></code></pre></div><p>but a query with capital <code>Z</code> does not:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;SZ  66&#39;</span>
</span></span></code></pre></div><p>There are some other (<em>new?</em>) problems too, for instance database does not seem to care about the number of whitespace characters in the identifier - all of the following queries do return the same result, while only one should (<em>the one with 2 whitespace characters</em>), since it is a strict <code>=</code> operator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- WHERE main_ID = &#39;Sz 66&#39; -- one space, should not find the result, but it does
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Sz  66&#39;</span> <span style="color:#75715e">-- two spaces, correct
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- WHERE main_ID = &#39;Sz   66&#39; -- three spaces, should not find the result, but it does
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- WHERE main_ID = &#39;Sz     66&#39; -- five spaces, should not find the result, but it does
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- WHERE main_ID = &#39;Sz          66&#39; -- ten spaces, should not find the result, but it does
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- ...
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>+---------+-----------+
</span></span><span style="display:flex;"><span>|     oid | main_id   |
</span></span><span style="display:flex;"><span>|---------+-----------|
</span></span><span style="display:flex;"><span>| 2325762 | Sz  66    |
</span></span><span style="display:flex;"><span>+---------+-----------+
</span></span></code></pre></div><p>Finally, a wildcard <code>LIKE</code> query with capital <code>Z</code> also does return a result, and the returned value is different from all the previous queries mentioned above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> oid, main_ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> basic
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> main_ID <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;SZ%66&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>+---------+-------------+
</span></span><span style="display:flex;"><span>|     oid | main_id     |
</span></span><span style="display:flex;"><span>|---------+-------------|
</span></span><span style="display:flex;"><span>| 2173332 | SZ   II  66 |
</span></span><span style="display:flex;"><span>+---------+-------------+
</span></span></code></pre></div><p>&hellip;although this one might not be an error, if they do in fact have this other object with a different identifier (<em>even though it looks awefully similar</em>).</p>
<p>I&rsquo;ve reported all these new findings back to them (<em>on 2026-01-09</em>).</p>
<h2 id="overall">Overall</h2>
<p>It is rather concerning that being a astronomer / planetary scientist you don&rsquo;t have a reliable source of data about stars and planets.</p>
<p>Why there is more than one database about space objects, each containing intersecting/overlapping data? Why it is not one common database instead, why the efforts are spread around on several databases?</p>
<p>Why these databases have different numbers of stars and planets, and more importantly why do they have different data about the same stars and planets? How can a researcher know which one to use, which one has the most recent / trustworthy data? Why there is no common agreement about naming, since different databases have different names/identifiers for the same objects?</p>
<p>Ð”Ð°, Ñ Ñ‚Ð°ÐºÐ¸Ð¼Ð¸ Ð±Ð°Ð·ÑƒÐ»ÑÐ¼Ð¸ Ð½Ð°Ð¼ Ð½Ðµ Ð»ÐµÑ‚Ð°Ñ‚ÑŒ Ðº Ð´Ð°Ð»Ñ‘ÐºÐ¾Ð¼Ñƒ ÐºÐ¾ÑÐ¼Ð¾ÑÑƒ.</p>
<p>On the bright side though, having at least these databases free to use for any researcher is tremendously better than having closed/private databases or no databases at all. And hopefully the problems that I described in the article will eventually get fixed/resolved. Although I don&rsquo;t find it reassuring that I have never got a response to most of the bugreports that I have submitted over the years.</p>
      </div>
    </article>
    <div><div id="tags">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://retifrav.github.io/tags/science/">science</a><a class="tag" href="https://retifrav.github.io/tags/python/">python</a><a class="tag" href="https://retifrav.github.io/tags/mestuff/">mestuff</a></div><hr class="comments-divider"/>
      <div id="comments">
      
          <div style="border:2px orange solid; background-color: floralwhite; border-radius:0.5rem; padding: 10px 14px; font-style:italic; font-size:0.9em;">
              If you'd like to comment the article, you can do it on the
              <a href="https://decovar.dev/blog/2022/02/26/astronomy-databases-tap-adql/#remark42" style="font-weight:bold;">
                  original website</a>. This one is just a mirror without comments.
          </div>
      
      </div>
    </div>
  </div>

  
        <div id="footer">
          <div>
              2014 - 2026,
              <a href="/about/">retif</a>
          </div>
          <div><a href="/about/#licenses">CC BY-SA 4.0 / GPLv3</a></div>
        </div>
      </main>
      <div class="app-header">
        <div style="margin:0 0 20px;">
            <input id="search-query" placeholder="Search in titles and summaries" />
        </div>
        <div id="search-results" style="display:none;"></div>
        <div id="sidebars">
            <a id="avatar" href="/about"><img class="app-header-avatar" src="/images/avatar.png" /></a>
            <iframe src="https://github.com/sponsors/retifrav/button"
                height="35" style="border:0;"
                title="You can sponsor me">
            </iframe>
            
            <div class="sidebar-section">
              <h3>Feeds</h3>
              <div class="sidebar-row">
                <a href="/index.xml" title="Subscribe to RSS">
                  <img src="/images/rss.png" class="sidebar-row-icon">
                </a>
                
                <a href="https://t.me/decovar" title="Telegram channel">
                  <img src="/images/telegram.png" class="sidebar-row-icon">
                </a>
              </div>
            </div>
            
            
            
            <div class="sidebar-section">
              <h3>Tags</h3>
              <ul style="list-style-type:none; padding:0; margin:0;">
                  
                  <li><a href="/tags/web">web (68)</a></li>
                  
                  <li><a href="/tags/fail">fail (40)</a></li>
                  
                  <li><a href="/tags/dotnet">dotnet (38)</a></li>
                  
                  <li><a href="/tags/qt">qt (35)</a></li>
                  
                  <li><a href="/tags/linux">linux (28)</a></li>
                  
                  <li><a href="/tags/review">review (28)</a></li>
                  
                  <li><a href="/tags/devops">devops (23)</a></li>
                  
                  <li><a href="/tags/macos">macos (23)</a></li>
                  
                  <li><a href="/tags/windows">windows (19)</a></li>
                  
                  <li><a href="/tags/mestuff">mestuff (17)</a></li>
                  
                  <li><a href="/tags/movies">movies (15)</a></li>
                  
                  <li><a href="/tags/norway">norway (15)</a></li>
                  
                  <li><a href="/tags/tractor">tractor (15)</a></li>
                  
                  <li><a href="/tags/cpp">cpp (13)</a></li>
                  
                  <li><a href="/tags/cmake">cmake (12)</a></li>
                  
                  <li><a href="/tags/irl">irl (12)</a></li>
                  
                  <li><a href="/tags/python">python (12)</a></li>
                  
                  <li><a href="/tags/telegram">telegram (12)</a></li>
                  
                  <li><a href="/tags/embedded">embedded (11)</a></li>
                  
                  <li><a href="/tags/soft">soft (10)</a></li>
                  
                  <li><a href="/tags/travel">travel (10)</a></li>
                  
                  <li><a href="/tags/applescript">applescript (9)</a></li>
                  
                  <li><a href="/tags/piracy">piracy (9)</a></li>
                  
                  <li><a href="/tags/ios">ios (8)</a></li>
                  
                  <li><a href="/tags/octopress">octopress (8)</a></li>
                  
                  <li><a href="/tags/apple">apple (7)</a></li>
                  
                  <li><a href="/tags/banks">banks (7)</a></li>
                  
                  <li><a href="/tags/games">games (7)</a></li>
                  
                  <li><a href="/tags/javascript">javascript (6)</a></li>
                  
                  <li><a href="/tags/photo">photo (6)</a></li>
                  
                  <li><a href="/tags/sql">sql (6)</a></li>
                  
                  <li><a href="/tags/russia">russia (5)</a></li>
                  
                  <li><a href="/tags/android">android (4)</a></li>
                  
                  <li><a href="/tags/hugo">hugo (4)</a></li>
                  
                  <li><a href="/tags/usa">usa (4)</a></li>
                  
                  <li><a href="/tags/wordpress">wordpress (4)</a></li>
                  
                  <li><a href="/tags/azure">azure (3)</a></li>
                  
                  <li><a href="/tags/tv">tv (3)</a></li>
                  
                  <li><a href="/tags/privacy">privacy (2)</a></li>
                  
                  <li><a href="/tags/steam-deck">steam-deck (2)</a></li>
                  
                  <li><a href="/tags/tvos">tvos (2)</a></li>
                  
                  <li><a href="/tags/unsolved">unsolved (2)</a></li>
                  
                  <li><a href="/tags/books">books (1)</a></li>
                  
                  <li><a href="/tags/ffmpeg">ffmpeg (1)</a></li>
                  
                  <li><a href="/tags/home-automation">home-automation (1)</a></li>
                  
                  <li><a href="/tags/ldap">ldap (1)</a></li>
                  
                  <li><a href="/tags/music">music (1)</a></li>
                  
                  <li><a href="/tags/science">science (1)</a></li>
                  
                  <li><a href="/tags/vr">vr (1)</a></li>
                  
              </ul>
            </div>
        </div>
      </header>
    </div>

    <script src="/js/search.js"></script>

    
    

    <script>
        
        window.onload = () =>
        {
            
            
            
            
            
            
            
            
            
            
            
        }
    </script>

    
    
  </body>
</html>
